{"file_contents":{"app/models/__init__.py":{"content":"\"\"\"\nDatabase models for the Hack Club Dashboard application.\nAll models are imported here for easy access and to ensure proper SQLAlchemy relationships.\n\"\"\"\n\n# Import all models so SQLAlchemy can track relationships\nfrom app.models.user import User, Role, Permission, RolePermission, UserRole, AuditLog\nfrom app.models.auth import APIKey, OAuthApplication, OAuthToken, OAuthAuthorizationCode\nfrom app.models.club import Club, ClubMembership, ClubCosmetic, MemberCosmetic\nfrom app.models.club_content import ClubPost, ClubAssignment, ClubMeeting, ClubResource, ClubProject\nfrom app.models.slack import ClubSlackSettings\nfrom app.models.chat import ClubChatMessage\nfrom app.models.attendance import AttendanceSession, AttendanceRecord, AttendanceGuest\nfrom app.models.economy import ClubTransaction, ProjectSubmission, WeeklyQuest, ClubQuestProgress, LeaderboardExclusion\nfrom app.models.gallery import GalleryPost\nfrom app.models.system import SystemSettings, StatusIncident, StatusUpdate\nfrom app.models.shop import ShopItem, Order\n\n# Import helper functions\nfrom app.models.user import create_audit_log, initialize_rbac_system, migrate_existing_users_to_rbac\nfrom app.models.economy import create_club_transaction, get_current_week_start, update_quest_progress\n\n__all__ = [\n    # User models\n    'User', 'Role', 'Permission', 'RolePermission', 'UserRole', 'AuditLog',\n    # Auth models\n    'APIKey', 'OAuthApplication', 'OAuthToken', 'OAuthAuthorizationCode',\n    # Club models\n    'Club', 'ClubMembership', 'ClubCosmetic', 'MemberCosmetic',\n    # Club content models\n    'ClubPost', 'ClubAssignment', 'ClubMeeting', 'ClubResource', 'ClubProject',\n    # Integration models\n    'ClubSlackSettings',\n    # Chat models\n    'ClubChatMessage',\n    # Attendance models\n    'AttendanceSession', 'AttendanceRecord', 'AttendanceGuest',\n    # Economy models\n    'ClubTransaction', 'ProjectSubmission', 'WeeklyQuest', 'ClubQuestProgress', 'LeaderboardExclusion',\n    # Gallery models\n    'GalleryPost',\n    # System models\n    'SystemSettings', 'StatusIncident', 'StatusUpdate',\n    # Shop models\n    'ShopItem', 'Order',\n    # Helper functions\n    'create_audit_log', 'initialize_rbac_system', 'migrate_existing_users_to_rbac',\n    'create_club_transaction', 'get_current_week_start', 'update_quest_progress',\n]\n","size_bytes":2303},"static/js/dash.js":{"content":"// Global variables\nlet clubId = '';\nlet joinCode = '';\n\n// Initialize the application when DOM is ready\ndocument.addEventListener('DOMContentLoaded', function() {\n\n    // Get the club ID and join code from data attributes\n    const dashboardElement = document.querySelector('.club-dashboard');\n    if (dashboardElement) {\n        clubId = dashboardElement.dataset.clubId || '';\n        joinCode = dashboardElement.dataset.joinCode || '';\n    }\n\n    // Removed welcome toast since notifications are working\n\n    // Initialize navigation\n    initNavigation();\n\n    // Load initial data if club ID exists\n    if (clubId) {\n        loadInitialData();\n        loadQuestData();\n    }\n\n    // Setup settings form handler\n    setupSettingsForm();\n\n    // Initialize dashboard when page loads\n    initializeMemberSearch();\n});\n\n// Member search functionality\nfunction initializeMemberSearch() {\n    const searchInput = document.getElementById('membersSearchInput');\n    if (searchInput) {\n        searchInput.addEventListener('input', function() {\n            filterMembers(this.value);\n        });\n        console.log('Member search initialized successfully');\n    } else {\n        console.log('Member search input not found, retrying...');\n        // Retry after a short delay in case the DOM isn't ready\n        setTimeout(initializeMemberSearch, 100);\n    }\n}\n\nfunction filterMembers(searchTerm) {\n    const memberCards = document.querySelectorAll('.member-card');\n    const normalizedSearch = searchTerm.toLowerCase().trim();\n    \n    console.log('Filtering members with search term:', searchTerm);\n    console.log('Found member cards:', memberCards.length);\n\n    memberCards.forEach(card => {\n        const memberName = card.querySelector('.member-name')?.textContent?.toLowerCase() || '';\n        const memberEmail = card.querySelector('.member-email')?.textContent?.toLowerCase() || '';\n\n        const matchesSearch = memberName.includes(normalizedSearch) || \n                            memberEmail.includes(normalizedSearch);\n\n        if (matchesSearch || normalizedSearch === '') {\n            card.style.display = '';\n            card.style.animation = 'fadeInScale 0.3s ease-out';\n        } else {\n            card.style.display = 'none';\n        }\n    });\n\n    // Show \"no results\" message if no members are visible\n    const visibleCards = Array.from(memberCards).filter(card => card.style.display !== 'none');\n    const membersList = document.querySelector('.members-list');\n\n    // Remove existing no results message\n    const existingMessage = membersList.querySelector('.no-search-results');\n    if (existingMessage) {\n        existingMessage.remove();\n    }\n\n    if (visibleCards.length === 0 && normalizedSearch !== '') {\n        const noResultsDiv = document.createElement('div');\n        noResultsDiv.className = 'no-search-results empty-state';\n        noResultsDiv.innerHTML = `\n            <i class=\"fas fa-search\"></i>\n            <h3>No members found</h3>\n            <p>No members match your search for \"${searchTerm}\"</p>\n        `;\n        membersList.appendChild(noResultsDiv);\n    }\n}\n\n// Setup settings form handler\nfunction setupSettingsForm() {\n    const settingsForm = document.getElementById('clubSettingsForm');\n    if (settingsForm) {\n        // Remove any existing listeners to prevent duplicates\n        const newForm = settingsForm.cloneNode(true);\n        settingsForm.parentNode.replaceChild(newForm, settingsForm);\n\n        newForm.addEventListener('submit', function(e) {\n            e.preventDefault();\n\n            const clubName = document.getElementById('clubName').value;\n            const clubDescription = document.getElementById('clubDescription').value;\n            const clubLocation = document.getElementById('clubLocation').value;\n\n            if (!clubId) {\n                showToast('error', 'Cannot update settings: Club ID is missing.', 'Error');\n                return;\n            }\n\n            updateClubSettings(clubName, clubDescription, clubLocation);\n        });\n    }\n}\n\n// Utility function to safely escape HTML\nfunction escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\n// Utility function to create DOM elements safely\nfunction createElement(tag, className = '', textContent = '') {\n    const element = document.createElement(tag);\n    if (className) element.className = className;\n    if (textContent) element.textContent = textContent;\n    return element;\n}\n\n// Initialize navigation - only target sidebar nav links\nfunction initNavigation() {\n\n    // IMPORTANT: Only target the sidebar navigation links, not the top navbar\n    const sidebarNavLinks = document.querySelectorAll('.dashboard-sidebar .nav-link');\n\n    sidebarNavLinks.forEach(link => {\n        // Remove existing listeners by cloning and replacing\n        const newLink = link.cloneNode(true);\n        link.parentNode.replaceChild(newLink, link);\n\n        // Add direct onclick property (most reliable method)\n        newLink.onclick = function(e) {\n            // Special handling for shop links and project submission - let them navigate normally\n            if (this.classList.contains('shop-link') || this.classList.contains('project-link') || this.classList.contains('orders-link')) {\n                return true; // Allow normal navigation\n            }\n\n            e.preventDefault();\n\n            const section = this.getAttribute('data-section');\n            if (section) {\n                openTab(section);\n                return false; // Prevent default and stop propagation\n            }\n        };\n    });\n\n    // Leave the main navbar links alone - they should navigate to URLs\n\n    // Open default tab or the one from URL hash\n    const hash = window.location.hash.substring(1);\n    if (hash) {\n        openTab(hash);\n    } else {\n        openTab('dashboard');\n    }\n}\n\n// Load initial data for the dashboard\nfunction loadInitialData() {\n    if (!clubId) return;\n\n    loadPosts();\n    loadAssignments();\n    loadMeetings();\n}\n\n// Note: showToast function is provided globally in base.html\n// We don't need to redefine it here\n\nfunction openTab(sectionName) {\n    if (!sectionName) return;\n\n\n    // Get all sections and deactivate them\n    const allSections = document.querySelectorAll('.club-section');\n    allSections.forEach(section => {\n        section.classList.remove('active');\n    });\n\n    // Activate the selected section\n    const targetSection = document.getElementById(sectionName);\n    if (targetSection) {\n        targetSection.classList.add('active');\n    } else {\n        console.warn('Section not found:', sectionName);\n        return;\n    }\n\n    // Update navigation links\n    const allNavLinks = document.querySelectorAll('.nav-link');\n    allNavLinks.forEach(link => {\n        link.classList.remove('active');\n    });\n\n    const activeNavLink = document.querySelector(`.nav-link[data-section=\"${sectionName}\"]`);\n    if (activeNavLink) {\n        activeNavLink.classList.add('active');\n    }\n\n    // Load section data\n    loadSectionData(sectionName);\n}\n\n\nfunction loadSectionData(section) {\n    switch(section) {\n        case 'stream':\n            loadPosts();\n            break;\n        case 'assignments':\n            loadAssignments();\n            break;\n        case 'schedule':\n            loadMeetings();\n            break;\n        case 'resources':\n            loadResources();\n            break;\n        case 'transactions':\n            loadTransactions();\n            break;\n        case 'piggy-bank':\n            loadPiggyBankTransactions();\n            break;\n        case 'quests':\n            loadQuests();\n            break;\n        case 'slack':\n            loadSlackSettings();\n            break;\n        case 'chat':\n            initializeChat();\n            // Scroll to bottom after a short delay to ensure messages are loaded\n            setTimeout(() => {\n                const messagesContainer = document.getElementById('chatMessages');\n                if (messagesContainer) {\n                    messagesContainer.scrollTop = messagesContainer.scrollHeight;\n                }\n            }, 100);\n            break;\n    }\n}\n\nfunction deletePost(postId, content) {\n    const preview = content.length > 50 ? content.substring(0, 50) + '...' : content;\n    showConfirmModal(\n        `Delete post?`,\n        `\"${preview}\"`,\n        () => {\n            fetch(buildApiUrl(`/api/clubs/${clubId}/posts/${postId}`), {\n                method: 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.message || data.success) {\n                    loadPosts();\n                    showToast('success', 'Post deleted successfully', 'Post Deleted');\n                } else {\n                    showToast('error', data.error || 'Failed to delete post', 'Error');\n                }\n            })\n            .catch(error => {\n                showToast('error', 'Error deleting post', 'Error');\n            });\n        }\n    );\n}\n\nfunction deleteAssignment(assignmentId, title) {\n    showConfirmModal(\n        `Delete \"${title}\"?`,\n        'This action cannot be undone.',\n        () => {\n            fetch(buildApiUrl(`/api/clubs/${clubId}/assignments/${assignmentId}`), {\n                method: 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.message || data.success) {\n                    loadAssignments();\n                    showToast('success', 'Assignment deleted successfully', 'Assignment Deleted');\n                } else {\n                    showToast('error', data.error || 'Failed to delete assignment', 'Error');\n                }\n            })\n            .catch(error => {\n                showToast('error', 'Error deleting assignment', 'Error');\n            });\n        }\n    );\n}\n\nfunction showQRModal() {\n    if (!joinCode) {\n        showToast('error', 'Join code is not available to generate QR code.', 'Error');\n        console.error('Join code is undefined, cannot generate QR code.');\n        return;\n    }\n    const joinUrl = `${window.location.origin}/join-club?code=${joinCode}`;\n    const joinUrlInput = document.getElementById('joinUrl');\n    if (joinUrlInput) {\n        joinUrlInput.value = joinUrl;\n    } else {\n        console.warn('joinUrl input element not found in QR modal.');\n    }\n\n    const qrContainer = document.getElementById('qrcode');\n    if (!qrContainer) {\n        console.error('QR code container not found');\n        return;\n    }\n\n    qrContainer.innerHTML = '';\n\n    const canvas = document.createElement('canvas');\n    qrContainer.appendChild(canvas);\n\n    QRCode.toCanvas(canvas, joinUrl, {\n        width: 200,\n        margin: 2,\n        color: {\n            dark: '#ec3750',\n            light: '#ffffff'\n        }\n    }, function (error) {\n        if (error) {\n            console.error('QR Code generation failed:', error);\n            qrContainer.innerHTML = '<p style=\"color: #ef4444;\">Failed to generate QR code</p>';\n        }\n    });\n\n    const modal = document.getElementById('qrModal');\n    if (modal) {\n        modal.style.display = 'block';\n    }\n}\n\nfunction copyJoinUrl() {\n    const joinUrl = document.getElementById('joinUrl');\n    joinUrl.select();\n    document.execCommand('copy');\n    showToast('success', 'Join code copied to clipboard!', 'Copied');\n}\n\nfunction generateNewJoinCode() {\n    if (!clubId) {\n        showToast('error', 'Cannot generate new join code: Club ID is missing.', 'Error');\n        console.error('generateNewJoinCode: clubId is missing.');\n        return;\n    }\n    showConfirmModal(\n        'Generate a new join code?',\n        'The old code will stop working.',\n        () => {\n            fetch(`/api/clubs/${clubId}/join-code`, {\n                method: 'POST'\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.join_code) {\n                    const joinCodeDisplay = document.querySelector('.join-code-display');\n                    if (joinCodeDisplay) {\n                        joinCodeDisplay.innerHTML = '';\n                        const icon = createElement('i', 'fas fa-key');\n                        joinCodeDisplay.appendChild(icon);\n                        joinCodeDisplay.appendChild(document.createTextNode(' ' + data.join_code));\n                    }\n                    // Update the join code in the QR modal input as well\n                    const qrCodeInput = document.querySelector('#qrModal input[readonly]');\n                    if (qrCodeInput) {\n                        qrCodeInput.value = data.join_code;\n                    }\n                    showToast('success', 'New join code generated!', 'Generated');\n                } else {\n                    showToast('error', 'Failed to generate new join code', 'Error');\n                }\n            })\n            .catch(error => {\n                showToast('error', 'Error generating join code', 'Error');\n            });\n        }\n    );\n}\n\nfunction showConfirmModal(message, details, typeOrCallback, onConfirm) {\n    // Handle both 3-parameter and 4-parameter calls\n    let callback;\n    if (typeof typeOrCallback === 'function') {\n        // 3-parameter call: message, details, callback\n        callback = typeOrCallback;\n    } else {\n        // 4-parameter call: message, details, type, callback\n        callback = onConfirm;\n    }\n\n    const confirmMessage = document.getElementById('confirmMessage');\n    if (confirmMessage) {\n        confirmMessage.innerHTML = '';\n        confirmMessage.appendChild(document.createTextNode(message));\n        if (details) {\n            confirmMessage.appendChild(createElement('br'));\n            const small = createElement('small', '', details);\n            confirmMessage.appendChild(small);\n        }\n    }\n    document.getElementById('confirmModal').style.display = 'block';\n\n    const confirmButton = document.getElementById('confirmButton');\n    if (confirmButton) {\n        confirmButton.onclick = () => {\n            document.getElementById('confirmModal').style.display = 'none';\n            if (callback && typeof callback === 'function') {\n                callback();\n            }\n        };\n    }\n}\n\nfunction loadPosts() {\n    if (!clubId) {\n        console.warn('loadPosts: clubId is missing. Skipping fetch.');\n        const postsList = document.getElementById('postsList');\n        if (postsList) postsList.textContent = 'Error: Club information is unavailable to load posts.';\n        return;\n    }\n    fetch(buildApiUrl(`/api/clubs/${clubId}/posts`))\n        .then(response => {\n            if (response.status === 401) {\n                window.location.href = '/login';\n                return null;\n            }\n            if (response.status === 403) {\n                throw new Error('You do not have permission to view posts');\n            }\n            if (!response.ok) {\n                throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n            }\n\n            // Check if response is JSON\n            const contentType = response.headers.get('content-type');\n            if (!contentType || !contentType.includes('application/json')) {\n                throw new Error('Server returned non-JSON response (possibly an error page)');\n            }\n\n            return response.json();\n        })\n        .then(data => {\n            if (!data) return;\n            const postsList = document.getElementById('postsList');\n            postsList.innerHTML = '';\n\n            if (data.posts && data.posts.length > 0) {\n                data.posts.forEach(post => {\n                    const postCard = createElement('div', 'post-card');\n\n                    const postHeader = createElement('div', 'post-header');\n                    const postAvatar = createElement('div', 'post-avatar', post.user.username[0].toUpperCase());\n                    const postInfo = createElement('div', 'post-info');\n                    const postUsername = createElement('h4', '', post.user.username);\n                    const postDate = createElement('div', 'post-date', new Date(post.created_at).toLocaleDateString());\n\n                    postInfo.appendChild(postUsername);\n                    postInfo.appendChild(postDate);\n                    postHeader.appendChild(postAvatar);\n                    postHeader.appendChild(postInfo);\n\n                    // Add delete button for club leaders\n                    if (window.clubData && window.clubData.isLeader) {\n                        const deleteBtn = createElement('button', 'btn-icon delete-btn');\n                        deleteBtn.setAttribute('onclick', `deletePost(${post.id}, '${post.content.replace(/'/g, \"\\\\'\")}')`)\n                        deleteBtn.setAttribute('title', 'Delete Post');\n                        deleteBtn.innerHTML = '<i class=\"fas fa-trash\"></i>';\n                        postHeader.appendChild(deleteBtn);\n                    }\n\n                    const postContent = createElement('div', 'post-content');\n                    // Use HTML content if available (for markdown posts), otherwise escape plain text\n                    if (post.content_html) {\n                        postContent.innerHTML = post.content_html;\n                    } else {\n                        const postText = createElement('p', '', post.content);\n                        postContent.appendChild(postText);\n                    }\n\n                    postCard.appendChild(postHeader);\n                    postCard.appendChild(postContent);\n                    postsList.appendChild(postCard);\n                });\n            } else {\n                const emptyState = createElement('div', 'empty-state');\n                const icon = createElement('i', 'fas fa-stream');\n                const title = createElement('h3', '', 'No posts yet');\n                const description = createElement('p', '', 'Be the first to share something with your club!');\n\n                emptyState.appendChild(icon);\n                emptyState.appendChild(title);\n                emptyState.appendChild(description);\n                postsList.appendChild(emptyState);\n            }\n        })\n        .catch(error => {\n            console.error('Error loading posts:', error);\n            console.error('Full error details:', {\n                message: error.message,\n                stack: error.stack,\n                clubId: clubId,\n                timestamp: new Date().toISOString()\n            });\n\n            const postsList = document.getElementById('postsList');\n            if (postsList) {\n                let errorMessage = 'Please try refreshing the page';\n                if (error.message.includes('non-JSON')) {\n                    errorMessage = 'Server error detected. Check browser console and server logs.';\n                } else if (error.message.includes('HTTP 500')) {\n                    errorMessage = 'Internal server error. Check server logs for details.';\n                } else if (error.message.includes('TypeError')) {\n                    errorMessage = 'JavaScript parsing error. Check browser console for details.';\n                } else {\n                    errorMessage = error.message || 'Unknown error occurred';\n                }\n\n                postsList.innerHTML = `\n                    <div class=\"empty-state\">\n                        <i class=\"fas fa-exclamation-triangle\"></i>\n                        <h3>Error Loading Posts</h3>\n                        <p>${errorMessage}</p>\n                        <button onclick=\"loadPosts()\" class=\"btn btn-primary\" style=\"margin-top: 1rem;\">\n                            <i class=\"fas fa-refresh\"></i> Try Again\n                        </button>\n                    </div>\n                `;\n            }\n        });\n}\n\nfunction createPost() {\n    if (!clubId) {\n        showToast('error', 'Cannot create post: Club ID is missing.', 'Error');\n        console.error('createPost: clubId is missing.');\n        return;\n    }\n    const content = document.getElementById('postContent').value;\n    if (!content.trim()) {\n        showToast('error', 'Please enter some content', 'Validation Error');\n        return;\n    }\n\n    fetch(buildApiUrl(`/api/clubs/${clubId}/posts`), {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ content })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message) {\n            document.getElementById('postContent').value = '';\n            loadPosts();\n            showToast('success', 'Post created successfully', 'Post Created');\n        } else {\n            showToast('error', data.error || 'Failed to create post', 'Error');\n        }\n    })\n    .catch(error => {\n        showToast('error', 'Error creating post', 'Error');\n    });\n}\n\nfunction openCreateAssignmentModal() {\n    const modal = document.getElementById('createAssignmentModal');\n    if (modal) modal.style.display = 'block';\n}\n\nfunction createAssignment() {\n    if (!clubId) {\n        showToast('error', 'Cannot create assignment: Club ID is missing.', 'Error');\n        console.error('createAssignment: clubId is missing.');\n        return;\n    }\n    const title = document.getElementById('assignmentTitle').value;\n    const description = document.getElementById('assignmentDescription').value;\n    const dueDate = document.getElementById('assignmentDueDate').value;\n    const forAllMembers = document.getElementById('assignmentForAll').checked;\n\n    if (!title || !description) {\n        showToast('error', 'Please fill in all required fields', 'Validation Error');\n        return;\n    }\n\n    fetch(buildApiUrl(`/api/clubs/${clubId}/assignments`), {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            title,\n            description,\n            due_date: dueDate || null,\n            for_all_members: forAllMembers\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message) {\n            document.getElementById('createAssignmentModal').style.display = 'none';\n            document.getElementById('createAssignmentForm').reset();\n            loadAssignments();\n            showToast('success', 'Assignment created successfully', 'Assignment Created');\n        } else {\n            showToast('error', data.error || 'Failed to create assignment', 'Error');\n        }\n    })\n    .catch(error => {\n        showToast('error', 'Error creating assignment', 'Error');\n    });\n}\n\nfunction loadAssignments() {\n    if (!clubId) {\n        console.warn('loadAssignments: clubId is missing. Skipping fetch.');\n        const assignmentsList = document.getElementById('assignmentsList');\n        if (assignmentsList) assignmentsList.textContent = 'Error: Club information is unavailable to load assignments.';\n        return;\n    }\n    fetch(buildApiUrl(`/api/clubs/${clubId}/assignments`))\n        .then(response => {\n            if (response.status === 401) {\n                window.location.href = '/login';\n                return null;\n            }\n            if (response.status === 403) {\n                throw new Error('You do not have permission to view assignments');\n            }\n            return response.json();\n        })\n        .then(data => {\n            if (!data) return;\n            const assignmentsList = document.getElementById('assignmentsList');\n            const assignmentsCount = document.getElementById('assignmentsCount');\n\n            if (assignmentsList) assignmentsList.innerHTML = '';\n\n            if (data.assignments && data.assignments.length > 0) {\n                data.assignments.forEach(assignment => {\n                    const card = createElement('div', 'card');\n                    card.style.marginBottom = '1rem';\n\n                    const cardHeader = createElement('div', 'card-header');\n                    cardHeader.style.cssText = 'display: flex; justify-content: space-between; align-items: flex-start;';\n\n                    const headerDiv = createElement('div');\n                    const title = createElement('h3', '', assignment.title);\n                    title.style.cssText = 'margin: 0; font-size: 1.125rem; color: #1f2937;';\n\n                    const statusSpan = createElement('span', '', assignment.status);\n                    statusSpan.style.cssText = `background: ${assignment.status === 'active' ? '#10b981' : '#6b7280'}; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; margin-top: 0.5rem; display: inline-block;`;\n\n                    headerDiv.appendChild(title);\n                    headerDiv.appendChild(statusSpan);\n                    cardHeader.appendChild(headerDiv);\n\n                    // Add delete button for club leaders\n                    if (window.clubData && window.clubData.isLeader) {\n                        const deleteBtn = createElement('button', 'btn-icon delete-btn');\n                        deleteBtn.setAttribute('onclick', `deleteAssignmentDesktop(${assignment.id}, '${assignment.title.replace(/'/g, \"\\\\'\")}')`)\n                        deleteBtn.setAttribute('title', 'Delete Assignment');\n                        deleteBtn.innerHTML = '<i class=\"fas fa-trash\"></i>';\n                        cardHeader.appendChild(deleteBtn);\n                    }\n\n                    const cardBody = createElement('div', 'card-body');\n                    const description = createElement('p', '', assignment.description);\n                    description.style.cssText = 'margin-bottom: 1rem; color: #6b7280;';\n                    cardBody.appendChild(description);\n\n                    const infoDiv = createElement('div');\n                    infoDiv.style.cssText = 'display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; color: #6b7280;';\n\n                    if (assignment.due_date) {\n                        const dueSpan = createElement('span');\n                        dueSpan.style.cssText = 'display: flex; align-items: center; gap: 0.25rem;';\n                        const dueIcon = createElement('i', 'fas fa-calendar');\n                        dueSpan.appendChild(dueIcon);\n                        dueSpan.appendChild(document.createTextNode(' Due: ' + new Date(assignment.due_date).toLocaleDateString()));\n                        infoDiv.appendChild(dueSpan);\n                    }\n\n                    const membersSpan = createElement('span');\n                    membersSpan.style.cssText = 'display: flex; align-items: center; gap: 0.25rem;';\n                    const membersIcon = createElement('i', 'fas fa-users');\n                    membersSpan.appendChild(membersIcon);\n                    membersSpan.appendChild(document.createTextNode(' ' + (assignment.for_all_members ? 'All members' : 'Selected members')));\n                    infoDiv.appendChild(membersSpan);\n\n                    cardBody.appendChild(infoDiv);\n                    card.appendChild(cardHeader);\n                    card.appendChild(cardBody);\n                    if (assignmentsList) assignmentsList.appendChild(card);\n                });\n\n                if (assignmentsCount) assignmentsCount.textContent = data.assignments.filter(a => a.status === 'active').length;\n            } else {\n                const emptyState = createElement('div', 'empty-state');\n                const icon = createElement('i', 'fas fa-clipboard-list');\n                const title = createElement('h3', '', 'No assignments yet');\n                const description = createElement('p', '', 'Create your first assignment to get started!');\n\n                emptyState.appendChild(icon);\n                emptyState.appendChild(title);\n                emptyState.appendChild(description);\n                if (assignmentsList) assignmentsList.appendChild(emptyState);\n\n                if (assignmentsCount) assignmentsCount.textContent = '0';\n            }\n        })\n        .catch(error => {\n            console.error('Error loading assignments:', error);\n            const assignmentsList = document.getElementById('assignmentsList');\n            if (assignmentsList) {\n                assignmentsList.innerHTML = '<div class=\"empty-state\"><i class=\"fas fa-exclamation-triangle\"></i><h3>Error Loading Assignments</h3><p>' + error.message + '</p></div>';\n            }\n        });\n}\n\n// Opening the create meeting modal\nfunction openCreateMeetingModal() {\n    // Close edit modal if it's open\n    if (typeof closeEditMeetingModal === 'function') {\n        closeEditMeetingModal();\n    }\n\n    // Clear form fields\n    const form = document.getElementById('createMeetingForm');\n    if (form) form.reset();\n\n    // Show the modal\n    const modal = document.getElementById('createMeetingModal');\n    if (modal) modal.style.display = 'block';\n}\n\nfunction createMeeting() {\n    if (!clubId) {\n        showToast('error', 'Cannot create meeting: Club ID is missing.', 'Error');\n        console.error('createMeeting: clubId is missing.');\n        return;\n    }\n    const title = document.getElementById('meetingTitle').value;\n    const description = document.getElementById('meetingDescription').value;\n    const date = document.getElementById('meetingDate').value;\n    const startTime = document.getElementById('meetingStartTime').value;\n    const endTime = document.getElementById('meetingEndTime').value;\n    const location = document.getElementById('meetingLocation').value;\n    const link = document.getElementById('meetingLink').value;\n\n    if (!title || !date || !startTime) {\n        showToast('error', 'Please fill in all required fields', 'Validation Error');\n        return;\n    }\n\n    fetch(buildApiUrl(`/api/clubs/${clubId}/meetings`), {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            title,\n            description,\n            meeting_date: date,\n            start_time: startTime,\n            end_time: endTime,\n            location,\n            meeting_link: link\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message) {\n            document.getElementById('createMeetingModal').style.display = 'none';\n            document.getElementById('createMeetingForm').reset();\n            loadMeetings();\n            showToast('success', 'Meeting scheduled successfully', 'Meeting Scheduled');\n        } else {\n            showToast('error', data.error || 'Failed to schedule meeting', 'Error');\n        }\n    })\n    .catch(error => {\n        showToast('error', 'Error scheduling meeting', 'Error');\n    });\n}\n\nfunction loadMeetings() {\n    if (!clubId) {\n        console.warn('loadMeetings: clubId is missing. Skipping fetch.');\n        const meetingsList = document.getElementById('meetingsList');\n        if (meetingsList) meetingsList.textContent = 'Error: Club information is unavailable to load meetings.';\n        return;\n    }\n    fetch(buildApiUrl(`/api/clubs/${clubId}/meetings`))\n        .then(response => {\n            if (response.status === 401) {\n                window.location.href = '/login';\n                return null;\n            }\n            if (response.status === 403) {\n                throw new Error('You do not have permission to view meetings');\n            }\n            return response.json();\n        })\n        .then(data => {\n            if (!data) return;\n            const meetingsList = document.getElementById('meetingsList');\n            const meetingsCount = document.getElementById('meetingsCount');\n\n            if (meetingsList) meetingsList.innerHTML = '';\n\n            if (data.meetings && data.meetings.length > 0) {\n                data.meetings.forEach(meeting => {\n                    const card = createElement('div', 'card');\n                    card.style.marginBottom = '1rem';\n                    card.id = `meeting-${meeting.id}`;\n\n                    const cardHeader = createElement('div', 'card-header');\n                    cardHeader.style.cssText = 'display: flex; justify-content: space-between; align-items: flex-start;';\n\n                    const headerDiv = createElement('div');\n                    const title = createElement('h3', '', meeting.title);\n                    title.style.cssText = 'margin: 0; font-size: 1.125rem; color: #1f2937;';\n                    headerDiv.appendChild(title);\n                    cardHeader.appendChild(headerDiv);\n\n                    // Add delete button for club leaders\n                    if (window.clubData && window.clubData.isLeader) {\n                        const deleteBtn = createElement('button', 'btn-icon delete-btn');\n                        deleteBtn.setAttribute('onclick', `deleteMeetingDesktop(${meeting.id}, '${meeting.title.replace(/'/g, \"\\\\'\")}')`)\n                        deleteBtn.setAttribute('title', 'Delete Meeting');\n                        deleteBtn.innerHTML = '<i class=\"fas fa-trash\"></i>';\n                        cardHeader.appendChild(deleteBtn);\n                    }\n\n                    const cardBody = createElement('div', 'card-body');\n\n                    if (meeting.description) {\n                        const description = createElement('p', '', meeting.description);\n                        description.style.cssText = 'margin-bottom: 1rem; color: #6b7280;';\n                        cardBody.appendChild(description);\n                    }\n\n                    const infoDiv = createElement('div');\n                    infoDiv.style.cssText = 'display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; color: #6b7280;';\n\n                    const dateSpan = createElement('span');\n                    dateSpan.style.cssText = 'display: flex; align-items: center; gap: 0.25rem;';\n                    const dateIcon = createElement('i', 'fas fa-calendar');\n                    dateSpan.appendChild(dateIcon);\n                    dateSpan.appendChild(document.createTextNode(' ' + new Date(meeting.meeting_date).toLocaleDateString()));\n                    infoDiv.appendChild(dateSpan);\n\n                    const timeSpan = createElement('span');\n                    timeSpan.style.cssText = 'display: flex; align-items: center; gap: 0.25rem;';\n                    const timeIcon = createElement('i', 'fas fa-clock');\n                    timeSpan.appendChild(timeIcon);\n                    const timeText = meeting.start_time + (meeting.end_time ? ` - ${meeting.end_time}` : '');\n                    timeSpan.appendChild(document.createTextNode(' ' + timeText));\n                    infoDiv.appendChild(timeSpan);\n\n                    if (meeting.location) {\n                        const locationSpan = createElement('span');\n                        locationSpan.style.cssText = 'display: flex; align-items: center; gap: 0.25rem;';\n                        const locationIcon = createElement('i', 'fas fa-map-marker-alt');\n                        locationSpan.appendChild(locationIcon);\n                        locationSpan.appendChild(document.createTextNode(' ' + meeting.location));\n                        infoDiv.appendChild(locationSpan);\n                    }\n\n                    if (meeting.meeting_link) {\n                        const linkSpan = createElement('span');\n                        linkSpan.style.cssText = 'display: flex; align-items: center; gap: 0.25rem;';\n                        const linkIcon = createElement('i', 'fas fa-link');\n                        linkSpan.appendChild(linkIcon);\n                        linkSpan.appendChild(document.createTextNode(' '));\n\n                        const link = createElement('a');\n                        link.href = meeting.meeting_link;\n                        link.target = '_blank';\n                        link.style.color = '#ec3750';\n                        link.textContent = 'Visit Resource';\n                        linkSpan.appendChild(link);\n                        infoDiv.appendChild(linkSpan);\n                    }\n\n                    cardBody.appendChild(infoDiv);\n                    card.appendChild(cardHeader);\n                    card.appendChild(cardBody);\n                    if (meetingsList) meetingsList.appendChild(card);\n                });\n\n                const thisMonth = new Date().getMonth();\n                const thisYear = new Date().getFullYear();\n                const thisMonthMeetings = data.meetings.filter(m => {\n                    const meetingDate = new Date(m.meeting_date);\n                    return meetingDate.getMonth() === thisMonth && meetingDate.getFullYear() === thisYear;\n                });\n                if (meetingsCount) meetingsCount.textContent = thisMonthMeetings.length;\n            } else {\n                const emptyState = createElement('div', 'empty-state');\n                const icon = createElement('i', 'fas fa-calendar-times');\n                const title = createElement('h3', '', 'No meetings scheduled');\n                const description = createElement('p', '', 'Schedule your first club meeting to get started!');\n\n                emptyState.appendChild(icon);\n                emptyState.appendChild(title);\n                emptyState.appendChild(description);\n                if (meetingsList) meetingsList.appendChild(emptyState);\n\n                if (meetingsCount) meetingsCount.textContent = '0';\n            }\n        })\n        .catch(error => {\n            console.error('Error loading meetings:', error);\n            const meetingsList = document.getElementById('meetingsList');\n            if (meetingsList) {\n                meetingsList.innerHTML = '<div class=\"empty-state\"><i class=\"fas fa-exclamation-triangle\"></i><h3>Error Loading Meetings</h3><p>' + error.message + '</p></div>';\n            }\n        });\n}\n\nfunction editMeeting(id, title, description, date, startTime, endTime, location, link) {\n    // Populate edit form\n    document.getElementById('meetingTitle').value = title;\n    document.getElementById('meetingDescription').value = description;\n    document.getElementById('meetingDate').value = date;\n    document.getElementById('meetingStartTime').value = startTime;\n    document.getElementById('meetingEndTime').value = endTime;\n    document.getElementById('meetingLocation').value = location;\n    document.getElementById('meetingLink').value = link;\n\n    // Change form action to update\n    document.getElementById('createMeetingModal').setAttribute('data-edit-id', id);\n    document.querySelector('#createMeetingModal .modal-header h3').textContent = 'Edit Meeting';\n    const submitBtn = document.querySelector('#createMeetingModal .btn-primary');\n    submitBtn.textContent = '';\n    const icon = createElement('i', 'fas fa-save');\n    submitBtn.appendChild(icon);\n    submitBtn.appendChild(document.createTextNode(' Update Meeting'));\n    submitBtn.setAttribute('onclick', 'updateMeeting()');\n\n    const modal = document.getElementById('createMeetingModal');\n    if (modal) modal.style.display = 'block';\n}\n\nfunction updateMeeting() {\n    const id = document.getElementById('createMeetingModal').getAttribute('data-edit-id');\n    const title = document.getElementById('meetingTitle').value;\n    const description = document.getElementById('meetingDescription').value;\n    const date = document.getElementById('meetingDate').value;\n    const startTime = document.getElementById('meetingStartTime').value;\n    const endTime = document.getElementById('meetingEndTime').value;\n    const location = document.getElementById('meetingLocation').value;\n    const link = document.getElementById('meetingLink').value;\n\n    if (!title || !date || !startTime) {\n        showToast('error', 'Please fill in all required fields', 'Validation Error');\n        return;\n    }\n\n    fetch(buildApiUrl(`/api/clubs/${clubId}/meetings/${id}`), {\n        method: 'PUT',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            title,\n            description,\n            meeting_date: date,\n            start_time: startTime,\n            end_time: endTime,\n            location,\n            meeting_link: link\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message) {\n            closeEditMeetingModal();\n            loadMeetings();\n            showToast('success', 'Meeting updated successfully', 'Meeting Updated');\n        } else {\n            showToast('error', data.error || 'Failed to update meeting', 'Error');\n        }\n    })\n    .catch(error => {\n        showToast('error', 'Error updating meeting', 'Error');\n    });\n}\n\nfunction deleteMeeting(id, title) {\n    showConfirmModal(\n        `Delete \"${title}\"?`,\n        'This action cannot be undone.',\n        () => {\n            fetch(buildApiUrl(`/api/clubs/${clubId}/meetings/${id}`), {\n                method: 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.message) {\n                    loadMeetings();\n                    showToast('success', 'Meeting deleted successfully', 'Meeting Deleted');\n                } else {\n                    showToast('error', data.error || 'Failed to delete meeting', 'Error');\n                }\n            })\n            .catch(error => {\n                showToast('error', 'Error deleting meeting', 'Error');\n            });\n        }\n    );\n}\n\nfunction closeEditMeetingModal() {\n    const modal = document.getElementById('createMeetingModal');\n    if (modal){\n        modal.style.display = 'none';\n        modal.removeAttribute('data-edit-id');\n    }\n    document.querySelector('#createMeetingModal .modal-header h3').textContent = 'Schedule Meeting';\n    const submitBtn = document.querySelector('#createMeetingModal .btn-primary');\n    submitBtn.textContent = '';\n    const icon = createElement('i', 'fas fa-calendar-plus');\n    submitBtn.appendChild(icon);\n    submitBtn.appendChild(document.createTextNode(' Schedule Meeting'));\n    submitBtn.setAttribute('onclick', 'createMeeting()');\n    document.getElementById('createMeetingForm').reset();\n}\n\n\nfunction loadProjects() {\n    if (!clubId) {\n        console.warn('loadProjects: clubId is missing. Skipping fetch.');\n        const projectsList = document.getElementById('projects-list'); // Ensure this ID matches your HTML\n        if (projectsList) projectsList.textContent = 'Error: Club information is unavailable to load projects.';\n        return;\n    }\n    fetch(`/api/clubs/${clubId}/projects`)\n        .then(response => response.json())\n        .then(data => {\n            const projectsList = document.getElementById('projectsList');\n            const projectsCount = document.getElementById('projectsCount');\n\n            projectsList.innerHTML = '';\n\n            if (data.projects && data.projects.length > 0) {\n                data.projects.forEach(project => {\n                    const card = createElement('div', 'card');\n                    card.style.marginBottom = '1rem';\n\n                    const cardHeader = createElement('div', 'card-header');\n                    cardHeader.style.cssText = 'display: flex; justify-content: space-between; align-items: flex-start;';\n\n                    const headerDiv = createElement('div');\n                    const title = createElement('h3', '', project.name);\n                    title.style.cssText = 'margin: 0; font-size: 1.125rem; color: #1f2937;';\n                    headerDiv.appendChild(title);\n\n                    if (project.featured) {\n                        const featuredSpan = createElement('span', '', 'Featured');\n                        featuredSpan.style.cssText = 'background: #f59e0b; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; margin-top: 0.5rem; display: inline-block;';\n                        headerDiv.appendChild(featuredSpan);\n                    }\n\n                    cardHeader.appendChild(headerDiv);\n\n                    const cardBody = createElement('div', 'card-body');\n                    const description = createElement('p', '', project.description || 'No description available');\n                    description.style.cssText = 'margin-bottom: 1rem; color: #6b7280;';\n                    cardBody.appendChild(description);\n\n                    const infoDiv = createElement('div');\n                    infoDiv.style.cssText = 'display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; color: #6b7280;';\n\n                    const ownerSpan = createElement('span');\n                    ownerSpan.style.cssText = 'display: flex; align-items: center; gap: 0.25rem;';\n                    const ownerIcon = createElement('i', 'fas fa-user');\n                    ownerSpan.appendChild(ownerIcon);\n                    ownerSpan.appendChild(document.createTextNode(' ' + project.owner.username));\n                    infoDiv.appendChild(ownerSpan);\n\n                    const dateSpan = createElement('span');\n                    dateSpan.style.cssText = 'display: flex; align-items: center; gap: 0.25rem;';\n                    const dateIcon = createElement('i', 'fas fa-calendar');\n                    dateSpan.appendChild(dateIcon);\n                    dateSpan.appendChild(document.createTextNode(' ' + new Date(project.updated_at).toLocaleDateString()));\n                    infoDiv.appendChild(dateSpan);\n\n                    cardBody.appendChild(infoDiv);\n                    card.appendChild(cardHeader);\n                    card.appendChild(cardBody);\n                    projectsList.appendChild(card);\n                });\n\n                if (projectsCount) projectsCount.textContent = data.projects.length;\n            } else {\n                const emptyState = createElement('div', 'empty-state');\n                const icon = createElement('i', 'fas fa-code');\n                const title = createElement('h3', '', 'No projects yet');\n                const description = createElement('p', '', 'Members can start creating projects to showcase here!');\n\n                emptyState.appendChild(icon);\n                emptyState.appendChild(title);\n                emptyState.appendChild(description);\n                projectsList.appendChild(emptyState);\n\n                if (projectsCount) projectsCount.textContent = '0';\n            }\n        })\n        .catch(error => {\n            showToast('error', 'Failed to load projects', 'Error');\n        });\n}\n\n// Opening the add resource modal\nfunction openAddResourceModal() {\n    // Close edit modal if it's open\n    if (typeof closeEditResourceModal === 'function') {\n        closeEditResourceModal();\n    }\n\n    // Clear form fields\n    const form = document.getElementById('addResourceForm');\n    if (form) form.reset();\n\n    // Show the modal\n    const modal = document.getElementById('addResourceModal');\n    if (modal) modal.style.display = 'block';\n}\n\nfunction addResource() {\n    if (!clubId) {\n        showToast('error', 'Cannot add resource: Club ID is missing.', 'Error');\n        console.error('addResource: clubId is missing.');\n        return;\n    }\n    const title = document.getElementById('resourceTitle').value;\n    const url = document.getElementById('resourceUrl').value;\n    const description = document.getElementById('resourceDescription').value;\n    const icon = document.getElementById('resourceIcon').value;\n\n    if (!title || !url) {\n        showToast('error', 'Please fill in title and URL', 'Validation Error');\n        return;\n    }\n\n    fetch(`/api/clubs/${clubId}/resources`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            title,\n            url,\n            description,\n            icon\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message) {\n            document.getElementById('addResourceModal').style.display = 'none';\n            document.getElementById('addResourceForm').reset();\n            loadResources();\n            showToast('success', 'Resource added successfully', 'Resource Added');\n        } else {\n            showToast('error', data.error || 'Failed to add resource', 'Error');\n        }\n    })\n    .catch(error => {\n        showToast('error', 'Error adding resource', 'Error');\n    });\n}\n\nfunction loadResources() {\n    if (!clubId) {\n        console.warn('loadResources: clubId is missing. Skipping fetch.');\n        const resourcesList = document.getElementById('resourcesList');\n        if (resourcesList) resourcesList.textContent = 'Error: Club information is unavailable to load resources.';\n        return;\n    }\n    fetch(`/api/clubs/${clubId}/resources`)\n        .then(response => {\n            if (response.status === 401) {\n                window.location.href = '/login';\n                return null;\n            }\n            if (response.status === 403) {\n                throw new Error('You do not have permission to view resources');\n            }\n            return response.json();\n        })\n        .then(data => {\n            if (!data) return;\n            const resourcesList = document.getElementById('resourcesList');\n            resourcesList.innerHTML = '';\n\n            if (data.resources && data.resources.length > 0) {\n                data.resources.forEach(resource => {\n                    const card = createElement('div', 'card');\n                    card.style.marginBottom = '1rem';\n                    card.id = `resource-${resource.id}`;\n\n                    const cardHeader = createElement('div', 'card-header');\n                    cardHeader.style.cssText = 'display: flex; justify-content: space-between; align-items: flex-start;';\n\n                    const headerDiv = createElement('div');\n                    const title = createElement('h3');\n                    title.style.cssText = 'margin: 0; font-size: 1.125rem; color: #1f2937;';\n                    const icon = createElement('i', `fas fa-${resource.icon}`);\n                    title.appendChild(icon);\n                    title.appendChild(document.createTextNode(' ' + resource.title));\n                    headerDiv.appendChild(title);\n                    cardHeader.appendChild(headerDiv);\n\n                    // Add delete button for club leaders\n                    if (window.clubData && window.clubData.isLeader) {\n                        const deleteBtn = createElement('button', 'btn-icon delete-btn');\n                        deleteBtn.setAttribute('onclick', `deleteResourceDesktop(${resource.id}, '${resource.title.replace(/'/g, \"\\\\'\")}')`)\n                        deleteBtn.setAttribute('title', 'Delete Resource');\n                        deleteBtn.innerHTML = '<i class=\"fas fa-trash\"></i>';\n                        cardHeader.appendChild(deleteBtn);\n                    }\n\n                    const cardBody = createElement('div', 'card-body');\n\n                    if (resource.description) {\n                        const description = createElement('p', '', resource.description);\n                        description.style.cssText = 'margin-bottom: 1rem; color: #6b7280;';\n                        cardBody.appendChild(description);\n                    }\n\n                    const infoDiv = createElement('div');\n                    infoDiv.style.cssText = 'display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; color: #6b7280;';\n\n                    const linkSpan = createElement('span');\n                    linkSpan.style.cssText = 'display: flex; align-items: center; gap: 0.25rem;';\n                    const linkIcon = createElement('i', 'fas fa-link');\n                    linkSpan.appendChild(linkIcon);\n                    linkSpan.appendChild(document.createTextNode(' '));\n\n                    const link = createElement('a');\n                    link.href = resource.url;\n                    link.target = '_blank';\n                    link.style.color = '#ec3750';\n                    link.textContent = 'Visit Resource';\n                    linkSpan.appendChild(link);\n                    infoDiv.appendChild(linkSpan);\n\n                    cardBody.appendChild(infoDiv);\n                    card.appendChild(cardHeader);\n                    card.appendChild(cardBody);\n                    resourcesList.appendChild(card);\n                });\n            } else {\n                const emptyState = createElement('div', 'empty-state');\n                const icon = createElement('i', 'fas fa-book');\n                const title = createElement('h3', '', 'No resources yet');\n                const description = createElement('p', '', 'Add helpful links and learning materials for your club!');\n\n                emptyState.appendChild(icon);\n                emptyState.appendChild(title);\n                emptyState.appendChild(description);\n                resourcesList.appendChild(emptyState);\n            }\n        })\n        .catch(error => {\n            console.error('Error loading resources:', error);\n            const resourcesList = document.getElementById('resourcesList');\n            if (resourcesList) {\n                resourcesList.innerHTML = '<div class=\"empty-state\"><i class=\"fas fa-exclamation-triangle\"></i><h3>Error Loading Resources</h3><p>' + error.message + '</p></div>';\n            }\n        });\n}\n\nfunction editResource(id, title, url, description, icon) {\n    // Populate edit form\n    document.getElementById('resourceTitle').value = title;\n    document.getElementById('resourceUrl').value = url;\n    document.getElementById('resourceDescription').value = description;\n    document.getElementById('resourceIcon').value = icon;\n\n    // Change form action to update\n    document.getElementById('addResourceModal').setAttribute('data-edit-id', id);\n    document.querySelector('#addResourceModal .modal-header h3').textContent = 'Edit Resource';\n    const submitBtn = document.querySelector('#addResourceModal .btn-primary');\n    submitBtn.textContent = '';\n    const saveIcon = createElement('i', 'fas fa-save');\n    submitBtn.appendChild(saveIcon);\n    submitBtn.appendChild(document.createTextNode(' Update Resource'));\n    submitBtn.setAttribute('onclick', 'updateResource()');\n    const modal = document.getElementById('addResourceModal');\n    if (modal) modal.style.display = 'block';\n}\n\nfunction updateResource() {\n    const id = document.getElementById('addResourceModal').getAttribute('data-edit-id');\n    const title = document.getElementById('resourceTitle').value;\n    const url = document.getElementById('resourceUrl').value;\n    const description = document.getElementById('resourceDescription').value;\n    const icon = document.getElementById('resourceIcon').value;\n\n    if (!title || !url) {\n        showToast('error', 'Please fill in title and URL', 'Validation Error');\n        return;\n    }\n\n    fetch(`/api/clubs/${clubId}/resources/${id}`, {\n        method: 'PUT',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            title,\n            url,\n            description,\n            icon\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message) {\n            closeEditResourceModal();\n            loadResources();\n            showToast('success', 'Resource updated successfully', 'Resource Updated');\n        } else {\n            showToast('error', data.error || 'Failed to update resource', 'Error');\n        }\n    })\n    .catch(error => {\n        showToast('error', 'Error updating resource', 'Error');\n    });\n}\n\nfunction deleteResource(id, title) {\n    showConfirmModal(\n        `Delete \"${title}\"?`,\n        'This action cannot be undone.',\n        () => {\n            fetch(`/api/clubs/${clubId}/resources/${id}`, {\n                method: 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.message) {\n                    loadResources();\n                    showToast('success', 'Resource deleted successfully', 'Resource Deleted');\n                } else {\n                    showToast('error', data.error || 'Failed to delete resource', 'Error');\n                }\n            })\n            .catch(error => {\n                showToast('error', 'Error deleting resource', 'Error');\n            });\n        }\n    );\n}\n\nfunction deleteResourceDesktop(id, title) {\n    deleteResource(id, title);\n}\n\nfunction deleteAssignmentDesktop(id, title) {\n    deleteAssignment(id, title);\n}\n\nfunction deleteMeetingDesktop(id, title) {\n    deleteMeeting(id, title);\n}\n\nfunction closeEditResourceModal() {\n    const modal = document.getElementById('addResourceModal');\n    if(modal){\n        modal.style.display = 'none';\n        modal.removeAttribute('data-edit-id');\n    }\n    document.querySelector('#addResourceModal .modal-header h3').textContent = 'Add Resource';\n    const submitBtn = document.querySelector('#addResourceModal .btn-primary');\n    submitBtn.textContent = '';\n    const addIcon = createElement('i', 'fas fa-plus');\n    submitBtn.appendChild(addIcon);\n    submitBtn.appendChild(document.createTextNode(' Add Resource'));\n    submitBtn.setAttribute('onclick', 'addResource()');\n    document.getElementById('addResourceForm').reset();\n}\n\n// Global variable for preventing duplicate settings updates\nlet settingsUpdateInProgress = false;\n\n// Update club settings with email verification workflow\nfunction updateClubSettings(clubName, clubDescription, clubLocation) {\n    if (!clubId) {\n        showToast('error', 'Cannot update settings: Club ID is missing.', 'Error');\n        return;\n    }\n\n    // Prevent duplicate requests\n    if (settingsUpdateInProgress) {\n        return;\n    }\n\n    settingsUpdateInProgress = true;\n\n    // Try to update settings first - backend will handle verification requirement\n    fetch(`/api/clubs/${clubId}/settings`, {\n        method: 'PUT',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            name: clubName,\n            description: clubDescription,\n            location: clubLocation\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message || data.success) {\n            showToast('success', 'Club settings updated successfully', 'Settings Updated');\n\n            // Update the displayed information on the page\n            const clubNameDisplay = document.querySelector('.club-name');\n            if (clubNameDisplay) clubNameDisplay.textContent = clubName;\n\n            const clubDescDisplay = document.querySelector('.club-description');\n            if (clubDescDisplay) clubDescDisplay.textContent = clubDescription;\n\n            const clubLocDisplay = document.querySelector('.club-location');\n            if (clubLocDisplay) clubLocDisplay.textContent = clubLocation;\n\n        } else if (data.error && data.error.includes('Email verification required')) {\n            // Show verification modal and send code\n            showEmailVerificationModal(clubName, clubDescription, clubLocation);\n        } else {\n            showToast('error', data.error || 'Failed to update settings', 'Error');\n        }\n    })\n    .catch(error => {\n        console.error('Error updating settings:', error);\n        showToast('error', 'Error updating settings', 'Error');\n    })\n    .finally(() => {\n        // Reset the progress flag\n        settingsUpdateInProgress = false;\n    });\n}\n\n// Show email verification modal\nfunction showEmailVerificationModal(clubName, clubDescription, clubLocation) {\n    // Create modal HTML if it doesn't exist\n    let modal = document.getElementById('emailVerificationModal');\n    if (!modal) {\n        modal = document.createElement('div');\n        modal.id = 'emailVerificationModal';\n        modal.className = 'modal';\n        modal.style.cssText = 'display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow: auto;';\n        modal.innerHTML = `\n            <div class=\"modal-content\" style=\"background-color: var(--surface); margin: 10% auto; padding: 0; border-radius: var(--border-radius); max-width: 500px; width: 90%; box-shadow: var(--shadow-hover); position: relative;\">\n                <div class=\"modal-header\" style=\"padding: 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;\">\n                    <h3 style=\"margin: 0; color: var(--text);\"><i class=\"fas fa-envelope\"></i> Email Verification Required</h3>\n                    <button class=\"close\" onclick=\"closeEmailVerificationModal()\" style=\"background: none; border: none; font-size: 1.5rem; font-weight: bold; color: var(--text-secondary); cursor: pointer;\">&times;</button>\n                </div>\n                <div class=\"modal-body\" style=\"padding: 1.5rem;\">\n                    <div style=\"background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;\">\n                        <p style=\"margin: 0; color: #92400e; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <i class=\"fas fa-info-circle\" style=\"color: #f39c12;\"></i>\n                            A verification code is being sent to your email address. Please check your inbox and enter the code below.\n                        </p>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\" for=\"verificationCode\">Verification Code *</label>\n                        <input type=\"text\" id=\"verificationCode\" class=\"form-control\" placeholder=\"Enter 5-digit code\" maxlength=\"5\" pattern=\"[0-9]{5}\" style=\"text-align: center; font-size: 1.2rem; letter-spacing: 0.2rem;\">\n                        <small style=\"color: #64748b; font-size: 0.875rem; margin-top: 0.5rem; display: block;\">\n                            <i class=\"fas fa-clock\"></i> Code expires in 10 minutes\n                        </small>\n                    </div>\n                </div>\n                <div class=\"modal-footer\" style=\"padding: 1rem 1.5rem; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 1rem;\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeEmailVerificationModal()\">\n                        <i class=\"fas fa-times\"></i> Cancel\n                    </button>\n                    <button type=\"button\" class=\"btn btn-primary\" onclick=\"verifyCodeAndUpdateSettings('${clubName.replace(/'/g, \"\\\\'\")}', '${clubDescription.replace(/'/g, \"\\\\'\")}', '${clubLocation.replace(/'/g, \"\\\\'\")}')\">\n                        <i class=\"fas fa-check\"></i> Verify & Update\n                    </button>\n                </div>\n            </div>\n        `;\n        document.body.appendChild(modal);\n    }\n\n    // Clear previous code and show modal\n    document.getElementById('verificationCode').value = '';\n    modal.style.display = 'block';\n\n    // Focus on the input field\n    setTimeout(() => {\n        document.getElementById('verificationCode').focus();\n    }, 100);\n\n    // Send verification code using the club settings endpoint\n    sendVerificationCodeForSettings();\n}\n\n// Send verification code for settings update\nfunction sendVerificationCodeForSettings() {\n    fetch(`/api/clubs/${clubId}/settings`, {\n        method: 'PUT',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            step: 'send_verification'\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message || data.success) {\n            showToast('success', 'Verification code sent to your email', 'Code Sent');\n        } else {\n            showToast('error', data.error || 'Failed to send verification code', 'Error');\n        }\n    })\n    .catch(error => {\n        console.error('Error sending verification code:', error);\n        showToast('error', 'Error sending verification code', 'Error');\n    });\n}\n\n// Close email verification modal\nfunction closeEmailVerificationModal() {\n    const modal = document.getElementById('emailVerificationModal');\n    if (modal) {\n        modal.style.display = 'none';\n    }\n}\n\n// Verify code and update settings\nfunction verifyCodeAndUpdateSettings(clubName, clubDescription, clubLocation) {\n    const verificationCode = document.getElementById('verificationCode').value;\n\n    if (!verificationCode || verificationCode.length !== 5) {\n        showToast('error', 'Please enter a valid 5-digit verification code', 'Validation Error');\n        return;\n    }\n\n    // Step 1: Verify the email code first\n    fetch(`/api/clubs/${clubId}/settings`, {\n        method: 'PUT',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            step: 'verify_email',\n            verification_code: verificationCode\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success && data.email_verified) {\n            // Step 2: Now update the settings with email_verified flag\n            return fetch(`/api/clubs/${clubId}/settings`, {\n                method: 'PUT',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    name: clubName,\n                    description: clubDescription,\n                    location: clubLocation,\n                    email_verified: true\n                })\n            });\n        } else {\n            throw new Error(data.error || 'Email verification failed');\n        }\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message || data.success) {\n            closeEmailVerificationModal();\n            showToast('success', 'Club settings updated successfully', 'Settings Updated');\n\n            // Update the displayed information on the page\n            const clubNameDisplay = document.querySelector('.club-name');\n            if (clubNameDisplay) clubNameDisplay.textContent = clubName;\n\n            const clubDescDisplay = document.querySelector('.club-description');\n            if (clubDescDisplay) clubDescDisplay.textContent = clubDescription;\n\n            const clubLocDisplay = document.querySelector('.club-location');\n            if (clubLocDisplay) clubLocDisplay.textContent = clubLocation;\n\n        } else {\n            showToast('error', data.error || 'Failed to update settings', 'Error');\n        }\n    })\n    .catch(error => {\n        console.error('Error in verification process:', error);\n        showToast('error', error.message || 'Error updating settings', 'Error');\n    });\n}\n\n// Global variables for transactions pagination\nlet currentTransactionsPage = 1;\nlet totalTransactionsPages = 1;\n\nfunction loadTransactions(page = 1) {\n    if (!clubId) {\n        console.warn('loadTransactions: clubId is missing. Skipping fetch.');\n        const transactionsList = document.getElementById('transactionsList');\n        if (transactionsList) transactionsList.textContent = 'Error: Club information is unavailable to load transactions.';\n        return;\n    }\n\n    // Hide notification when user visits transactions tab\n    hideTransactionNotification();\n\n    const typeFilter = document.getElementById('transactionTypeFilter')?.value || '';\n    const dateFilter = document.getElementById('transactionDateFilter')?.value || '';\n\n    const params = new URLSearchParams({\n        page: page.toString(),\n        per_page: '25'\n    });\n\n    if (typeFilter) params.append('type', typeFilter);\n    if (dateFilter) params.append('date_range', dateFilter);\n\n    fetch(`/api/clubs/${clubId}/transactions?${params}`)\n        .then(response => {\n            if (response.status === 401) {\n                // Authentication failed - redirect to login\n                window.location.href = '/login';\n                return null;\n            }\n            if (response.status === 403) {\n                // Authorization failed - show error message\n                throw new Error('You do not have permission to view transactions');\n            }\n            return response.json();\n        })\n        .then(data => {\n            if (!data) return; // Handle null case from auth failure\n            const transactionsList = document.getElementById('transactionsList');\n            const pagination = document.getElementById('transactionsPagination');\n\n            transactionsList.innerHTML = '';\n\n            if (data.transactions && data.transactions.length > 0) {\n                // Update pagination info\n                currentTransactionsPage = data.pagination.page;\n                totalTransactionsPages = data.pagination.pages;\n\n                data.transactions.forEach(transaction => {\n                    const transactionCard = createTransactionCard(transaction);\n                    transactionsList.appendChild(transactionCard);\n                });\n\n                // Update pagination controls\n                updateTransactionsPagination(data);\n                pagination.style.display = 'flex';\n\n            } else {\n                const emptyState = createElement('div', 'empty-state');\n                const icon = createElement('i', 'fas fa-receipt');\n                const title = createElement('h3', '', 'No transactions yet');\n                const description = createElement('p', '', 'Transaction history will appear here when you earn or spend tokens.');\n\n                emptyState.appendChild(icon);\n                emptyState.appendChild(title);\n                emptyState.appendChild(description);\n                transactionsList.appendChild(emptyState);\n\n                pagination.style.display = 'none';\n            }\n        })\n        .catch(error => {\n            console.error('Error loading transactions:', error);\n            showToast('error', 'Failed to load transactions', 'Error');\n        });\n}\n\nfunction createTransactionCard(transaction) {\n    const card = createElement('div', 'transaction-card');\n\n    const isPositive = transaction.amount > 0;\n    const amountClass = isPositive ? 'positive' : 'negative';\n    const amountSign = isPositive ? '+' : '';\n\n    card.innerHTML = `\n        <div class=\"transaction-header\">\n            <div class=\"transaction-icon ${transaction.transaction_type}\">\n                <i class=\"fas ${getTransactionIcon(transaction.transaction_type)}\"></i>\n            </div>\n            <div class=\"transaction-info\">\n                <h4 class=\"transaction-description\">${escapeHtml(transaction.description)}</h4>\n                <div class=\"transaction-meta\">\n                    <span class=\"transaction-type\">${transaction.transaction_type.charAt(0).toUpperCase() + transaction.transaction_type.slice(1)}</span>\n                    ${transaction.user ? `<span class=\"transaction-user\">by ${escapeHtml(transaction.user.username || transaction.user.first_name + ' ' + transaction.user.last_name || transaction.user.email)}</span>` : ''}\n                    <span class=\"transaction-date\">${new Date(transaction.created_at).toLocaleDateString()}</span>\n                </div>\n            </div>\n            <div class=\"transaction-amount ${amountClass}\">\n                ${amountSign}${Math.abs(transaction.amount).toFixed(0)} tokens\n            </div>\n        </div>\n    `;\n\n    return card;\n}\n\nfunction getTransactionIcon(type) {\n    const icons = {\n        'credit': 'fa-plus-circle',\n        'debit': 'fa-minus-circle',\n        'grant': 'fa-gift',\n        'purchase': 'fa-shopping-cart',\n        'refund': 'fa-undo',\n        'manual': 'fa-edit'\n    };\n    return icons[type] || 'fa-exchange-alt';\n}\n\nfunction updateTransactionsPagination(data) {\n    const prevBtn = document.getElementById('prevPage');\n    const nextBtn = document.getElementById('nextPage');\n    const pageInfo = document.getElementById('pageInfo');\n\n    if (prevBtn && nextBtn && pageInfo) {\n        prevBtn.disabled = !data.pagination.has_prev;\n        nextBtn.disabled = !data.pagination.has_next;\n        pageInfo.textContent = `Page ${data.pagination.page} of ${data.pagination.pages}`;\n\n        // Update onclick handlers\n        prevBtn.onclick = () => {\n            if (data.pagination.has_prev) {\n                loadTransactions(data.pagination.page - 1);\n            }\n        };\n\n        nextBtn.onclick = () => {\n            if (data.pagination.has_next) {\n                loadTransactions(data.pagination.page + 1);\n            }\n        };\n    }\n}\n\n// Transaction notification functionality\nlet lastTransactionCount = 0;\nlet transactionCheckInterval = null;\n\nfunction checkForNewTransactions() {\n    if (!clubId) return;\n\n    fetch(`/api/clubs/${clubId}/transactions?page=1&per_page=1`)\n        .then(response => {\n            if (response.status === 401 || response.status === 403) {\n                // Authentication/authorization failed, stop checking\n                console.warn('Transaction check failed due to auth, stopping notifications');\n                if (transactionCheckInterval) {\n                    clearInterval(transactionCheckInterval);\n                    transactionCheckInterval = null;\n                }\n                return null;\n            }\n            return response.json();\n        })\n        .then(data => {\n            if (data && data.pagination && data.pagination.total > lastTransactionCount) {\n                if (lastTransactionCount > 0) { // Don't show on first load\n                    showTransactionNotification();\n                }\n                lastTransactionCount = data.pagination.total;\n                localStorage.setItem(`club_${clubId}_transaction_count`, lastTransactionCount);\n            }\n        })\n        .catch(error => {\n            console.error('Error checking for new transactions:', error);\n            // Stop checking if there are repeated errors\n            if (transactionCheckInterval) {\n                clearInterval(transactionCheckInterval);\n                transactionCheckInterval = null;\n            }\n        });\n}\n\nfunction showTransactionNotification() {\n    const notificationDot = document.getElementById('transactionsNotification');\n    if (notificationDot) {\n        notificationDot.style.display = 'block';\n    }\n}\n\nfunction hideTransactionNotification() {\n    const notificationDot = document.getElementById('transactionsNotification');\n    if (notificationDot) {\n        notificationDot.style.display = 'none';\n    }\n}\n\nfunction initializeTransactionNotifications() {\n    // Load last known transaction count from localStorage\n    const storedCount = localStorage.getItem(`club_${clubId}_transaction_count`);\n    if (storedCount) {\n        lastTransactionCount = parseInt(storedCount);\n    }\n\n    // Check for new transactions immediately\n    checkForNewTransactions();\n\n    // Set up periodic checking every 30 seconds\n    transactionCheckInterval = setInterval(checkForNewTransactions, 30000);\n}\n\n// Initialize transaction filters\ndocument.addEventListener('DOMContentLoaded', function() {\n    const typeFilter = document.getElementById('transactionTypeFilter');\n    const dateFilter = document.getElementById('transactionDateFilter');\n\n    if (typeFilter) {\n        typeFilter.addEventListener('change', () => loadTransactions(1));\n    }\n\n    if (dateFilter) {\n        dateFilter.addEventListener('change', () => loadTransactions(1));\n    }\n\n    // Initialize transaction notifications\n    if (clubId) {\n        initializeTransactionNotifications();\n    }\n});\n\n// Piggy Bank Functions\nlet currentPiggyBankPage = 1;\nlet totalPiggyBankPages = 1;\n\nfunction loadPiggyBankTransactions(page = 1) {\n    if (!clubId) {\n        console.warn('loadPiggyBankTransactions: clubId is missing. Skipping fetch.');\n        const piggyBankList = document.getElementById('piggyBankTransactionsList');\n        if (piggyBankList) piggyBankList.innerHTML = '<tr><td colspan=\"5\" class=\"text-center\">Error: Club information is unavailable.</td></tr>';\n        return;\n    }\n\n    const typeFilter = document.getElementById('piggyBankTypeFilter')?.value || '';\n\n    let url = `/api/clubs/${clubId}/piggy-bank/transactions?page=${page}&per_page=10`;\n    if (typeFilter) url += `&type=${typeFilter}`;\n\n    fetch(url)\n        .then(response => response.json())\n        .then(data => {\n            if (data.error) {\n                throw new Error(data.error);\n            }\n\n            const piggyBankList = document.getElementById('piggyBankTransactionsList');\n            const piggyBankAmount = document.querySelector('.piggy-bank-balance .balance-amount');\n\n            if (piggyBankAmount && data.club) {\n                piggyBankAmount.textContent = `${data.club.piggy_bank_balance} tokens`;\n            }\n\n            if (data.transactions.length === 0) {\n                piggyBankList.innerHTML = '<tr><td colspan=\"5\" class=\"text-center text-muted\">No piggy bank transactions found</td></tr>';\n            } else {\n                piggyBankList.innerHTML = data.transactions.map(transaction => {\n                    const date = new Date(transaction.created_at).toLocaleDateString();\n                    const time = new Date(transaction.created_at).toLocaleTimeString();\n                    const amount = transaction.amount;\n                    const amountClass = amount > 0 ? 'text-success' : 'text-danger';\n                    const amountText = amount > 0 ? `+${amount}` : amount;\n                    const typeText = transaction.transaction_type === 'piggy_bank_credit' ? 'Deposit' : 'Withdrawal';\n                    const projectInfo = transaction.reference_id ? `Project ${transaction.reference_id}` : 'N/A';\n\n                    return `\n                        <tr>\n                            <td>\n                                <div class=\"transaction-date\">\n                                    <div>${date}</div>\n                                    <small class=\"text-muted\">${time}</small>\n                                </div>\n                            </td>\n                            <td>\n                                <span class=\"badge ${transaction.transaction_type === 'piggy_bank_credit' ? 'badge-success' : 'badge-danger'}\">\n                                    ${typeText}\n                                </span>\n                            </td>\n                            <td class=\"${amountClass} font-weight-bold\">${amountText} tokens</td>\n                            <td class=\"transaction-description\">${transaction.description}</td>\n                            <td class=\"text-muted\">${projectInfo}</td>\n                        </tr>\n                    `;\n                }).join('');\n            }\n\n            // Update pagination\n            currentPiggyBankPage = data.pagination.page;\n            totalPiggyBankPages = data.pagination.pages;\n\n            const prevBtn = document.getElementById('piggyBankPrevPage');\n            const nextBtn = document.getElementById('piggyBankNextPage');\n            const pageInfo = document.getElementById('piggyBankPageInfo');\n\n            if (prevBtn && nextBtn && pageInfo) {\n                prevBtn.disabled = !data.pagination.has_prev;\n                nextBtn.disabled = !data.pagination.has_next;\n                pageInfo.textContent = `Page ${data.pagination.page} of ${data.pagination.pages}`;\n\n                prevBtn.onclick = () => {\n                    if (data.pagination.has_prev) {\n                        loadPiggyBankTransactions(data.pagination.page - 1);\n                    }\n                };\n                nextBtn.onclick = () => {\n                    if (data.pagination.has_next) {\n                        loadPiggyBankTransactions(data.pagination.page + 1);\n                    }\n                };\n            }\n        })\n        .catch(error => {\n            console.error('Error loading piggy bank transactions:', error);\n            const piggyBankList = document.getElementById('piggyBankTransactionsList');\n            if (piggyBankList) {\n                piggyBankList.innerHTML = '<tr><td colspan=\"5\" class=\"text-center text-danger\">Error loading piggy bank transactions</td></tr>';\n            }\n        });\n}\n\n// Initialize piggy bank event listeners\ndocument.addEventListener('DOMContentLoaded', function() {\n    const piggyBankTypeFilter = document.getElementById('piggyBankTypeFilter');\n    if (piggyBankTypeFilter) {\n        piggyBankTypeFilter.addEventListener('change', () => loadPiggyBankTransactions(1));\n    }\n});\n\n// Quest Management Functions\nasync function loadQuestData() {\n    if (!clubId) return;\n\n    try {\n        const response = await fetch(buildApiUrl(`/api/club/${clubId}/quests`));\n\n        if (response.status === 401) {\n            window.location.href = '/login';\n            return;\n        }\n\n        const data = await response.json();\n\n        if (response.ok) {\n            updateQuestDisplay(data);\n            updateQuestTimer(data.time_remaining);\n        } else {\n            console.error('Failed to load quest data:', data.error);\n        }\n    } catch (error) {\n        console.error('Error loading quest data:', error);\n    }\n}\n\nfunction updateQuestDisplay(data) {\n    const quests = data.quests;\n\n    quests.forEach(quest => {\n        if (quest.quest_type === 'gallery_post') {\n            updateGalleryQuestDisplay(quest);\n        } else if (quest.quest_type === 'member_projects') {\n            updateMemberProjectsQuestDisplay(quest);\n        }\n    });\n}\n\nfunction updateGalleryQuestDisplay(quest) {\n    const progressFill = document.getElementById('galleryProgress');\n    const progressText = document.getElementById('galleryProgressText');\n    const status = document.getElementById('galleryStatus');\n\n    if (progressFill) {\n        progressFill.style.width = `${quest.percentage}%`;\n    }\n\n    if (progressText) {\n        progressText.textContent = `${quest.progress}/${quest.target} posts`;\n    }\n\n    if (status) {\n        if (quest.completed) {\n            status.textContent = 'Completed';\n            status.className = 'quest-status completed';\n        } else {\n            status.textContent = 'Pending';\n            status.className = 'quest-status pending';\n        }\n    }\n}\n\nfunction updateMemberProjectsQuestDisplay(quest) {\n    const progressFill = document.getElementById('membersProgress');\n    const progressText = document.getElementById('membersProgressText');\n    const status = document.getElementById('membersStatus');\n\n    if (progressFill) {\n        progressFill.style.width = `${quest.percentage}%`;\n    }\n\n    if (progressText) {\n        progressText.textContent = `${quest.progress}/${quest.target} members`;\n    }\n\n    if (status) {\n        if (quest.completed) {\n            status.textContent = 'Completed';\n            status.className = 'quest-status completed';\n        } else {\n            status.textContent = 'Pending';\n            status.className = 'quest-status pending';\n        }\n    }\n}\n\nfunction updateQuestTimer(timeRemaining) {\n    const timerElement = document.getElementById('questTimer');\n    if (!timerElement) return;\n\n    function formatTime() {\n        const days = timeRemaining.days;\n        const hours = timeRemaining.hours;\n        const minutes = timeRemaining.minutes;\n\n        if (days > 0) {\n            return `${days}d ${hours}h ${minutes}m`;\n        } else if (hours > 0) {\n            return `${hours}h ${minutes}m`;\n        } else {\n            return `${minutes}m`;\n        }\n    }\n\n    timerElement.textContent = formatTime();\n\n    // Update the timer every minute\n    setInterval(() => {\n        // Decrease the time remaining\n        timeRemaining.minutes--;\n        if (timeRemaining.minutes < 0) {\n            timeRemaining.minutes = 59;\n            timeRemaining.hours--;\n            if (timeRemaining.hours < 0) {\n                timeRemaining.hours = 23;\n                timeRemaining.days--;\n                if (timeRemaining.days < 0) {\n                    // Week has reset, reload quest data\n                    loadQuestData();\n                    return;\n                }\n            }\n        }\n        timerElement.textContent = formatTime();\n    }, 60000); // Update every minute\n}\n\n// Transfer leadership functionality\nfunction initiateLeadershipTransfer() {\n    const newLeaderSelect = document.getElementById('newLeaderSelect');\n    const selectedUserId = newLeaderSelect.value;\n    const selectedUserText = newLeaderSelect.options[newLeaderSelect.selectedIndex].text;\n\n    if (!selectedUserId) {\n        showToast('error', 'Please select a member to become the new leader');\n        return;\n    }\n\n    // Parse username and email from the option text\n    const match = selectedUserText.match(/^(.+?) \\((.+?)\\)$/);\n    if (match) {\n        const username = match[1];\n        const email = match[2];\n\n        // Update the modal with the selected user info\n        document.getElementById('newLeaderAvatar').textContent = username.charAt(0).toUpperCase();\n        document.getElementById('newLeaderName').textContent = username;\n        document.getElementById('newLeaderEmail').textContent = email;\n\n        // Store the user ID for later use\n        document.getElementById('confirmTransferButton').setAttribute('data-user-id', selectedUserId);\n\n        // Show the transfer confirmation modal\n        document.getElementById('transferLeadershipModal').style.display = 'block';\n\n        // Reset the confirmation input\n        document.getElementById('transferConfirmationInput').value = '';\n        document.getElementById('confirmTransferButton').disabled = true;\n    }\n}\n\n// Function to confirm leadership transfer with email verification\nfunction confirmLeadershipTransfer() {\n    const confirmButton = document.getElementById('confirmTransferButton');\n    const newLeaderUserId = confirmButton.getAttribute('data-user-id');\n    const confirmationText = document.getElementById('transferConfirmationInput').value.trim();\n\n    if (!newLeaderUserId) {\n        showToast('error', 'No user selected for leadership transfer', 'Error');\n        return;\n    }\n\n    if (confirmationText.toUpperCase() !== 'TRANSFER') {\n        showToast('error', 'Please type TRANSFER to confirm', 'Validation Error');\n        return;\n    }\n\n    // First attempt without email verification\n    fetch(`/api/clubs/${clubId}/transfer-leadership`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            new_leader_id: parseInt(newLeaderUserId),\n            confirmation_text: confirmationText\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            document.getElementById('transferLeadershipModal').style.display = 'none';\n            showToast('success', data.message || 'Leadership transferred successfully', 'Success');\n            // Reload the page to reflect changes\n            setTimeout(() => {\n                window.location.reload();\n            }, 2000);\n        } else if (data.error && data.error.includes('Email verification required')) {\n            // Show verification modal and send code\n            showEmailVerificationModalForLeadershipTransfer(newLeaderUserId, confirmationText);\n        } else {\n            showToast('error', data.error || 'Failed to transfer leadership', 'Error');\n        }\n    })\n    .catch(error => {\n        console.error('Error transferring leadership:', error);\n        showToast('error', 'Error transferring leadership', 'Error');\n    });\n}\n\n// Email verification modal for leadership transfer\nfunction showEmailVerificationModalForLeadershipTransfer(newLeaderUserId, confirmationText) {\n    // Create modal HTML if it doesn't exist\n    let modal = document.getElementById('leadershipTransferVerificationModal');\n    if (!modal) {\n        modal = document.createElement('div');\n        modal.id = 'leadershipTransferVerificationModal';\n        modal.className = 'modal';\n        modal.style.cssText = 'display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow: auto;';\n        modal.innerHTML = `\n            <div class=\"modal-content\" style=\"background-color: var(--surface); margin: 10% auto; padding: 0; border-radius: var(--border-radius); max-width: 500px; width: 90%; box-shadow: var(--shadow-hover); position: relative;\">\n                <div class=\"modal-header\" style=\"padding: 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: between; align-items: center;\">\n                    <h3 style=\"margin: 0; color: #dc3545;\">\n                        <i class=\"fas fa-shield-alt\"></i> Verify Leadership Transfer\n                    </h3>\n                    <button class=\"close\" onclick=\"closeLeadershipTransferVerificationModal()\" style=\"background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);\">&times;</button>\n                </div>\n                <div class=\"modal-body\" style=\"padding: 1.5rem;\">\n                    <div style=\"background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;\">\n                        <p style=\"margin: 0; color: #92400e; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <i class=\"fas fa-info-circle\" style=\"color: #f39c12;\"></i>\n                            A verification code is being sent to your email address. Please check your inbox and enter the code below.\n                        </p>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\" for=\"leadershipTransferVerificationCode\">Verification Code *</label>\n                        <input type=\"text\" id=\"leadershipTransferVerificationCode\" class=\"form-control\" placeholder=\"Enter 5-digit code\" maxlength=\"5\" pattern=\"[0-9]{5}\" style=\"text-align: center; font-size: 1.2rem; letter-spacing: 0.2rem;\">\n                        <small style=\"color: #64748b; font-size: 0.875rem; margin-top: 0.5rem; display: block;\">\n                            <i class=\"fas fa-clock\"></i> Code expires in 10 minutes\n                        </small>\n                    </div>\n                </div>\n                <div class=\"modal-footer\" style=\"padding: 1rem 1.5rem; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 1rem;\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeLeadershipTransferVerificationModal()\">\n                        <i class=\"fas fa-times\"></i> Cancel\n                    </button>\n                    <button type=\"button\" class=\"btn btn-danger\" onclick=\"verifyCodeAndTransferLeadership()\">\n                        <i class=\"fas fa-shield-alt\"></i> Verify & Transfer\n                    </button>\n                </div>\n            </div>\n        `;\n        document.body.appendChild(modal);\n    }\n\n    // Store the transfer details for later use\n    modal.setAttribute('data-new-leader-id', newLeaderUserId);\n    modal.setAttribute('data-confirmation-text', confirmationText);\n\n    // Clear previous code and show modal\n    document.getElementById('leadershipTransferVerificationCode').value = '';\n    modal.style.display = 'block';\n\n    // Focus on the input field\n    setTimeout(() => {\n        document.getElementById('leadershipTransferVerificationCode').focus();\n    }, 100);\n\n    // Send verification code\n    sendVerificationCodeForLeadershipTransfer();\n}\n\n// Send verification code for leadership transfer\nfunction sendVerificationCodeForLeadershipTransfer() {\n    fetch(`/api/clubs/${clubId}/transfer-leadership`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            step: 'send_verification'\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message || data.success) {\n            showToast('success', 'Verification code sent to your email', 'Code Sent');\n        } else {\n            showToast('error', data.error || 'Failed to send verification code', 'Error');\n        }\n    })\n    .catch(error => {\n        console.error('Error sending verification code:', error);\n        showToast('error', 'Error sending verification code', 'Error');\n    });\n}\n\n// Close leadership transfer verification modal\nfunction closeLeadershipTransferVerificationModal() {\n    const modal = document.getElementById('leadershipTransferVerificationModal');\n    if (modal) {\n        modal.style.display = 'none';\n    }\n}\n\n// Verify code and transfer leadership\nfunction verifyCodeAndTransferLeadership() {\n    const modal = document.getElementById('leadershipTransferVerificationModal');\n    const verificationCode = document.getElementById('leadershipTransferVerificationCode').value;\n    const newLeaderUserId = modal.getAttribute('data-new-leader-id');\n    const confirmationText = modal.getAttribute('data-confirmation-text');\n\n    if (!verificationCode || verificationCode.length !== 5) {\n        showToast('error', 'Please enter a valid 5-digit verification code', 'Validation Error');\n        return;\n    }\n\n    // Step 1: Verify the email code first\n    fetch(`/api/clubs/${clubId}/transfer-leadership`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            step: 'verify_email',\n            verification_code: verificationCode\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success && data.email_verified) {\n            // Step 2: Now perform the leadership transfer with email_verified flag\n            return fetch(`/api/clubs/${clubId}/transfer-leadership`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    new_leader_id: parseInt(newLeaderUserId),\n                    confirmation_text: confirmationText,\n                    email_verified: true\n                })\n            });\n        } else {\n            throw new Error(data.error || 'Email verification failed');\n        }\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            closeLeadershipTransferVerificationModal();\n            document.getElementById('transferLeadershipModal').style.display = 'none';\n            showToast('success', data.message || 'Leadership transferred successfully', 'Success');\n            // Reload the page to reflect changes\n            setTimeout(() => {\n                window.location.reload();\n            }, 2000);\n        } else {\n            showToast('error', data.error || 'Failed to transfer leadership', 'Error');\n        }\n    })\n    .catch(error => {\n        console.error('Error in verification process:', error);\n        showToast('error', `Error transferring leadership: ${error.message}`, 'Error');\n    });\n}\n\n// Slack Integration Functions\nasync function loadSlackSettings() {\n    try {\n        const response = await fetch(buildApiUrl(`/api/club/${clubId}/slack/settings`));\n        const data = await response.json();\n\n        if (data.settings) {\n            // Populate form with existing settings\n            document.getElementById('slackChannelId').value = data.settings.channel_id || '';\n            document.getElementById('slackChannelName').value = data.settings.channel_name || '';\n            document.getElementById('slackIsPublic').checked = data.settings.is_public !== false;\n\n            // Show invite section if channel is configured\n            if (data.settings.channel_id) {\n                document.getElementById('slackInviteCard').style.display = 'block';\n                document.getElementById('currentChannelInfo').style.display = 'block';\n                document.getElementById('displayChannelName').textContent = data.settings.channel_name || '#your-channel';\n                document.getElementById('displayChannelId').textContent = data.settings.channel_id;\n            }\n        }\n    } catch (error) {\n        console.error('Error loading Slack settings:', error);\n    }\n}\n\nasync function saveSlackSettings(event) {\n    event.preventDefault();\n\n    const channelId = document.getElementById('slackChannelId').value.trim();\n    const channelName = document.getElementById('slackChannelName').value.trim();\n    const isPublic = document.getElementById('slackIsPublic').checked;\n\n    if (!channelId) {\n        showToast('error', 'Channel ID is required');\n        return;\n    }\n\n    if (!channelId.startsWith('C')) {\n        showToast('error', 'Invalid channel ID format. Should start with \"C\"');\n        return;\n    }\n\n    try {\n        const response = await fetch(buildApiUrl(`/api/club/${clubId}/slack/settings`), {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                channel_id: channelId,\n                channel_name: channelName,\n                is_public: isPublic\n            })\n        });\n\n        const data = await response.json();\n\n        if (response.ok) {\n            showToast('success', 'Slack settings saved successfully!');\n\n            // Show invite section\n            document.getElementById('slackInviteCard').style.display = 'block';\n            document.getElementById('currentChannelInfo').style.display = 'block';\n            document.getElementById('displayChannelName').textContent = channelName || '#your-channel';\n            document.getElementById('displayChannelId').textContent = channelId;\n        } else {\n            showToast('error', data.error || 'Failed to save Slack settings');\n        }\n    } catch (error) {\n        console.error('Error saving Slack settings:', error);\n        showToast('error', 'Failed to save Slack settings');\n    }\n}\n\nasync function bulkInviteToSlack() {\n    // Get current channel info\n    const channelName = document.getElementById('displayChannelName').textContent;\n    const channelId = document.getElementById('displayChannelId').textContent;\n\n    // Update modal with current channel info\n    document.getElementById('bulkInviteChannelName').textContent = channelName;\n    document.getElementById('bulkInviteChannelId').textContent = channelId;\n\n    // Show confirmation modal\n    document.getElementById('slackBulkInviteModal').style.display = 'block';\n}\n\nasync function confirmBulkInvite() {\n    const bulkInviteButton = document.querySelector('#slackBulkInviteModal .btn-primary');\n    const originalContent = bulkInviteButton.innerHTML;\n\n    // Show loading state\n    bulkInviteButton.disabled = true;\n    bulkInviteButton.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Sending Invitations...';\n\n    try {\n        const response = await fetch(buildApiUrl(`/api/club/${clubId}/slack/bulk-invite`), {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            }\n        });\n\n        const data = await response.json();\n\n        // Close confirmation modal\n        closeSlackBulkInviteModal();\n\n        if (response.ok) {\n            let resultHtml = `\n                <div style=\"color: #10b981; margin-bottom: 1rem;\">\n                    <i class=\"fas fa-check-circle\"></i> <strong>Success!</strong>\n                </div>\n                <p><strong>${data.success_count}</strong> out of <strong>${data.total_members}</strong> members invited successfully.</p>\n            `;\n\n            if (data.failed_invitations && data.failed_invitations.length > 0) {\n                resultHtml += `\n                    <div style=\"margin-top: 1rem;\">\n                        <p><strong>Failed invitations (${data.failed_invitations.length}):</strong></p>\n                        <ul style=\"margin: 0; padding-left: 1.5rem;\">\n                            ${data.failed_invitations.map(email => `<li>${email}</li>`).join('')}\n                        </ul>\n                    </div>\n                `;\n            }\n\n            showSlackInviteResult(resultHtml);\n        } else {\n            showSlackInviteResult(`\n                <div style=\"color: #ef4444; margin-bottom: 1rem;\">\n                    <i class=\"fas fa-times-circle\"></i> <strong>Error</strong>\n                </div>\n                <p>${data.error || 'Failed to send bulk invitations'}</p>\n            `);\n        }\n    } catch (error) {\n        console.error('Error sending bulk invitations:', error);\n        closeSlackBulkInviteModal();\n        showSlackInviteResult(`\n            <div style=\"color: #ef4444; margin-bottom: 1rem;\">\n                <i class=\"fas fa-times-circle\"></i> <strong>Error</strong>\n            </div>\n            <p>Failed to send bulk invitations. Please try again.</p>\n        `);\n    } finally {\n        // Restore button state\n        bulkInviteButton.disabled = false;\n        bulkInviteButton.innerHTML = originalContent;\n    }\n}\n\nfunction closeSlackBulkInviteModal() {\n    document.getElementById('slackBulkInviteModal').style.display = 'none';\n}\n\nfunction showSlackInviteResult(content) {\n    document.getElementById('slackInviteResultContent').innerHTML = content;\n    document.getElementById('slackInviteResultModal').style.display = 'block';\n}\n\nfunction closeSlackInviteResultModal() {\n    document.getElementById('slackInviteResultModal').style.display = 'none';\n}\n\nasync function inviteIndividualToSlack() {\n    const selectElement = document.getElementById('individualInviteSelect');\n    const email = selectElement.value.trim();\n    const selectedText = selectElement.options[selectElement.selectedIndex].text;\n    const inviteButton = document.querySelector('button[onclick=\"inviteIndividualToSlack()\"]');\n\n    if (!email) {\n        showSlackInviteResult(`\n            <div style=\"color: #f59e0b; margin-bottom: 1rem;\">\n                <i class=\"fas fa-exclamation-triangle\"></i> <strong>No Selection</strong>\n            </div>\n            <p>Please select a member to invite.</p>\n        `);\n        return;\n    }\n\n    // Show loading state\n    const originalContent = inviteButton.innerHTML;\n    inviteButton.disabled = true;\n    inviteButton.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Sending...';\n\n    try {\n        const response = await fetch(buildApiUrl(`/api/club/${clubId}/slack/invite`), {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                email: email\n            })\n        });\n\n        const data = await response.json();\n\n        if (response.ok) {\n            showSlackInviteResult(`\n                <div style=\"color: #10b981; margin-bottom: 1rem;\">\n                    <i class=\"fas fa-check-circle\"></i> <strong>Success!</strong>\n                </div>\n                <p>Successfully invited <strong>${selectedText}</strong> to the Slack channel.</p>\n            `);\n            selectElement.value = '';\n        } else {\n            showSlackInviteResult(`\n                <div style=\"color: #ef4444; margin-bottom: 1rem;\">\n                    <i class=\"fas fa-times-circle\"></i> <strong>Error</strong>\n                </div>\n                <p>${data.error || 'Failed to send invitation'}</p>\n            `);\n        }\n    } catch (error) {\n        console.error('Error sending individual invitation:', error);\n        showSlackInviteResult(`\n            <div style=\"color: #ef4444; margin-bottom: 1rem;\">\n                <i class=\"fas fa-times-circle\"></i> <strong>Error</strong>\n            </div>\n            <p>Failed to send invitation. Please try again.</p>\n        `);\n    } finally {\n        // Restore button state\n        inviteButton.disabled = false;\n        inviteButton.innerHTML = originalContent;\n    }\n}\n\nasync function inviteByEmailToSlack() {\n    const emailInput = document.getElementById('inviteByEmailInput');\n    const email = emailInput.value.trim();\n    const emailInviteButton = document.querySelector('button[onclick=\"inviteByEmailToSlack()\"]');\n\n    if (!email) {\n        showSlackInviteResult(`\n            <div style=\"color: #f59e0b; margin-bottom: 1rem;\">\n                <i class=\"fas fa-exclamation-triangle\"></i> <strong>No Email</strong>\n            </div>\n            <p>Please enter an email address to invite.</p>\n        `);\n        return;\n    }\n\n    if (!email.includes('@')) {\n        showSlackInviteResult(`\n            <div style=\"color: #f59e0b; margin-bottom: 1rem;\">\n                <i class=\"fas fa-exclamation-triangle\"></i> <strong>Invalid Email</strong>\n            </div>\n            <p>Please enter a valid email address.</p>\n        `);\n        return;\n    }\n\n    // Show loading state\n    const originalContent = emailInviteButton.innerHTML;\n    emailInviteButton.disabled = true;\n    emailInviteButton.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Sending...';\n\n    try {\n        const response = await fetch(buildApiUrl(`/api/club/${clubId}/slack/invite`), {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                email: email\n            })\n        });\n\n        const data = await response.json();\n\n        if (response.ok) {\n            showSlackInviteResult(`\n                <div style=\"color: #10b981; margin-bottom: 1rem;\">\n                    <i class=\"fas fa-check-circle\"></i> <strong>Success!</strong>\n                </div>\n                <p>Successfully invited <strong>${email}</strong> to the Slack channel.</p>\n            `);\n            emailInput.value = '';\n        } else {\n            showSlackInviteResult(`\n                <div style=\"color: #ef4444; margin-bottom: 1rem;\">\n                    <i class=\"fas fa-times-circle\"></i> <strong>Error</strong>\n                </div>\n                <p>${data.error || 'Failed to send invitation'}</p>\n            `);\n        }\n    } catch (error) {\n        console.error('Error sending email invitation:', error);\n        showSlackInviteResult(`\n            <div style=\"color: #ef4444; margin-bottom: 1rem;\">\n                <i class=\"fas fa-times-circle\"></i> <strong>Error</strong>\n            </div>\n            <p>Failed to send invitation. Please try again.</p>\n        `);\n    } finally {\n        // Restore button state\n        emailInviteButton.disabled = false;\n        emailInviteButton.innerHTML = originalContent;\n    }\n}\n\n// Co-leader management functions\nfunction promoteToCoLeader(userId, username) {\n    if (!clubId) {\n        showToast('error', 'Cannot promote member: Club ID is missing.', 'Error');\n        return;\n    }\n\n    showConfirmModal(\n        `Promote ${username} to Co-Leader?`,\n        'This will give them management privileges for the club.',\n        () => {\n            // First attempt without email verification\n            fetch(`/api/clubs/${clubId}/co-leader`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    user_id: userId\n                })\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    showToast('success', 'Member promoted to co-leader successfully', 'Promoted');\n                    // Reload the page to update the members list\n                    window.location.reload();\n                } else if (data.error && data.error.includes('Email verification required')) {\n                    // Show verification modal and send code\n                    showEmailVerificationModalForCoLeader(userId, username, 'promote');\n                } else {\n                    showToast('error', data.error || 'Failed to promote member', 'Error');\n                }\n            })\n            .catch(error => {\n                console.error('Error promoting member:', error);\n                showToast('error', 'Error promoting member', 'Error');\n            });\n        }\n    );\n}\n\nfunction removeCoLeader(userId, username) {\n    if (!clubId) {\n        showToast('error', 'Cannot remove co-leader: Club ID is missing.', 'Error');\n        return;\n    }\n\n    showConfirmModal(\n        `Remove ${username || 'Co-Leader'}?`,\n        'This will revoke their management privileges.',\n        () => {\n            // First attempt without email verification\n            fetch(`/api/clubs/${clubId}/co-leader`, {\n                method: 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({ user_id: userId })\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    showToast('success', 'Co-leader removed successfully', 'Removed');\n                    // Reload the page to update the members list\n                    window.location.reload();\n                } else if (data.error && data.error.includes('Email verification required')) {\n                    // Show verification modal and send code\n                    showEmailVerificationModalForCoLeader(null, null, 'remove');\n                } else {\n                    showToast('error', data.error || 'Failed to remove co-leader', 'Error');\n                }\n            })\n            .catch(error => {\n                console.error('Error removing co-leader:', error);\n                showToast('error', 'Error removing co-leader', 'Error');\n            });\n        }\n    );\n}\n\n// Email verification modal for co-leader management\nfunction showEmailVerificationModalForCoLeader(userId, username, action) {\n    // Create modal HTML if it doesn't exist\n    let modal = document.getElementById('coLeaderVerificationModal');\n    if (!modal) {\n        modal = document.createElement('div');\n        modal.id = 'coLeaderVerificationModal';\n        modal.className = 'modal';\n        modal.style.cssText = 'display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow: auto;';\n        modal.innerHTML = `\n            <div class=\"modal-content\" style=\"background-color: var(--surface); margin: 10% auto; padding: 0; border-radius: var(--border-radius); max-width: 500px; width: 90%; box-shadow: var(--shadow-hover); position: relative;\">\n                <div class=\"modal-header\" style=\"padding: 1.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;\">\n                    <h3 style=\"margin: 0; color: var(--text);\"><i class=\"fas fa-envelope\"></i> Email Verification Required</h3>\n                    <button class=\"close\" onclick=\"closeCoLeaderVerificationModal()\" style=\"background: none; border: none; font-size: 1.5rem; font-weight: bold; color: var(--text-secondary); cursor: pointer;\">&times;</button>\n                </div>\n                <div class=\"modal-body\" style=\"padding: 1.5rem;\">\n                    <div style=\"background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;\">\n                        <p style=\"margin: 0; color: #92400e; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;\">\n                            <i class=\"fas fa-info-circle\" style=\"color: #f39c12;\"></i>\n                            A verification code is being sent to your email address. Please check your inbox and enter the code below.\n                        </p>\n                    </div>\n                    <div class=\"form-group\">\n                        <label class=\"form-label\" for=\"coLeaderVerificationCode\">Verification Code *</label>\n                        <input type=\"text\" id=\"coLeaderVerificationCode\" class=\"form-control\" placeholder=\"Enter 5-digit code\" maxlength=\"5\" pattern=\"[0-9]{5}\" style=\"text-align: center; font-size: 1.2rem; letter-spacing: 0.2rem;\">\n                        <small style=\"color: #64748b; font-size: 0.875rem; margin-top: 0.5rem; display: block;\">\n                            <i class=\"fas fa-clock\"></i> Code expires in 10 minutes\n                        </small>\n                    </div>\n                </div>\n                <div class=\"modal-footer\" style=\"padding: 1rem 1.5rem; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 1rem;\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"closeCoLeaderVerificationModal()\">\n                        <i class=\"fas fa-times\"></i> Cancel\n                    </button>\n                    <button type=\"button\" class=\"btn btn-primary\" onclick=\"verifyCodeAndManageCoLeader()\">\n                        <i class=\"fas fa-check\"></i> Verify & Continue\n                    </button>\n                </div>\n            </div>\n        `;\n        document.body.appendChild(modal);\n    }\n\n    // Store the action and user info for later use\n    modal.setAttribute('data-action', action);\n    if (userId) modal.setAttribute('data-user-id', userId);\n    if (username) modal.setAttribute('data-username', username);\n\n    // Clear previous code and show modal\n    document.getElementById('coLeaderVerificationCode').value = '';\n    modal.style.display = 'block';\n\n    // Focus on the input field\n    setTimeout(() => {\n        document.getElementById('coLeaderVerificationCode').focus();\n    }, 100);\n\n    // Send verification code\n    sendVerificationCodeForCoLeader();\n}\n\n// Send verification code for co-leader management\nfunction sendVerificationCodeForCoLeader() {\n    fetch(`/api/clubs/${clubId}/co-leader`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            step: 'send_verification'\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.message || data.success) {\n            showToast('success', 'Verification code sent to your email', 'Code Sent');\n        } else {\n            showToast('error', data.error || 'Failed to send verification code', 'Error');\n        }\n    })\n    .catch(error => {\n        console.error('Error sending verification code:', error);\n        showToast('error', 'Error sending verification code', 'Error');\n    });\n}\n\n// Close co-leader verification modal\nfunction closeCoLeaderVerificationModal() {\n    const modal = document.getElementById('coLeaderVerificationModal');\n    if (modal) {\n        modal.style.display = 'none';\n    }\n}\n\n// Verify code and manage co-leader\nfunction verifyCodeAndManageCoLeader() {\n    const modal = document.getElementById('coLeaderVerificationModal');\n    const verificationCode = document.getElementById('coLeaderVerificationCode').value;\n    const action = modal.getAttribute('data-action');\n    const userId = modal.getAttribute('data-user-id');\n    const username = modal.getAttribute('data-username');\n\n    if (!verificationCode || verificationCode.length !== 5) {\n        showToast('error', 'Please enter a valid 5-digit verification code', 'Validation Error');\n        return;\n    }\n\n    // Step 1: Verify the email code first\n    fetch(`/api/clubs/${clubId}/co-leader`, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            step: 'verify_email',\n            verification_code: verificationCode\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success && data.email_verified) {\n            // Step 2: Now perform the co-leader management action with email_verified flag\n            const requestBody = {\n                email_verified: true\n            };\n\n            if (action === 'promote') {\n                requestBody.user_id = parseInt(userId);\n            }\n\n            return fetch(`/api/clubs/${clubId}/co-leader`, {\n                method: action === 'promote' ? 'POST' : 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(requestBody)\n            });\n        } else {\n            throw new Error(data.error || 'Email verification failed');\n        }\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            closeCoLeaderVerificationModal();\n            const actionText = action === 'promote' ? 'promoted to co-leader' : 'removed as co-leader';\n            showToast('success', `Member ${actionText} successfully`, 'Success');\n            // Reload the page to update the members list\n            window.location.reload();\n        } else {\n            showToast('error', data.error || `Failed to ${action} co-leader`, 'Error');\n        }\n    })\n    .catch(error => {\n        console.error('Error in verification process:', error);\n        showToast('error', `Error managing co-leader: ${error.message}`, 'Error');\n    });\n}\n\nfunction confirmRemoveMember(userId, username) {\n    if (!clubId) {\n        showToast('error', 'Cannot remove member: Club ID is missing.', 'Error');\n        return;\n    }\n\n    showConfirmModal(\n        `Remove ${username} from the club?`,\n        'This action cannot be undone.',\n        'danger',\n        () => {\n            fetch(`/api/clubs/${clubId}/members/${userId}`, {\n                method: 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    showToast('success', 'Member removed successfully', 'Member Removed');\n                    // Reload the page to update the members list\n                    window.location.reload();\n                } else {\n                    showToast('error', data.error || 'Failed to remove member', 'Error');\n                }\n            })\n            .catch(error => {\n                console.error('Error removing member:', error);\n                showToast('error', 'Error removing member', 'Error');\n            });\n        }\n    );\n}\n\n// Leave club function for regular members\nfunction confirmLeaveClub() {\n    if (!clubId) {\n        showToast('error', 'Cannot leave club: Club ID is missing.', 'Error');\n        return;\n    }\n\n    if (!window.clubData) {\n        showToast('error', 'Cannot leave club: Missing club data.', 'Error');\n        return;\n    }\n\n    // Get current user ID from window.currentUserId (set in club_dashboard.html)\n    if (!window.currentUserId) {\n        showToast('error', 'Cannot leave club: User ID is missing.', 'Error');\n        return;\n    }\n\n    showConfirmModal(\n        `Leave ${window.clubData.name}?`,\n        'You will need a new join code to rejoin this club.',\n        'danger',\n        () => {\n            fetch(`/api/clubs/${clubId}/members/${window.currentUserId}`, {\n                method: 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    showToast('success', 'You have left the club', 'Left Club');\n                    // Redirect to dashboard after leaving\n                    setTimeout(() => {\n                        window.location.href = '/dashboard';\n                    }, 1000);\n                } else {\n                    showToast('error', data.error || 'Failed to leave club', 'Error');\n                }\n            })\n            .catch(error => {\n                console.error('Error leaving club:', error);\n                showToast('error', 'Error leaving club', 'Error');\n            });\n        }\n    );\n}\n\n// Slack form event listener\nconst slackForm = document.getElementById('slackSettingsForm');\nif (slackForm) {\n    slackForm.addEventListener('submit', saveSlackSettings);\n}\n\n// Club settings form event listener\nconst clubSettingsForm = document.getElementById('clubSettingsForm');\nif (clubSettingsForm) {\n    clubSettingsForm.addEventListener('submit', updateClubSettings);\n}\n\n// Transfer confirmation input event listener\nconst transferConfirmationInput = document.getElementById('transferConfirmationInput');\nif (transferConfirmationInput) {\n    transferConfirmationInput.addEventListener('input', function() {\n        const input = this.value.trim();\n        const button = document.getElementById('confirmTransferButton');\n        if (button) {\n            button.disabled = input !== 'TRANSFER';\n        }\n    });\n}\n\n// Chat functionality\nlet chatMessages = [];\nlet chatInitialized = false;\nlet currentImageFile = null;\nlet currentImagePreview = null;\n\nfunction initializeChat() {\n    if (chatInitialized || !clubId) return;\n\n    const chatInput = document.getElementById('chatMessageInput');\n    const sendButton = document.getElementById('sendChatMessage');\n    const chatStatus = document.getElementById('chatStatus');\n\n    if (!chatInput || !sendButton) return;\n\n    chatInitialized = true;\n\n    // Load existing messages\n    loadChatMessages();\n\n    // Setup send message functionality\n    chatInput.addEventListener('keypress', function(e) {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            sendChatMessage();\n        }\n    });\n\n    sendButton.addEventListener('click', sendChatMessage);\n\n    // Update character counter\n    chatInput.addEventListener('input', function() {\n        const remaining = 1000 - this.value.length;\n        const placeholder = `Type your message (${remaining} chars remaining)...`;\n        this.placeholder = placeholder;\n    });\n\n    // Poll for new messages every 5 seconds\n    setInterval(() => {\n        if (document.querySelector('#chat.club-section.active')) {\n            loadChatMessages();\n        }\n    }, 5000);\n\n    // Setup modal event listeners\n    const confirmDeleteBtn = document.getElementById('confirmDeleteMessage');\n    const confirmEditBtn = document.getElementById('confirmEditMessage');\n\n    if (confirmDeleteBtn) {\n        confirmDeleteBtn.addEventListener('click', confirmDeleteMessage);\n    }\n\n    if (confirmEditBtn) {\n        confirmEditBtn.addEventListener('click', confirmEditMessage);\n    }\n\n    // Setup image upload functionality\n    setupImageUpload();\n}\n\nfunction loadChatMessages() {\n    const chatStatus = document.getElementById('chatStatus');\n\n    fetch(buildApiUrl(`/api/club/${clubId}/chat/messages`))\n        .then(response => response.json())\n        .then(data => {\n            if (data.error) {\n                chatStatus.textContent = 'Error loading messages';\n                return;\n            }\n\n            const newMessages = data.messages || [];\n\n            // Only re-render if messages have changed\n            if (JSON.stringify(newMessages) !== JSON.stringify(chatMessages)) {\n                chatMessages = newMessages;\n                renderChatMessages();\n            }\n\n            // Enable input and button\n            const chatInput = document.getElementById('chatMessageInput');\n            const sendButton = document.getElementById('sendChatMessage');\n            const uploadButton = document.getElementById('uploadImageButton');\n            if (chatInput && sendButton) {\n                chatInput.disabled = false;\n                sendButton.disabled = false;\n                if (uploadButton) {\n                    uploadButton.disabled = false;\n                }\n                chatStatus.textContent = '';\n            }\n        })\n        .catch(error => {\n            console.error('Error loading chat messages:', error);\n            chatStatus.textContent = 'Error loading messages';\n        });\n}\n\nfunction renderChatMessages() {\n    const messagesContainer = document.getElementById('chatMessages');\n    if (!messagesContainer) return;\n\n    if (chatMessages.length === 0) {\n        messagesContainer.innerHTML = '<div class=\"no-messages\">No messages yet. Start the conversation!</div>';\n        return;\n    }\n\n    const messagesHTML = chatMessages.map(message => {\n        const messageDate = new Date(message.created_at);\n        const timeString = messageDate.toLocaleTimeString('en-US', { \n            hour: '2-digit', \n            minute: '2-digit',\n            hour12: true \n        });\n        const dateString = messageDate.toLocaleDateString('en-US', { \n            month: 'short', \n            day: 'numeric' \n        });\n\n        const actionButtons = [];\n\n        if (message.can_edit && message.message) { // Only allow editing text messages\n            const escapedMessage = (message.message || '').replace(/'/g, \"\\\\'\").replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\r');\n            actionButtons.push(`\n                <button class=\"edit-message-btn\" onclick=\"editChatMessage(${message.id}, '${escapedMessage}')\" title=\"Edit message\">\n                    <i class=\"fas fa-edit\"></i>\n                </button>\n            `);\n        }\n\n        if (message.can_delete) {\n            const previewText = message.message || (message.image_url ? '[Image]' : '[Message]');\n            const escapedPreview = previewText.replace(/'/g, \"\\\\'\").replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\r');\n            actionButtons.push(`\n                <button class=\"delete-message-btn\" onclick=\"showDeleteConfirmation(${message.id}, '${escapedPreview}')\" title=\"Delete message\">\n                    <i class=\"fas fa-trash\"></i>\n                </button>\n            `);\n        }\n\n        const buttonsHtml = actionButtons.length > 0 \n            ? `<div class=\"message-actions\">${actionButtons.join('')}</div>`\n            : '';\n\n        // Build message content\n        let messageContent = '';\n\n        // Add image if present\n        if (message.image_url) {\n            messageContent += `<div class=\"message-image\">\n                <img src=\"${message.image_url}\" alt=\"Shared image\" onclick=\"openImageModal('${message.image_url}')\">\n            </div>`;\n        }\n\n        // Add text if present\n        if (message.message) {\n            messageContent += `<div class=\"message-text\">${message.message}</div>`;\n        }\n\n        return `\n            <div class=\"chat-message\" data-message-id=\"${message.id}\">\n                <div class=\"message-header\">\n                    <span class=\"message-username\">${escapeHtml(message.username)}</span>\n                    <span class=\"message-time\">${dateString} ${timeString}</span>\n                    ${buttonsHtml}\n                </div>\n                <div class=\"message-content\">${messageContent}</div>\n            </div>\n        `;\n    }).join('');\n\n    messagesContainer.innerHTML = messagesHTML;\n\n    // Auto-scroll to bottom\n    messagesContainer.scrollTop = messagesContainer.scrollHeight;\n}\n\nfunction sendChatMessage() {\n    const chatInput = document.getElementById('chatMessageInput');\n    const sendButton = document.getElementById('sendChatMessage');\n    const chatStatus = document.getElementById('chatStatus');\n\n    if (!chatInput || !sendButton) return;\n\n    const message = chatInput.value.trim();\n\n    // Must have either message or image\n    if (!message && !currentImagePreview) return;\n\n    // Disable input while sending\n    chatInput.disabled = true;\n    sendButton.disabled = true;\n    chatStatus.textContent = 'Sending...';\n\n    // If we have an image, upload it first\n    if (currentImagePreview) {\n        uploadImageAndSendMessage(message);\n    } else {\n        // Just send text message\n        sendTextMessage(message);\n    }\n}\n\nfunction sendTextMessage(message) {\n    const chatInput = document.getElementById('chatMessageInput');\n    const sendButton = document.getElementById('sendChatMessage');\n    const chatStatus = document.getElementById('chatStatus');\n\n    fetch(buildApiUrl(`/api/club/${clubId}/chat/messages`), {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ message: message })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.error) {\n            showToast('error', data.error, 'Error');\n            chatStatus.textContent = '';\n        } else {\n            // Clear input and refresh messages\n            chatInput.value = '';\n            chatInput.placeholder = 'Type your message or paste/upload an image...';\n            loadChatMessages();\n        }\n    })\n    .catch(error => {\n        console.error('Error sending message:', error);\n        showToast('error', 'Failed to send message', 'Error');\n        chatStatus.textContent = '';\n    })\n    .finally(() => {\n        // Re-enable input\n        chatInput.disabled = false;\n        sendButton.disabled = false;\n    });\n}\n\nfunction uploadImageAndSendMessage(message) {\n    const chatInput = document.getElementById('chatMessageInput');\n    const sendButton = document.getElementById('sendChatMessage');\n    const chatStatus = document.getElementById('chatStatus');\n\n    chatStatus.textContent = 'Uploading image...';\n\n    fetch(buildApiUrl(`/api/club/${clubId}/chat/upload-image`), {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ image: currentImagePreview })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.error) {\n            showToast('error', data.error, 'Error');\n            chatStatus.textContent = '';\n            chatInput.disabled = false;\n            sendButton.disabled = false;\n        } else {\n            // Now send the message with the image URL\n            chatStatus.textContent = 'Sending message...';\n\n            const messageData = { image_url: data.image_url };\n            if (message) {\n                messageData.message = message;\n            }\n\n            fetch(buildApiUrl(`/api/club/${clubId}/chat/messages`), {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify(messageData)\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.error) {\n                    showToast('error', data.error, 'Error');\n                    chatStatus.textContent = '';\n                } else {\n                    // Clear input and image preview, refresh messages\n                    chatInput.value = '';\n                    chatInput.placeholder = 'Type your message or paste/upload an image...';\n                    clearImagePreview();\n                    loadChatMessages();\n                }\n            })\n            .catch(error => {\n                console.error('Error sending message:', error);\n                showToast('error', 'Failed to send message', 'Error');\n                chatStatus.textContent = '';\n            })\n            .finally(() => {\n                // Re-enable input\n                chatInput.disabled = false;\n                sendButton.disabled = false;\n            });\n        }\n    })\n    .catch(error => {\n        console.error('Error uploading image:', error);\n        showToast('error', 'Failed to upload image', 'Error');\n        chatStatus.textContent = '';\n        chatInput.disabled = false;\n        sendButton.disabled = false;\n    });\n}\n\nlet currentDeleteMessageId = null;\nlet currentEditMessageId = null;\n\nfunction showDeleteConfirmation(messageId, messageText) {\n    currentDeleteMessageId = messageId;\n    const preview = document.getElementById('deleteMessagePreview');\n    if (preview) {\n        preview.innerHTML = `<div class=\"message-preview-text\">${messageText}</div>`;\n    }\n\n    // Show the modal using custom modal system\n    showModal('deleteChatMessageModal');\n}\n\nfunction editChatMessage(messageId, messageText) {\n    currentEditMessageId = messageId;\n    const editContent = document.getElementById('editMessageContent');\n    const charCount = document.getElementById('editCharacterCount');\n\n    if (editContent && charCount) {\n        editContent.value = messageText;\n        charCount.textContent = messageText.length;\n\n        // Update character count on input\n        editContent.oninput = function() {\n            charCount.textContent = this.value.length;\n        };\n    }\n\n    // Show the modal using custom modal system\n    showModal('editChatMessageModal');\n}\n\nfunction confirmDeleteMessage() {\n    if (!currentDeleteMessageId) return;\n\n    const confirmBtn = document.getElementById('confirmDeleteMessage');\n    const originalText = confirmBtn.innerHTML;\n    confirmBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Deleting...';\n    confirmBtn.disabled = true;\n\n    fetch(buildApiUrl(`/api/club/${clubId}/chat/messages/${currentDeleteMessageId}`), {\n        method: 'DELETE'\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.error) {\n            showToast('error', data.error, 'Error');\n        } else {\n            // Hide modal and refresh messages\n            closeModal('deleteChatMessageModal');\n            loadChatMessages();\n            showToast('success', 'Message deleted successfully', 'Success');\n        }\n    })\n    .catch(error => {\n        console.error('Error deleting message:', error);\n        showToast('error', 'Failed to delete message', 'Error');\n    })\n    .finally(() => {\n        confirmBtn.innerHTML = originalText;\n        confirmBtn.disabled = false;\n        currentDeleteMessageId = null;\n    });\n}\n\nfunction confirmEditMessage() {\n    if (!currentEditMessageId) return;\n\n    const editContent = document.getElementById('editMessageContent');\n    const confirmBtn = document.getElementById('confirmEditMessage');\n\n    if (!editContent || !editContent.value.trim()) {\n        showToast('error', 'Message cannot be empty', 'Error');\n        return;\n    }\n\n    const originalText = confirmBtn.innerHTML;\n    confirmBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Saving...';\n    confirmBtn.disabled = true;\n\n    fetch(buildApiUrl(`/api/club/${clubId}/chat/messages/${currentEditMessageId}`), {\n        method: 'PUT',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ message: editContent.value.trim() })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.error) {\n            showToast('error', data.error, 'Error');\n        } else {\n            // Hide modal and refresh messages\n            closeModal('editChatMessageModal');\n            loadChatMessages();\n            showToast('success', 'Message updated successfully', 'Success');\n        }\n    })\n    .catch(error => {\n        console.error('Error editing message:', error);\n        showToast('error', 'Failed to edit message', 'Error');\n    })\n    .finally(() => {\n        confirmBtn.innerHTML = originalText;\n        confirmBtn.disabled = false;\n        currentEditMessageId = null;\n    });\n}\n\n// Initialize chat when the chat section is first viewed\ndocument.addEventListener('DOMContentLoaded', function() {\n    // Add to existing navigation handler\n    const existingNavLinks = document.querySelectorAll('.nav-link');\n    existingNavLinks.forEach(link => {\n        if (link.getAttribute('data-section') === 'chat') {\n            link.addEventListener('click', function() {\n                setTimeout(() => {\n                    initializeChat();\n                }, 100); // Small delay to ensure DOM is ready\n            });\n        }\n    });\n});\n\n// Custom modal functions (matching the existing modal system)\nfunction showModal(modalId) {\n    document.getElementById(modalId).style.display = 'block';\n}\n\nfunction closeModal(modalId) {\n    document.getElementById(modalId).style.display = 'none';\n}\n\n// Image upload and paste functionality\nfunction setupImageUpload() {\n    const uploadButton = document.getElementById('uploadImageButton');\n    const fileInput = document.getElementById('imageFileInput');\n    const chatInput = document.getElementById('chatMessageInput');\n    const removeImageBtn = document.getElementById('removeImagePreview');\n\n    if (!uploadButton || !fileInput || !chatInput) return;\n\n    // Setup file upload button\n    uploadButton.addEventListener('click', () => {\n        fileInput.click();\n    });\n\n    // Handle file selection\n    fileInput.addEventListener('change', (e) => {\n        const file = e.target.files[0];\n        if (file) {\n            handleImageFile(file);\n        }\n        // Reset file input\n        fileInput.value = '';\n    });\n\n    // Handle image paste\n    chatInput.addEventListener('paste', (e) => {\n        const items = e.clipboardData.items;\n        for (let item of items) {\n            if (item.type.indexOf('image') !== -1) {\n                e.preventDefault();\n                const file = item.getAsFile();\n                if (file) {\n                    handleImageFile(file);\n                }\n                break;\n            }\n        }\n    });\n\n    // Handle drag and drop\n    const chatContainer = document.querySelector('.chat-input-area');\n    if (chatContainer) {\n        chatContainer.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            chatContainer.classList.add('drag-over');\n        });\n\n        chatContainer.addEventListener('dragleave', (e) => {\n            e.preventDefault();\n            chatContainer.classList.remove('drag-over');\n        });\n\n        chatContainer.addEventListener('drop', (e) => {\n            e.preventDefault();\n            chatContainer.classList.remove('drag-over');\n\n            const files = e.dataTransfer.files;\n            if (files.length > 0) {\n                const file = files[0];\n                if (file.type.startsWith('image/')) {\n                    handleImageFile(file);\n                } else {\n                    showToast('error', 'Please drop an image file', 'Error');\n                }\n            }\n        });\n    }\n\n    // Remove image preview\n    if (removeImageBtn) {\n        removeImageBtn.addEventListener('click', clearImagePreview);\n    }\n}\n\nfunction handleImageFile(file) {\n    // Validate file type\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];\n    if (!allowedTypes.includes(file.type)) {\n        showToast('error', 'Invalid file type. Please use JPEG, PNG, GIF, or WebP images.', 'Error');\n        return;\n    }\n\n    // Validate file size (10MB limit)\n    const maxSize = 10 * 1024 * 1024;\n    if (file.size > maxSize) {\n        showToast('error', 'Image too large. Maximum size is 10MB.', 'Error');\n        return;\n    }\n\n    // Convert to base64 for preview and upload\n    const reader = new FileReader();\n    reader.onload = (e) => {\n        const base64Data = e.target.result;\n        currentImageFile = file;\n        currentImagePreview = base64Data;\n        showImagePreview(base64Data);\n    };\n    reader.onerror = () => {\n        showToast('error', 'Failed to read image file', 'Error');\n    };\n    reader.readAsDataURL(file);\n}\n\nfunction showImagePreview(base64Data) {\n    const preview = document.getElementById('imagePreview');\n    const previewImg = document.getElementById('previewImage');\n\n    if (preview && previewImg) {\n        previewImg.src = base64Data;\n        preview.style.display = 'block';\n    }\n}\n\nfunction clearImagePreview() {\n    const preview = document.getElementById('imagePreview');\n    const previewImg = document.getElementById('previewImage');\n\n    if (preview && previewImg) {\n        preview.style.display = 'none';\n        previewImg.src = '';\n    }\n\n    currentImageFile = null;\n    currentImagePreview = null;\n}\n\nfunction openImageModal(imageUrl) {\n    // Create a simple image modal for viewing full-size images\n    const modal = document.createElement('div');\n    modal.className = 'image-modal';\n    modal.innerHTML = `\n        <div class=\"image-modal-backdrop\" onclick=\"closeImageModal(this)\">\n            <div class=\"image-modal-content\">\n                <img src=\"${imageUrl}\" alt=\"Full size image\">\n                <button class=\"image-modal-close\" onclick=\"closeImageModal(this)\" title=\"Close\">\n                    <i class=\"fas fa-times\"></i>\n                </button>\n            </div>\n        </div>\n    `;\n\n    document.body.appendChild(modal);\n\n    // Prevent body scroll\n    document.body.style.overflow = 'hidden';\n}\n\nfunction closeImageModal(element) {\n    const modal = element.closest('.image-modal');\n    if (modal) {\n        modal.remove();\n        document.body.style.overflow = '';\n    }\n}","size_bytes":141252},"static/css/dash-mobile.css":{"content":"/* Mobile Club Dashboard Styles */\n\n/* Hide navbar completely on mobile when using mobile dashboard */\nbody.mobile-dashboard-active .navbar {\n    display: none !important;\n}\n\n/* Alternative approach for broader browser support */\n/* Mobile body fixes */\nbody.mobile-dashboard-active {\n    overflow: hidden;\n    position: fixed;\n    width: 100%;\n    height: 100%;\n}\n\n/* Global Animation Variables - Optimized for speed */\n:root {\n    --animation-speed-fast: 0.05s;\n    --animation-speed-normal: 0.1s;\n    --animation-speed-slow: 0.15s;\n    --bounce-timing: cubic-bezier(0.25, 0.46, 0.45, 0.94);\n    --smooth-timing: cubic-bezier(0.4, 0, 0.2, 1);\n    --elastic-timing: cubic-bezier(0.25, 0.46, 0.45, 0.94);\n}\n\n/* Keyframe Animations */\n@keyframes slideInUp {\n    from {\n        opacity: 0;\n        transform: translateY(30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n@keyframes slideInRight {\n    from {\n        opacity: 0;\n        transform: translateX(30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(0);\n    }\n}\n\n@keyframes slideInLeft {\n    from {\n        opacity: 0;\n        transform: translateX(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(0);\n    }\n}\n\n@keyframes fadeInScale {\n    from {\n        opacity: 0;\n        transform: scale(0.9);\n    }\n    to {\n        opacity: 1;\n        transform: scale(1);\n    }\n}\n\n@keyframes bounceIn {\n    0% {\n        opacity: 0;\n        transform: scale(0.8);\n    }\n    100% {\n        opacity: 1;\n        transform: scale(1);\n    }\n}\n\n@keyframes pulse {\n    0%, 100% {\n        transform: scale(1);\n    }\n    50% {\n        transform: scale(1.02);\n    }\n}\n\n@keyframes ripple {\n    0% {\n        transform: scale(0);\n        opacity: 1;\n    }\n    100% {\n        transform: scale(4);\n        opacity: 0;\n    }\n}\n\n@media (max-width: 768px) {\n    .mobile-club-dashboard {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        z-index: 1000;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n    }\n\n    /* Hide navbar when mobile dashboard is present */\n    body:has(.mobile-club-dashboard) .navbar,\n    .mobile-club-dashboard ~ .navbar {\n        display: none !important;\n    }\n}\n\n/* PWA Installation Instructions */\n.pwa-install-instructions {\n    padding: 1rem;\n    padding-bottom: 2rem;\n}\n\n.pwa-install-option {\n    text-align: center;\n    margin: 1.5rem 0;\n}\n\n.pwa-install-btn-large {\n    background: linear-gradient(135deg, #3b82f6, #2563eb);\n    color: white;\n    border: none;\n    padding: 1rem 2rem;\n    border-radius: 16px;\n    font-size: 1.1rem;\n    font-weight: 600;\n    cursor: pointer;\n    display: inline-flex;\n    align-items: center;\n    gap: 0.75rem;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);\n}\n\n.pwa-install-btn-large:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);\n}\n\n.install-steps {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    margin-top: 1rem;\n}\n\n.install-step {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n    padding: 1rem;\n    background: #f8fafc;\n    border-radius: 12px;\n    border: 1px solid #e2e8f0;\n}\n\n.step-number {\n    width: 30px;\n    height: 30px;\n    background: #3b82f6;\n    color: white;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: 600;\n    font-size: 0.875rem;\n    flex-shrink: 0;\n}\n\n.step-content {\n    flex: 1;\n}\n\n.step-content strong {\n    color: #1a202c;\n    font-size: 0.9rem;\n    display: block;\n    margin-bottom: 0.25rem;\n}\n\n.step-content p {\n    margin: 0;\n    color: #4a5568;\n    font-size: 0.8rem;\n    line-height: 1.4;\n}\n\n.step-content i {\n    color: #3b82f6;\n    margin: 0 0.25rem;\n}\n\n.pwa-benefits {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n    margin-top: 1rem;\n}\n\n.benefit-item {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    padding: 0.75rem;\n    background: #f0f9ff;\n    border-radius: 8px;\n    border: 1px solid #bae6fd;\n}\n\n.benefit-item i {\n    color: #0284c7;\n    font-size: 1rem;\n    width: 20px;\n    text-align: center;\n    flex-shrink: 0;\n}\n\n.benefit-item span {\n    color: #0c4a6e;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n}\n\n.mobile-club-dashboard {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: #f5f7fa;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    z-index: 1000;\n    will-change: transform;\n}\n\n/* Mobile Header */\n.mobile-header {\n    background: linear-gradient(135deg, #ec3750, #d63146);\n    color: white;\n    padding: 1rem;\n    box-shadow: 0 2px 20px rgba(236, 55, 80, 0.3);\n    flex-shrink: 0;\n    z-index: 100;\n    animation: slideInUp var(--animation-speed-normal) var(--smooth-timing);\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n}\n\n.mobile-header-content {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    margin-bottom: 0.75rem;\n}\n\n.club-avatar-mobile {\n    width: 50px;\n    height: 50px;\n    background: rgba(255, 255, 255, 0.2);\n    border-radius: 12px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.5rem;\n    color: white;\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    animation: bounceIn var(--animation-speed-slow) var(--bounce-timing) 0.2s both;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n}\n\n.club-avatar-mobile:hover {\n    transform: scale(1.1) rotate(5deg);\n    animation: wiggle 0.6s ease-in-out;\n}\n\n.club-info-mobile {\n    flex: 1;\n    min-width: 0;\n    animation: slideInRight var(--animation-speed-normal) var(--smooth-timing) 0.1s both;\n}\n\n.club-info-mobile h1 {\n    margin: 0 0 0.25rem 0;\n    font-size: 1.5rem;\n    font-weight: 700;\n    color: white;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n}\n\n.club-info-mobile h1:hover {\n    transform: translateX(5px);\n}\n\n.club-stats {\n    display: flex;\n    gap: 1rem;\n    font-size: 0.875rem;\n    opacity: 0.9;\n}\n\n.club-stats span {\n    display: flex;\n    align-items: center;\n    gap: 0.25rem;\n}\n\n.club-stats .balance {\n    background: rgba(255, 255, 255, 0.2);\n    padding: 0.25rem 0.5rem;\n    border-radius: 6px;\n    font-weight: 600;\n}\n\n.header-actions {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.action-btn {\n    width: 40px;\n    height: 40px;\n    background: rgba(255, 255, 255, 0.2);\n    border: none;\n    border-radius: 10px;\n    color: white;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.1rem;\n    cursor: pointer;\n    transition: all var(--animation-speed-normal) var(--bounce-timing);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    animation: fadeInScale var(--animation-speed-normal) var(--smooth-timing) 0.3s both;\n    position: relative;\n    overflow: hidden;\n}\n\n.action-btn:hover {\n    background: rgba(255, 255, 255, 0.3);\n    transform: scale(1.05);\n}\n\n.action-btn:active {\n    transform: scale(0.95);\n}\n\n.action-btn::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    background: rgba(255, 255, 255, 0.3);\n    border-radius: 50%;\n    transition: all var(--animation-speed-fast) ease;\n    transform: translate(-50%, -50%);\n}\n\n.action-btn:active::after {\n    width: 40px;\n    height: 40px;\n}\n\n.join-code-mobile {\n    text-align: center;\n    background: rgba(255, 255, 255, 0.15);\n    padding: 0.5rem;\n    border-radius: 8px;\n    font-size: 0.875rem;\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    animation: slideInUp var(--animation-speed-normal) var(--smooth-timing) 0.4s both;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n    cursor: pointer;\n}\n\n.join-code-mobile:hover {\n    transform: translateY(-2px);\n    background: rgba(255, 255, 255, 0.25);\n    animation: glow 1s ease-in-out infinite;\n}\n\n.join-code-mobile strong {\n    font-family: 'SF Mono', Consolas, monospace;\n    letter-spacing: 1px;\n    font-size: 1rem;\n}\n\n/* Mobile Navigation */\n.mobile-nav {\n    background: white;\n    border-top: 1px solid #e2e8f0;\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 1000;\n    box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.1);\n    display: block !important;\n    height: 70px;\n    animation: slideInUp var(--animation-speed-normal) var(--smooth-timing) 0.5s both;\n    backdrop-filter: blur(10px);\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n}\n\n.nav-tabs {\n    display: grid;\n    grid-template-columns: repeat(6, 1fr);\n    padding: 0;\n}\n\n.nav-tab {\n    background: none;\n    border: none;\n    padding: 0.5rem 0.25rem;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.25rem;\n    color: #6b7280;\n    font-size: 0.65rem;\n    font-weight: 500;\n    cursor: pointer;\n    transition: color var(--animation-speed-fast) ease, background-color var(--animation-speed-fast) ease;\n    min-width: 0;\n    position: relative;\n    border-radius: 12px;\n    will-change: color, background-color;\n}\n\n.nav-tab::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 50%;\n    width: 0;\n    height: 3px;\n    background: #ec3750;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n    transform: translateX(-50%);\n    border-radius: 0 0 3px 3px;\n}\n\n.nav-tab.active {\n    color: #ec3750;\n    background: rgba(236, 55, 80, 0.05);\n    transform: translateY(-2px);\n}\n\n.nav-tab.active::before {\n    width: 80%;\n}\n\n.nav-tab:hover:not(.active) {\n    color: #ec3750;\n    transform: translateY(-1px) scale(1.05);\n    background: rgba(236, 55, 80, 0.02);\n}\n\n.nav-tab:active {\n    transform: translateY(0) scale(0.95);\n}\n\n.nav-tab i {\n    font-size: 1.1rem;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n}\n\n.nav-tab.active i {\n    animation: pulse 0.6s ease-in-out;\n}\n\n.nav-tab:hover i {\n    transform: scale(1.2);\n}\n\n.nav-tab span {\n    margin-top: 0.125rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    max-width: 100%;\n}\n\n/* Mobile Content */\n.mobile-content {\n    flex: 1;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n    padding: 1rem;\n    padding-bottom: 90px; /* Space for fixed nav */\n    margin-bottom: 0;\n}\n\n.mobile-section {\n    display: none;\n}\n\n.mobile-section.active {\n    display: block;\n}\n\n.mobile-nav-spacer {\n    height: 80px;\n}\n\n/* PWA Install Card */\n.pwa-install-card {\n    background: linear-gradient(135deg, #dbeafe, #bfdbfe);\n    border: 1px solid #3b82f6;\n    border-radius: 16px;\n    padding: 1rem;\n    margin-bottom: 1.5rem;\n    display: flex;\n    gap: 0.75rem;\n    position: relative;\n    animation: slideDown 0.3s ease-out;\n}\n\n@keyframes slideDown {\n    from {\n        opacity: 0;\n        transform: translateY(-20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.pwa-install-icon {\n    color: #3b82f6;\n    font-size: 1.5rem;\n    flex-shrink: 0;\n    margin-top: 0.125rem;\n}\n\n.pwa-install-content {\n    flex: 1;\n}\n\n.pwa-install-content h4 {\n    margin: 0 0 0.5rem 0;\n    color: #1e40af;\n    font-size: 1rem;\n    font-weight: 600;\n}\n\n.pwa-install-content p {\n    margin: 0 0 1rem 0;\n    color: #1e40af;\n    font-size: 0.875rem;\n    line-height: 1.4;\n}\n\n.pwa-install-btn {\n    background: #3b82f6;\n    color: white;\n    border: none;\n    padding: 0.5rem 0.75rem;\n    border-radius: 8px;\n    font-size: 0.875rem;\n    font-weight: 600;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    transition: all 0.2s ease;\n}\n\n.pwa-install-btn:hover {\n    background: #2563eb;\n    transform: translateY(-1px);\n}\n\n.pwa-close-btn {\n    position: absolute;\n    top: 0.75rem;\n    right: 0.75rem;\n    background: none;\n    border: none;\n    color: #1e40af;\n    font-size: 1rem;\n    cursor: pointer;\n    padding: 0.25rem;\n    border-radius: 4px;\n    transition: all 0.2s ease;\n}\n\n.pwa-close-btn:hover {\n    background: rgba(59, 130, 246, 0.1);\n}\n\n/* Alert Card */\n.alert-card {\n    background: linear-gradient(135deg, #fef3c7, #fde68a);\n    border: 1px solid #f59e0b;\n    border-radius: 16px;\n    padding: 1rem;\n    margin-bottom: 1.5rem;\n    display: flex;\n    gap: 0.75rem;\n}\n\n.alert-icon {\n    color: #f59e0b;\n    font-size: 1.5rem;\n    flex-shrink: 0;\n    margin-top: 0.125rem;\n}\n\n.alert-content h4 {\n    margin: 0 0 0.5rem 0;\n    color: #92400e;\n    font-size: 1rem;\n    font-weight: 600;\n}\n\n.alert-content p {\n    margin: 0 0 1rem 0;\n    color: #92400e;\n    font-size: 0.875rem;\n    line-height: 1.4;\n}\n\n.alert-btn {\n    background: #ec3750;\n    color: white;\n    padding: 0.5rem 0.75rem;\n    border-radius: 8px;\n    text-decoration: none;\n    font-size: 0.875rem;\n    font-weight: 600;\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n/* Quick Actions */\n.quick-actions {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 0.75rem;\n    margin-bottom: 1.5rem;\n    animation: slideInUp var(--animation-speed-normal) var(--smooth-timing) 0.6s both;\n}\n\n.quick-action-btn {\n    background: white;\n    border: 2px solid #e2e8f0;\n    border-radius: 16px;\n    padding: 1rem;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    cursor: pointer;\n    transition: all var(--animation-speed-normal) var(--bounce-timing);\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n    position: relative;\n    overflow: hidden;\n    animation: fadeInScale var(--animation-speed-normal) var(--smooth-timing) calc(var(--animation-delay, 0) * 0.1s) both;\n}\n\n\n.quick-action-btn::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: -100%;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(90deg, transparent, rgba(236, 55, 80, 0.1), transparent);\n    transition: left var(--animation-speed-slow) ease;\n}\n\n.quick-action-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n    border-color: #ec3750;\n}\n\n.quick-action-btn:active {\n    transform: translateY(0);\n}\n\n.quick-action-btn.pizza {\n    background: linear-gradient(135deg, #ec3750, #d63146);\n    color: white;\n    border-color: #ec3750;\n}\n\n.quick-action-btn i {\n    font-size: 1.5rem;\n    color: #ec3750;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n}\n\n.quick-action-btn.pizza i {\n    color: white;\n}\n\n.quick-action-btn:hover i {\n    transform: scale(1.2) rotate(5deg);\n    animation: wiggle 0.6s ease-in-out;\n}\n\n.quick-action-btn.pizza:hover i {\n    animation: float 1s ease-in-out infinite;\n}\n\n.quick-action-btn span {\n    font-size: 0.75rem;\n    font-weight: 600;\n    color: #4a5568;\n    text-align: center;\n    line-height: 1.2;\n}\n\n.quick-action-btn.pizza span {\n    color: white;\n}\n\n/* Stats Grid */\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 1rem;\n    margin-bottom: 1.5rem;\n    animation: slideInUp var(--animation-speed-normal) var(--smooth-timing) 0.7s both;\n}\n\n.stat-card {\n    background: white;\n    border-radius: 16px;\n    padding: 1.25rem;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n    border: 2px solid #e2e8f0;\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    transition: all var(--animation-speed-normal) var(--bounce-timing);\n    position: relative;\n    overflow: hidden;\n    animation: bounceIn var(--animation-speed-slow) var(--bounce-timing) calc(var(--stat-delay, 0) * 0.15s) both;\n}\n\n\n.stat-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: radial-gradient(circle at center, rgba(236, 55, 80, 0.05), transparent);\n    opacity: 0;\n    transition: opacity var(--animation-speed-normal) ease;\n}\n\n.stat-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n    border-color: #ec3750;\n}\n\n.stat-icon {\n    width: 40px;\n    height: 40px;\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 1.25rem;\n    flex-shrink: 0;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n    position: relative;\n    overflow: hidden;\n}\n\n.stat-icon::before {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    background: rgba(255, 255, 255, 0.3);\n    border-radius: 50%;\n    transition: all var(--animation-speed-normal) ease;\n    transform: translate(-50%, -50%);\n}\n\n.stat-card:hover .stat-icon {\n    transform: scale(1.1) rotate(5deg);\n}\n\n.stat-card:hover .stat-icon::before {\n    width: 40px;\n    height: 40px;\n}\n\n.stat-icon.members { background: #ec3750; }\n.stat-icon.meetings { background: #f59e0b; }\n.stat-icon.assignments { background: #3b82f6; }\n.stat-icon.projects { background: #10b981; }\n\n.stat-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.stat-number {\n    font-size: 1.5rem;\n    font-weight: bold;\n    color: #1a202c;\n    line-height: 1;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n}\n\n.stat-card:hover .stat-number {\n    transform: scale(1.1);\n    color: #ec3750;\n}\n\n.stat-label {\n    font-size: 0.75rem;\n    color: #6b7280;\n    font-weight: 500;\n    margin-top: 0.25rem;\n}\n\n/* Mobile Composer */\n.mobile-composer {\n    background: white;\n    border-radius: 16px;\n    padding: 1rem;\n    margin-bottom: 1.5rem;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n    border: 2px solid #e2e8f0;\n}\n\n.mobile-composer textarea {\n    width: 100%;\n    border: 2px solid #e2e8f0;\n    border-radius: 12px;\n    padding: 0.75rem;\n    font-family: inherit;\n    font-size: 0.875rem;\n    resize: none;\n    margin-bottom: 0.75rem;\n    transition: all 0.2s ease;\n}\n\n.mobile-composer textarea:focus {\n    outline: none;\n    border-color: #ec3750;\n    box-shadow: 0 0 0 3px rgba(236, 55, 80, 0.1);\n}\n\n.composer-btn {\n    background: #ec3750;\n    color: white;\n    border: none;\n    border-radius: 10px;\n    padding: 0.75rem 1rem;\n    font-weight: 600;\n    font-size: 0.875rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    margin-left: auto;\n}\n\n.composer-btn:hover {\n    background: #d63146;\n    transform: translateY(-1px);\n}\n\n/* Empty States */\n.empty-state-mobile {\n    text-align: center;\n    padding: 2rem 1rem;\n    color: #6b7280;\n}\n\n.empty-state-mobile i {\n    font-size: 2.5rem;\n    margin-bottom: 0.75rem;\n    opacity: 0.5;\n}\n\n.empty-state-mobile h3 {\n    margin: 0 0 0.5rem 0;\n    font-size: 1.125rem;\n    font-weight: 600;\n}\n\n.empty-state-mobile p {\n    margin: 0;\n    font-size: 0.875rem;\n    opacity: 0.8;\n}\n\n/* Mobile Members List */\n.mobile-members-list {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n\n.member-card {\n    background: white;\n    border-radius: 16px;\n    padding: 1rem;\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n    border: 2px solid #e2e8f0;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n    position: relative;\n    overflow: hidden;\n    animation: slideInLeft var(--animation-speed-normal) var(--smooth-timing) calc(var(--member-delay, 0) * 0.1s) both;\n}\n\n\n.member-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 4px;\n    height: 0;\n    background: #ec3750;\n    transition: height var(--animation-speed-normal) ease;\n    border-radius: 0 2px 2px 0;\n}\n\n.member-card:hover {\n    transform: translateY(-2px) translateX(4px);\n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);\n    border-color: #ec3750;\n}\n\n.member-card:hover::before {\n    height: 100%;\n}\n\n.member-card.leader {\n    border-left: 4px solid #f59e0b;\n}\n\n.member-card.co-leader {\n    border-left: 4px solid #3b82f6;\n}\n\n.member-card .member-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    background: #6b7280;\n    color: white;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: 600;\n    font-size: 0.875rem;\n    flex-shrink: 0;\n    transition: all var(--animation-speed-normal) var(--bounce-timing);\n    position: relative;\n    overflow: hidden;\n}\n\n.member-card .member-avatar::before {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    background: rgba(255, 255, 255, 0.3);\n    border-radius: 50%;\n    transition: all var(--animation-speed-normal) ease;\n    transform: translate(-50%, -50%);\n}\n\n.member-card:hover .member-avatar {\n    transform: scale(1.1) rotate(5deg);\n}\n\n.member-card:hover .member-avatar::before {\n    width: 40px;\n    height: 40px;\n}\n\n.member-card.leader .member-avatar {\n    background: #ec3750;\n    animation: glow 2s ease-in-out infinite;\n}\n\n.member-card .member-info {\n    flex: 1;\n    min-width: 0;\n}\n\n.member-card .member-name {\n    font-weight: 600;\n    color: #1a202c;\n    font-size: 0.9rem;\n    margin-bottom: 0.125rem;\n}\n\n.member-card .member-role {\n    font-size: 0.75rem;\n    color: #6b7280;\n    display: flex;\n    align-items: center;\n    gap: 0.25rem;\n}\n\n.member-card.leader .member-role {\n    color: #ec3750;\n}\n\n.member-card .member-role i {\n    font-size: 0.7rem;\n}\n\n.member-actions-mobile {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    gap: 0.25rem;\n}\n\n.member-date {\n    font-size: 0.75rem;\n    color: #9ca3af;\n}\n\n.remove-btn {\n    background: rgba(220, 53, 69, 0.1);\n    color: #dc3545;\n    border: none;\n    border-radius: 50%;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 0.75rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.remove-btn:hover {\n    background: rgba(220, 53, 69, 0.2);\n}\n\n/* More Options */\n.more-options {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.more-group h3 {\n    margin: 0 0 0.75rem 0;\n    color: #1a202c;\n    font-size: 1.125rem;\n    font-weight: 600;\n}\n\n.more-option {\n    background: white;\n    border: 2px solid #e2e8f0;\n    border-radius: 16px;\n    padding: 1rem;\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    margin-bottom: 0.5rem;\n    text-align: left;\n    width: 100%;\n}\n\n.more-option:hover {\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n    border-color: #ec3750;\n}\n\n.more-option i:first-child {\n    width: 40px;\n    height: 40px;\n    background: rgba(236, 55, 80, 0.1);\n    color: #ec3750;\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.25rem;\n    flex-shrink: 0;\n}\n\n.more-option span {\n    flex: 1;\n    font-weight: 600;\n    color: #1a202c;\n    font-size: 0.9rem;\n}\n\n.more-option i:last-child {\n    color: #9ca3af;\n    font-size: 0.875rem;\n}\n\n/* Detail Sections */\n.detail-section {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: #f5f7fa;\n    z-index: 2000;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n    padding-bottom: 100px;\n    display: flex;\n    flex-direction: column;\n}\n\n/* Hide header and nav when detail section is active */\n.detail-section.active ~ .mobile-header,\n.detail-section.active ~ .mobile-nav,\n.detail-section[style*=\"flex\"] ~ .mobile-header,\n.detail-section[style*=\"flex\"] ~ .mobile-nav {\n    display: none !important;\n}\n\n/* Alternative approach using body class */\nbody.detail-section-open .mobile-header,\nbody.detail-section-open .mobile-nav {\n    display: none !important;\n}\n\n.detail-header {\n    background: white;\n    padding: 1rem;\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    position: sticky;\n    top: 0;\n    z-index: 10;\n    flex-shrink: 0;\n}\n\n.detail-content {\n    flex: 1;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n    padding: 1rem;\n}\n\n.back-btn {\n    background: none;\n    border: none;\n    color: #ec3750;\n    font-size: 1.25rem;\n    cursor: pointer;\n    padding: 0.5rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n}\n\n.back-btn:hover {\n    background: rgba(236, 55, 80, 0.1);\n}\n\n.detail-header h2 {\n    flex: 1;\n    margin: 0;\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: #1a202c;\n}\n\n.add-btn {\n    background: #ec3750;\n    color: white;\n    border: none;\n    border-radius: 10px;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.125rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.add-btn:hover {\n    background: #d63146;\n    transform: scale(1.05);\n}\n\n/* Mobile Cards */\n.mobile-card {\n    background: white;\n    border-radius: 16px;\n    padding: 1.25rem;\n    margin: 1rem;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n    border: 2px solid #e2e8f0;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n    position: relative;\n    overflow: hidden;\n    animation: slideInUp var(--animation-speed-normal) var(--smooth-timing) both;\n}\n\n.mobile-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: -100%;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(90deg, transparent, rgba(236, 55, 80, 0.05), transparent);\n    transition: left var(--animation-speed-slow) ease;\n}\n\n.mobile-card:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);\n    border-color: #ec3750;\n}\n\n.mobile-card:hover::before {\n    left: 100%;\n}\n\n.mobile-card h3 {\n    margin: 0 0 0.75rem 0;\n    color: #1a202c;\n    font-size: 1.125rem;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.mobile-card h3 i {\n    color: #ec3750;\n}\n\n.mobile-card p {\n    margin: 0 0 1rem 0;\n    color: #6b7280;\n    font-size: 0.875rem;\n    line-height: 1.4;\n}\n\n.mobile-select {\n    width: 100%;\n    padding: 0.75rem;\n    border: 2px solid #e2e8f0;\n    border-radius: 12px;\n    font-size: 0.875rem;\n    background: white;\n    margin-bottom: 1rem;\n}\n\n/* Balance Card */\n.balance-card {\n    background: linear-gradient(135deg, #10b981, #059669);\n    color: white;\n    border-radius: 16px;\n    padding: 1.5rem;\n    text-align: center;\n    margin: 1rem;\n    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);\n}\n\n.balance-amount {\n    font-size: 2.5rem;\n    font-weight: bold;\n    margin-bottom: 0.25rem;\n}\n\n.balance-label {\n    font-size: 0.875rem;\n    opacity: 0.9;\n}\n\n/* Shop Items Mobile */\n.shop-items-mobile {\n    padding: 1rem;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n.shop-item-mobile {\n    background: white;\n    border-radius: 16px;\n    padding: 1rem;\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n    border: 2px solid #e2e8f0;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.shop-item-mobile:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\n    border-color: #ec3750;\n}\n\n.shop-item-mobile img {\n    width: 50px;\n    height: 50px;\n    object-fit: contain;\n    flex-shrink: 0;\n}\n\n.shop-item-info {\n    flex: 1;\n}\n\n.shop-item-info h4 {\n    margin: 0 0 0.25rem 0;\n    font-size: 1rem;\n    font-weight: 600;\n    color: #1a202c;\n}\n\n.shop-item-info p {\n    margin: 0 0 0.75rem 0;\n    font-size: 0.875rem;\n    color: #6b7280;\n    line-height: 1.3;\n}\n\n.shop-btn {\n    background: #ec3750;\n    color: white;\n    border: none;\n    border-radius: 8px;\n    padding: 0.5rem 0.75rem;\n    font-size: 0.75rem;\n    font-weight: 600;\n    cursor: pointer;\n}\n\n.shop-btn.free {\n    background: #10b981;\n}\n\n/* YSWS Items */\n.ysws-items {\n    padding: 1rem;\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n\n.ysws-item {\n    background: white;\n    border-radius: 16px;\n    padding: 1rem;\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);\n    border: 2px solid #e2e8f0;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.ysws-item:hover {\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n    border-color: #ec3750;\n}\n\n.ysws-icon {\n    width: 40px;\n    height: 40px;\n    background: rgba(236, 55, 80, 0.1);\n    color: #ec3750;\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.25rem;\n    flex-shrink: 0;\n}\n\n.ysws-img {\n    width: 40px;\n    height: 40px;\n    object-fit: contain;\n    flex-shrink: 0;\n}\n\n.ysws-info {\n    flex: 1;\n}\n\n.ysws-info h4 {\n    margin: 0 0 0.25rem 0;\n    font-size: 0.9rem;\n    font-weight: 600;\n    color: #1a202c;\n}\n\n.ysws-info p {\n    margin: 0;\n    font-size: 0.75rem;\n    color: #6b7280;\n    line-height: 1.3;\n}\n\n.ysws-item i:last-child {\n    color: #9ca3af;\n    font-size: 0.875rem;\n}\n\n/* Mobile Forms */\n.form-group-mobile {\n    margin-bottom: 1rem;\n}\n\n.form-group-mobile label {\n    display: block;\n    margin-bottom: 0.5rem;\n    color: #4a5568;\n    font-weight: 500;\n    font-size: 0.875rem;\n}\n\n.form-group-mobile input,\n.form-group-mobile textarea {\n    width: 100%;\n    padding: 0.75rem;\n    border: 2px solid #e2e8f0;\n    border-radius: 12px;\n    font-size: 0.875rem;\n    transition: all 0.2s ease;\n}\n\n.form-group-mobile input:focus,\n.form-group-mobile textarea:focus {\n    outline: none;\n    border-color: #ec3750;\n    box-shadow: 0 0 0 3px rgba(236, 55, 80, 0.1);\n}\n\n.save-btn {\n    background: #ec3750;\n    color: white;\n    border: none;\n    border-radius: 12px;\n    padding: 0.75rem 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    width: 100%;\n    justify-content: center;\n}\n\n.save-btn:hover {\n    background: #d63146;\n    transform: translateY(-1px);\n}\n\n/* Ensure bottom nav is always visible on mobile */\n@media (max-width: 768px) {\n    .mobile-nav {\n        display: block !important;\n        visibility: visible !important;\n        opacity: 1 !important;\n    }\n}\n\n/* Responsive Overrides for Mobile */\n@media (max-width: 480px) {\n    .quick-actions {\n        grid-template-columns: repeat(2, 1fr);\n    }\n\n    .quick-action-btn {\n        padding: 0.75rem;\n    }\n\n    .quick-action-btn i {\n        font-size: 1.25rem;\n    }\n\n    .quick-action-btn span {\n        font-size: 0.7rem;\n    }\n\n    .stats-grid {\n        grid-template-columns: 1fr;\n    }\n\n    .mobile-header-content {\n        gap: 0.75rem;\n    }\n\n    .club-info-mobile h1 {\n        font-size: 1.25rem;\n    }\n\n    .club-stats {\n        flex-direction: column;\n        gap: 0.25rem;\n        font-size: 0.8rem;\n    }\n}\n\n/* Modal Adjustments for Mobile */\n@media (max-width: 768px) {\n    .modal-content {\n        margin: 1rem;\n        margin-top: 2rem;\n        max-height: 85vh;\n        overflow-y: auto;\n        position: relative;\n        z-index: 1001;\n    }\n    \n    .modal {\n        z-index: 1000;\n        padding-top: 2rem;\n    }\n\n    @keyframes modalSlideIn {\n        from {\n            opacity: 0;\n            transform: translateY(-30px);\n            margin-top: 1rem;\n        }\n        to {\n            opacity: 1;\n            transform: translateY(0);\n            margin-top: 2rem;\n        }\n    }\n\n    .toast-container {\n        bottom: 100px !important;\n        left: 20px;\n        right: 20px;\n    }\n}\n\n/* Hide desktop dashboard on mobile */\n@media (max-width: 768px) {\n    .club-dashboard:not(.mobile-club-dashboard) {\n        display: none;\n    }\n}\n\n/* Show mobile dashboard only on mobile */\n@media (min-width: 769px) {\n    .mobile-club-dashboard {\n        display: none;\n    }\n}\n\n/* Loading Screen */\n.mobile-loading-screen {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(245, 247, 250, 0.95);\n    backdrop-filter: blur(5px);\n    z-index: 3000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: opacity 0.3s ease;\n}\n\n.loading-content {\n    text-align: center;\n    color: #ec3750;\n}\n\n.loading-logo {\n    font-size: 3rem;\n    margin-bottom: 1rem;\n    animation: bounce 1s infinite;\n}\n\n.loading-spinner {\n    width: 40px;\n    height: 40px;\n    border: 3px solid rgba(236, 55, 80, 0.2);\n    border-radius: 50%;\n    border-top-color: #ec3750;\n    animation: spin 1s linear infinite;\n    margin: 0 auto 1rem;\n}\n\n.loading-text {\n    font-size: 1rem;\n    font-weight: 500;\n    color: #6b7280;\n}\n\n@keyframes bounce {\n    0%, 20%, 50%, 80%, 100% {\n        transform: translateY(0);\n    }\n    40% {\n        transform: translateY(-10px);\n    }\n    60% {\n        transform: translateY(-5px);\n    }\n}\n\n@keyframes spin {\n    to {\n        transform: rotate(360deg);\n    }\n}\n\n/* Section Loading */\n.section-loading {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 2rem;\n    color: #ec3750;\n}\n\n.section-loading i {\n    font-size: 1.5rem;\n    animation: spin 1s linear infinite;\n    margin-right: 0.5rem;\n}\n\n.section-loading-text {\n    font-size: 0.875rem;\n    color: #6b7280;\n    margin-top: 0.5rem;\n}\n\n/* Button Loading State */\n.btn-loading {\n    opacity: 0.7;\n    pointer-events: none;\n    position: relative;\n}\n\n.btn-loading::after {\n    content: '';\n    position: absolute;\n    width: 16px;\n    height: 16px;\n    margin: auto;\n    border: 2px solid transparent;\n    border-top-color: currentColor;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n}\n\n/* Mobile Modals */\n.mobile-modal {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(4px);\n    z-index: 3000;\n    display: none;\n    align-items: flex-end;\n    justify-content: center;\n    padding: 0;\n    opacity: 0;\n    transition: opacity var(--animation-speed-normal) ease;\n}\n\n.mobile-modal.active {\n    display: flex;\n    animation: fadeInModal var(--animation-speed-normal) ease forwards;\n}\n\n@keyframes fadeInModal {\n    to {\n        opacity: 1;\n    }\n}\n\n.mobile-modal-content {\n    background: white;\n    width: 100%;\n    max-height: 90vh;\n    border-radius: 20px 20px 0 0;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    transform: translateY(100%);\n    transition: transform var(--animation-speed-slow) var(--elastic-timing);\n    box-shadow: 0 -4px 25px rgba(0, 0, 0, 0.2);\n}\n\n.mobile-modal.active .mobile-modal-content {\n    transform: translateY(0);\n}\n\n.mobile-modal-header {\n    padding: 1.5rem 1.5rem 1rem 1.5rem;\n    border-bottom: 1px solid #e2e8f0;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    flex-shrink: 0;\n}\n\n.mobile-modal-header h3 {\n    margin: 0;\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: #1a202c;\n}\n\n.mobile-modal-close {\n    background: rgba(107, 114, 128, 0.1);\n    border: none;\n    border-radius: 50%;\n    width: 36px;\n    height: 36px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #6b7280;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.mobile-modal-close:hover {\n    background: rgba(107, 114, 128, 0.2);\n    color: #374151;\n}\n\n.mobile-modal-body {\n    padding: 1.5rem;\n    flex: 1;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n\n.mobile-modal-footer {\n    padding: 1.5rem;\n    border-top: 1px solid #e2e8f0;\n    display: flex;\n    gap: 1rem;\n    flex-shrink: 0;\n}\n\n.mobile-btn-primary {\n    flex: 1;\n    background: #ec3750;\n    color: white;\n    border: none;\n    border-radius: 12px;\n    padding: 1rem;\n    font-weight: 600;\n    font-size: 1rem;\n    cursor: pointer;\n    transition: all var(--animation-speed-normal) var(--bounce-timing);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n    position: relative;\n    overflow: hidden;\n}\n\n\n.confirm-delete-content {\n    text-align: center;\n    padding: 1rem 0;\n}\n\n.confirm-delete-icon {\n    width: 64px;\n    height: 64px;\n    background: rgba(220, 38, 38, 0.1);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin: 0 auto 1rem;\n}\n\n.confirm-delete-icon i {\n    font-size: 1.5rem;\n    color: #dc2626;\n}\n\n.confirm-delete-content p {\n    margin: 0.5rem 0;\n    color: #374151;\n}\n\n.confirm-delete-warning {\n    font-size: 0.875rem;\n    color: #6b7280;\n    font-style: italic;\n}\n\n.mobile-btn-primary::before {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 0;\n    height: 0;\n    background: rgba(255, 255, 255, 0.2);\n    border-radius: 50%;\n    transition: all var(--animation-speed-normal) ease;\n    transform: translate(-50%, -50%);\n}\n\n.mobile-btn-primary:hover {\n    background: #d63146;\n    transform: translateY(-2px) scale(1.02);\n    box-shadow: 0 4px 15px rgba(236, 55, 80, 0.4);\n}\n\n.mobile-btn-primary:hover::before {\n    width: 100px;\n    height: 100px;\n}\n\n.mobile-btn-primary:active {\n    transform: translateY(0) scale(0.98);\n}\n\n.mobile-btn-secondary {\n    flex: 1;\n    background: #f8fafc;\n    color: #4a5568;\n    border: 2px solid #e2e8f0;\n    border-radius: 12px;\n    padding: 1rem;\n    font-weight: 600;\n    font-size: 1rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.mobile-btn-secondary:hover {\n    background: #e2e8f0;\n    border-color: #cbd5e0;\n}\n\n.mobile-btn-danger {\n    flex: 1;\n    background: #dc3545;\n    color: white;\n    border: none;\n    border-radius: 12px;\n    padding: 1rem;\n    font-weight: 600;\n    font-size: 1rem;\n    cursor: pointer;\n    transition: all var(--animation-speed-normal) var(--bounce-timing);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n    position: relative;\n    overflow: hidden;\n}\n\n.mobile-btn-danger:hover {\n    background: #c82333;\n    transform: translateY(-2px) scale(1.02);\n    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);\n}\n\n.mobile-btn-danger:active {\n    transform: translateY(0) scale(0.98);\n}\n\n/* Clickable card styles */\n.mobile-card.clickable {\n    cursor: pointer;\n    transition: all var(--animation-speed-normal) var(--smooth-timing);\n}\n\n.mobile-card.clickable:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);\n    border-color: #ec3750;\n}\n\n.mobile-card.clickable:active {\n    transform: translateY(-1px);\n}\n\n/* Stream post with delete button */\n.stream-post-actions {\n    display: flex;\n    justify-content: flex-end;\n    margin-top: 0.75rem;\n    padding-top: 0.75rem;\n    border-top: 1px solid #e2e8f0;\n}\n\n.delete-post-btn {\n    background: rgba(220, 53, 69, 0.1);\n    color: #dc3545;\n    border: none;\n    border-radius: 6px;\n    padding: 0.5rem 0.75rem;\n    font-size: 0.75rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 0.25rem;\n}\n\n.delete-post-btn:hover {\n    background: rgba(220, 53, 69, 0.2);\n}\n\n/* Resource card with delete button */\n.resource-actions {\n    margin-top: 0.75rem;\n    padding-top: 0.75rem;\n    border-top: 1px solid #e2e8f0;\n    display: flex;\n    justify-content: flex-end;\n}\n\n.delete-resource-btn {\n    background: rgba(220, 53, 69, 0.1);\n    color: #dc3545;\n    border: none;\n    border-radius: 6px;\n    padding: 0.5rem 0.75rem;\n    font-size: 0.75rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 0.25rem;\n}\n\n.delete-resource-btn:hover {\n    background: rgba(220, 53, 69, 0.2);\n}\n\n.form-group-mobile select {\n    width: 100%;\n    padding: 0.75rem;\n    border: 2px solid #e2e8f0;\n    border-radius: 12px;\n    font-size: 0.875rem;\n    background: white;\n    appearance: none;\n    background-image: url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e\");\n    background-repeat: no-repeat;\n    background-position: right 0.75rem center;\n    background-size: 1rem;\n    padding-right: 2.5rem;\n}\n\n.form-group-mobile select:focus {\n    outline: none;\n    border-color: #ec3750;\n    box-shadow: 0 0 0 3px rgba(236, 55, 80, 0.1);\n}\n\n/* Enhanced Modal Z-Index */\n.modal {\n    z-index: 2000 !important;\n}\n\n.modal-content {\n    z-index: 2001 !important;\n}\n\n.toast-container {\n    z-index: 2500 !important;\n}\n\n/* Hide desktop modals on mobile */\n@media (max-width: 768px) {\n    .modal:not(.mobile-modal) {\n        display: none !important;\n    }\n}\n\n.member-actions-buttons {\n    display: flex;\n    gap: 0.5rem;\n    align-items: center;\n}\n\n.promote-btn {\n    background: #10b981;\n    color: white;\n    border: none;\n    border-radius: 50%;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    font-size: 0.75rem;\n    transition: all 0.2s ease;\n}\n\n.promote-btn:hover {\n    background: #059669;\n    transform: scale(1.1);\n}\n\n/* This CSS will ensure entrance animations are immediate and navigation bar transitions are smooth and less obtrusive. */\n\n/* Cosmetic Effects for Member Names */\n\n.cosmetic-rainbow {\n    background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #80ff00, #00ff00, #00ff80, #00ffff, #0080ff, #0000ff, #8000ff, #ff00ff, #ff0080);\n    background-size: 400% 400%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: rainbow-wave 3s ease-in-out infinite;\n    font-weight: 600;\n}\n\n@keyframes rainbow-wave {\n    0%, 100% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n}\n\n.cosmetic-gold {\n    background: linear-gradient(45deg, #ffd700, #ffed4a, #fff59d, #ffd700);\n    background-size: 300% 300%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: gold-shine 2s ease-in-out infinite;\n    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);\n    font-weight: 600;\n}\n\n@keyframes gold-shine {\n    0%, 100% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n}\n\n.cosmetic-fire {\n    background: linear-gradient(45deg, #ff4500, #ff6347, #ff8c00, #ffa500, #ff0000);\n    background-size: 300% 300%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: fire-flicker 1.5s ease-in-out infinite;\n    text-shadow: 0 0 15px rgba(255, 69, 0, 0.7);\n    font-weight: 600;\n}\n\n@keyframes fire-flicker {\n    0%, 100% { \n        background-position: 0% 50%;\n        filter: brightness(1);\n    }\n    25% { \n        background-position: 50% 0%;\n        filter: brightness(1.2);\n    }\n    50% { \n        background-position: 100% 50%;\n        filter: brightness(0.9);\n    }\n    75% { \n        background-position: 50% 100%;\n        filter: brightness(1.1);\n    }\n}\n\n.cosmetic-ice {\n    background: linear-gradient(45deg, #00bfff, #87ceeb, #b0e0e6, #e0f6ff, #00bfff);\n    background-size: 300% 300%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: ice-crystal 2.5s ease-in-out infinite;\n    text-shadow: 0 0 10px rgba(0, 191, 255, 0.6);\n    font-weight: 600;\n}\n\n@keyframes ice-crystal {\n    0%, 100% { \n        background-position: 0% 50%;\n        filter: brightness(1);\n    }\n    50% { \n        background-position: 100% 50%;\n        filter: brightness(1.3);\n    }\n}\n\n.cosmetic-neon {\n    color: #00ff41;\n    text-shadow: \n        0 0 5px #00ff41,\n        0 0 10px #00ff41,\n        0 0 15px #00ff41,\n        0 0 20px #00ff41,\n        0 0 35px #00ff41,\n        0 0 40px #00ff41;\n    animation: neon-pulse 2s ease-in-out infinite alternate;\n    font-weight: 600;\n}\n\n@keyframes neon-pulse {\n    from {\n        text-shadow: \n            0 0 5px #00ff41,\n            0 0 10px #00ff41,\n            0 0 15px #00ff41,\n            0 0 20px #00ff41,\n            0 0 35px #00ff41,\n            0 0 40px #00ff41;\n    }\n    to {\n        text-shadow: \n            0 0 2px #00ff41,\n            0 0 5px #00ff41,\n            0 0 8px #00ff41,\n            0 0 12px #00ff41,\n            0 0 18px #00ff41,\n            0 0 25px #00ff41;\n    }\n}\n\n.cosmetic-gradient {\n    background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);\n    background-size: 300% 300%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: gradient-shift 4s ease-in-out infinite;\n    font-weight: 600;\n}\n\n@keyframes gradient-shift {\n    0%, 100% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n}\n\n.cosmetic-sparkle {\n    color: #9333ea;\n    position: relative;\n    font-weight: 600;\n    animation: sparkle-text 2s ease-in-out infinite;\n}\n\n.cosmetic-sparkle::before {\n    content: '';\n    position: absolute;\n    left: -15px;\n    animation: sparkle-float 1.5s ease-in-out infinite;\n    font-size: 0.8em;\n}\n\n.cosmetic-sparkle::after {\n    content: '';\n    position: absolute;\n    right: -15px;\n    animation: sparkle-float 1.5s ease-in-out infinite 0.5s;\n    font-size: 0.8em;\n}\n\n@keyframes sparkle-text {\n    0%, 100% { filter: brightness(1); }\n    50% { filter: brightness(1.3); }\n}\n\n@keyframes sparkle-float {\n    0%, 100% { \n        transform: translateY(0px);\n        opacity: 0.7;\n    }\n    50% { \n        transform: translateY(-5px);\n        opacity: 1;\n    }\n}\n\n.cosmetic-shadow {\n    color: #4a5568;\n    text-shadow: \n        2px 2px 4px rgba(0, 0, 0, 0.5),\n        -1px -1px 2px rgba(255, 255, 255, 0.3);\n    font-weight: 600;\n    animation: shadow-depth 3s ease-in-out infinite;\n}\n\n@keyframes shadow-depth {\n    0%, 100% {\n        text-shadow: \n            2px 2px 4px rgba(0, 0, 0, 0.5),\n            -1px -1px 2px rgba(255, 255, 255, 0.3);\n    }\n    50% {\n        text-shadow: \n            4px 4px 8px rgba(0, 0, 0, 0.7),\n            -2px -2px 4px rgba(255, 255, 255, 0.5);\n    }\n}","size_bytes":45981},"static/js/dash-member.js":{"content":"// Member-specific dashboard JavaScript\n\n// Utility function to format dates\nfunction formatDate(dateString) {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', { \n        year: 'numeric', \n        month: 'short', \n        day: 'numeric' \n    });\n}\n\nlet clubId = '';\nlet joinCode = '';\n\ndocument.addEventListener('DOMContentLoaded', function() {\n\n    const dashboardElement = document.querySelector('.club-dashboard');\n    if (dashboardElement) {\n        clubId = dashboardElement.dataset.clubId || '';\n        joinCode = dashboardElement.dataset.joinCode || '';\n    }\n\n    initNavigation();\n\n    if (clubId) {\n        loadMemberData();\n    }\n});\n\nfunction initNavigation() {\n\n    const sidebarNavLinks = document.querySelectorAll('.dashboard-sidebar .nav-link');\n\n    sidebarNavLinks.forEach(link => {\n        const newLink = link.cloneNode(true);\n        link.parentNode.replaceChild(newLink, link);\n\n        newLink.onclick = function(e) {\n            e.preventDefault();\n            const section = this.getAttribute('data-section');\n            if (section) {\n                openTab(section);\n                return false;\n            }\n        };\n    });\n\n    const hash = window.location.hash.substring(1);\n    if (hash) {\n        openTab(hash);\n    } else {\n        openTab('dashboard');\n    }\n}\n\nfunction openTab(sectionName) {\n    if (!sectionName) return;\n\n\n    const allSections = document.querySelectorAll('.club-section');\n    allSections.forEach(section => {\n        section.classList.remove('active');\n    });\n\n    const targetSection = document.getElementById(sectionName);\n    if (targetSection) {\n        targetSection.classList.add('active');\n    } else {\n        console.warn('Section not found:', sectionName);\n        return;\n    }\n\n    const allNavLinks = document.querySelectorAll('.nav-link');\n    allNavLinks.forEach(link => {\n        link.classList.remove('active');\n    });\n\n    const activeNavLink = document.querySelector(`.nav-link[data-section=\"${sectionName}\"]`);\n    if (activeNavLink) {\n        activeNavLink.classList.add('active');\n    }\n\n    loadMemberSectionData(sectionName);\n}\n\nfunction loadMemberData() {\n    if (!clubId) return;\n\n    loadMemberPosts();\n    loadMemberAssignments();\n    loadMemberMeetings();\n    loadMemberProjects();\n    loadMemberResources();\n    loadMemberSubmissions();\n}\n\nfunction loadMemberSectionData(section) {\n    switch(section) {\n        case 'stream':\n            loadMemberPosts();\n            break;\n        case 'assignments':\n            loadMemberAssignments();\n            break;\n        case 'schedule':\n            loadMemberMeetings();\n            break;\n        case 'projects':\n            loadMemberProjects();\n            break;\n        case 'resources':\n            loadMemberResources();\n            break;\n        case 'pizza':\n            loadMemberSubmissions();\n            break;\n    }\n}\n\nfunction loadMemberPosts() {\n    if (!clubId) return;\n\n    fetch(`/api/clubs/${clubId}/posts`)\n        .then(response => response.json())\n        .then(data => {\n            const postsList = document.getElementById('postsList');\n            postsList.innerHTML = '';\n\n            if (data.posts && data.posts.length > 0) {\n                data.posts.forEach(post => {\n                    const postCard = document.createElement('div');\n                    postCard.className = 'post-card';\n\n                    // Create post elements safely\n                    const postHeader = document.createElement('div');\n                    postHeader.className = 'post-header';\n\n                    const postAvatar = document.createElement('div');\n                    postAvatar.className = 'post-avatar';\n                    postAvatar.textContent = post.user.username.charAt(0).toUpperCase();\n\n                    const postInfo = document.createElement('div');\n                    postInfo.className = 'post-info';\n\n                    const postUsername = document.createElement('h4');\n                    postUsername.textContent = post.user.username;\n\n                    const postDate = document.createElement('div');\n                    postDate.className = 'post-date';\n                    postDate.textContent = formatDate(post.created_at);\n\n                    postInfo.appendChild(postUsername);\n                    postInfo.appendChild(postDate);\n                    postHeader.appendChild(postAvatar);\n                    postHeader.appendChild(postInfo);\n\n                    const postContent = document.createElement('div');\n                    postContent.className = 'post-content';\n\n                    const postText = document.createElement('p');\n                    postText.textContent = post.content;\n                    postContent.appendChild(postText);\n\n                    postCard.appendChild(postHeader);\n                    postCard.appendChild(postContent);\n\n                    postsList.appendChild(postCard);\n                });\n            } else {\n                postsList.innerHTML = `\n                    <div class=\"empty-state\">\n                        <i class=\"fas fa-stream\"></i>\n                        <h3>No announcements yet</h3>\n                        <p>Your club leaders will post updates here!</p>\n                    </div>\n                `;\n            }\n        })\n        .catch(error => {\n            console.error('Error loading posts:', error);\n        });\n}\n\nfunction loadMemberAssignments() {\n    if (!clubId) return;\n\n    fetch(`/api/clubs/${clubId}/assignments`)\n        .then(response => response.json())\n        .then(data => {\n            const assignmentsList = document.getElementById('assignmentsList');\n            const assignmentsCount = document.getElementById('myAssignmentsCount');\n\n            assignmentsList.innerHTML = '';\n\n            if (data.assignments && data.assignments.length > 0) {\n                data.assignments.forEach(assignment => {\n                    const card = document.createElement('div');\n                    card.className = 'card';\n                    card.style.marginBottom = '1rem';\n\n                    const isOverdue = assignment.due_date && new Date(assignment.due_date) < new Date();\n\n                    card.innerHTML = `\n                        <div class=\"card-header\" style=\"display: flex; justify-content: space-between; align-items: flex-start;\">\n                            <div>\n                                <h3 style=\"margin: 0; font-size: 1.125rem; color: #1f2937;\">${assignment.title}</h3>\n                                <span style=\"background: ${assignment.status === 'active' ? '#10b981' : '#6b7280'}; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; margin-top: 0.5rem; display: inline-block;\">${assignment.status}</span>\n                                ${isOverdue ? '<span style=\"background: #ef4444; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; margin-left: 0.5rem;\">OVERDUE</span>' : ''}\n                            </div>\n                        </div>\n                        <div class=\"card-body\">\n                            <p style=\"margin-bottom: 1rem; color: #6b7280;\">${assignment.description}</p>\n                            <div style=\"display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; color: #6b7280;\">\n                                ${assignment.due_date ? `<span style=\"display: flex; align-items: center; gap: 0.25rem;\"><i class=\"fas fa-calendar\"></i> Due: ${new Date(assignment.due_date).toLocaleDateString()}</span>` : ''}\n                                <span style=\"display: flex; align-items: center; gap: 0.25rem;\"><i class=\"fas fa-users\"></i> ${assignment.for_all_members ? 'All members' : 'Selected members'}</span>\n                            </div>\n                        </div>\n                    `;\n\n                    assignmentsList.appendChild(card);\n                });\n\n                if (assignmentsCount) {\n                    assignmentsCount.textContent = data.assignments.filter(a => a.status === 'active').length;\n                }\n            } else {\n                assignmentsList.innerHTML = `\n                    <div class=\"empty-state\">\n                        <i class=\"fas fa-clipboard-list\"></i>\n                        <h3>No assignments yet</h3>\n                        <p>Your leaders will assign coding challenges soon!</p>\n                    </div>\n                `;\n                if (assignmentsCount) assignmentsCount.textContent = '0';\n            }\n        })\n        .catch(error => {\n            console.error('Error loading assignments:', error);\n        });\n}\n\nfunction loadMemberMeetings() {\n    if (!clubId) return;\n\n    fetch(`/api/clubs/${clubId}/meetings`)\n        .then(response => response.json())\n        .then(data => {\n            const meetingsList = document.getElementById('meetingsList');\n            const eventsCount = document.getElementById('upcomingEventsCount');\n\n            meetingsList.innerHTML = '';\n\n            if (data.meetings && data.meetings.length > 0) {\n                data.meetings.forEach(meeting => {\n                    const card = document.createElement('div');\n                    card.className = 'card';\n                    card.style.marginBottom = '1rem';\n\n                    card.innerHTML = `\n                        <div class=\"card-header\">\n                            <h3 style=\"margin: 0; font-size: 1.125rem; color: #1f2937;\">${meeting.title}</h3>\n                        </div>\n                        <div class=\"card-body\">\n                            ${meeting.description ? `<p style=\"margin-bottom: 1rem; color: #6b7280;\">${meeting.description}</p>` : ''}\n                            <div style=\"display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; color: #6b7280;\">\n                                <span style=\"display: flex; align-items: center; gap: 0.25rem;\"><i class=\"fas fa-calendar\"></i> ${new Date(meeting.meeting_date).toLocaleDateString()}</span>\n                                <span style=\"display: flex; align-items: center; gap: 0.25rem;\"><i class=\"fas fa-clock\"></i> ${meeting.start_time}${meeting.end_time ? ` - ${meeting.end_time}` : ''}</span>\n                                ${meeting.location ? `<span style=\"display: flex; align-items: center; gap: 0.25rem;\"><i class=\"fas fa-map-marker-alt\"></i> ${meeting.location}</span>` : ''}\n                                ${meeting.meeting_link ? `<span style=\"display: flex; align-items: center; gap: 0.25rem;\"><i class=\"fas fa-link\"></i> <a href=\"${meeting.meeting_link}\" target=\"_blank\" style=\"color: #ec3750;\">Join Meeting</a></span>` : ''}\n                            </div>\n                        </div>\n                    `;\n\n                    meetingsList.appendChild(card);\n                });\n\n                if (eventsCount) {\n                    const thisMonth = new Date().getMonth();\n                    const thisYear = new Date().getFullYear();\n                    const thisMonthMeetings = data.meetings.filter(m => {\n                        const meetingDate = new Date(m.meeting_date);\n                        return meetingDate.getMonth() === thisMonth && meetingDate.getFullYear() === thisYear;\n                    });\n                    eventsCount.textContent = thisMonthMeetings.length;\n                }\n            } else {\n                meetingsList.innerHTML = `\n                    <div class=\"empty-state\">\n                        <i class=\"fas fa-calendar-times\"></i>\n                        <h3>No events scheduled</h3>\n                        <p>Check back for upcoming club events!</p>\n                    </div>\n                `;\n                if (eventsCount) eventsCount.textContent = '0';\n            }\n        })\n        .catch(error => {\n            console.error('Error loading meetings:', error);\n        });\n}\n\nfunction loadMemberProjects() {\n    if (!clubId) return;\n\n    // Load current user's Hackatime projects\n    fetch(`/api/hackatime/projects/${window.currentUserId || ''}`)\n        .then(response => response.json())\n        .then(data => {\n            const projectsList = document.getElementById('myHackatimeProjectsList');\n            const projectsCount = document.getElementById('myProjectsCount');\n\n            if (data.error) {\n                projectsList.innerHTML = `\n                    <div class=\"empty-state\">\n                        <i class=\"fas fa-exclamation-triangle\"></i>\n                        <h3>Unable to load projects</h3>\n                        <p>${data.error}</p>\n                    </div>\n                `;\n                if (projectsCount) projectsCount.textContent = '0';\n                return;\n            }\n\n            if (data.projects && data.projects.length > 0) {\n                let projectsHtml = `<h4 style=\"margin-bottom: 1rem; color: #1a202c;\">Your Hackatime Projects</h4>`;\n\n                data.projects.forEach(project => {\n                    projectsHtml += `\n                        <div class=\"card\" style=\"margin-bottom: 1rem;\">\n                            <div class=\"card-header\" style=\"display: flex; justify-content: space-between; align-items: flex-start;\">\n                                <h4 style=\"margin: 0; color: #1a202c; font-size: 1rem;\">\n                                    <i class=\"fas fa-code\"></i> ${project.name}\n                                </h4>\n                                <span style=\"background: #10b981; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">${project.formatted_time}</span>\n                            </div>\n                            <div class=\"card-body\">\n                                <div style=\"display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem; color: #6b7280;\">\n                                    <span style=\"display: flex; align-items: center; gap: 0.25rem;\">\n                                        <i class=\"fas fa-clock\"></i> ${project.total_seconds.toLocaleString()} seconds\n                                    </span>\n                                    ${project.percent ? `<span style=\"display: flex; align-items: center; gap: 0.25rem;\"><i class=\"fas fa-chart-pie\"></i> ${project.percent.toFixed(1)}% of total time</span>` : ''}\n                                </div>\n                            </div>\n                        </div>\n                    `;\n                });\n\n                projectsList.innerHTML = projectsHtml;\n                if (projectsCount) projectsCount.textContent = data.projects.length;\n            } else {\n                projectsList.innerHTML = `\n                    <div class=\"empty-state\">\n                        <i class=\"fas fa-clock\"></i>\n                        <h3>No projects found</h3>\n                        <p>You haven't logged any coding time yet on Hackatime</p>\n                    </div>\n                `;\n                if (projectsCount) projectsCount.textContent = '0';\n            }\n        })\n        .catch(error => {\n            console.error('Error loading Hackatime projects:', error);\n            const projectsList = document.getElementById('myHackatimeProjectsList');\n            if (projectsList) {\n                projectsList.innerHTML = `\n                    <div class=\"empty-state\">\n                        <i class=\"fas fa-exclamation-triangle\"></i>\n                        <h3>Error loading projects</h3>\n                        <p>Failed to fetch Hackatime data. Please try again.</p>\n                    </div>\n                `;\n            }\n        });\n}\n\nfunction loadMemberResources() {\n    if (!clubId) return;\n\n    fetch(`/api/clubs/${clubId}/resources`)\n        .then(response => response.json())\n        .then(data => {\n            const resourcesList = document.getElementById('resourcesList');\n            resourcesList.innerHTML = '';\n\n            if (data.resources && data.resources.length > 0) {\n                data.resources.forEach(resource => {\n                    const card = document.createElement('div');\n                    card.className = 'card';\n                    card.style.marginBottom = '1rem';\n\n                    card.innerHTML = `\n                        <div class=\"card-header\">\n                            <h3 style=\"margin: 0; font-size: 1.125rem; color: #1f2937;\">\n                                <i class=\"fas fa-${resource.icon}\"></i> ${resource.title}\n                            </h3>\n                        </div>\n                        <div class=\"card-body\">\n                            ${resource.description ? `<p style=\"margin-bottom: 1rem; color: #6b7280;\">${resource.description}</p>` : ''}\n                            <div style=\"display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; color: #6b7280;\">\n                                <span style=\"display: flex; align-items: center; gap: 0.25rem;\">\n                                    <i class=\"fas fa-link\"></i> \n                                    <a href=\"${resource.url}\" target=\"_blank\" style=\"color: #ec3750;\">Visit Resource</a>\n                                </span>\n                            </div>\n                        </div>\n                    `;\n\n                    resourcesList.appendChild(card);\n                });\n            } else {\n                resourcesList.innerHTML = `\n                    <div class=\"empty-state\">\n                        <i class=\"fas fa-book\"></i>\n                        <h3>No resources yet</h3>\n                        <p>Your club leaders will share helpful resources here!</p>\n                    </div>\n                `;\n            }\n        })\n        .catch(error => {\n            console.error('Error loading resources:', error);\n        });\n}\n\nfunction loadMemberSubmissions() {\n    // This would load the current user's submissions\n    const submissionsList = document.getElementById('mySubmissionsList');\n    const submissionsCount = document.getElementById('achievementsCount');\n\n    if (submissionsList) {\n        submissionsList.innerHTML = `\n            <div class=\"empty-state\">\n                <i class=\"fas fa-hand-holding-usd\"></i>\n                <h3>No submissions yet</h3>\n                <p>Submit your first project to get started!</p>\n            </div>\n        `;\n    }\n\n    if (submissionsCount) {\n        submissionsCount.textContent = '0';\n    }\n}\n","size_bytes":18526},"app/models/slack.py":{"content":"\"\"\"\nSlack integration models for club channels.\n\"\"\"\nfrom datetime import datetime, timezone\nfrom extensions import db\n\n\nclass ClubSlackSettings(db.Model):\n    __tablename__ = 'club_slack_settings'\n\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    channel_id = db.Column(db.String(255))\n    channel_name = db.Column(db.String(255))\n    is_public = db.Column(db.Boolean, default=True)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    club = db.relationship('Club', backref=db.backref('slack_settings', uselist=False, cascade='all, delete-orphan'))\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'club_id': self.club_id,\n            'channel_id': self.channel_id,\n            'channel_name': self.channel_name,\n            'is_public': self.is_public,\n            'created_at': self.created_at.isoformat() if self.created_at else None,\n            'updated_at': self.updated_at.isoformat() if self.updated_at else None\n        }\n","size_bytes":1165},"app/routes/auth.py":{"content":"\"\"\"\nAuthentication routes blueprint for the Hack Club Dashboard.\nHandles login, signup, password reset, Slack OAuth, and Hack Club Identity OAuth.\n\"\"\"\n\nfrom flask import Blueprint, render_template, redirect, url_for, request, flash, jsonify, session\nfrom werkzeug.security import generate_password_hash\nfrom extensions import db, limiter\nfrom app.decorators.auth import login_required\nfrom app.utils.auth_helpers import get_current_user, login_user as do_login_user, logout_user as do_logout_user, is_authenticated\nfrom app.utils.sanitization import sanitize_string\nfrom app.utils.security import (\n    get_real_ip, log_security_event, validate_username, validate_email,\n    validate_name, validate_password, validate_input_with_security\n)\nfrom app.models.user import User\nfrom app.models.club import Club, ClubMembership\nimport re\nimport os\n\nauth_bp = Blueprint('auth', __name__)\n\n# Constants from environment\nSLACK_CLIENT_ID = os.getenv('SLACK_CLIENT_ID')\nSLACK_CLIENT_SECRET = os.getenv('SLACK_CLIENT_SECRET')\nHACKCLUB_IDENTITY_URL = os.getenv('HACKCLUB_IDENTITY_URL', 'https://identity.hackclub.com')\nHACKCLUB_IDENTITY_CLIENT_ID = os.getenv('HACKCLUB_IDENTITY_CLIENT_ID')\nHACKCLUB_IDENTITY_CLIENT_SECRET = os.getenv('HACKCLUB_IDENTITY_CLIENT_SECRET')\n\n\n@auth_bp.route('/login', methods=['GET', 'POST'])\n@limiter.limit(\"10 per minute\")\ndef login():\n    \"\"\"User login\"\"\"\n    if is_authenticated():\n        return redirect(url_for('main.dashboard'))\n\n    if request.method == 'POST':\n        email = sanitize_string(request.form.get('email', ''), max_length=120).strip().lower()\n        password = request.form.get('password', '')\n        remember_me = request.form.get('remember_me') == 'on'\n\n        if not email or not password:\n            flash('Email and password are required', 'error')\n            return render_template('login.html')\n\n        try:\n            user = User.query.filter_by(email=email).first()\n        except Exception as e:\n            db.session.rollback()\n            flash('Database connection error. Please try again.', 'error')\n            return render_template('login.html')\n\n        if user and user.check_password(password):\n            # Check if account is suspended\n            if user.is_suspended:\n                flash('Your account has been suspended. Please contact support.', 'error')\n                return redirect(url_for('main.suspended'))\n\n            do_login_user(user, remember=remember_me)\n            flash(f'Welcome back, {user.username}!', 'success')\n\n            # Check for pending OAuth flow\n            oauth_params = session.get('oauth_params')\n            if oauth_params:\n                session.pop('oauth_params', None)\n                query_string = '&'.join([f\"{k}={v}\" for k, v in oauth_params.items()])\n                return redirect(url_for('oauth.authorize') + f'?{query_string}')\n\n            return redirect(url_for('main.dashboard'))\n        else:\n            log_security_event(\"FAILED_LOGIN\", f\"Failed login attempt for email: {email}\", ip_address=get_real_ip())\n            flash('Invalid email or password', 'error')\n\n    # Check if mobile device\n    user_agent = request.headers.get('User-Agent', '').lower()\n    is_mobile = any(mobile in user_agent for mobile in ['mobile', 'android', 'iphone', 'ipad'])\n    force_mobile = request.args.get('mobile', '').lower() == 'true'\n    force_desktop = request.args.get('desktop', '').lower() == 'true'\n\n    if (is_mobile or force_mobile) and not force_desktop:\n        return render_template('login_mobile.html')\n    else:\n        return render_template('login.html')\n\n\n@auth_bp.route('/logout')\ndef logout():\n    \"\"\"User logout\"\"\"\n    do_logout_user()\n    flash('You have been logged out successfully.', 'success')\n    return redirect(url_for('main.index'))\n\n\n@auth_bp.route('/signup', methods=['GET', 'POST'])\n@limiter.limit(\"5 per minute\")\ndef signup():\n    \"\"\"User signup\"\"\"\n    if is_authenticated():\n        return redirect(url_for('main.dashboard'))\n\n    if request.method == 'POST':\n        # Get form data\n        username = sanitize_string(request.form.get('username', ''), max_length=30).strip()\n        email = sanitize_string(request.form.get('email', ''), max_length=120).strip().lower()\n        password = request.form.get('password', '')\n        first_name = sanitize_string(request.form.get('first_name', ''), max_length=50).strip()\n        last_name = sanitize_string(request.form.get('last_name', ''), max_length=50).strip()\n\n        # Validate inputs\n        valid_username, username_or_error = validate_username(username)\n        if not valid_username:\n            flash(username_or_error, 'error')\n            return render_template('signup.html')\n\n        valid_email, email_or_error = validate_email(email)\n        if not valid_email:\n            flash(email_or_error, 'error')\n            return render_template('signup.html')\n\n        valid_password, password_or_error = validate_password(password)\n        if not valid_password:\n            flash(password_or_error, 'error')\n            return render_template('signup.html')\n\n        # Check if username or email already exists\n        if User.query.filter_by(username=username).first():\n            flash('Username already taken', 'error')\n            return render_template('signup.html')\n\n        if User.query.filter_by(email=email).first():\n            flash('Email already registered', 'error')\n            return render_template('signup.html')\n\n        # Create new user\n        user = User(\n            username=username,\n            email=email,\n            first_name=first_name,\n            last_name=last_name\n        )\n        user.set_password(password)\n\n        db.session.add(user)\n        db.session.commit()\n\n        # Log in the new user\n        do_login_user(user)\n        flash(f'Welcome to Hack Club, {user.username}!', 'success')\n\n        return redirect(url_for('main.dashboard'))\n\n    return render_template('signup.html')\n\n\n@auth_bp.route('/forgot-password', methods=['GET', 'POST'])\n@limiter.limit(\"10 per minute\")\ndef forgot_password():\n    \"\"\"Request password reset\"\"\"\n    if is_authenticated():\n        return redirect(url_for('main.dashboard'))\n\n    if request.method == 'POST':\n        email = sanitize_string(request.form.get('email', ''), max_length=120).strip().lower()\n\n        if not email:\n            return jsonify({'success': False, 'message': 'Email is required'}), 400\n\n        # Validate email format\n        if not re.match(r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$', email):\n            return jsonify({'success': False, 'message': 'Invalid email format'}), 400\n\n        # TODO: Implement email sending for password reset\n        # For now, just return success\n        return jsonify({'success': True, 'message': 'If an account exists with this email, you will receive reset instructions.'})\n\n    return render_template('forgot_password.html')\n\n\n@auth_bp.route('/reset-password', methods=['GET', 'POST'])\n@limiter.limit(\"10 per minute\")\ndef reset_password():\n    \"\"\"Reset password with code\"\"\"\n    # TODO: Implement password reset functionality\n    return render_template('reset_password.html')\n\n\n@auth_bp.route('/verify-reset-code', methods=['POST'])\n@limiter.limit(\"10 per minute\")\ndef verify_reset_code():\n    \"\"\"Verify password reset code\"\"\"\n    # TODO: Implement reset code verification\n    return jsonify({'success': False, 'message': 'Not implemented'}), 501\n\n\n@auth_bp.route('/auth/slack')\ndef slack_login():\n    \"\"\"Initiate Slack OAuth flow\"\"\"\n    if not SLACK_CLIENT_ID:\n        flash('Slack authentication is not configured', 'error')\n        return redirect(url_for('auth.login'))\n\n    from app.services.slack_oauth import SlackOAuthService\n    redirect_uri = url_for('auth.slack_callback', _external=True)\n\n    # Generate state for CSRF protection\n    import secrets\n    state = secrets.token_urlsafe(32)\n    session['slack_oauth_state'] = state\n\n    auth_url = SlackOAuthService.get_authorization_url(redirect_uri, state)\n    return redirect(auth_url)\n\n\n@auth_bp.route('/auth/slack/callback')\n@limiter.limit(\"10 per minute\")\ndef slack_callback():\n    \"\"\"Handle Slack OAuth callback\"\"\"\n    # Verify state for CSRF protection\n    state = request.args.get('state')\n    if state != session.get('slack_oauth_state'):\n        flash('Invalid authentication state', 'error')\n        return redirect(url_for('auth.login'))\n\n    session.pop('slack_oauth_state', None)\n\n    code = request.args.get('code')\n    error = request.args.get('error')\n\n    if error:\n        flash(f'Slack authentication failed: {error}', 'error')\n        return redirect(url_for('auth.login'))\n\n    if not code:\n        flash('No authorization code received', 'error')\n        return redirect(url_for('auth.login'))\n\n    # Exchange code for token\n    from app.services.slack_oauth import SlackOAuthService\n    redirect_uri = url_for('auth.slack_callback', _external=True)\n    token_data = SlackOAuthService.exchange_code(code, redirect_uri)\n\n    if not token_data:\n        flash('Failed to authenticate with Slack', 'error')\n        return redirect(url_for('auth.login'))\n\n    # Get user info from Slack\n    user_info = SlackOAuthService.get_user_info(token_data.get('access_token'))\n\n    if not user_info:\n        flash('Failed to get user information from Slack', 'error')\n        return redirect(url_for('auth.login'))\n\n    # Find or create user\n    slack_id = user_info.get('user', {}).get('id')\n    email = user_info.get('user', {}).get('email')\n\n    if not slack_id or not email:\n        flash('Incomplete user information from Slack', 'error')\n        return redirect(url_for('auth.login'))\n\n    # Check if user exists\n    user = User.query.filter_by(email=email).first()\n\n    if user:\n        # User exists, log them in\n        user.slack_id = slack_id\n        db.session.commit()\n        do_login_user(user)\n        flash(f'Welcome back, {user.username}!', 'success')\n        return redirect(url_for('main.dashboard'))\n    else:\n        # New user, redirect to complete signup\n        session['slack_user_info'] = user_info\n        return redirect(url_for('auth.complete_slack_signup'))\n\n\n@auth_bp.route('/complete-slack-signup', methods=['GET', 'POST'])\n@limiter.limit(\"10 per minute\")\ndef complete_slack_signup():\n    \"\"\"Complete signup after Slack OAuth\"\"\"\n    slack_user_info = session.get('slack_user_info')\n    if not slack_user_info:\n        flash('No Slack authentication found. Please try again.', 'error')\n        return redirect(url_for('auth.signup'))\n\n    if request.method == 'POST':\n        username = sanitize_string(request.form.get('username', ''), max_length=30).strip()\n\n        # Validate username\n        valid_username, username_or_error = validate_username(username)\n        if not valid_username:\n            flash(username_or_error, 'error')\n            return render_template('complete_slack_signup.html', user_info=slack_user_info)\n\n        # Check if username exists\n        if User.query.filter_by(username=username).first():\n            flash('Username already taken', 'error')\n            return render_template('complete_slack_signup.html', user_info=slack_user_info)\n\n        # Create new user\n        email = slack_user_info.get('user', {}).get('email')\n        slack_id = slack_user_info.get('user', {}).get('id')\n        first_name = slack_user_info.get('user', {}).get('profile', {}).get('first_name', '')\n        last_name = slack_user_info.get('user', {}).get('profile', {}).get('last_name', '')\n\n        user = User(\n            username=username,\n            email=email,\n            slack_id=slack_id,\n            first_name=first_name,\n            last_name=last_name\n        )\n\n        # Generate a random password (user won't need it since they use Slack OAuth)\n        import secrets\n        random_password = secrets.token_urlsafe(32)\n        user.set_password(random_password)\n\n        db.session.add(user)\n        db.session.commit()\n\n        session.pop('slack_user_info', None)\n\n        # Log in the new user\n        do_login_user(user)\n        flash(f'Welcome to Hack Club, {user.username}!', 'success')\n\n        return redirect(url_for('main.dashboard'))\n\n    return render_template('complete_slack_signup.html', user_info=slack_user_info)\n\n\n@auth_bp.route('/identity/callback')\n@limiter.limit(\"10 per minute\")\ndef hackclub_identity_callback():\n    \"\"\"Handle Hack Club Identity OAuth callback\"\"\"\n    # TODO: Implement Hack Club Identity OAuth\n    flash('Hack Club Identity authentication is not yet implemented', 'warning')\n    return redirect(url_for('auth.login'))\n\n\n@auth_bp.route('/verify-leader', methods=['GET', 'POST'])\n@limiter.limit(\"10 per minute\")\ndef verify_leader():\n    \"\"\"Verify club leader with Airtable\"\"\"\n    # TODO: Implement leader verification\n    return render_template('verify_leader.html')\n\n\n@auth_bp.route('/complete-leader-signup')\n@login_required\ndef complete_leader_signup():\n    \"\"\"Complete signup for verified leaders\"\"\"\n    # TODO: Implement leader signup completion\n    flash('Leader signup completion is not yet implemented', 'warning')\n    return redirect(url_for('main.dashboard'))\n\n\n@auth_bp.route('/setup-hackatime', methods=['GET', 'POST'])\n@login_required\ndef setup_hackatime():\n    \"\"\"Setup Hackatime integration\"\"\"\n    # TODO: Implement Hackatime setup\n    return render_template('setup_hackatime.html')\n","size_bytes":13340},"app/routes/clubs.py":{"content":"\"\"\"\nClub routes blueprint for the Hack Club Dashboard.\nHandles club management, shop, poster editor, and club-specific features.\n\"\"\"\n\nfrom flask import Blueprint, render_template, redirect, url_for, request, flash, jsonify, send_file\nfrom extensions import db\nfrom app.decorators.auth import login_required\nfrom app.decorators.economy import economy_required\nfrom app.utils.auth_helpers import get_current_user\nfrom app.utils.club_helpers import verify_club_leadership, is_user_co_leader\nfrom app.utils.economy_helpers import create_club_transaction\nfrom app.models.club import Club, ClubMembership\nfrom app.models.economy import ClubTransaction\nfrom app.models.club_content import ClubPost, ClubProject\n\nclubs_bp = Blueprint('clubs', __name__)\n\n\n@clubs_bp.route('/club-connection-required/<int:club_id>')\n@login_required\ndef club_connection_required(club_id):\n    \"\"\"Page shown when club connection is required\"\"\"\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Check if user is a member\n    membership = ClubMembership.query.filter_by(\n        club_id=club_id,\n        user_id=user.id\n    ).first()\n\n    if not membership:\n        flash('You must be a member of this club to access this page.', 'danger')\n        return redirect(url_for('main.dashboard'))\n\n    return render_template('club_connection_required.html', club=club)\n\n\n@clubs_bp.route('/club/<int:club_id>/shop')\n@login_required\n@economy_required\ndef club_shop(club_id):\n    \"\"\"Club token shop\"\"\"\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Verify user is a member or leader\n    membership = ClubMembership.query.filter_by(\n        club_id=club_id,\n        user_id=user.id\n    ).first()\n\n    if not membership:\n        flash('You must be a member of this club to access the shop.', 'danger')\n        return redirect(url_for('main.dashboard'))\n\n    # Get club transactions for balance history\n    transactions = ClubTransaction.query.filter_by(\n        club_id=club_id\n    ).order_by(ClubTransaction.created_at.desc()).limit(20).all()\n\n    return render_template('club_shop.html', club=club, transactions=transactions)\n\n\n@clubs_bp.route('/club/<int:club_id>/orders')\n@login_required\ndef club_orders(club_id):\n    \"\"\"View club orders\"\"\"\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Verify user is a leader\n    if not verify_club_leadership(club, user):\n        flash('Only club leaders can view orders.', 'danger')\n        return redirect(url_for('main.club_dashboard', club_id=club_id))\n\n    # TODO: Implement order viewing\n    return render_template('club_orders.html', club=club)\n\n\n@clubs_bp.route('/club/<int:club_id>/poster-editor')\n@login_required\ndef poster_editor(club_id):\n    \"\"\"Club poster editor\"\"\"\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Verify user is a member\n    membership = ClubMembership.query.filter_by(\n        club_id=club_id,\n        user_id=user.id\n    ).first()\n\n    if not membership:\n        flash('You must be a member of this club to use the poster editor.', 'danger')\n        return redirect(url_for('main.dashboard'))\n\n    return render_template('poster_editor.html', club=club)\n\n\n@clubs_bp.route('/club/<int:club_id>/project-submission', methods=['GET', 'POST'])\n@login_required\ndef project_submission(club_id):\n    \"\"\"Submit a project for club\"\"\"\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Verify user is a member\n    membership = ClubMembership.query.filter_by(\n        club_id=club_id,\n        user_id=user.id\n    ).first()\n\n    if not membership:\n        flash('You must be a member of this club to submit projects.', 'danger')\n        return redirect(url_for('main.dashboard'))\n\n    if request.method == 'POST':\n        from app.utils.sanitization import sanitize_string, sanitize_url\n        from app.models.economy import ProjectSubmission\n\n        project_name = sanitize_string(request.form.get('project_name', ''), max_length=200)\n        project_url = sanitize_url(request.form.get('project_url', ''), max_length=500)\n\n        if not project_name:\n            flash('Project name is required.', 'error')\n            return render_template('project_submission.html', club=club)\n\n        # Create project submission\n        submission = ProjectSubmission(\n            user_id=user.id,\n            club_id=club_id,\n            project_name=project_name,\n            project_url=project_url\n        )\n\n        db.session.add(submission)\n        db.session.commit()\n\n        flash('Project submitted successfully! Waiting for approval.', 'success')\n        return redirect(url_for('main.club_dashboard', club_id=club_id))\n\n    return render_template('project_submission.html', club=club)\n\n\n@clubs_bp.route('/api/clubs/<int:club_id>/members')\n@login_required\ndef get_club_members(club_id):\n    \"\"\"Get club members API endpoint\"\"\"\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Verify user is a member\n    membership = ClubMembership.query.filter_by(\n        club_id=club_id,\n        user_id=user.id\n    ).first()\n\n    if not membership:\n        return jsonify({'error': 'Not authorized'}), 403\n\n    # Get all members\n    memberships = ClubMembership.query.filter_by(club_id=club_id).all()\n\n    members_data = []\n    for m in memberships:\n        member_data = {\n            'id': m.user.id,\n            'username': m.user.username,\n            'first_name': m.user.first_name,\n            'last_name': m.user.last_name,\n            'email': m.user.email,\n            'role': m.role,\n            'is_leader': m.user.id == club.leader_id,\n            'is_co_leader': m.user.id == club.co_leader_id,\n            'joined_at': m.joined_at.isoformat() if m.joined_at else None\n        }\n        members_data.append(member_data)\n\n    return jsonify({\n        'success': True,\n        'club_id': club_id,\n        'club_name': club.name,\n        'members': members_data,\n        'total_members': len(members_data)\n    })\n\n\n@clubs_bp.route('/api/clubs/<int:club_id>/background', methods=['GET', 'POST'])\n@login_required\ndef club_background(club_id):\n    \"\"\"Get or update club background\"\"\"\n    from app.utils.sanitization import sanitize_string\n\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Check if user is leader or co-leader\n    is_leader = club.leader_id == user.id\n    is_co_leader = is_user_co_leader(club, user)\n\n    if request.method == 'GET':\n        # Any member can view\n        membership = ClubMembership.query.filter_by(club_id=club_id, user_id=user.id).first()\n        if not membership and not user.is_admin:\n            return jsonify({'error': 'Not authorized'}), 403\n\n        return jsonify({\n            'background_color': club.background_color or '#1e293b',\n            'background_image': club.background_image or ''\n        })\n\n    elif request.method == 'POST':\n        # Only leaders/co-leaders can update\n        if not is_leader and not is_co_leader and not user.is_admin:\n            return jsonify({'error': 'Only club leaders can update background'}), 403\n\n        data = request.get_json()\n\n        if 'background_color' in data:\n            club.background_color = sanitize_string(data['background_color'], max_length=20)\n\n        if 'background_image' in data:\n            club.background_image = sanitize_string(data['background_image'], max_length=500)\n\n        db.session.commit()\n\n        return jsonify({\n            'success': True,\n            'message': 'Background updated successfully',\n            'background_color': club.background_color,\n            'background_image': club.background_image\n        })\n\n\n@clubs_bp.route('/api/clubs/<int:club_id>/update-email', methods=['POST'])\n@login_required\ndef update_club_email(club_id):\n    \"\"\"Update club email\"\"\"\n    from app.utils.sanitization import sanitize_string\n    from app.models.user import create_audit_log\n\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Check if user is leader or co-leader\n    is_leader = club.leader_id == user.id\n    is_co_leader = is_user_co_leader(club, user)\n\n    if not is_leader and not is_co_leader and not user.is_admin:\n        return jsonify({'error': 'Only club leaders can update email'}), 403\n\n    data = request.get_json()\n    new_email = sanitize_string(data.get('email', ''), max_length=120)\n\n    if not new_email or '@' not in new_email:\n        return jsonify({'error': 'Invalid email address'}), 400\n\n    old_email = club.email\n    club.email = new_email\n    db.session.commit()\n\n    create_audit_log(\n        action_type='club_email_update',\n        description=f'Club {club.name} email updated from {old_email} to {new_email}',\n        user=user,\n        target_type='club',\n        target_id=club_id,\n        category='club'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Email updated successfully',\n        'email': new_email\n    })\n\n\n@clubs_bp.route('/api/club/<int:club_id>/orders', methods=['GET'])\n@login_required\ndef get_club_orders(club_id):\n    \"\"\"Get orders for a club\"\"\"\n    from app.models.shop import Order\n\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Verify user is a member or admin\n    membership = ClubMembership.query.filter_by(club_id=club_id, user_id=user.id).first()\n    if not membership and not user.is_admin:\n        return jsonify({'error': 'Not authorized'}), 403\n\n    # Get orders for this club\n    orders = Order.query.filter_by(club_id=club_id).order_by(Order.created_at.desc()).all()\n\n    orders_data = [order.to_dict() for order in orders]\n\n    return jsonify({\n        'success': True,\n        'club_id': club_id,\n        'club_name': club.name,\n        'orders': orders_data,\n        'total_orders': len(orders_data)\n    })\n\n\n@clubs_bp.route('/api/club/<int:club_id>/cosmetics', methods=['GET'])\n@login_required\ndef get_club_cosmetics(club_id):\n    \"\"\"Get available cosmetics for a club\"\"\"\n    from app.models.club import ClubCosmetic, MemberCosmetic\n\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Verify user is a member\n    membership = ClubMembership.query.filter_by(club_id=club_id, user_id=user.id).first()\n    if not membership and not user.is_admin:\n        return jsonify({'error': 'Not authorized'}), 403\n\n    # Get all available cosmetics\n    cosmetics = ClubCosmetic.query.filter_by(is_active=True).all()\n\n    cosmetics_data = []\n    for cosmetic in cosmetics:\n        # Check if club owns this cosmetic\n        owned = MemberCosmetic.query.filter_by(\n            club_id=club_id,\n            cosmetic_id=cosmetic.id\n        ).first() is not None\n\n        cosmetics_data.append({\n            'id': cosmetic.id,\n            'name': cosmetic.name,\n            'description': cosmetic.description,\n            'cosmetic_type': cosmetic.cosmetic_type,\n            'price': cosmetic.price,\n            'image_url': cosmetic.image_url,\n            'owned': owned\n        })\n\n    return jsonify({\n        'success': True,\n        'cosmetics': cosmetics_data\n    })\n\n\n@clubs_bp.route('/api/club/<int:club_id>/cosmetics/purchase', methods=['POST'])\n@login_required\ndef purchase_cosmetic(club_id):\n    \"\"\"Purchase a cosmetic for the club\"\"\"\n    from app.models.club import ClubCosmetic, MemberCosmetic\n    from app.models.user import create_audit_log\n\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Only leaders can purchase cosmetics\n    if club.leader_id != user.id and not user.is_admin:\n        return jsonify({'error': 'Only club leaders can purchase cosmetics'}), 403\n\n    data = request.get_json()\n    cosmetic_id = data.get('cosmetic_id')\n\n    if not cosmetic_id:\n        return jsonify({'error': 'cosmetic_id is required'}), 400\n\n    cosmetic = ClubCosmetic.query.get_or_404(cosmetic_id)\n\n    # Check if already owned\n    existing = MemberCosmetic.query.filter_by(\n        club_id=club_id,\n        cosmetic_id=cosmetic_id\n    ).first()\n\n    if existing:\n        return jsonify({'error': 'Cosmetic already owned'}), 400\n\n    # Check if club has enough tokens\n    if club.tokens < cosmetic.price:\n        return jsonify({'error': 'Insufficient tokens'}), 400\n\n    # Deduct tokens\n    club.tokens -= cosmetic.price\n\n    # Grant cosmetic\n    member_cosmetic = MemberCosmetic(\n        club_id=club_id,\n        cosmetic_id=cosmetic_id\n    )\n    db.session.add(member_cosmetic)\n\n    # Create transaction\n    create_club_transaction(\n        club_id=club_id,\n        transaction_type='debit',\n        amount=cosmetic.price,\n        description=f'Purchased cosmetic: {cosmetic.name}',\n        user_id=user.id,\n        reference_type='cosmetic_purchase',\n        reference_id=cosmetic_id,\n        created_by=user.id\n    )\n\n    db.session.commit()\n\n    create_audit_log(\n        action_type='cosmetic_purchase',\n        description=f'Club {club.name} purchased cosmetic {cosmetic.name}',\n        user=user,\n        target_type='cosmetic',\n        target_id=cosmetic_id,\n        category='club'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Cosmetic purchased successfully',\n        'remaining_tokens': club.tokens\n    })\n\n\n@clubs_bp.route('/api/club/<int:club_id>/shop-items', methods=['GET'])\n@login_required\ndef get_club_shop_items(club_id):\n    \"\"\"Get shop items available for purchase\"\"\"\n    from app.models.shop import ShopItem\n\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Verify user is a member\n    membership = ClubMembership.query.filter_by(club_id=club_id, user_id=user.id).first()\n    if not membership and not user.is_admin:\n        return jsonify({'error': 'Not authorized'}), 403\n\n    # Get active shop items\n    items = ShopItem.query.filter_by(is_active=True).order_by(ShopItem.price).all()\n\n    items_data = [item.to_dict() for item in items]\n\n    return jsonify({\n        'success': True,\n        'items': items_data,\n        'club_tokens': club.tokens\n    })\n\n\n@clubs_bp.route('/api/clubs/<int:club_id>/project-submission', methods=['POST'])\n@login_required\ndef submit_club_project(club_id):\n    \"\"\"Submit a project for the club\"\"\"\n    from app.models.economy import ProjectSubmission\n    from app.models.user import create_audit_log\n    from app.utils.sanitization import sanitize_string\n\n    club = Club.query.get_or_404(club_id)\n    user = get_current_user()\n\n    # Verify user is a member\n    membership = ClubMembership.query.filter_by(club_id=club_id, user_id=user.id).first()\n    if not membership:\n        return jsonify({'error': 'Not authorized'}), 403\n\n    data = request.get_json()\n\n    name = sanitize_string(data.get('name', ''), max_length=200)\n    description = sanitize_string(data.get('description', ''), max_length=2000)\n    url = sanitize_string(data.get('url', ''), max_length=500)\n    github_url = sanitize_string(data.get('github_url', ''), max_length=500)\n\n    if not name or not url:\n        return jsonify({'error': 'Name and URL are required'}), 400\n\n    # Create project submission\n    project = ProjectSubmission(\n        name=name,\n        description=description,\n        url=url,\n        github_url=github_url,\n        club_id=club_id,\n        user_id=user.id\n    )\n    db.session.add(project)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='project_submission',\n        description=f'User {user.username} submitted project \"{name}\" for club {club.name}',\n        user=user,\n        target_type='project',\n        target_id=project.id,\n        category='club'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Project submitted for review',\n        'project_id': project.id\n    })\n","size_bytes":15699},"app/routes/main.py":{"content":"\"\"\"\nMain routes blueprint for the Hack Club Dashboard.\nHandles home page, dashboard, gallery, leaderboard, and general pages.\n\"\"\"\n\nfrom flask import Blueprint, render_template, redirect, url_for, request, flash, jsonify\nfrom app.decorators.auth import login_required\nfrom app.utils.auth_helpers import get_current_user\nfrom app.models.user import User\nfrom app.models.club import Club\nfrom app.models.gallery import GalleryPost\nfrom app.models.economy import LeaderboardExclusion\nfrom app.models.system import SystemSettings\nfrom extensions import db\n\nmain_bp = Blueprint('main', __name__)\n\n\n@main_bp.route('/')\ndef index():\n    \"\"\"Home page\"\"\"\n    user = get_current_user()\n    if user:\n        return redirect(url_for('main.dashboard'))\n    return render_template('index.html')\n\n\n@main_bp.route('/dashboard')\n@login_required\ndef dashboard():\n    \"\"\"User dashboard\"\"\"\n    user = get_current_user()\n\n    # Get user's club memberships and led clubs\n    from app.models.club import ClubMembership\n    memberships = ClubMembership.query.filter_by(user_id=user.id).all()\n    led_clubs = Club.query.filter_by(leader_id=user.id).all()\n\n    # If user only has one club, redirect directly to it\n    all_club_ids = set([club.id for club in led_clubs] + [m.club.id for m in memberships])\n    if len(all_club_ids) == 1:\n        club_id = list(all_club_ids)[0]\n        return redirect(url_for('main.club_dashboard', club_id=club_id))\n\n    return render_template('dashboard.html', memberships=memberships, led_clubs=led_clubs)\n\n\n@main_bp.route('/club-dashboard')\n@main_bp.route('/club-dashboard/<int:club_id>')\n@login_required\ndef club_dashboard(club_id=None):\n    \"\"\"Club dashboard\"\"\"\n    user = get_current_user()\n\n    if club_id:\n        club = Club.query.get_or_404(club_id)\n    else:\n        # Get user's first club\n        club = Club.query.filter_by(leader_id=user.id).first()\n        if not club:\n            from app.models.club import ClubMembership\n            membership = ClubMembership.query.filter_by(user_id=user.id).first()\n            if membership:\n                club = membership.club\n\n        if not club:\n            flash('You are not a member of any club', 'error')\n            return redirect(url_for('main.dashboard'))\n\n    # Verify user has access to this club\n    from app.models.club import ClubMembership\n    is_leader = club.leader_id == user.id\n    is_co_leader = club.co_leader_id == user.id\n    membership = ClubMembership.query.filter_by(club_id=club.id, user_id=user.id).first()\n    is_member = membership is not None\n    is_admin_access = request.args.get('admin') == 'true' and user.is_admin\n\n    if not is_leader and not is_co_leader and not is_member and not is_admin_access:\n        flash('You are not a member of this club', 'error')\n        return redirect(url_for('main.dashboard'))\n\n    # Check if club is suspended\n    if club.is_suspended and not user.is_admin:\n        flash('This club has been suspended', 'error')\n        return redirect(url_for('main.dashboard'))\n\n    # Check if club has orders\n    from app.services.airtable import AirtableService\n    try:\n        airtable_service = AirtableService()\n        orders = airtable_service.get_orders_for_club(club.name)\n        has_orders = len(orders) > 0\n    except:\n        has_orders = False\n\n    # Check if club has gallery post\n    has_gallery_post = GalleryPost.query.filter_by(club_id=club.id).first() is not None\n\n    # Check if connected to directory\n    airtable_data = club.get_airtable_data()\n    is_connected_to_directory = airtable_data and airtable_data.get('airtable_id')\n\n    # Get banner settings\n    banner_settings = {\n        'enabled': SystemSettings.get_setting('banner_enabled', 'false') == 'true',\n        'title': SystemSettings.get_setting('banner_title', 'Design Contest'),\n        'subtitle': SystemSettings.get_setting('banner_subtitle', 'Submit your creative projects!'),\n        'icon': SystemSettings.get_setting('banner_icon', 'fas fa-palette'),\n        'primary_color': SystemSettings.get_setting('banner_primary_color', '#ec3750'),\n        'secondary_color': SystemSettings.get_setting('banner_secondary_color', '#d63146'),\n        'background_color': SystemSettings.get_setting('banner_background_color', '#ffffff'),\n        'text_color': SystemSettings.get_setting('banner_text_color', '#1a202c'),\n        'link_url': SystemSettings.get_setting('banner_link_url', '/gallery'),\n        'link_text': SystemSettings.get_setting('banner_link_text', 'Submit Entry')\n    }\n\n    # Get membership date\n    membership_date = membership.joined_at if membership else None\n\n    # Role variables for template\n    effective_is_leader = is_leader or is_admin_access\n    effective_is_co_leader = is_co_leader or is_admin_access\n    effective_can_manage = is_leader or is_co_leader or is_admin_access\n\n    # Check for mobile\n    user_agent = request.headers.get('User-Agent', '').lower()\n    is_mobile = any(mobile in user_agent for mobile in ['mobile', 'android', 'iphone', 'ipad'])\n    force_mobile = request.args.get('mobile', '').lower() == 'true'\n    force_desktop = request.args.get('desktop', '').lower() == 'true'\n\n    if (is_mobile or force_mobile) and not force_desktop:\n        return render_template('club_dashboard_mobile.html',\n                             club=club,\n                             membership_date=membership_date,\n                             has_orders=has_orders,\n                             has_gallery_post=has_gallery_post,\n                             is_leader=is_leader,\n                             is_co_leader=is_co_leader,\n                             is_admin_access=is_admin_access,\n                             effective_is_leader=effective_is_leader,\n                             effective_is_co_leader=effective_is_co_leader,\n                             effective_can_manage=effective_can_manage,\n                             banner_settings=banner_settings,\n                             is_connected_to_directory=is_connected_to_directory)\n\n    return render_template('club_dashboard.html',\n                         club=club,\n                         membership_date=membership_date,\n                         has_orders=has_orders,\n                         has_gallery_post=has_gallery_post,\n                         is_leader=is_leader,\n                         is_co_leader=is_co_leader,\n                         is_admin_access=is_admin_access,\n                         effective_is_leader=effective_is_leader,\n                         effective_is_co_leader=effective_is_co_leader,\n                         effective_can_manage=effective_can_manage,\n                         banner_settings=banner_settings,\n                         is_connected_to_directory=is_connected_to_directory)\n\n\n@main_bp.route('/gallery')\ndef gallery():\n    \"\"\"Public gallery of club posts\"\"\"\n    # Get all gallery posts ordered by date (featured first, then by date)\n    posts = GalleryPost.query.order_by(\n        GalleryPost.featured.desc(),\n        GalleryPost.created_at.desc()\n    ).limit(50).all()\n\n    return render_template('gallery.html', posts=posts)\n\n\n@main_bp.route('/leaderboard')\n@main_bp.route('/leaderboard/<leaderboard_type>')\ndef leaderboard(leaderboard_type='total_tokens'):\n    \"\"\"Club leaderboard\"\"\"\n    # Get excluded clubs for this leaderboard type\n    excluded_club_ids = [\n        exc.club_id for exc in LeaderboardExclusion.query.filter_by(\n            leaderboard_type=leaderboard_type\n        ).all()\n    ]\n\n    # Query clubs based on leaderboard type\n    if leaderboard_type == 'total_tokens':\n        clubs = Club.query.filter(\n            ~Club.id.in_(excluded_club_ids)\n        ).order_by(Club.tokens.desc()).limit(100).all()\n        title = \"Top Clubs by Total Tokens\"\n    elif leaderboard_type == 'monthly_tokens':\n        # For now, use total tokens (TODO: track monthly separately)\n        clubs = Club.query.filter(\n            ~Club.id.in_(excluded_club_ids)\n        ).order_by(Club.tokens.desc()).limit(100).all()\n        title = \"Top Clubs by Monthly Tokens\"\n    else:\n        clubs = []\n        title = \"Leaderboard\"\n\n    # Add rank to each club\n    for i, club in enumerate(clubs, 1):\n        club.rank = i\n\n    return render_template('leaderboard.html',\n                         clubs=clubs,\n                         title=title,\n                         leaderboard_type=leaderboard_type)\n\n\n@main_bp.route('/join-club')\ndef join_club_redirect():\n    \"\"\"Redirect to club joining flow\"\"\"\n    return redirect('https://clubs.hackclub.com')\n\n\n@main_bp.route('/maintenance')\ndef maintenance():\n    \"\"\"Maintenance mode page\"\"\"\n    return render_template('maintenance.html'), 503\n\n\n@main_bp.route('/suspended')\ndef suspended():\n    \"\"\"Account suspended page\"\"\"\n    return render_template('suspended.html'), 403\n\n\n@main_bp.route('/account')\n@login_required\ndef account():\n    \"\"\"User account settings\"\"\"\n    user = get_current_user()\n    return render_template('account.html', user=user)\n","size_bytes":8966},"app/utils/economy_helpers.py":{"content":"\"\"\"\nEconomy helper utilities for the Hack Club Dashboard.\nContains functions for managing club transactions, quests, and token systems.\n\"\"\"\n\nfrom datetime import datetime, timedelta\nfrom flask import current_app\nfrom extensions import db\nfrom app.models.club import Club\nfrom app.models.economy import ClubTransaction, WeeklyQuest, ClubQuestProgress\n\n\ndef create_club_transaction(club_id, transaction_type, amount, description,\n                            user_id=None, reference_id=None, reference_type=None,\n                            created_by=None):\n    \"\"\"\n    Create a new club transaction and update the club balance.\n\n    Args:\n        club_id: ID of the club\n        transaction_type: Type of transaction ('credit', 'debit', 'grant', etc.)\n        amount: Amount in tokens (positive for credits, negative for debits)\n        description: Description of the transaction\n        user_id: Optional ID of the user who triggered the transaction\n        reference_id: Optional reference to related record\n        reference_type: Optional type of reference ('project', 'shop_order', etc.)\n        created_by: Optional ID of admin who created the transaction\n\n    Returns:\n        Tuple of (success: bool, result: ClubTransaction or error message)\n    \"\"\"\n    try:\n        # Use SELECT FOR UPDATE to lock the club record and prevent race conditions\n        club = Club.query.filter_by(id=club_id).with_for_update().first()\n        if not club:\n            return False, \"Club not found\"\n\n        # For debit transactions, check if sufficient balance exists\n        if amount < 0 and club.tokens + amount < 0:\n            return False, f\"Insufficient balance. Current: {club.tokens} tokens, Required: {abs(amount)} tokens\"\n\n        # Update club balance atomically\n        club.tokens += amount\n        # Keep balance field in sync (convert tokens to USD)\n        club.balance = club.tokens / 100.0\n\n        # Create transaction record\n        transaction = ClubTransaction(\n            club_id=club_id,\n            user_id=user_id,\n            transaction_type=transaction_type,\n            amount=amount,\n            description=description,\n            balance_after=club.tokens,\n            reference_id=reference_id,\n            reference_type=reference_type,\n            created_by=created_by\n        )\n\n        db.session.add(transaction)\n        db.session.commit()\n\n        return True, transaction\n    except Exception as e:\n        db.session.rollback()\n        return False, str(e)\n\n\ndef get_current_week_start():\n    \"\"\"\n    Get the start of the current week (Monday).\n\n    Returns:\n        datetime.date: The date of the current week's Monday\n    \"\"\"\n    today = datetime.now().date()\n    days_since_monday = today.weekday()\n    week_start = today - timedelta(days=days_since_monday)\n    return week_start\n\n\ndef update_quest_progress(club_id, quest_type, increment=1):\n    \"\"\"\n    Update quest progress for a club and automatically award tokens on completion.\n\n    Args:\n        club_id: ID of the club\n        quest_type: Type of quest ('gallery_post', 'member_projects', etc.)\n        increment: Amount to increment progress by (default: 1)\n\n    Returns:\n        Tuple of (success: bool, message: str)\n    \"\"\"\n    try:\n        week_start = get_current_week_start()\n\n        # Find the quest by type\n        quest = WeeklyQuest.query.filter_by(quest_type=quest_type, is_active=True).first()\n        if not quest:\n            return False, \"Quest not found\"\n\n        # Set target based on quest type\n        target = 1 if quest_type == 'gallery_post' else 5\n\n        # Get or create quest progress record\n        progress_record = ClubQuestProgress.query.filter_by(\n            club_id=club_id,\n            quest_id=quest.id,\n            week_start=week_start\n        ).first()\n\n        if not progress_record:\n            progress_record = ClubQuestProgress(\n                club_id=club_id,\n                quest_id=quest.id,\n                week_start=week_start,\n                progress=0,\n                target=target,\n                completed=False,\n                reward_claimed=False\n            )\n            db.session.add(progress_record)\n\n        # Update progress\n        progress_record.progress += increment\n        progress_record.updated_at = datetime.utcnow()\n\n        # Check if quest is completed\n        if progress_record.progress >= target and not progress_record.completed:\n            progress_record.completed = True\n            progress_record.completed_at = datetime.utcnow()\n\n            # Get club with lock to check piggy bank balance\n            club = Club.query.filter_by(id=club_id).with_for_update().first()\n            if not club:\n                current_app.logger.error(f\"Club {club_id} not found when completing quest\")\n                return False, \"Club not found\"\n\n            # Check if piggy bank has enough tokens\n            if club.piggy_bank_tokens >= quest.reward_tokens:\n                # Transfer tokens from piggy bank to regular balance\n                club.piggy_bank_tokens -= quest.reward_tokens\n\n                # Award tokens to regular balance\n                success, transaction = create_club_transaction(\n                    club_id=club_id,\n                    transaction_type='credit',\n                    amount=quest.reward_tokens,\n                    description=f'Weekly quest reward: {quest.name} (transferred from piggy bank)',\n                    reference_type='weekly_quest',\n                    reference_id=str(quest.id),\n                    created_by=None\n                )\n\n                if success:\n                    # Create piggy bank debit transaction record\n                    try:\n                        piggy_success, piggy_transaction = create_club_transaction(\n                            club_id=club_id,\n                            transaction_type='piggy_bank_debit',\n                            amount=-quest.reward_tokens,\n                            description=f'Piggy bank deduction for quest reward: {quest.name}',\n                            reference_type='weekly_quest',\n                            reference_id=str(quest.id),\n                            created_by=None\n                        )\n                        if piggy_success:\n                            progress_record.reward_claimed = True\n                            current_app.logger.info(\n                                f\"Club {club_id} completed quest {quest.name} and received \"\n                                f\"{quest.reward_tokens} tokens from piggy bank \"\n                                f\"(remaining piggy bank: {club.piggy_bank_tokens})\"\n                            )\n                        else:\n                            current_app.logger.error(\n                                f\"Failed to record piggy bank debit transaction: {piggy_transaction}\"\n                            )\n                            # Still mark as claimed since the main transaction succeeded\n                            progress_record.reward_claimed = True\n                    except Exception as piggy_error:\n                        current_app.logger.error(f\"Error recording piggy bank transaction: {str(piggy_error)}\")\n                        # Still mark as claimed since the main transaction succeeded\n                        progress_record.reward_claimed = True\n                else:\n                    # Restore piggy bank tokens if main transaction failed\n                    club.piggy_bank_tokens += quest.reward_tokens\n                    current_app.logger.error(f\"Failed to award quest tokens: {transaction}\")\n            else:\n                # Not enough tokens in piggy bank - don't award anything\n                current_app.logger.warning(\n                    f\"Club {club_id} completed quest {quest.name} but piggy bank has \"\n                    f\"insufficient tokens ({club.piggy_bank_tokens} < {quest.reward_tokens}). \"\n                    f\"No reward given.\"\n                )\n                # Still mark as completed but not rewarded\n                progress_record.reward_claimed = False\n\n        db.session.commit()\n        return True, \"Quest progress updated\"\n\n    except Exception as e:\n        db.session.rollback()\n        current_app.logger.error(f\"Error updating quest progress: {str(e)}\")\n        return False, str(e)\n","size_bytes":8342},"app/models/club_content.py":{"content":"\"\"\"\nClub content models for posts, assignments, meetings, resources, and projects.\n\"\"\"\nfrom datetime import datetime, timezone\nfrom extensions import db\n\n\nclass ClubPost(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    content = db.Column(db.Text, nullable=False)  # Stores markdown content\n    content_html = db.Column(db.Text)  # Stores rendered HTML content\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    club = db.relationship('Club', backref='posts')\n    user = db.relationship('User', backref='posts')\n\n\nclass ClubAssignment(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    title = db.Column(db.String(200), nullable=False)\n    description = db.Column(db.Text, nullable=False)\n    due_date = db.Column(db.DateTime)\n    for_all_members = db.Column(db.Boolean, default=True)\n    status = db.Column(db.String(20), default='active')\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    club = db.relationship('Club', backref='assignments')\n\n\nclass ClubMeeting(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    title = db.Column(db.String(200), nullable=False)\n    description = db.Column(db.Text)\n    meeting_date = db.Column(db.Date, nullable=False)\n    start_time = db.Column(db.String(10), nullable=False)\n    end_time = db.Column(db.String(10))\n    location = db.Column(db.String(255))\n    meeting_link = db.Column(db.String(500))\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    club = db.relationship('Club', backref='meetings')\n\n\nclass ClubResource(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    title = db.Column(db.String(200), nullable=False)\n    url = db.Column(db.String(500), nullable=False)\n    description = db.Column(db.Text)\n    icon = db.Column(db.String(50), default='book')\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    club = db.relationship('Club', backref='resources')\n\n\nclass ClubProject(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    name = db.Column(db.String(200), nullable=False)\n    description = db.Column(db.Text)\n    url = db.Column(db.String(500))\n    github_url = db.Column(db.String(500))\n    featured = db.Column(db.Boolean, default=False)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    club = db.relationship('Club', backref='projects')\n    user = db.relationship('User', backref='projects')\n","size_bytes":3142},"README.md":{"content":"# Hack Club Dashboard\n\nA comprehensive, modularized dashboard system for Hack Club leaders to manage their clubs, track attendance, manage projects, and engage with their community.\n\n##  Fully Modularized Architecture\n\nThis application has been completely refactored from a monolithic 16,000+ line file into a clean, maintainable, modular structure with proper separation of concerns.\n\n##  Features\n\n- **Club Management**: Create and manage your Hack Club\n- **Attendance Tracking**: Track member attendance and generate reports\n- **Project Gallery**: Showcase club projects and achievements\n- **Blog System**: Share updates, announcements, and stories\n- **Shop System**: Order supplies and materials for your club\n- **Token Economy**: Reward members with tokens for participation\n- **Chat System**: Club messaging and communication\n- **Admin Panel**: Comprehensive administration and moderation tools\n- **OAuth Server**: Third-party application integration\n- **Status Page**: Monitor system health and incidents\n\n##  Project Structure\n\n```\n app/\n    __init__.py           # Application factory\n    decorators/           # Auth, permissions, rate limiting\n    models/               # Database models (13 files)\n    routes/               # Route blueprints (10 blueprints)\n    services/             # External API integrations\n    utils/                # Helper functions\n config.py                # Configuration management\n extensions.py            # Flask extensions\n main.py                  # Application entry point\n requirements.txt         # Python dependencies\n```\n\n##  Quick Start\n\n### Install & Run\n\n```bash\n# Install dependencies\npip install -r requirements.txt\n\n# Set environment variables in .env file (see Configuration section)\n\n# Initialize database\npython init_db.py\n\n# Run application\npython main.py\n```\n\n##  Configuration\n\nCreate a `.env` file:\n\n```env\nDATABASE_URL=postgresql://user:password@localhost/hackclub_dashboard\nSECRET_KEY=your-secret-key-here\nSLACK_CLIENT_ID=your-slack-client-id\nSLACK_CLIENT_SECRET=your-slack-client-secret\nHC_IDENTITY_CLIENT_ID=your-hc-identity-client-id\nHC_IDENTITY_CLIENT_SECRET=your-hc-identity-client-secret\nPORT=5000\n```\n\n##  Learn More\n\n- **Architecture**: Application factory pattern with 10 blueprints\n- **Security**: CSRF, XSS, SQL injection protection, rate limiting\n- **Database**: PostgreSQL with SQLAlchemy ORM\n- **Auth**: Slack OAuth, Hack Club Identity OAuth, session-based\n\n---\n\n**Built with  for the Hack Club community**\n","size_bytes":2633},"app/utils/__init__.py":{"content":"\"\"\"\nUtility functions for the Hack Club Dashboard.\n\"\"\"\n\nfrom app.utils.formatting import *\nfrom app.utils.sanitization import *\nfrom app.utils.security import *\nfrom app.utils.auth_helpers import *\nfrom app.utils.club_helpers import *\nfrom app.utils.economy_helpers import *\n\n__all__ = [\n    # Formatting\n    'format_date', 'format_datetime', 'format_currency',\n    # Sanitization\n    'sanitize_string', 'sanitize_css_value', 'sanitize_css_color',\n    'sanitize_html_attribute', 'sanitize_url', 'markdown_to_html',\n    # Security\n    'get_real_ip', 'log_security_event', 'add_security_headers',\n    'validate_security_input', 'check_profanity', 'check_content_safety',\n    # Auth helpers\n    'get_current_user', 'is_authenticated', 'login_user', 'logout_user',\n    # Club helpers\n    'get_user_club', 'check_club_permission',\n    # Economy helpers\n    'process_transaction', 'check_quest_completion', 'award_quest_tokens',\n]\n","size_bytes":925},"init_db.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nDatabase initialization script for Hack Club Dashboard\n\"\"\"\n\nimport os\nimport sys\nfrom datetime import datetime, timezone\n\n# Add the current directory to the Python path if running from Docker\nif os.path.exists('/app'):\n    sys.path.insert(0, '/app')\n\nfrom app import create_app\nfrom extensions import db\nfrom app.models.user import User\nfrom werkzeug.security import generate_password_hash\n\ndef init_database():\n    \"\"\"Initialize the database with tables and test data\"\"\"\n    print(\" Initializing database...\")\n    \n    app = create_app()\n    with app.app_context():\n        try:\n            # Create all tables\n            db.create_all()\n            print(\" Database tables created successfully\")\n            \n            # Check if admin user exists\n            admin_user = User.query.filter_by(email='admin@hackclub.local').first()\n            if not admin_user:\n                # Create admin user\n                admin_user = User(\n                    username='admin',\n                    email='admin@hackclub.local',\n                    first_name='Admin',\n                    last_name='User',\n                    is_admin=True,\n                    created_at=datetime.now(timezone.utc),\n                    registration_ip='127.0.0.1'\n                )\n                admin_user.set_password('AdminPass123!')\n                admin_user.add_ip('127.0.0.1')\n                db.session.add(admin_user)\n                \n                # Create test user\n                test_user = User(\n                    username='testuser',\n                    email='test@hackclub.local',\n                    first_name='Test',\n                    last_name='User',\n                    is_admin=False,\n                    created_at=datetime.now(timezone.utc),\n                    registration_ip='127.0.0.1'\n                )\n                test_user.set_password('TestPass123!')\n                test_user.add_ip('127.0.0.1')\n                db.session.add(test_user)\n                \n                db.session.commit()\n                print(\" Test users created:\")\n                print(\"   Admin: admin@hackclub.local / AdminPass123!\")\n                print(\"   User:  test@hackclub.local / TestPass123!\")\n            else:\n                print(\"  Database already initialized\")\n                \n        except Exception as e:\n            print(f\" Error initializing database: {str(e)}\")\n            sys.exit(1)\n\nif __name__ == '__main__':\n    init_database()\n","size_bytes":2511},"app/__init__.py":{"content":"\"\"\"\nHack Club Dashboard Application Factory\n\nThis module provides the application factory pattern for creating and configuring\nthe Flask application with all necessary extensions, blueprints, and configurations.\n\"\"\"\n\nimport logging\nfrom flask import Flask\nfrom config import Config\nfrom extensions import db, limiter\nfrom better_profanity import profanity\n\n\ndef create_app(config_class=Config):\n    \"\"\"\n    Application factory function.\n\n    Args:\n        config_class: Configuration class to use (defaults to Config from config.py)\n\n    Returns:\n        Configured Flask application instance\n    \"\"\"\n    # Create Flask app\n    app = Flask(__name__, template_folder='../templates', static_folder='../static')\n\n    # Load configuration\n    app.config.from_object(config_class)\n\n    # Configure logging\n    logging.basicConfig(\n        level=logging.INFO,\n        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n    )\n\n    # Initialize profanity filter\n    profanity.load_censor_words()\n\n    # Initialize extensions\n    db.init_app(app)\n    limiter.init_app(app)\n\n    # Import models (ensures they're registered with SQLAlchemy)\n    with app.app_context():\n        from app import models\n\n    # Register blueprints\n    register_blueprints(app)\n\n    # Register error handlers\n    register_error_handlers(app)\n\n    # Register template filters and context processors\n    register_template_helpers(app)\n\n    # Register middleware\n    register_middleware(app)\n\n    # Initialize services\n    initialize_services(app)\n\n    return app\n\n\ndef register_blueprints(app):\n    \"\"\"Register all Flask blueprints for routes\"\"\"\n    # Import all blueprints\n    from app.routes.main import main_bp\n    from app.routes.auth import auth_bp\n    from app.routes.clubs import clubs_bp\n    from app.routes.admin import admin_bp\n    from app.routes.api import api_bp\n    from app.routes.chat import chat_bp\n    from app.routes.attendance import attendance_bp\n    from app.routes.status import status_bp\n    from app.routes.oauth import oauth_bp\n\n    # Register all blueprints\n    # Note: URL prefixes are defined in the blueprint constructors where applicable\n    app.register_blueprint(main_bp)\n    app.register_blueprint(auth_bp)\n    app.register_blueprint(clubs_bp)\n    app.register_blueprint(admin_bp)      # Prefix: /admin\n    app.register_blueprint(api_bp)        # Prefix: /api\n    app.register_blueprint(chat_bp)       # Routes: /api/club/<id>/chat/*\n    app.register_blueprint(attendance_bp) # Routes: /api/clubs/<id>/attendance/*\n    app.register_blueprint(status_bp)     # Routes: /status, /admin/status/*\n    app.register_blueprint(oauth_bp)      # Prefix: /oauth\n\n\ndef register_error_handlers(app):\n    \"\"\"Register error handlers for common HTTP errors\"\"\"\n    from flask import render_template, jsonify, request\n\n    @app.errorhandler(400)\n    def bad_request(e):\n        if request.path.startswith('/api/'):\n            return jsonify({'error': 'Bad request', 'message': str(e)}), 400\n        try:\n            return render_template('error.html', error_code=400, error_message='Bad Request'), 400\n        except:\n            return '<h1>400 Bad Request</h1>', 400\n\n    @app.errorhandler(403)\n    def forbidden(e):\n        if request.path.startswith('/api/'):\n            return jsonify({'error': 'Forbidden', 'message': 'You do not have permission to access this resource'}), 403\n        try:\n            return render_template('error.html', error_code=403, error_message='Forbidden'), 403\n        except:\n            return '<h1>403 Forbidden</h1>', 403\n\n    @app.errorhandler(404)\n    def not_found(e):\n        if request.path.startswith('/api/'):\n            return jsonify({'error': 'Not found', 'message': 'The requested resource was not found'}), 404\n        try:\n            return render_template('error.html', error_code=404, error_message='Page Not Found'), 404\n        except:\n            return '<h1>404 Page Not Found</h1>', 404\n\n    @app.errorhandler(429)\n    def ratelimit_handler(e):\n        if request.path.startswith('/api/'):\n            return jsonify({'error': 'Too many requests', 'message': 'Rate limit exceeded'}), 429\n        try:\n            return render_template('error.html', error_code=429, error_message='Too Many Requests'), 429\n        except:\n            return '<h1>429 Too Many Requests</h1>', 429\n\n    @app.errorhandler(500)\n    def internal_error(e):\n        app.logger.error(f'Internal server error: {str(e)}')\n        if request.path.startswith('/api/'):\n            return jsonify({'error': 'Internal server error', 'message': 'An unexpected error occurred'}), 500\n        try:\n            return render_template('error.html', error_code=500, error_message='Internal Server Error'), 500\n        except:\n            return '<h1>500 Internal Server Error</h1>', 500\n\n\ndef register_template_helpers(app):\n    \"\"\"Register Jinja2 template filters and context processors\"\"\"\n    from app.utils.sanitization import (\n        markdown_to_html,\n        sanitize_css_color,\n        sanitize_css_value,\n        sanitize_html_attribute,\n        sanitize_url\n    )\n    from app.utils.auth_helpers import get_current_user\n    from app.models.system import SystemSettings\n\n    # Register custom Jinja2 filters\n    app.jinja_env.filters['safe_css_color'] = sanitize_css_color\n    app.jinja_env.filters['safe_css_value'] = sanitize_css_value\n    app.jinja_env.filters['safe_html_attr'] = sanitize_html_attribute\n    app.jinja_env.filters['safe_url'] = sanitize_url\n    app.jinja_env.filters['markdown'] = markdown_to_html\n\n    # Context processor for current user\n    @app.context_processor\n    def inject_user():\n        return dict(current_user=get_current_user())\n\n    # Context processor for system settings\n    @app.context_processor\n    def inject_system_settings():\n        \"\"\"Inject system settings helpers into templates\"\"\"\n        return dict(\n            is_maintenance_mode=SystemSettings.is_maintenance_mode(),\n            is_economy_enabled=SystemSettings.is_economy_enabled(),\n            is_mobile_enabled=SystemSettings.is_mobile_enabled(),\n            economy_enabled=SystemSettings.is_economy_enabled()  # Legacy compatibility\n        )\n    \n    # Context processor for cosmetics functions\n    @app.context_processor\n    def inject_cosmetics_functions():\n        \"\"\"Inject cosmetics helper functions for templates\"\"\"\n        import html\n        from app.utils.sanitization import sanitize_html_attribute\n        from app.models.club import MemberCosmetic\n        from app.models.user import User\n        \n        def get_member_cosmetics(club_id, user_id):\n            \"\"\"Get cosmetic effects for a club member\"\"\"\n            cosmetic = MemberCosmetic.query.filter_by(\n                club_id=club_id,\n                user_id=user_id\n            ).first()\n            return cosmetic.cosmetic_type if cosmetic else None\n        \n        def get_cosmetic_css_class(effects):\n            \"\"\"Convert cosmetic effects to CSS class\"\"\"\n            if not effects:\n                return ''\n            # Map effects to CSS classes\n            effect_classes = {\n                'rainbow': 'rainbow-text',\n                'glow': 'glow-text',\n                'sparkle': 'sparkle-text',\n                'fire': 'fire-text'\n            }\n            return effect_classes.get(effects, '')\n        \n        def apply_member_cosmetics(club_id, user_id, username):\n            \"\"\"Apply cosmetic effects to a member's username\"\"\"\n            user = User.query.get(user_id)\n            escaped_username = html.escape(username) if username else ''\n            result = escaped_username\n            \n            # Check if user is admin and add lightning bolt\n            if user and user.is_admin:\n                result = f'{escaped_username} <i class=\"fas fa-bolt\" style=\"color: #fbbf24; margin-left: 4px;\" title=\"Admin\"></i>'\n            \n            # Apply cosmetic effects\n            effects = get_member_cosmetics(club_id, user_id)\n            if effects:\n                css_class = get_cosmetic_css_class(effects)\n                if css_class:\n                    safe_css_class = sanitize_html_attribute(css_class)\n                    result = f'<span class=\"{safe_css_class}\">{result}</span>'\n            \n            return result\n        \n        return dict(\n            get_member_cosmetics=get_member_cosmetics,\n            get_cosmetic_css_class=get_cosmetic_css_class,\n            apply_member_cosmetics=apply_member_cosmetics\n        )\n    \n    # Override url_for to provide backward compatibility for templates\n    from flask import url_for as flask_url_for\n    \n    @app.context_processor\n    def override_url_for():\n        \"\"\"Provide backward compatibility for old endpoint names\"\"\"\n        def url_for_compat(endpoint, **values):\n            # Map old endpoint names to new blueprint names\n            endpoint_map = {\n                # Main routes\n                'index': 'main.index',\n                'dashboard': 'main.dashboard',\n                'gallery': 'main.gallery',\n                'leaderboard': 'main.leaderboard',\n                'maintenance': 'main.maintenance',\n                'account': 'main.account',\n                'contact': 'main.contact',\n                # Auth routes\n                'login': 'auth.login',\n                'logout': 'auth.logout',\n                'signup': 'auth.signup',\n                'forgot_password': 'auth.forgot_password',\n                'reset_password': 'auth.reset_password',\n                'verify_email': 'auth.verify_email',\n                'verify_reset_code': 'auth.verify_reset_code',\n                'slack_login': 'auth.slack_login',\n                'auth_slack': 'auth.slack_login',\n                'auth_slack_callback': 'auth.slack_callback',\n                'complete_slack_signup': 'auth.complete_slack_signup',\n                'verify_leader': 'auth.verify_leader',\n                # Club routes\n                'club_dashboard': 'main.club_dashboard',\n                'club_shop': 'clubs.club_shop',\n                'club_orders': 'clubs.club_orders',\n                'poster_editor': 'clubs.poster_editor',\n                'project_submission': 'clubs.project_submission',\n                'setup_hackatime': 'clubs.setup_hackatime',\n                # Blog routes\n                'blog': 'blog.blog_index',\n                'blog_list': 'blog.blog_index',\n                'blog_post': 'blog.blog_post',\n                'blog_detail': 'blog.blog_post',\n                'blog_create': 'blog.blog_create',\n                'blog_edit': 'blog.blog_edit',\n                'blog_delete': 'blog.blog_delete',\n                # Admin routes\n                'admin': 'admin.dashboard',\n                'admin_dashboard': 'admin.dashboard',\n                'admin_users': 'admin.admin_users',\n                'admin_clubs': 'admin.admin_clubs',\n                'admin_settings': 'admin.admin_settings',\n            }\n            \n            # If endpoint is in map, use the new name, otherwise keep as-is\n            endpoint = endpoint_map.get(endpoint, endpoint)\n            \n            return flask_url_for(endpoint, **values)\n        \n        return dict(url_for=url_for_compat)\n\n\ndef register_middleware(app):\n    \"\"\"Register middleware and before/after request handlers\"\"\"\n    from flask import request, session\n    from app.models.system import SystemSettings\n    from app.utils.security import add_security_headers, get_real_ip\n\n    @app.before_request\n    def check_maintenance_mode():\n        \"\"\"Check if maintenance mode is enabled and redirect if necessary\"\"\"\n        # Skip for maintenance page itself and static files\n        if request.endpoint in ['main.maintenance', 'static']:\n            return None\n\n        if SystemSettings.is_maintenance_mode():\n            # Allow admins to bypass maintenance mode\n            from app.utils.auth_helpers import get_current_user\n            user = get_current_user()\n            if not user or not user.is_admin:\n                from flask import render_template\n                try:\n                    return render_template('maintenance.html'), 503\n                except:\n                    # Fallback if template doesn't exist\n                    return '<h1>System Maintenance</h1><p>We are currently performing maintenance. Please check back soon.</p>', 503\n\n        return None\n\n    @app.after_request\n    def after_request(response):\n        \"\"\"Add security headers to all responses\"\"\"\n        return add_security_headers(response)\n\n\ndef initialize_services(app):\n    \"\"\"Initialize external service integrations\"\"\"\n    from app.services.airtable import AirtableService\n    from app.services.hackatime import HackatimeService\n    from app.services.identity import HackClubIdentityService\n    from app.services.slack_oauth import SlackOAuthService\n\n    # Initialize services with app context\n    # Services will be accessible via their respective modules\n    with app.app_context():\n        # Services are initialized when imported\n        # Additional initialization can be done here if needed\n        pass\n","size_bytes":13088},"app/utils/security.py":{"content":"\"\"\"\nSecurity utilities for the Hack Club Dashboard.\nContains functions for security validation, profanity checking, and exploit detection.\n\"\"\"\n\nimport re\nimport logging\nfrom flask import request\nfrom better_profanity import profanity\n\n# Try to import profanity_check if available\ntry:\n    import profanity_check\n    PROFANITY_CHECK_AVAILABLE = True\nexcept ImportError:\n    PROFANITY_CHECK_AVAILABLE = False\n\n# Initialize profanity filters\nprofanity.load_censor_words()\n\n\ndef get_real_ip():\n    \"\"\"Get the real client IP address, accounting for proxies and load balancers\"\"\"\n    # Check common proxy headers in order of preference\n    if request.headers.get('CF-Connecting-IP'):\n        return request.headers.get('CF-Connecting-IP')\n    elif request.headers.get('X-Real-IP'):\n        return request.headers.get('X-Real-IP')\n    elif request.headers.get('X-Forwarded-For'):\n        # X-Forwarded-For can contain multiple IPs, get the first one (original client)\n        forwarded_ips = request.headers.get('X-Forwarded-For').split(',')\n        return forwarded_ips[0].strip()\n    elif request.headers.get('X-Forwarded-Proto'):\n        return request.headers.get('X-Client-IP', request.remote_addr)\n    else:\n        return request.remote_addr\n\n\ndef log_security_event(event_type, message, user_id=None, ip_address=None, app=None):\n    \"\"\"Log security-related events for monitoring\"\"\"\n    if not ip_address:\n        ip_address = get_real_ip() if request else 'unknown'\n\n    security_message = f\"SECURITY EVENT - {event_type}: {message} | User ID: {user_id} | IP: {ip_address}\"\n\n    if app:\n        app.logger.warning(security_message)\n    else:\n        logging.warning(security_message)\n\n\ndef check_profanity_comprehensive(text):\n    \"\"\"\n    Less strict profanity detection to avoid false positives with names.\n    Returns True if clear profanity is detected, False otherwise.\n    \"\"\"\n    if not text or not isinstance(text, str):\n        return False\n\n    # Normalize text for better detection\n    normalized_text = text.lower().strip()\n\n    # Common false positive patterns (names, etc.) to exclude\n    false_positive_patterns = [\n        r'\\b(shi|wang|dong|hung|peng|ling|chen|chan|chang|cheng|jung|sung|young|long|wong|tong|kong|song|pong|ding|ming|jing|king|ping|zing|ring|wing|yang|gang|bang|fang|dang|sang|tang|hang|lang|mang|nang|pang|rang|vang|zang)\\b',\n        r'\\b(kumar|singh|shah|khan|ali|hassan|hussain|ahmad|ahmed)\\b',\n        r'\\b(analytic|analytics|arsenal|assassin|bass|class|glass|mass|pass|brass)\\b',\n        r'\\b(scunthorpe|shitake|shiitake|shitzu|shihtzu)\\b'  # Common false positives\n    ]\n\n    # Check if text matches common false positive patterns\n    for pattern in false_positive_patterns:\n        if re.search(pattern, normalized_text, re.IGNORECASE):\n            return False\n\n    # Only use the basic profanity filter, skip aggressive detection methods\n    if profanity.contains_profanity(normalized_text):\n        # Allow mild words like 'screw', 'crap', 'damn', 'hell' in appropriate contexts\n        mild_words = ['screw', 'crap', 'damn', 'hell', 'suck', 'sucks']\n        if normalized_text.strip() in mild_words:\n            return False\n        return True\n\n    # Only check spaced out words if they're clearly intentional profanity\n    # (require at least 3 spaces to avoid false positives)\n    spaced_pattern = re.findall(r'\\b\\w(?:\\s+\\w){3,}\\b', normalized_text)\n    for spaced_word in spaced_pattern:\n        no_spaces = re.sub(r'\\s+', '', spaced_word)\n        if profanity.contains_profanity(no_spaces):\n            return True\n\n    return False\n\n\ndef filter_profanity_comprehensive(text, replacement=\"***\"):\n    \"\"\"\n    Filter profanity with comprehensive evasion detection and replacement.\n    Returns the filtered text or raises ValueError if profanity is detected.\n    \"\"\"\n    if not text or not isinstance(text, str):\n        return text\n\n    if check_profanity_comprehensive(text):\n        raise ValueError(\"Content contains inappropriate language\")\n\n    return text\n\n\ndef validate_username(username):\n    \"\"\"Validate username format\"\"\"\n    if not username:\n        return False, \"Username is required\"\n\n    username = username.strip()\n    if len(username) < 3:\n        return False, \"Username must be at least 3 characters long\"\n    if len(username) > 30:\n        return False, \"Username must be less than 30 characters\"\n\n    # Only allow alphanumeric characters, underscores, and hyphens\n    if not re.match(r'^[a-zA-Z0-9_-]+$', username):\n        return False, \"Username can only contain letters, numbers, underscores, and hyphens\"\n\n    return True, username\n\n\ndef validate_email(email):\n    \"\"\"Validate email format\"\"\"\n    if not email:\n        return False, \"Email is required\"\n\n    email = email.strip().lower()\n    if len(email) > 120:\n        return False, \"Email is too long\"\n\n    # Basic email validation\n    email_regex = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$'\n    if not re.match(email_regex, email):\n        return False, \"Invalid email format\"\n\n    return True, email\n\n\ndef validate_name(name, field_name=\"Name\"):\n    \"\"\"Validate first/last name\"\"\"\n    if not name:\n        return True, \"\"  # Names are optional\n\n    name = name.strip()\n    if len(name) > 50:\n        return False, f\"{field_name} must be less than 50 characters\"\n\n    # Only allow letters, spaces, hyphens, and apostrophes\n    if not re.match(r\"^[a-zA-Z\\s'-]+$\", name):\n        return False, f\"{field_name} can only contain letters, spaces, hyphens, and apostrophes\"\n\n    return True, name\n\n\ndef validate_password(password):\n    \"\"\"Validate password strength\"\"\"\n    if not password:\n        return False, \"Password is required\"\n\n    if len(password) < 8:\n        return False, \"Password must be at least 8 characters long\"\n\n    if len(password) > 128:\n        return False, \"Password must be less than 128 characters\"\n\n    # Check against common weak passwords\n    common_passwords = {\n        'password', 'password123', '12345678', 'qwertyui', 'qwerty123',\n        'admin123', 'welcome123', 'hackclub123', 'password1', '123456789',\n        'letmein123', 'password!', 'Welcome123', 'Password123'\n    }\n\n    if password.lower() in common_passwords:\n        return False, \"Password is too common. Please choose a more secure password.\"\n\n    # Check for at least one uppercase, lowercase, digit, and special character\n    has_upper = any(c.isupper() for c in password)\n    has_lower = any(c.islower() for c in password)\n    has_digit = any(c.isdigit() for c in password)\n    has_special = any(c in \"!@#$%^&*()_+-=[]{}|;:,.<>?\" for c in password)\n\n    if not (has_upper and has_lower and has_digit and has_special):\n        return False, \"Password must contain at least one uppercase letter, lowercase letter, digit, and special character\"\n\n    return True, password\n\n\ndef suspend_user_for_security_violation(user, violation_type, details=\"\", db=None, app=None, create_audit_log=None):\n    \"\"\"Suspend a user for security violations with logging\"\"\"\n    if not user or user.is_admin:\n        return False  # Don't suspend admins\n\n    try:\n        user.is_suspended = True\n        if db:\n            db.session.commit()\n\n        # Log the security violation in audit log\n        if create_audit_log:\n            create_audit_log(\n                action_type='security_violation',\n                description=f\"User suspended for {violation_type}\",\n                user=user,\n                target_type='user',\n                target_id=user.id,\n                details={\n                    'violation_type': violation_type,\n                    'details': details,\n                    'action_taken': 'account_suspended'\n                },\n                severity='critical',\n                category='security'\n            )\n\n        # Also log the security event (existing system)\n        log_security_event(\n            violation_type,\n            f\"User suspended: {details}\",\n            user_id=user.id,\n            ip_address=get_real_ip(),\n            app=app\n        )\n\n        if app:\n            app.logger.warning(f\"SECURITY SUSPENSION - User {user.username} (ID: {user.id}) suspended for {violation_type}: {details}\")\n        return True\n    except Exception as e:\n        if app:\n            app.logger.error(f\"Error suspending user {user.id}: {str(e)}\")\n        return False\n\n\ndef detect_exploit_attempts(text, field_context=\"\"):\n    \"\"\"Detect common exploit and penetration testing attempts with context awareness\"\"\"\n    if not text or not isinstance(text, str):\n        return False, \"\"\n\n    text_lower = text.lower().strip()\n\n    # More lenient patterns for assignment, meeting, and resource content\n    is_content_field = any(keyword in field_context.lower() for keyword in [\"assignment\", \"meeting\", \"resource\", \"club_post\"])\n\n    # SQL Injection patterns\n    sql_patterns = [\n        r\"union\\s+select\", r\"drop\\s+table\", r\"delete\\s+from\", r\"insert\\s+into\",\n        r\"alter\\s+table\", r\"create\\s+table\", r\"exec\\s*\\(\",\n        r\"'.*or.*'\", r\"'.*and.*'\", r\"--\", r\"/\\*.*\\*/\", r\"xp_cmdshell\",\n        r\"sp_executesql\", r\"information_schema\", r\"sysobjects\", r\"syscolumns\"\n    ]\n\n    # Only flag \"update.*set\" if it's not content field\n    if not is_content_field:\n        sql_patterns.append(r\"update\\s+.*set\")\n\n    # XSS patterns\n    xss_patterns = [\n        r\"<script\", r\"javascript:\", r\"vbscript:\", r\"onload=\", r\"onerror=\",\n        r\"onclick=\", r\"onmouseover=\", r\"alert\\s*\\(\", r\"document\\.cookie\",\n        r\"eval\\s*\\(\", r\"fromcharcode\", r\"<iframe\", r\"<object\", r\"<embed\"\n    ]\n\n    # Command injection patterns - more restrictive for content fields\n    if is_content_field:\n        cmd_patterns = [\n            r\";\\s*rm\\s+[^\\s]\", r\";\\s*ls\\s+[^\\s]\", r\";\\s*pwd\\s\", r\";\\s*id\\s\",\n            r\"&&\\s*rm\\s+\", r\"\\|\\s*rm\\s+\", r\">\\s*/dev/null\", r\"2>&1\", r\"/etc/passwd\",\n            r\"/bin/sh\", r\"/bin/bash\", r\"curl\\s+http\", r\"wget\\s+http\", r\"nc\\s+-\"\n        ]\n    else:\n        cmd_patterns = [\n            r\";\\s*rm\\s+\", r\";\\s*cat\\s+\", r\";\\s*ls\\s+\", r\";\\s*pwd\", r\";\\s*id\",\n            r\"&&\\s*rm\\s+\", r\"\\|\\s*rm\\s+\", r\">\\s*/dev/null\", r\"2>&1\", r\"/etc/passwd\",\n            r\"/bin/sh\", r\"/bin/bash\", r\"curl\\s+\", r\"wget\\s+\", r\"nc\\s+-\"\n        ]\n\n    # Path traversal patterns\n    path_patterns = [\n        r\"\\.\\.\\/\", r\"\\.\\.\\\\\", r\"..%2f\", r\"..%5c\", r\"~root\", r\"~admin\",\n        r\"/etc/\", r\"/proc/\", r\"/sys/\", r\"c:\\\\windows\", r\"c:\\\\users\"\n    ]\n\n    # LDAP injection patterns\n    ldap_patterns = [\n        r\"\\(\\|\", r\"\\(&\", r\"\\(!\", r\"\\*\\)\", r\"admin\\)\", r\"user\\)\", r\"password\\)\"\n    ]\n\n    # File inclusion patterns - http/https are legitimate protocols, not file inclusion attacks\n    file_patterns = [\n        r\"php://\", r\"file://\", r\"ftp://\",\n        r\"include\\s*\\(\", r\"require\\s*\\(\", r\"include_once\", r\"require_once\"\n    ]\n\n    all_patterns = {\n        \"SQL Injection\": sql_patterns,\n        \"XSS\": xss_patterns,\n        \"Command Injection\": cmd_patterns,\n        \"Path Traversal\": path_patterns,\n        \"LDAP Injection\": ldap_patterns,\n        \"File Inclusion\": file_patterns\n    }\n\n    for exploit_type, patterns in all_patterns.items():\n        for pattern in patterns:\n            if re.search(pattern, text_lower, re.IGNORECASE):\n                return True, exploit_type\n\n    return False, \"\"\n\n\ndef detect_enumeration_attempts(text, field_context=\"\"):\n    \"\"\"Detect reconnaissance and enumeration attempts with context awareness\"\"\"\n    if not text or not isinstance(text, str):\n        return False, \"\"\n\n    text_lower = text.lower().strip()\n\n    # Be much more lenient for content fields\n    is_content_field = any(keyword in field_context.lower() for keyword in [\"assignment\", \"meeting\", \"resource\", \"club_post\"])\n\n    if is_content_field:\n        # Only flag obvious enumeration patterns in content fields\n        enum_patterns = [\n            r\"information_schema\", r\"sysobjects\", r\"syscolumns\",\n            r\"web\\.config\", r\"\\.htaccess\", r\"wp-config\"\n        ]\n\n        suspicious_files = [\n            r\"passwords?\\.txt\", r\"secrets\\.txt\", r\"\\.env\"\n        ]\n\n        # Much higher threshold for content fields\n        enum_count = sum(1 for pattern in enum_patterns if re.search(pattern, text_lower))\n        file_count = sum(1 for pattern in suspicious_files if re.search(pattern, text_lower))\n\n        if enum_count >= 2 or file_count >= 2:\n            return True, \"Enumeration\"\n    else:\n        # Original strict patterns for other content\n        enum_patterns = [\n            r\"admin\", r\"administrator\", r\"root\", r\"test\", r\"guest\", r\"user\",\n            r\"backup\", r\"temp\", r\"demo\", r\"default\", r\"service\", r\"oracle\",\n            r\"mysql\", r\"postgres\", r\"database\", r\"db\", r\"config\", r\"conf\"\n        ]\n\n        suspicious_files = [\n            r\"web\\.config\", r\"\\.htaccess\", r\"config\\.php\", r\"wp-config\",\n            r\"database\\.yml\", r\"settings\\.py\", r\"\\.env\", r\"secrets\",\n            r\"passwords?\\.txt\", r\"users?\\.txt\", r\"backup\", r\"dump\"\n        ]\n\n        enum_count = sum(1 for pattern in enum_patterns if re.search(pattern, text_lower))\n        file_count = sum(1 for pattern in suspicious_files if re.search(pattern, text_lower))\n\n        if enum_count >= 3 or file_count >= 2:\n            return True, \"Enumeration\"\n\n    return False, \"\"\n\n\ndef validate_input_with_security(text, field_name=\"input\", user=None, max_length=None,\n                                 app=None, create_audit_log=None, sanitize_string=None,\n                                 suspend_user_func=None):\n    \"\"\"Comprehensive input validation with auto-suspension for security violations\"\"\"\n    if not text:\n        return True, text\n\n    try:\n        # Check length before processing to avoid false positives from truncation\n        if max_length and len(text) > max_length:\n            # For content fields, be more lenient and just return an error instead of suspending\n            is_content_field = any(keyword in field_name.lower() for keyword in [\"assignment\", \"meeting\", \"resource\", \"club_post\"])\n            if is_content_field:\n                return False, f\"Content too long (max {max_length} characters)\"\n            # For other fields, also just return error to be consistent\n            return False, f\"Content too long (max {max_length} characters)\"\n\n        # Basic sanitization without truncation since we've already checked length\n        if sanitize_string:\n            sanitized = sanitize_string(text, max_length=None)\n        else:\n            from .sanitization import sanitize_string as _sanitize_string\n            sanitized = _sanitize_string(text, max_length=None)\n\n        # Check for profanity\n        if check_profanity_comprehensive(sanitized):\n            # Log the profanity attempt for monitoring but don't suspend\n            if user and not user.is_admin:\n                if app:\n                    app.logger.warning(f\"PROFANITY DETECTED - User {user.username} (ID: {user.id}) used inappropriate language in {field_name}: {text[:100]}...\")\n                if create_audit_log:\n                    create_audit_log(\n                        action_type='profanity_violation',\n                        description=f\"Inappropriate language detected in {field_name}\",\n                        user=user,\n                        target_type='user',\n                        target_id=user.id,\n                        details={\n                            'field_name': field_name,\n                            'content_preview': text[:100] + \"...\" if len(text) > 100 else text\n                        },\n                        severity='warning',\n                        category='security'\n                    )\n            return False, \"Please remove inappropriate language from your content and try again.\"\n\n        # Check for exploit attempts with field context\n        is_exploit, exploit_type = detect_exploit_attempts(sanitized, field_name)\n        if is_exploit and user and not user.is_admin:\n            if suspend_user_func:\n                suspend_user_func(\n                    user,\n                    f\"Security Exploit - {exploit_type}\",\n                    f\"Detected {exploit_type} attempt in {field_name}: {text[:100]}...\"\n                )\n            return False, \"Account suspended for security violation\"\n\n        # Check for enumeration attempts with field context\n        is_enum, enum_type = detect_enumeration_attempts(sanitized, field_name)\n        if is_enum and user and not user.is_admin:\n            if suspend_user_func:\n                suspend_user_func(\n                    user,\n                    f\"Enumeration Attempt - {enum_type}\",\n                    f\"Detected enumeration in {field_name}: {text[:100]}...\"\n                )\n            return False, \"Account suspended for suspicious activity\"\n\n        return True, sanitized\n\n    except Exception as e:\n        if app:\n            app.logger.error(f\"Error in security validation: {str(e)}\")\n        return False, \"Validation error\"\n\n\ndef add_security_headers(response):\n    \"\"\"Add security headers to HTTP responses\"\"\"\n    # Prevent clickjacking\n    response.headers['X-Frame-Options'] = 'DENY'\n    # Prevent MIME type sniffing\n    response.headers['X-Content-Type-Options'] = 'nosniff'\n    # XSS protection\n    response.headers['X-XSS-Protection'] = '1; mode=block'\n    # Referrer policy\n    response.headers['Referrer-Policy'] = 'strict-origin-when-cross-origin'\n    # Strict Transport Security (HTTPS only)\n    if request.is_secure:\n        response.headers['Strict-Transport-Security'] = 'max-age=31536000; includeSubDomains'\n    # Content Security Policy - more restrictive\n    if not response.headers.get('Content-Security-Policy'):\n        response.headers['Content-Security-Policy'] = (\n            \"default-src 'self'; \"\n            \"script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://server.fillout.com; \"\n            \"style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; \"\n            \"font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com https://r2cdn.perplexity.ai; \"\n            \"img-src 'self' data: https:; \"\n            \"connect-src 'self' https://api.hackclub.com https://ai.hackclub.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; \"\n            \"frame-src 'self' https://forms.hackclub.com https://server.fillout.com; \"\n            \"object-src 'none'; \"\n            \"base-uri 'self'\"\n        )\n    # Permissions Policy (formerly Feature Policy)\n    response.headers['Permissions-Policy'] = 'camera=(), microphone=(), geolocation=()'\n    return response\n","size_bytes":18542},"app/models/system.py":{"content":"\"\"\"\nSystem settings and status management models.\n\"\"\"\nimport json\nfrom datetime import datetime, timezone\nfrom flask import current_app\nfrom extensions import db\n\n\nclass SystemSettings(db.Model):\n    __tablename__ = 'system_settings'\n\n    id = db.Column(db.Integer, primary_key=True)\n    key = db.Column(db.String(255), unique=True, nullable=False)\n    value = db.Column(db.Text, nullable=False)\n    description = db.Column(db.Text)\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), onupdate=lambda: datetime.now(timezone.utc))\n    updated_by = db.Column(db.Integer, db.ForeignKey('user.id'))\n\n    # Relationships\n    updated_by_user = db.relationship('User', backref=db.backref('system_settings_updates', lazy=True))\n\n    @staticmethod\n    def get_setting(key, default=None):\n        \"\"\"Get a system setting value\"\"\"\n        try:\n            setting = SystemSettings.query.filter_by(key=key).first()\n            return setting.value if setting else default\n        except Exception as e:\n            current_app.logger.error(f\"Error getting setting '{key}': {str(e)}\")\n            return default\n\n    @staticmethod\n    def set_setting(key, value, user_id=None):\n        \"\"\"Set a system setting value\"\"\"\n        try:\n            # Import here to avoid circular dependency\n            from app.models.user import User\n\n            setting = SystemSettings.query.filter_by(key=key).first()\n            if setting:\n                setting.value = str(value)\n                if user_id:\n                    # Verify user exists before setting\n                    user_exists = db.session.query(User.query.filter(User.id == user_id).exists()).scalar()\n                    if user_exists:\n                        setting.updated_by = user_id\n            else:\n                # Verify user exists before creating setting\n                valid_user_id = None\n                if user_id:\n                    user_exists = db.session.query(User.query.filter(User.id == user_id).exists()).scalar()\n                    if user_exists:\n                        valid_user_id = user_id\n                setting = SystemSettings(key=key, value=str(value), updated_by=valid_user_id)\n                db.session.add(setting)\n\n            db.session.commit()\n            return True\n        except Exception as e:\n            db.session.rollback()\n            current_app.logger.error(f\"Error setting '{key}': {str(e)}\")\n            return False\n\n    @staticmethod\n    def get_bool_setting(key, default=False):\n        \"\"\"Get a boolean system setting\"\"\"\n        value = SystemSettings.get_setting(key, str(default))\n        return value.lower() in ('true', '1', 'yes', 'on')\n\n    @staticmethod\n    def is_maintenance_mode():\n        \"\"\"Check if maintenance mode is enabled\"\"\"\n        return SystemSettings.get_bool_setting('maintenance_mode', False)\n\n    @staticmethod\n    def is_economy_enabled():\n        \"\"\"Check if economy is enabled\"\"\"\n        return SystemSettings.get_bool_setting('economy_enabled', True)\n\n    @staticmethod\n    def is_admin_economy_override_enabled():\n        \"\"\"Check if admin economy override is enabled\"\"\"\n        return SystemSettings.get_bool_setting('admin_economy_override', False)\n\n    @staticmethod\n    def is_club_creation_enabled():\n        \"\"\"Check if club creation is enabled\"\"\"\n        return SystemSettings.get_bool_setting('club_creation_enabled', True)\n\n    @staticmethod\n    def is_user_registration_enabled():\n        \"\"\"Check if user registration is enabled\"\"\"\n        return SystemSettings.get_bool_setting('user_registration_enabled', True)\n\n    @staticmethod\n    def is_mobile_enabled():\n        \"\"\"Check if mobile dashboard is enabled\"\"\"\n        return SystemSettings.get_bool_setting('mobile_enabled', True)\n\n\nclass StatusIncident(db.Model):\n    __tablename__ = 'status_incident'\n\n    id = db.Column(db.Integer, primary_key=True)\n    title = db.Column(db.String(255), nullable=False)\n    description = db.Column(db.Text, nullable=False)\n    status = db.Column(db.String(50), nullable=False, default='investigating')  # investigating, identified, monitoring, resolved\n    impact = db.Column(db.String(50), nullable=False, default='minor')  # minor, major, critical\n    affected_services = db.Column(db.Text)  # JSON array of affected services\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), nullable=False)\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), onupdate=lambda: datetime.now(timezone.utc))\n    resolved_at = db.Column(db.DateTime)\n    created_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n\n    # Relationships\n    creator = db.relationship('User', foreign_keys=[created_by], backref=db.backref('created_incidents', lazy=True))\n\n    def get_affected_services(self):\n        \"\"\"Get affected services as a list\"\"\"\n        if self.affected_services:\n            try:\n                return json.loads(self.affected_services)\n            except:\n                return []\n        return []\n\n    def set_affected_services(self, services_list):\n        \"\"\"Set affected services from a list\"\"\"\n        self.affected_services = json.dumps(services_list)\n\n    def get_duration(self):\n        \"\"\"Get incident duration in human readable format\"\"\"\n        if self.resolved_at:\n            # Both timestamps should be timezone-aware\n            resolved_at = self.resolved_at\n            if resolved_at.tzinfo is None:\n                resolved_at = resolved_at.replace(tzinfo=timezone.utc)\n            created_at = self.created_at\n            if created_at.tzinfo is None:\n                created_at = created_at.replace(tzinfo=timezone.utc)\n            delta = resolved_at - created_at\n        else:\n            # Handle timezone-aware vs naive datetime comparison\n            created_at = self.created_at\n            if created_at.tzinfo is None:\n                created_at = created_at.replace(tzinfo=timezone.utc)\n            delta = datetime.now(timezone.utc) - created_at\n\n        total_seconds = int(delta.total_seconds())\n        if total_seconds < 0:\n            return \"0s\"  # Handle negative durations\n        elif total_seconds < 60:\n            return f\"{total_seconds}s\"\n        elif total_seconds < 3600:\n            return f\"{total_seconds // 60}m\"\n        elif total_seconds < 86400:\n            hours = total_seconds // 3600\n            minutes = (total_seconds % 3600) // 60\n            return f\"{hours}h {minutes}m\"\n        else:\n            days = total_seconds // 86400\n            hours = (total_seconds % 86400) // 3600\n            return f\"{days}d {hours}h\"\n\n    def to_dict(self):\n        def format_timestamp(dt):\n            \"\"\"Format timestamp ensuring timezone info\"\"\"\n            if not dt:\n                return None\n            if dt.tzinfo is None:\n                dt = dt.replace(tzinfo=timezone.utc)\n            return dt.isoformat()\n\n        return {\n            'id': self.id,\n            'title': self.title,\n            'description': self.description,\n            'status': self.status,\n            'impact': self.impact,\n            'affected_services': self.get_affected_services(),\n            'created_at': format_timestamp(self.created_at),\n            'updated_at': format_timestamp(self.updated_at),\n            'resolved_at': format_timestamp(self.resolved_at),\n            'duration': self.get_duration(),\n            'creator': {\n                'id': self.creator.id,\n                'username': self.creator.username\n            } if self.creator else None\n        }\n\n\nclass StatusUpdate(db.Model):\n    __tablename__ = 'status_update'\n\n    id = db.Column(db.Integer, primary_key=True)\n    incident_id = db.Column(db.Integer, db.ForeignKey('status_incident.id'), nullable=False)\n    message = db.Column(db.Text, nullable=False)\n    status = db.Column(db.String(50), nullable=False)  # investigating, identified, monitoring, resolved\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), nullable=False)\n    created_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n\n    # Relationships\n    incident = db.relationship('StatusIncident', backref=db.backref('updates', lazy=True, order_by='StatusUpdate.created_at'))\n    creator = db.relationship('User', foreign_keys=[created_by], backref=db.backref('status_updates', lazy=True))\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'message': self.message,\n            'status': self.status,\n            'created_at': self.created_at.isoformat() if self.created_at else None,\n            'creator': {\n                'id': self.creator.id,\n                'username': self.creator.username\n            } if self.creator else None\n        }\n","size_bytes":8771},"app/decorators/economy.py":{"content":"\"\"\"\nEconomy-related decorators for the Hack Club Dashboard.\n\nThis module contains decorators for protecting routes that require the economy\nsystem to be enabled. The economy system can be toggled by administrators\nthrough the SystemSettings model.\n\"\"\"\n\nfrom functools import wraps\nfrom flask import request, jsonify, flash, redirect, url_for\n\n\ndef economy_required(f):\n    \"\"\"\n    Decorator to protect routes that require economy to be enabled.\n\n    Checks if the economy system is enabled in SystemSettings before allowing\n    access to the route. Administrators can bypass this check if the admin\n    economy override setting is enabled.\n\n    Args:\n        f: The function to decorate\n\n    Returns:\n        The decorated function\n\n    Usage:\n        @app.route('/shop')\n        @economy_required\n        def shop():\n            # Only accessible when economy is enabled\n            return render_template('shop.html')\n\n    Notes:\n        - Returns JSON error for API requests (request.is_json)\n        - Redirects to dashboard with flash message for HTML requests\n        - Allows admin access when admin override is enabled\n        - Gracefully handles errors by allowing access if settings can't be checked\n    \"\"\"\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        # Import here to avoid circular imports\n        from flask import current_app\n        from app.models.system import SystemSettings\n        from app.utils.auth_helpers import get_current_user\n\n        try:\n            if not SystemSettings.is_economy_enabled():\n                # Check if user is admin and admin override is enabled\n                current_user = get_current_user()\n                if current_user and current_user.is_admin and SystemSettings.is_admin_economy_override_enabled():\n                    # Allow admin access when override is enabled\n                    return f(*args, **kwargs)\n                else:\n                    if request.is_json:\n                        return jsonify({'error': 'This feature is currently disabled.'}), 403\n                    flash('This feature is currently disabled.', 'error')\n                    return redirect(url_for('dashboard'))\n        except Exception as e:\n            current_app.logger.error(f\"Error checking economy status: {str(e)}\")\n            # Allow access if we can't check the setting (fail open for availability)\n\n        return f(*args, **kwargs)\n    return decorated_function\n","size_bytes":2445},"app/models/chat.py":{"content":"\"\"\"\nChat models for club messaging.\n\"\"\"\nfrom datetime import datetime, timezone\nfrom extensions import db\n\n\nclass ClubChatMessage(db.Model):\n    __tablename__ = 'club_chat_messages'\n\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    message = db.Column(db.String(1000), nullable=True)  # 1000 char limit, nullable for image-only messages\n    image_url = db.Column(db.String(500), nullable=True)  # URL to image on CDN\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    # Relationships\n    club = db.relationship('Club', backref=db.backref('chat_messages', lazy='dynamic', cascade='all, delete-orphan'))\n    user = db.relationship('User', backref=db.backref('club_chat_messages', lazy='dynamic'))\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'club_id': self.club_id,\n            'user_id': self.user_id,\n            'username': self.user.username,\n            'message': self.message,\n            'image_url': self.image_url,\n            'created_at': self.created_at.isoformat() if self.created_at else None,\n            'can_delete': True  # Will be set in the route based on user permissions\n        }\n","size_bytes":1336},"app/routes/status.py":{"content":"\"\"\"\nStatus page routes blueprint for the Hack Club Dashboard.\nHandles public status page and admin status management.\n\"\"\"\n\nfrom flask import Blueprint, render_template, jsonify, request\nfrom datetime import datetime, timezone\nfrom extensions import db\nfrom app.decorators.auth import login_required, admin_required\nfrom app.utils.auth_helpers import get_current_user\nfrom app.utils.sanitization import sanitize_string\nfrom app.models.system import StatusIncident, StatusUpdate\n\nstatus_bp = Blueprint('status', __name__)\n\n\n@status_bp.route('/api/status/banner')\ndef status_banner():\n    \"\"\"API endpoint for status banner (returns active incidents for display)\"\"\"\n    # Get active critical/major incidents (status not 'resolved')\n    incidents = StatusIncident.query.filter(\n        StatusIncident.status != 'resolved',\n        StatusIncident.impact.in_(['major', 'critical'])\n    ).order_by(StatusIncident.created_at.desc()).limit(1).all()\n    \n    if incidents:\n        incident = incidents[0]\n        return jsonify({\n            'show': True,\n            'message': incident.title,\n            'severity': incident.impact,\n            'status': incident.status,\n            'link': '/status'\n        })\n    \n    return jsonify({'show': False})\n\n\n@status_bp.route('/status')\ndef status_page():\n    \"\"\"Public status page\"\"\"\n    # Get recent incidents (not resolved)\n    incidents = StatusIncident.query.filter(\n        StatusIncident.status != 'resolved'\n    ).order_by(StatusIncident.created_at.desc()).limit(10).all()\n\n    # Get recent resolved incidents\n    resolved_incidents = StatusIncident.query.filter(\n        StatusIncident.status == 'resolved'\n    ).order_by(StatusIncident.resolved_at.desc()).limit(5).all()\n\n    # Check overall system status\n    if any(inc.impact in ['critical', 'major'] for inc in incidents):\n        overall_status = 'degraded'\n        status_color = 'danger'\n    elif any(inc.impact == 'minor' for inc in incidents):\n        overall_status = 'minor issues'\n        status_color = 'warning'\n    else:\n        overall_status = 'operational'\n        status_color = 'success'\n\n    return render_template('status.html',\n                         incidents=incidents,\n                         resolved_incidents=resolved_incidents,\n                         overall_status=overall_status,\n                         status_color=status_color)\n\n\n@status_bp.route('/api/status', methods=['GET'])\ndef api_status():\n    \"\"\"API endpoint for status\"\"\"\n    incidents = StatusIncident.query.filter_by(\n        is_resolved=False\n    ).order_by(StatusIncident.created_at.desc()).all()\n\n    incidents_data = []\n    for incident in incidents:\n        updates = StatusUpdate.query.filter_by(\n            incident_id=incident.id\n        ).order_by(StatusUpdate.created_at.desc()).all()\n\n        incidents_data.append({\n            'id': incident.id,\n            'title': incident.title,\n            'description': incident.description,\n            'severity': incident.severity,\n            'affected_components': incident.affected_components,\n            'created_at': incident.created_at.isoformat() if incident.created_at else None,\n            'updates': [{\n                'id': update.id,\n                'message': update.message,\n                'status': update.status,\n                'created_at': update.created_at.isoformat() if update.created_at else None\n            } for update in updates]\n        })\n\n    # Determine overall status\n    if any(inc['severity'] in ['critical', 'major'] for inc in incidents_data):\n        overall_status = 'degraded'\n    elif any(inc['severity'] == 'minor' for inc in incidents_data):\n        overall_status = 'minor_issues'\n    else:\n        overall_status = 'operational'\n\n    return jsonify({\n        'status': overall_status,\n        'incidents': incidents_data,\n        'timestamp': datetime.now(timezone.utc).isoformat()\n    })\n\n\n@status_bp.route('/admin/status/incidents', methods=['GET', 'POST'])\n@login_required\n@admin_required\ndef admin_incidents():\n    \"\"\"Manage status incidents (admin only)\"\"\"\n    if request.method == 'GET':\n        incidents = StatusIncident.query.order_by(\n            StatusIncident.created_at.desc()\n        ).limit(50).all()\n\n        incidents_data = []\n        for incident in incidents:\n            incidents_data.append({\n                'id': incident.id,\n                'title': incident.title,\n                'description': incident.description,\n                'severity': incident.severity,\n                'affected_components': incident.affected_components,\n                'is_resolved': incident.is_resolved,\n                'created_at': incident.created_at.isoformat() if incident.created_at else None,\n                'resolved_at': incident.resolved_at.isoformat() if incident.resolved_at else None\n            })\n\n        return jsonify({\n            'success': True,\n            'incidents': incidents_data\n        })\n\n    elif request.method == 'POST':\n        data = request.get_json()\n\n        title = sanitize_string(data.get('title', ''), max_length=200)\n        description = sanitize_string(data.get('description', ''), max_length=2000)\n        severity = data.get('severity', 'minor')\n        affected_components = data.get('affected_components', [])\n\n        if not title:\n            return jsonify({'error': 'Title is required'}), 400\n\n        if severity not in ['minor', 'major', 'critical']:\n            return jsonify({'error': 'Invalid severity'}), 400\n\n        incident = StatusIncident(\n            title=title,\n            description=description,\n            severity=severity,\n            affected_components=affected_components,\n            created_by=get_current_user().id\n        )\n\n        db.session.add(incident)\n        db.session.commit()\n\n        return jsonify({\n            'success': True,\n            'incident': {\n                'id': incident.id,\n                'title': incident.title,\n                'severity': incident.severity\n            }\n        }), 201\n\n\n@status_bp.route('/admin/status/incidents/<int:incident_id>/updates', methods=['POST'])\n@login_required\n@admin_required\ndef add_incident_update(incident_id):\n    \"\"\"Add update to an incident\"\"\"\n    incident = StatusIncident.query.get_or_404(incident_id)\n\n    data = request.get_json()\n    message = sanitize_string(data.get('message', ''), max_length=2000)\n    status = data.get('status', 'investigating')\n\n    if not message:\n        return jsonify({'error': 'Message is required'}), 400\n\n    update = StatusUpdate(\n        incident_id=incident_id,\n        message=message,\n        status=status,\n        created_by=get_current_user().id\n    )\n\n    db.session.add(update)\n    db.session.commit()\n\n    return jsonify({\n        'success': True,\n        'update': {\n            'id': update.id,\n            'message': update.message,\n            'status': update.status,\n            'created_at': update.created_at.isoformat() if update.created_at else None\n        }\n    }), 201\n\n\n@status_bp.route('/admin/status/incidents/<int:incident_id>/resolve', methods=['POST'])\n@login_required\n@admin_required\ndef resolve_incident(incident_id):\n    \"\"\"Resolve an incident\"\"\"\n    incident = StatusIncident.query.get_or_404(incident_id)\n\n    incident.is_resolved = True\n    incident.resolved_at = datetime.now(timezone.utc)\n\n    db.session.commit()\n\n    return jsonify({\n        'success': True,\n        'message': 'Incident resolved'\n    })\n","size_bytes":7448},"app/decorators/rate_limit.py":{"content":"\"\"\"\nRate limiting decorators for the Hack Club Dashboard.\n\nThis application uses Flask-Limiter for rate limiting, which is configured\nin the main application file. Rate limits are applied using the @limiter.limit()\ndecorator directly on routes.\n\nExample usage in main.py:\n    from flask_limiter import Limiter\n    from flask_limiter.util import get_remote_address\n\n    limiter = Limiter(\n        app=app,\n        key_func=get_remote_address,\n        default_limits=[\"200 per day\", \"50 per hour\"],\n        storage_uri=\"memory://\"\n    )\n\n    @app.route('/api/endpoint')\n    @limiter.limit(\"10 per minute\")\n    def rate_limited_endpoint():\n        return jsonify({'message': 'Success'})\n\nFor more information on Flask-Limiter:\n    - Documentation: https://flask-limiter.readthedocs.io/\n    - GitHub: https://github.com/alisaifee/flask-limiter\n\nCommon rate limiting patterns:\n    - Per minute: \"10 per minute\" or \"10/minute\"\n    - Per hour: \"100 per hour\" or \"100/hour\"\n    - Per day: \"1000 per day\" or \"1000/day\"\n    - Multiple limits: [\"10 per minute\", \"100 per hour\"]\n\nTo import the limiter instance:\n    from extensions import limiter\n\n    @limiter.limit(\"5 per minute\")\n    def my_route():\n        pass\n\nCustom rate limit key functions:\n    You can create custom key functions to rate limit by user ID, API key, etc.:\n\n    def get_user_id():\n        return str(session.get('user_id', 'anonymous'))\n\n    @limiter.limit(\"100 per hour\", key_func=get_user_id)\n    def user_specific_limit():\n        pass\n\nRate limit exemptions:\n    To exempt specific routes or conditions:\n\n    @limiter.exempt\n    def unlimited_route():\n        pass\n\n    Or conditionally:\n\n    @limiter.limit(\"10 per minute\", exempt_when=lambda: current_user.is_admin)\n    def conditional_limit():\n        pass\n\"\"\"\n\n# This file serves as documentation for rate limiting in the application.\n# All rate limiting functionality is provided by Flask-Limiter directly.\n# No custom decorators are needed for standard rate limiting use cases.\n","size_bytes":2000},"app/utils/cdn_helpers.py":{"content":"\"\"\"\nCDN Helper Functions\nHandles image uploads to Hack Club CDN\n\"\"\"\n\nimport os\nimport uuid\nimport base64\nimport requests\nfrom flask import current_app, request\n\n\ndef upload_to_hackclub_cdn(image_data_list):\n    \"\"\"\n    Upload images to Hack Club CDN\n\n    Args:\n        image_data_list: List of tuples (image_data_bytes, file_extension)\n\n    Returns:\n        tuple: (success: bool, result: list of CDN URLs or error message)\n    \"\"\"\n    try:\n        # Get CDN token from environment\n        cdn_token = os.getenv('HACKCLUB_CDN_TOKEN')\n        if not cdn_token:\n            current_app.logger.error(\"HACKCLUB_CDN_TOKEN not configured\")\n            return False, \"Image upload service not configured\"\n\n        if not image_data_list:\n            return False, \"No images provided\"\n\n        # Create temp directory\n        temp_upload_dir = os.path.join(current_app.root_path, '..', 'static', 'temp')\n        os.makedirs(temp_upload_dir, exist_ok=True)\n\n        temp_files = []\n        temp_urls = []\n\n        try:\n            # Save all images to temporary files\n            for image_data, file_ext in image_data_list:\n                temp_filename = f\"upload_{uuid.uuid4()}{file_ext}\"\n                temp_file_path = os.path.join(temp_upload_dir, temp_filename)\n\n                with open(temp_file_path, 'wb') as f:\n                    f.write(image_data)\n\n                temp_files.append(temp_file_path)\n\n                # Create public URL for CDN to access\n                temp_url = f\"{request.url_root}static/temp/{temp_filename}\"\n                temp_urls.append(temp_url)\n\n            current_app.logger.info(f'Uploading {len(temp_urls)} images to Hack Club CDN')\n\n            # Upload to Hack Club CDN\n            cdn_response = requests.post(\n                'https://cdn.hackclub.com/api/v3/new',\n                headers={\n                    'Authorization': f'Bearer {cdn_token}',\n                    'Content-Type': 'application/json'\n                },\n                json=temp_urls,  # Send array of URLs\n                timeout=60\n            )\n\n            if cdn_response.status_code != 200:\n                current_app.logger.error(f\"CDN upload failed: {cdn_response.status_code} - {cdn_response.text}\")\n                return False, \"Failed to upload images to CDN\"\n\n            cdn_data = cdn_response.json()\n\n            if 'files' in cdn_data and len(cdn_data['files']) > 0:\n                cdn_urls = [file_info['deployedUrl'] for file_info in cdn_data['files']]\n                current_app.logger.info(f'Successfully uploaded {len(cdn_urls)} images to CDN')\n                return True, cdn_urls\n            else:\n                current_app.logger.error(f\"Unexpected CDN response format: {cdn_data}\")\n                return False, \"Failed to process upload response\"\n\n        finally:\n            # Clean up temporary files\n            for temp_file in temp_files:\n                try:\n                    if os.path.exists(temp_file):\n                        os.unlink(temp_file)\n                except Exception as e:\n                    current_app.logger.error(f\"Error cleaning up temp file {temp_file}: {str(e)}\")\n\n    except requests.RequestException as e:\n        current_app.logger.error(f\"Error uploading to CDN: {str(e)}\")\n        return False, \"Failed to connect to image service\"\n    except Exception as e:\n        current_app.logger.error(f\"Error in upload_to_hackclub_cdn: {str(e)}\")\n        return False, \"Failed to upload images\"\n\n\ndef parse_base64_images(base64_images_list, max_size=10 * 1024 * 1024):\n    \"\"\"\n    Parse and validate base64 image data\n\n    Args:\n        base64_images_list: List of base64 encoded images (data URLs)\n        max_size: Maximum file size in bytes (default 10MB)\n\n    Returns:\n        list: List of tuples (image_data_bytes, file_extension)\n    \"\"\"\n    allowed_mime_types = {'image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'}\n    ext_map = {\n        'image/jpeg': '.jpg',\n        'image/jpg': '.jpg',\n        'image/png': '.png',\n        'image/gif': '.gif',\n        'image/webp': '.webp'\n    }\n\n    parsed_images = []\n\n    for idx, base64_image in enumerate(base64_images_list):\n        try:\n            # Parse base64 data URL\n            if not base64_image.startswith('data:image/'):\n                current_app.logger.warning(f'Invalid image format for image {idx}')\n                continue\n\n            # Extract MIME type and base64 data\n            header, data_part = base64_image.split(',', 1)\n            mime_type = header.split(':')[1].split(';')[0]\n\n            # Validate MIME type\n            if mime_type not in allowed_mime_types:\n                current_app.logger.warning(f'Invalid MIME type: {mime_type}')\n                continue\n\n            # Decode base64 and check file size\n            image_data = base64.b64decode(data_part)\n            if len(image_data) > max_size:\n                current_app.logger.warning(f'Image {idx} too large: {len(image_data)} bytes')\n                continue\n\n            # Get file extension\n            file_ext = ext_map.get(mime_type, '.jpg')\n\n            parsed_images.append((image_data, file_ext))\n\n        except Exception as e:\n            current_app.logger.error(f'Error parsing image {idx}: {str(e)}')\n            continue\n\n    return parsed_images\n","size_bytes":5312},"app/routes/admin.py":{"content":"\"\"\"\nAdmin routes blueprint for the Hack Club Dashboard.\nHandles admin panel, user management, club management, order reviews, and system settings.\n\"\"\"\n\nfrom flask import Blueprint, render_template, redirect, url_for, request, flash, jsonify\nfrom datetime import datetime, timezone\nfrom extensions import db\nfrom app.decorators.auth import login_required, admin_required, reviewer_required\nfrom app.utils.auth_helpers import get_current_user\nfrom app.utils.sanitization import sanitize_string\nfrom app.models.user import User, Role, AuditLog\nfrom app.models.club import Club, ClubMembership\nfrom app.models.economy import ProjectSubmission, ClubTransaction\nfrom app.models.system import SystemSettings\nfrom app.services.airtable import AirtableService\n\nadmin_bp = Blueprint('admin', __name__, url_prefix='/admin')\n\n\n@admin_bp.route('/')\n@admin_bp.route('/dashboard')\n@login_required\n@admin_required\ndef dashboard():\n    \"\"\"Admin dashboard\"\"\"\n    from app.models.club_content import ClubPost, ClubAssignment\n\n    current_user = get_current_user()\n\n    # Get statistics\n    total_users = User.query.count()\n    total_clubs = Club.query.count()\n    total_posts = ClubPost.query.count()\n    total_assignments = ClubAssignment.query.count()\n    pending_projects = ProjectSubmission.query.filter_by(approved_at=None).count()\n\n    # Get total club balance\n    total_club_balance = db.session.query(db.func.sum(Club.balance)).scalar() or 0\n\n    # Get recent activity\n    recent_users = User.query.order_by(User.created_at.desc()).limit(10).all()\n    recent_clubs = Club.query.order_by(Club.created_at.desc()).limit(10).all()\n\n    # Check permissions for each tab\n    can_view_users = current_user.has_permission('users.view') or current_user.is_admin\n    can_view_clubs = current_user.has_permission('clubs.view') or current_user.is_admin\n    can_view_content = current_user.has_permission('content.view') or current_user.is_admin\n    can_manage_roles = current_user.has_permission('system.manage_roles') or current_user.has_role('super-admin')\n    can_manage_users = current_user.has_permission('users.edit') or current_user.is_admin\n    can_access_api = current_user.has_permission('admin.manage_api_keys') or current_user.is_admin\n    can_manage_settings = current_user.has_permission('system.manage_settings') or current_user.is_admin\n\n    return render_template('admin_dashboard.html',\n                         total_users=total_users,\n                         total_clubs=total_clubs,\n                         total_posts=total_posts,\n                         total_assignments=total_assignments,\n                         pending_projects=pending_projects,\n                         total_club_balance=total_club_balance,\n                         recent_users=recent_users,\n                         recent_clubs=recent_clubs,\n                         can_view_users=can_view_users,\n                         can_view_clubs=can_view_clubs,\n                         can_view_content=can_view_content,\n                         can_manage_roles=can_manage_roles,\n                         can_manage_users=can_manage_users,\n                         can_access_api=can_access_api,\n                         can_manage_settings=can_manage_settings)\n\n\n@admin_bp.route('/users')\n@login_required\n@admin_required\ndef users():\n    \"\"\"User management - returns JSON for now\"\"\"\n    page = request.args.get('page', 1, type=int)\n    per_page = 50\n\n    search = request.args.get('search', '')\n    if search:\n        search_term = f\"%{search}%\"\n        users_query = User.query.filter(\n            db.or_(\n                User.username.ilike(search_term),\n                User.email.ilike(search_term),\n                User.first_name.ilike(search_term),\n                User.last_name.ilike(search_term)\n            )\n        )\n    else:\n        users_query = User.query\n\n    users_pagination = users_query.order_by(User.created_at.desc()).paginate(\n        page=page, per_page=per_page, error_out=False\n    )\n\n    # Return JSON for now since template doesn't exist\n    return jsonify({\n        'users': [{\n            'id': u.id,\n            'username': u.username,\n            'email': u.email,\n            'created_at': u.created_at.isoformat() if u.created_at else None\n        } for u in users_pagination.items],\n        'total': users_pagination.total,\n        'page': page\n    })\n\n\n@admin_bp.route('/users/<int:user_id>')\n@login_required\n@admin_required\ndef user_detail(user_id):\n    \"\"\"View user details\"\"\"\n    user = User.query.get_or_404(user_id)\n\n    # Get user's clubs\n    memberships = ClubMembership.query.filter_by(user_id=user_id).all()\n    clubs = [m.club for m in memberships]\n\n    # Get user's audit logs\n    audit_logs = AuditLog.query.filter_by(user_id=user_id).order_by(\n        AuditLog.timestamp.desc()\n    ).limit(50).all()\n\n    return render_template('admin_user_detail.html',\n                         user=user,\n                         clubs=clubs,\n                         audit_logs=audit_logs)\n\n\n@admin_bp.route('/users/<int:user_id>/suspend', methods=['POST'])\n@login_required\n@admin_required\ndef suspend_user(user_id):\n    \"\"\"Suspend a user\"\"\"\n    user = User.query.get_or_404(user_id)\n\n    if user.is_admin:\n        flash('Cannot suspend admin users.', 'error')\n        return redirect(url_for('admin.user_detail', user_id=user_id))\n\n    reason = sanitize_string(request.form.get('reason', ''), max_length=500)\n\n    user.is_suspended = True\n    db.session.commit()\n\n    # Create audit log\n    from app.models.user import AuditLog\n    audit_log = AuditLog(\n        user_id=get_current_user().id,\n        action_type='user_suspended',\n        description=f'Suspended user: {user.username}',\n        target_type='user',\n        target_id=user_id,\n        details={'reason': reason},\n        severity='warning',\n        category='admin'\n    )\n    db.session.add(audit_log)\n    db.session.commit()\n\n    flash(f'User {user.username} has been suspended.', 'success')\n    return redirect(url_for('admin.user_detail', user_id=user_id))\n\n\n@admin_bp.route('/users/<int:user_id>/unsuspend', methods=['POST'])\n@login_required\n@admin_required\ndef unsuspend_user(user_id):\n    \"\"\"Unsuspend a user\"\"\"\n    user = User.query.get_or_404(user_id)\n\n    user.is_suspended = False\n    db.session.commit()\n\n    # Create audit log\n    audit_log = AuditLog(\n        user_id=get_current_user().id,\n        action_type='user_unsuspended',\n        description=f'Unsuspended user: {user.username}',\n        target_type='user',\n        target_id=user_id,\n        severity='info',\n        category='admin'\n    )\n    db.session.add(audit_log)\n    db.session.commit()\n\n    flash(f'User {user.username} has been unsuspended.', 'success')\n    return redirect(url_for('admin.user_detail', user_id=user_id))\n\n\n@admin_bp.route('/clubs')\n@login_required\n@admin_required\ndef clubs():\n    \"\"\"Club management - returns JSON for now\"\"\"\n    page = request.args.get('page', 1, type=int)\n    per_page = 50\n\n    search = request.args.get('search', '')\n    if search:\n        search_term = f\"%{search}%\"\n        clubs_query = Club.query.filter(Club.name.ilike(search_term))\n    else:\n        clubs_query = Club.query\n\n    clubs_pagination = clubs_query.order_by(Club.created_at.desc()).paginate(\n        page=page, per_page=per_page, error_out=False\n    )\n\n    # Return JSON for now since template doesn't exist\n    return jsonify({\n        'clubs': [{\n            'id': c.id,\n            'name': c.name,\n            'location': c.location,\n            'tokens': c.tokens,\n            'created_at': c.created_at.isoformat() if c.created_at else None\n        } for c in clubs_pagination.items],\n        'total': clubs_pagination.total,\n        'page': page\n    })\n\n\n@admin_bp.route('/clubs/<int:club_id>')\n@login_required\n@admin_required\ndef club_detail(club_id):\n    \"\"\"View club details\"\"\"\n    club = Club.query.get_or_404(club_id)\n\n    # Get club members\n    memberships = ClubMembership.query.filter_by(club_id=club_id).all()\n\n    # Get club transactions\n    transactions = ClubTransaction.query.filter_by(club_id=club_id).order_by(\n        ClubTransaction.created_at.desc()\n    ).limit(50).all()\n\n    return render_template('admin_club_detail.html',\n                         club=club,\n                         memberships=memberships,\n                         transactions=transactions)\n\n\n@admin_bp.route('/projects/review')\n@login_required\n@reviewer_required\ndef review_projects():\n    \"\"\"Review pending project submissions\"\"\"\n    pending_projects = ProjectSubmission.query.filter_by(\n        approved_at=None\n    ).order_by(ProjectSubmission.submitted_at.desc()).all()\n\n    return render_template('admin_review_projects.html', projects=pending_projects)\n\n\n@admin_bp.route('/projects/<int:project_id>/approve', methods=['POST'])\n@login_required\n@reviewer_required\ndef approve_project(project_id):\n    \"\"\"Approve a project submission\"\"\"\n    project = ProjectSubmission.query.get_or_404(project_id)\n\n    if project.approved_at:\n        flash('Project already approved.', 'warning')\n        return redirect(url_for('admin.review_projects'))\n\n    project.approved_at = datetime.now(timezone.utc)\n    project.approved_by = get_current_user().id\n\n    # TODO: Award tokens to club for approved project\n\n    db.session.commit()\n\n    flash(f'Project \"{project.project_name}\" approved!', 'success')\n    return redirect(url_for('admin.review_projects'))\n\n\n@admin_bp.route('/orders/review')\n@login_required\n@admin_required\ndef review_orders():\n    \"\"\"Review pending shop orders\"\"\"\n    # TODO: Implement order review system\n    return render_template('admin_order_review.html', orders=[])\n\n\n@admin_bp.route('/settings', methods=['GET', 'POST'])\n@login_required\n@admin_required\ndef settings():\n    \"\"\"System settings\"\"\"\n    system_settings = SystemSettings.query.first()\n    if not system_settings:\n        system_settings = SystemSettings()\n        db.session.add(system_settings)\n        db.session.commit()\n\n    if request.method == 'POST':\n        # Update settings\n        system_settings.maintenance_mode = request.form.get('maintenance_mode') == 'on'\n        system_settings.economy_enabled = request.form.get('economy_enabled') == 'on'\n        system_settings.registration_enabled = request.form.get('registration_enabled') == 'on'\n\n        announcement = sanitize_string(request.form.get('announcement', ''), max_length=500)\n        system_settings.announcement = announcement if announcement else None\n\n        db.session.commit()\n\n        flash('Settings updated successfully.', 'success')\n        return redirect(url_for('admin.settings'))\n\n    return render_template('admin_settings.html', settings=system_settings)\n\n\n@admin_bp.route('/stats')\n@login_required\n@admin_required\ndef stats():\n    \"\"\"System statistics\"\"\"\n    # Get various statistics\n    stats_data = {\n        'total_users': User.query.count(),\n        'active_users': User.query.filter_by(is_suspended=False).count(),\n        'suspended_users': User.query.filter_by(is_suspended=True).count(),\n        'total_clubs': Club.query.count(),\n        'total_tokens_distributed': db.session.query(\n            db.func.sum(ClubTransaction.amount)\n        ).filter(ClubTransaction.amount > 0).scalar() or 0,\n        'pending_projects': ProjectSubmission.query.filter_by(approved_at=None).count(),\n        'approved_projects': ProjectSubmission.query.filter(\n            ProjectSubmission.approved_at.isnot(None)\n        ).count(),\n    }\n\n    return render_template('admin_stats.html', stats=stats_data)\n\n\n@admin_bp.route('/pizza-grants')\n@login_required\n@admin_required\ndef pizza_grants():\n    \"\"\"Pizza grant management\"\"\"\n    # Get grants from Airtable\n    try:\n        grants = AirtableService.get_pizza_grants()\n    except Exception as e:\n        flash(f'Error loading grants: {str(e)}', 'error')\n        grants = []\n\n    return render_template('admin_pizza_grants.html', grants=grants)\n\n\n@admin_bp.route('/activity')\n@login_required\n@admin_required\ndef activity():\n    \"\"\"Recent activity log\"\"\"\n    page = request.args.get('page', 1, type=int)\n    per_page = 100\n\n    # Get recent audit logs\n    logs_pagination = AuditLog.query.order_by(\n        AuditLog.timestamp.desc()\n    ).paginate(page=page, per_page=per_page, error_out=False)\n\n    return render_template('admin_activity.html',\n                         logs=logs_pagination.items,\n                         pagination=logs_pagination)\n\n\n@admin_bp.route('/api/banner-settings', methods=['GET', 'POST'])\n@login_required\n@admin_required\ndef api_banner_settings():\n    \"\"\"Get or update banner settings (admin only) - Alias for /api/admin/banner-settings\"\"\"\n    # Import here to avoid circular imports\n    from app.routes.api import admin_banner_settings\n    # Forward the request to the main API endpoint\n    return admin_banner_settings()\n","size_bytes":12819},"app/routes/oauth.py":{"content":"\"\"\"\nOAuth routes blueprint for the Hack Club Dashboard.\nImplements OAuth 2.0 authorization server for third-party applications.\n\"\"\"\n\nfrom flask import Blueprint, render_template, redirect, url_for, request, jsonify, session\nfrom datetime import datetime, timedelta, timezone\nimport secrets\nfrom extensions import db, limiter\nfrom app.decorators.auth import login_required\nfrom app.utils.auth_helpers import get_current_user\nfrom app.utils.sanitization import sanitize_string, sanitize_url\nfrom app.models.auth import OAuthApplication, OAuthToken, OAuthAuthorizationCode\nfrom app.models.user import User\n\noauth_bp = Blueprint('oauth', __name__, url_prefix='/oauth')\n\n\n@oauth_bp.route('/authorize')\n@limiter.limit(\"30 per minute\")\ndef authorize():\n    \"\"\"OAuth authorization endpoint\"\"\"\n    # Get OAuth parameters\n    client_id = request.args.get('client_id')\n    redirect_uri = request.args.get('redirect_uri')\n    response_type = request.args.get('response_type', 'code')\n    scope = request.args.get('scope', '')\n    state = request.args.get('state', '')\n\n    if not client_id or not redirect_uri:\n        return jsonify({'error': 'invalid_request', 'error_description': 'Missing required parameters'}), 400\n\n    # Validate client\n    app = OAuthApplication.query.filter_by(client_id=client_id).first()\n    if not app:\n        return jsonify({'error': 'invalid_client', 'error_description': 'Unknown client'}), 401\n\n    # Validate redirect URI\n    if redirect_uri not in app.redirect_uris:\n        return jsonify({'error': 'invalid_request', 'error_description': 'Invalid redirect_uri'}), 400\n\n    # Check if user is logged in\n    user = get_current_user()\n    if not user:\n        # Store OAuth params and redirect to login\n        session['oauth_params'] = {\n            'client_id': client_id,\n            'redirect_uri': redirect_uri,\n            'response_type': response_type,\n            'scope': scope,\n            'state': state\n        }\n        return redirect(url_for('auth.login'))\n\n    # Only support authorization code flow\n    if response_type != 'code':\n        return jsonify({'error': 'unsupported_response_type'}), 400\n\n    # Show authorization page\n    scopes = scope.split() if scope else []\n    return render_template('oauth/authorize.html',\n                         app=app,\n                         scopes=scopes,\n                         redirect_uri=redirect_uri,\n                         state=state)\n\n\n@oauth_bp.route('/authorize/approve', methods=['POST'])\n@login_required\n@limiter.limit(\"30 per minute\")\ndef approve_authorization():\n    \"\"\"User approves OAuth authorization\"\"\"\n    user = get_current_user()\n\n    client_id = request.form.get('client_id')\n    redirect_uri = request.form.get('redirect_uri')\n    scope = request.form.get('scope', '')\n    state = request.form.get('state', '')\n\n    # Validate client\n    app = OAuthApplication.query.filter_by(client_id=client_id).first()\n    if not app:\n        return jsonify({'error': 'invalid_client'}), 401\n\n    # Generate authorization code\n    code = secrets.token_urlsafe(32)\n\n    # Store authorization code\n    auth_code = OAuthAuthorizationCode(\n        code=code,\n        application_id=app.id,\n        user_id=user.id,\n        redirect_uri=redirect_uri,\n        scope=scope,\n        expires_at=datetime.now(timezone.utc) + timedelta(minutes=10)\n    )\n\n    db.session.add(auth_code)\n    db.session.commit()\n\n    # Redirect back to client with code\n    separator = '&' if '?' in redirect_uri else '?'\n    callback_url = f\"{redirect_uri}{separator}code={code}\"\n    if state:\n        callback_url += f\"&state={state}\"\n\n    return redirect(callback_url)\n\n\n@oauth_bp.route('/token', methods=['POST'])\n@limiter.limit(\"30 per minute\")\ndef token():\n    \"\"\"OAuth token endpoint\"\"\"\n    grant_type = request.form.get('grant_type')\n    code = request.form.get('code')\n    redirect_uri = request.form.get('redirect_uri')\n    client_id = request.form.get('client_id')\n    client_secret = request.form.get('client_secret')\n\n    if grant_type != 'authorization_code':\n        return jsonify({'error': 'unsupported_grant_type'}), 400\n\n    # Validate client\n    app = OAuthApplication.query.filter_by(\n        client_id=client_id,\n        client_secret=client_secret\n    ).first()\n\n    if not app:\n        return jsonify({'error': 'invalid_client'}), 401\n\n    # Validate authorization code\n    auth_code = OAuthAuthorizationCode.query.filter_by(\n        code=code,\n        application_id=app.id\n    ).first()\n\n    if not auth_code:\n        return jsonify({'error': 'invalid_grant'}), 400\n\n    # Check if code expired\n    if auth_code.expires_at < datetime.now(timezone.utc):\n        return jsonify({'error': 'invalid_grant', 'error_description': 'Code expired'}), 400\n\n    # Check if code was used\n    if auth_code.used_at:\n        return jsonify({'error': 'invalid_grant', 'error_description': 'Code already used'}), 400\n\n    # Validate redirect URI\n    if auth_code.redirect_uri != redirect_uri:\n        return jsonify({'error': 'invalid_grant', 'error_description': 'Redirect URI mismatch'}), 400\n\n    # Mark code as used\n    auth_code.used_at = datetime.now(timezone.utc)\n\n    # Generate access token\n    access_token = secrets.token_urlsafe(32)\n    refresh_token = secrets.token_urlsafe(32)\n\n    # Create token\n    oauth_token = OAuthToken(\n        access_token=access_token,\n        refresh_token=refresh_token,\n        application_id=app.id,\n        user_id=auth_code.user_id,\n        scope=auth_code.scope,\n        expires_at=datetime.now(timezone.utc) + timedelta(days=30)\n    )\n\n    db.session.add(oauth_token)\n    db.session.commit()\n\n    return jsonify({\n        'access_token': access_token,\n        'token_type': 'Bearer',\n        'expires_in': 30 * 24 * 60 * 60,  # 30 days in seconds\n        'refresh_token': refresh_token,\n        'scope': auth_code.scope\n    })\n\n\n@oauth_bp.route('/user')\n@limiter.limit(\"60 per minute\")\ndef user_info():\n    \"\"\"Get user info with OAuth token\"\"\"\n    # Get token from Authorization header\n    auth_header = request.headers.get('Authorization', '')\n\n    if not auth_header.startswith('Bearer '):\n        return jsonify({'error': 'invalid_request'}), 401\n\n    access_token = auth_header[7:]  # Remove \"Bearer \" prefix\n\n    # Validate token\n    token = OAuthToken.query.filter_by(access_token=access_token).first()\n\n    if not token:\n        return jsonify({'error': 'invalid_token'}), 401\n\n    # Check if token expired\n    if token.expires_at < datetime.now(timezone.utc):\n        return jsonify({'error': 'invalid_token', 'error_description': 'Token expired'}), 401\n\n    # Check if token was revoked\n    if token.revoked_at:\n        return jsonify({'error': 'invalid_token', 'error_description': 'Token revoked'}), 401\n\n    # Get user\n    user = User.query.get(token.user_id)\n    if not user:\n        return jsonify({'error': 'invalid_token'}), 401\n\n    # Return user info (scope-limited)\n    scopes = token.scope.split() if token.scope else []\n\n    user_info = {\n        'id': user.id,\n        'username': user.username\n    }\n\n    if 'user:read' in scopes or 'user:email' in scopes:\n        user_info['email'] = user.email\n\n    if 'user:read' in scopes:\n        user_info['first_name'] = user.first_name\n        user_info['last_name'] = user.last_name\n        user_info['created_at'] = user.created_at.isoformat() if user.created_at else None\n\n    return jsonify(user_info)\n\n\n@oauth_bp.route('/debug')\n@login_required\ndef oauth_debug():\n    \"\"\"OAuth debug page (for testing)\"\"\"\n    user = get_current_user()\n\n    # Get user's tokens\n    tokens = OAuthToken.query.filter_by(user_id=user.id).all()\n\n    return render_template('oauth/debug.html', tokens=tokens)\n\n\n@oauth_bp.route('/debug/callback')\ndef oauth_debug_callback():\n    \"\"\"OAuth debug callback (for testing)\"\"\"\n    code = request.args.get('code')\n    state = request.args.get('state')\n    error = request.args.get('error')\n\n    return render_template('oauth/debug_callback.html',\n                         code=code,\n                         state=state,\n                         error=error)\n","size_bytes":8071},"app/models/attendance.py":{"content":"\"\"\"\nAttendance management models for club sessions.\n\"\"\"\nfrom datetime import datetime, timezone\nfrom extensions import db\n\n\nclass AttendanceSession(db.Model):\n    \"\"\"Represents a club meeting/session where attendance is tracked\"\"\"\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    title = db.Column(db.String(200), nullable=False)\n    description = db.Column(db.Text)\n    session_date = db.Column(db.Date, nullable=False)\n    start_time = db.Column(db.Time)\n    end_time = db.Column(db.Time)\n    location = db.Column(db.String(255))\n    session_type = db.Column(db.String(50), default='meeting')  # meeting, workshop, event, etc.\n    max_attendance = db.Column(db.Integer)  # Optional capacity limit\n    is_active = db.Column(db.Boolean, default=True)  # Session is open for attendance\n    created_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), onupdate=lambda: datetime.now(timezone.utc))\n\n    # Relationships\n    club = db.relationship('Club', backref=db.backref('attendance_sessions', lazy='dynamic', cascade='all, delete-orphan'))\n    creator = db.relationship('User', backref='created_attendance_sessions')\n    attendances = db.relationship('AttendanceRecord', back_populates='session', cascade='all, delete-orphan')\n\n    def get_attendance_count(self):\n        return AttendanceRecord.query.filter_by(session_id=self.id, status='present').count()\n\n    def get_guest_count(self):\n        return AttendanceGuest.query.filter_by(session_id=self.id).count()\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'club_id': self.club_id,\n            'title': self.title,\n            'description': self.description,\n            'session_date': self.session_date.isoformat() if self.session_date else None,\n            'start_time': self.start_time.strftime('%H:%M') if self.start_time else None,\n            'end_time': self.end_time.strftime('%H:%M') if self.end_time else None,\n            'location': self.location,\n            'session_type': self.session_type,\n            'max_attendance': self.max_attendance,\n            'is_active': self.is_active,\n            'attendance_count': self.get_attendance_count(),\n            'guest_count': self.get_guest_count(),\n            'created_at': self.created_at.isoformat() if self.created_at else None\n        }\n\n\nclass AttendanceRecord(db.Model):\n    \"\"\"Tracks individual member attendance at sessions\"\"\"\n    id = db.Column(db.Integer, primary_key=True)\n    session_id = db.Column(db.Integer, db.ForeignKey('attendance_session.id'), nullable=False)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    status = db.Column(db.String(20), default='present')  # present, absent, late, excused\n    check_in_time = db.Column(db.DateTime)\n    check_out_time = db.Column(db.DateTime)\n    notes = db.Column(db.Text)  # Optional notes about attendance\n    marked_by = db.Column(db.Integer, db.ForeignKey('user.id'))  # Who marked the attendance\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), onupdate=lambda: datetime.now(timezone.utc))\n\n    # Relationships\n    session = db.relationship('AttendanceSession', back_populates='attendances')\n    user = db.relationship('User', foreign_keys=[user_id], backref='attendance_records')\n    marker = db.relationship('User', foreign_keys=[marked_by], backref='marked_attendances')\n\n    # Unique constraint to prevent duplicate attendance records\n    __table_args__ = (\n        db.UniqueConstraint('session_id', 'user_id', name='unique_session_user_attendance'),\n    )\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'session_id': self.session_id,\n            'user_id': self.user_id,\n            'username': self.user.username if self.user else None,\n            'user_email': self.user.email if self.user else None,\n            'status': self.status,\n            'check_in_time': self.check_in_time.isoformat() if self.check_in_time else None,\n            'check_out_time': self.check_out_time.isoformat() if self.check_out_time else None,\n            'notes': self.notes,\n            'marked_by': self.marked_by,\n            'marker_username': self.marker.username if self.marker else None,\n            'created_at': self.created_at.isoformat() if self.created_at else None\n        }\n\n\nclass AttendanceGuest(db.Model):\n    \"\"\"Tracks guest attendance at sessions\"\"\"\n    id = db.Column(db.Integer, primary_key=True)\n    session_id = db.Column(db.Integer, db.ForeignKey('attendance_session.id'), nullable=False)\n    name = db.Column(db.String(100), nullable=False)\n    email = db.Column(db.String(255))\n    phone = db.Column(db.String(20))\n    organization = db.Column(db.String(100))  # School, company, etc.\n    check_in_time = db.Column(db.DateTime)\n    check_out_time = db.Column(db.DateTime)\n    notes = db.Column(db.Text)\n    added_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    # Relationships\n    session = db.relationship('AttendanceSession', backref=db.backref('guests', cascade='all, delete-orphan'))\n    adder = db.relationship('User', backref='added_guests')\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'session_id': self.session_id,\n            'name': self.name,\n            'email': self.email,\n            'phone': self.phone,\n            'organization': self.organization,\n            'check_in_time': self.check_in_time.isoformat() if self.check_in_time else None,\n            'check_out_time': self.check_out_time.isoformat() if self.check_out_time else None,\n            'notes': self.notes,\n            'added_by': self.added_by,\n            'added_by_username': self.adder.username if self.adder else None,\n            'created_at': self.created_at.isoformat() if self.created_at else None\n        }\n","size_bytes":6231},"app/routes/chat.py":{"content":"\"\"\"\nChat routes blueprint for the Hack Club Dashboard.\nHandles club chat messaging and image uploads.\n\"\"\"\n\nfrom flask import Blueprint, jsonify, request, current_app\nfrom datetime import datetime, timezone\nfrom extensions import db, limiter\nfrom app.decorators.auth import login_required\nfrom app.utils.auth_helpers import get_current_user\nfrom app.utils.sanitization import sanitize_string\nfrom app.utils.security import validate_input_with_security, get_real_ip, log_security_event\nfrom app.models.club import Club, ClubMembership\nfrom app.models.chat import ClubChatMessage\nfrom app.models.user import User\n\nchat_bp = Blueprint('chat', __name__)\n\n\n@chat_bp.route('/api/club/<int:club_id>/chat/messages', methods=['GET', 'POST'])\n@login_required\n@limiter.limit(\"60 per minute\")\ndef chat_messages(club_id):\n    \"\"\"Get or post chat messages for a club\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a member\n    membership = ClubMembership.query.filter_by(\n        club_id=club_id,\n        user_id=user.id\n    ).first()\n\n    if not membership:\n        return jsonify({'error': 'Not authorized'}), 403\n\n    if request.method == 'GET':\n        # Get messages\n        limit = request.args.get('limit', 50, type=int)\n        limit = min(limit, 100)  # Max 100 messages\n\n        before_id = request.args.get('before', type=int)\n\n        query = ClubChatMessage.query.filter_by(club_id=club_id)\n\n        if before_id:\n            query = query.filter(ClubChatMessage.id < before_id)\n\n        messages = query.order_by(\n            ClubChatMessage.created_at.desc()\n        ).limit(limit).all()\n\n        # Reverse to get chronological order\n        messages.reverse()\n\n        messages_data = []\n        for msg in messages:\n            messages_data.append({\n                'id': msg.id,\n                'user_id': msg.user_id,\n                'username': msg.user.username,\n                'first_name': msg.user.first_name,\n                'last_name': msg.user.last_name,\n                'message': msg.message,\n                'image_url': msg.image_url,\n                'created_at': msg.created_at.isoformat() if msg.created_at else None\n            })\n\n        return jsonify({\n            'success': True,\n            'messages': messages_data,\n            'club_id': club_id,\n            'club_name': club.name\n        })\n\n    elif request.method == 'POST':\n        # Post a new message\n        data = request.get_json()\n        message_text = data.get('message', '').strip()\n        image_url = data.get('image_url', '').strip()\n\n        if not message_text and not image_url:\n            return jsonify({'error': 'Message or image required'}), 400\n\n        # Validate message content\n        if message_text:\n            # Use security validation\n            is_valid, validated_message = validate_input_with_security(\n                message_text,\n                field_name='chat_message',\n                user=user,\n                max_length=2000\n            )\n\n            if not is_valid:\n                return jsonify({'error': validated_message}), 400\n\n            message_text = validated_message\n\n        # Create message\n        chat_message = ClubChatMessage(\n            club_id=club_id,\n            user_id=user.id,\n            message=message_text,\n            image_url=image_url\n        )\n\n        db.session.add(chat_message)\n        db.session.commit()\n\n        return jsonify({\n            'success': True,\n            'message': {\n                'id': chat_message.id,\n                'user_id': chat_message.user_id,\n                'username': user.username,\n                'first_name': user.first_name,\n                'last_name': user.last_name,\n                'message': chat_message.message,\n                'image_url': chat_message.image_url,\n                'created_at': chat_message.created_at.isoformat() if chat_message.created_at else None\n            }\n        }), 201\n\n\n@chat_bp.route('/api/club/<int:club_id>/chat/messages/<int:message_id>', methods=['PUT', 'DELETE'])\n@login_required\n@limiter.limit(\"30 per minute\")\ndef chat_message_operations(club_id, message_id):\n    \"\"\"Edit or delete a chat message\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a member\n    membership = ClubMembership.query.filter_by(\n        club_id=club_id,\n        user_id=user.id\n    ).first()\n\n    if not membership:\n        return jsonify({'error': 'Not authorized'}), 403\n\n    # Get the message\n    message = ClubChatMessage.query.filter_by(\n        id=message_id,\n        club_id=club_id\n    ).first_or_404()\n\n    # Verify user owns the message or is a leader\n    is_leader = (user.id == club.leader_id or user.id == club.co_leader_id)\n    if message.user_id != user.id and not is_leader and not user.is_admin:\n        return jsonify({'error': 'Not authorized to modify this message'}), 403\n\n    if request.method == 'PUT':\n        # Edit message\n        data = request.get_json()\n        new_message_text = data.get('message', '').strip()\n\n        if not new_message_text:\n            return jsonify({'error': 'Message text required'}), 400\n\n        # Validate message content\n        is_valid, validated_message = validate_input_with_security(\n            new_message_text,\n            field_name='chat_message',\n            user=user,\n            max_length=2000\n        )\n\n        if not is_valid:\n            return jsonify({'error': validated_message}), 400\n\n        message.message = validated_message\n\n        db.session.commit()\n\n        return jsonify({\n            'success': True,\n            'message': {\n                'id': message.id,\n                'message': message.message,\n                'created_at': message.created_at.isoformat() if message.created_at else None\n            }\n        })\n\n    elif request.method == 'DELETE':\n        # Delete message\n        db.session.delete(message)\n        db.session.commit()\n\n        # Log deletion\n        log_security_event(\n            'CHAT_MESSAGE_DELETED',\n            f'User {user.username} deleted message {message_id} in club {club_id}',\n            user_id=user.id,\n            ip_address=get_real_ip()\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Message deleted'\n        })\n\n\n@chat_bp.route('/api/club/<int:club_id>/chat/upload-image', methods=['POST'])\n@login_required\n@limiter.limit(\"10 per minute\")\ndef upload_chat_image(club_id):\n    \"\"\"Upload an image for chat to Hack Club CDN\"\"\"\n    from app.utils.cdn_helpers import upload_to_hackclub_cdn, parse_base64_images\n    from werkzeug.utils import secure_filename\n\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a member (or admin)\n    membership = ClubMembership.query.filter_by(\n        club_id=club_id,\n        user_id=user.id\n    ).first()\n\n    is_admin_access = request.args.get('admin') == 'true' and user.is_admin\n\n    if not membership and not is_admin_access:\n        return jsonify({'error': 'Not authorized'}), 403\n\n    max_size = 10 * 1024 * 1024  # 10MB for chat images\n    image_data_list = []\n\n    # Check if JSON with base64 image\n    if request.is_json:\n        data = request.get_json()\n        if not data or 'image' not in data:\n            return jsonify({'error': 'No image provided'}), 400\n\n        base64_image = data['image']\n        if not base64_image or not isinstance(base64_image, str):\n            return jsonify({'error': 'Invalid image data'}), 400\n\n        # Parse single base64 image\n        image_data_list = parse_base64_images([base64_image], max_size=max_size)\n\n    else:\n        # Check if file was uploaded\n        if 'image' not in request.files:\n            return jsonify({'error': 'No image file provided'}), 400\n\n        file = request.files['image']\n\n        if file.filename == '':\n            return jsonify({'error': 'No file selected'}), 400\n\n        # Validate file type\n        allowed_extensions = {'png', 'jpg', 'jpeg', 'gif', 'webp'}\n        if not ('.' in file.filename and file.filename.rsplit('.', 1)[1].lower() in allowed_extensions):\n            return jsonify({'error': 'Invalid file type. Allowed: PNG, JPG, GIF, WEBP'}), 400\n\n        # Read file data\n        try:\n            file.seek(0)\n            image_data = file.read()\n\n            if len(image_data) > max_size:\n                return jsonify({'error': 'Image too large. Maximum size: 10MB'}), 400\n\n            ext = '.' + file.filename.rsplit('.', 1)[1].lower()\n            image_data_list = [(image_data, ext)]\n\n        except Exception as e:\n            current_app.logger.error(f'Error reading uploaded file: {str(e)}')\n            return jsonify({'error': 'Failed to process image'}), 500\n\n    if not image_data_list:\n        return jsonify({'error': 'No valid image provided'}), 400\n\n    # Upload to Hack Club CDN\n    success, result = upload_to_hackclub_cdn(image_data_list)\n\n    if not success:\n        return jsonify({'error': result}), 500\n\n    cdn_urls = result\n    image_url = cdn_urls[0]  # Single image for chat\n\n    current_app.logger.info(f'User {user.username} uploaded chat image to CDN: {image_url}')\n\n    return jsonify({\n        'success': True,\n        'image_url': image_url\n    })\n","size_bytes":9278},"app/utils/formatting.py":{"content":"\"\"\"\nFormatting utilities for the Hack Club Dashboard.\nContains functions for markdown conversion and template filters.\n\"\"\"\n\nimport markdown\nfrom markdown.extensions import codehilite\nimport bleach\n\n\ndef markdown_to_html(markdown_content):\n    \"\"\"Convert markdown to safe HTML for club posts\"\"\"\n    if not markdown_content:\n        return \"\"\n\n    # Configure markdown with safe extensions\n    md = markdown.Markdown(extensions=['extra', 'codehilite', 'nl2br'],\n                          extension_configs={\n                              'codehilite': {\n                                  'css_class': 'highlight',\n                                  'use_pygments': False\n                              }\n                          })\n\n    # Convert markdown to HTML\n    html_content = md.convert(markdown_content)\n\n    # Define allowed HTML tags and attributes for club posts\n    allowed_tags = [\n        'p', 'br', 'strong', 'b', 'em', 'i', 'u', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',\n        'ul', 'ol', 'li', 'blockquote', 'code', 'pre', 'a', 'img',\n        'table', 'thead', 'tbody', 'tr', 'th', 'td', 'hr', 'del', 'ins'\n    ]\n\n    allowed_attributes = {\n        'a': ['href', 'title'],\n        'img': ['src', 'alt', 'title', 'width', 'height'],\n        'code': ['class'],\n        'pre': ['class'],\n        'th': ['align'],\n        'td': ['align']\n    }\n\n    # Clean HTML with bleach to prevent XSS\n    clean_html = bleach.clean(html_content,\n                             tags=allowed_tags,\n                             attributes=allowed_attributes,\n                             protocols=['http', 'https', 'mailto'])\n\n    return clean_html\n\n\n# Template filters - these will be registered with the Flask app\ndef safe_css_color_filter(value):\n    \"\"\"Template filter for safe CSS color output\"\"\"\n    from .sanitization import sanitize_css_color\n    return sanitize_css_color(value)\n\n\ndef safe_css_value_filter(value):\n    \"\"\"Template filter for safe CSS value output\"\"\"\n    from .sanitization import sanitize_css_value\n    return sanitize_css_value(value)\n\n\ndef safe_html_attr_filter(value):\n    \"\"\"Template filter for safe HTML attribute output\"\"\"\n    from .sanitization import sanitize_html_attribute\n    return sanitize_html_attribute(value)\n\n\ndef safe_url_filter(value):\n    \"\"\"Template filter for safe URL output\"\"\"\n    from .sanitization import sanitize_url\n    return sanitize_url(value)\n","size_bytes":2390},"app/routes/attendance.py":{"content":"\"\"\"\nAttendance routes blueprint for the Hack Club Dashboard.\nHandles attendance session management, tracking, and reporting.\n\"\"\"\n\nfrom flask import Blueprint, jsonify, request, send_file\nfrom datetime import datetime, timezone\nfrom io import StringIO, BytesIO\nimport csv\nfrom extensions import db, limiter\nfrom app.decorators.auth import login_required\nfrom app.utils.auth_helpers import get_current_user\nfrom app.utils.club_helpers import verify_club_leadership\nfrom app.utils.sanitization import sanitize_string\nfrom app.models.club import Club, ClubMembership\nfrom app.models.attendance import AttendanceSession, AttendanceRecord, AttendanceGuest\nfrom app.models.user import User\n\nattendance_bp = Blueprint('attendance', __name__)\n\n\n@attendance_bp.route('/api/clubs/<int:club_id>/attendance/sessions', methods=['GET', 'POST'])\n@login_required\n@limiter.limit(\"60 per minute\")\ndef attendance_sessions(club_id):\n    \"\"\"Get or create attendance sessions\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a leader\n    if not verify_club_leadership(club, user):\n        return jsonify({'error': 'Only club leaders can manage attendance sessions'}), 403\n\n    if request.method == 'GET':\n        # Get all sessions for the club\n        sessions = AttendanceSession.query.filter_by(\n            club_id=club_id\n        ).order_by(AttendanceSession.session_date.desc()).all()\n\n        sessions_data = []\n        for session in sessions:\n            sessions_data.append({\n                'id': session.id,\n                'title': session.title,\n                'session_date': session.session_date.isoformat() if session.session_date else None,\n                'location': session.location,\n                'notes': session.notes,\n                'is_active': session.is_active,\n                'created_by': session.created_by,\n                'created_at': session.created_at.isoformat() if session.created_at else None\n            })\n\n        return jsonify({\n            'success': True,\n            'sessions': sessions_data,\n            'total': len(sessions_data)\n        })\n\n    elif request.method == 'POST':\n        # Create a new session\n        data = request.get_json()\n\n        title = sanitize_string(data.get('title', ''), max_length=200)\n        session_date_str = data.get('session_date')\n        location = sanitize_string(data.get('location', ''), max_length=200)\n        notes = sanitize_string(data.get('notes', ''), max_length=1000)\n\n        if not title:\n            return jsonify({'error': 'Session title is required'}), 400\n\n        # Parse session date\n        if session_date_str:\n            try:\n                session_date = datetime.fromisoformat(session_date_str.replace('Z', '+00:00'))\n            except ValueError:\n                return jsonify({'error': 'Invalid date format'}), 400\n        else:\n            session_date = datetime.now(timezone.utc)\n\n        # Create session\n        session = AttendanceSession(\n            club_id=club_id,\n            title=title,\n            session_date=session_date,\n            location=location,\n            notes=notes,\n            is_active=True,\n            created_by=user.id\n        )\n\n        db.session.add(session)\n        db.session.commit()\n\n        return jsonify({\n            'success': True,\n            'session': {\n                'id': session.id,\n                'title': session.title,\n                'session_date': session.session_date.isoformat() if session.session_date else None,\n                'location': session.location,\n                'notes': session.notes,\n                'is_active': session.is_active\n            }\n        }), 201\n\n\n@attendance_bp.route('/api/clubs/<int:club_id>/attendance/sessions/<int:session_id>', methods=['GET', 'PUT', 'DELETE'])\n@login_required\n@limiter.limit(\"60 per minute\")\ndef attendance_session_operations(club_id, session_id):\n    \"\"\"Get, update, or delete an attendance session\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a leader\n    if not verify_club_leadership(club, user):\n        return jsonify({'error': 'Only club leaders can manage attendance sessions'}), 403\n\n    session = AttendanceSession.query.filter_by(\n        id=session_id,\n        club_id=club_id\n    ).first_or_404()\n\n    if request.method == 'GET':\n        # Get session details with attendance records\n        records = AttendanceRecord.query.filter_by(session_id=session_id).all()\n        guests = AttendanceGuest.query.filter_by(session_id=session_id).all()\n\n        records_data = []\n        for record in records:\n            records_data.append({\n                'id': record.id,\n                'user_id': record.user_id,\n                'username': record.user.username if record.user else None,\n                'first_name': record.user.first_name if record.user else None,\n                'last_name': record.user.last_name if record.user else None,\n                'checked_in_at': record.checked_in_at.isoformat() if record.checked_in_at else None\n            })\n\n        guests_data = []\n        for guest in guests:\n            guests_data.append({\n                'id': guest.id,\n                'name': guest.name,\n                'email': guest.email,\n                'checked_in_at': guest.checked_in_at.isoformat() if guest.checked_in_at else None\n            })\n\n        return jsonify({\n            'success': True,\n            'session': {\n                'id': session.id,\n                'title': session.title,\n                'session_date': session.session_date.isoformat() if session.session_date else None,\n                'location': session.location,\n                'notes': session.notes,\n                'is_active': session.is_active\n            },\n            'members': records_data,\n            'guests': guests_data,\n            'total_attendance': len(records_data) + len(guests_data)\n        })\n\n    elif request.method == 'PUT':\n        # Update session\n        data = request.get_json()\n\n        if 'title' in data:\n            session.title = sanitize_string(data['title'], max_length=200)\n        if 'session_date' in data:\n            try:\n                session.session_date = datetime.fromisoformat(data['session_date'].replace('Z', '+00:00'))\n            except ValueError:\n                return jsonify({'error': 'Invalid date format'}), 400\n        if 'location' in data:\n            session.location = sanitize_string(data['location'], max_length=200)\n        if 'notes' in data:\n            session.notes = sanitize_string(data['notes'], max_length=1000)\n        if 'is_active' in data:\n            session.is_active = bool(data['is_active'])\n\n        db.session.commit()\n\n        return jsonify({\n            'success': True,\n            'session': {\n                'id': session.id,\n                'title': session.title,\n                'session_date': session.session_date.isoformat() if session.session_date else None,\n                'location': session.location,\n                'notes': session.notes,\n                'is_active': session.is_active\n            }\n        })\n\n    elif request.method == 'DELETE':\n        # Delete session (and all associated records)\n        db.session.delete(session)\n        db.session.commit()\n\n        return jsonify({\n            'success': True,\n            'message': 'Session deleted'\n        })\n\n\n@attendance_bp.route('/api/clubs/<int:club_id>/attendance/sessions/<int:session_id>/attendance', methods=['POST'])\n@login_required\n@limiter.limit(\"100 per minute\")\ndef mark_attendance(club_id, session_id):\n    \"\"\"Mark attendance for a member\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a member or leader\n    membership = ClubMembership.query.filter_by(\n        club_id=club_id,\n        user_id=user.id\n    ).first()\n\n    if not membership:\n        return jsonify({'error': 'Not a member of this club'}), 403\n\n    session = AttendanceSession.query.filter_by(\n        id=session_id,\n        club_id=club_id\n    ).first_or_404()\n\n    data = request.get_json()\n    user_id_to_mark = data.get('user_id', user.id)\n\n    # Only leaders can mark attendance for others\n    is_leader = (user.id == session.club.leader_id or user.id == session.club.co_leader_id)\n    if user_id_to_mark != user.id and not is_leader and not user.is_admin:\n        return jsonify({'error': 'Only leaders can mark attendance for others'}), 403\n\n    # Check if already marked\n    existing_record = AttendanceRecord.query.filter_by(\n        session_id=session_id,\n        user_id=user_id_to_mark\n    ).first()\n\n    if existing_record:\n        return jsonify({'error': 'Attendance already marked'}), 400\n\n    # Create attendance record\n    record = AttendanceRecord(\n        session_id=session_id,\n        user_id=user_id_to_mark,\n        checked_in_at=datetime.now(timezone.utc),\n        checked_in_by=user.id\n    )\n\n    db.session.add(record)\n    db.session.commit()\n\n    marked_user = User.query.get(user_id_to_mark)\n\n    return jsonify({\n        'success': True,\n        'record': {\n            'id': record.id,\n            'user_id': record.user_id,\n            'username': marked_user.username if marked_user else None,\n            'checked_in_at': record.checked_in_at.isoformat() if record.checked_in_at else None\n        }\n    }), 201\n\n\n@attendance_bp.route('/api/clubs/<int:club_id>/attendance/sessions/<int:session_id>/guests', methods=['POST'])\n@login_required\n@limiter.limit(\"60 per minute\")\ndef add_guest(club_id, session_id):\n    \"\"\"Add a guest to attendance\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a leader\n    if not verify_club_leadership(club, user):\n        return jsonify({'error': 'Only club leaders can add guests'}), 403\n\n    session = AttendanceSession.query.filter_by(\n        id=session_id,\n        club_id=club_id\n    ).first_or_404()\n\n    data = request.get_json()\n    guest_name = sanitize_string(data.get('name', ''), max_length=100)\n    guest_email = sanitize_string(data.get('email', ''), max_length=120)\n\n    if not guest_name:\n        return jsonify({'error': 'Guest name is required'}), 400\n\n    # Create guest record\n    guest = AttendanceGuest(\n        session_id=session_id,\n        name=guest_name,\n        email=guest_email,\n        checked_in_at=datetime.now(timezone.utc),\n        added_by=user.id\n    )\n\n    db.session.add(guest)\n    db.session.commit()\n\n    return jsonify({\n        'success': True,\n        'guest': {\n            'id': guest.id,\n            'name': guest.name,\n            'email': guest.email,\n            'checked_in_at': guest.checked_in_at.isoformat() if guest.checked_in_at else None\n        }\n    }), 201\n\n\n@attendance_bp.route('/api/clubs/<int:club_id>/attendance/records/<int:record_id>', methods=['DELETE'])\n@login_required\ndef delete_attendance_record(club_id, record_id):\n    \"\"\"Delete an attendance record\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a leader\n    if not verify_club_leadership(club, user):\n        return jsonify({'error': 'Only club leaders can delete attendance records'}), 403\n\n    record = AttendanceRecord.query.get_or_404(record_id)\n\n    # Verify record belongs to a session in this club\n    if record.session.club_id != club_id:\n        return jsonify({'error': 'Record not found in this club'}), 404\n\n    db.session.delete(record)\n    db.session.commit()\n\n    return jsonify({\n        'success': True,\n        'message': 'Attendance record deleted'\n    })\n\n\n@attendance_bp.route('/api/clubs/<int:club_id>/attendance/guests/<int:guest_id>', methods=['DELETE'])\n@login_required\ndef delete_guest(club_id, guest_id):\n    \"\"\"Delete a guest record\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a leader\n    if not verify_club_leadership(club, user):\n        return jsonify({'error': 'Only club leaders can delete guests'}), 403\n\n    guest = AttendanceGuest.query.get_or_404(guest_id)\n\n    # Verify guest belongs to a session in this club\n    if guest.session.club_id != club_id:\n        return jsonify({'error': 'Guest not found in this club'}), 404\n\n    db.session.delete(guest)\n    db.session.commit()\n\n    return jsonify({\n        'success': True,\n        'message': 'Guest deleted'\n    })\n\n\n@attendance_bp.route('/api/clubs/<int:club_id>/attendance/reports', methods=['GET'])\n@login_required\ndef attendance_reports(club_id):\n    \"\"\"Get attendance reports for a club\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a leader\n    if not verify_club_leadership(club, user):\n        return jsonify({'error': 'Only club leaders can view reports'}), 403\n\n    # Get all sessions\n    sessions = AttendanceSession.query.filter_by(club_id=club_id).all()\n\n    # Calculate attendance statistics\n    total_sessions = len(sessions)\n    total_attendees = 0\n    member_attendance = {}\n\n    for session in sessions:\n        records = AttendanceRecord.query.filter_by(session_id=session.id).all()\n        total_attendees += len(records)\n\n        for record in records:\n            if record.user_id not in member_attendance:\n                member_attendance[record.user_id] = {\n                    'user': record.user,\n                    'sessions_attended': 0\n                }\n            member_attendance[record.user_id]['sessions_attended'] += 1\n\n    # Format member attendance\n    members_data = []\n    for user_id, data in member_attendance.items():\n        user_obj = data['user']\n        members_data.append({\n            'user_id': user_id,\n            'username': user_obj.username,\n            'first_name': user_obj.first_name,\n            'last_name': user_obj.last_name,\n            'sessions_attended': data['sessions_attended'],\n            'attendance_rate': (data['sessions_attended'] / total_sessions * 100) if total_sessions > 0 else 0\n        })\n\n    # Sort by attendance\n    members_data.sort(key=lambda x: x['sessions_attended'], reverse=True)\n\n    return jsonify({\n        'success': True,\n        'total_sessions': total_sessions,\n        'average_attendance': total_attendees / total_sessions if total_sessions > 0 else 0,\n        'members': members_data\n    })\n\n\n@attendance_bp.route('/api/clubs/<int:club_id>/attendance/export', methods=['GET'])\n@login_required\ndef export_attendance(club_id):\n    \"\"\"Export attendance data as CSV\"\"\"\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    # Verify user is a leader\n    if not verify_club_leadership(club, user):\n        return jsonify({'error': 'Only club leaders can export attendance'}), 403\n\n    # Get all sessions with records\n    sessions = AttendanceSession.query.filter_by(club_id=club_id).order_by(\n        AttendanceSession.session_date.desc()\n    ).all()\n\n    # Create CSV\n    output = StringIO()\n    writer = csv.writer(output)\n\n    # Write header\n    writer.writerow(['Session Date', 'Session Title', 'Attendee Name', 'Attendee Email', 'Type', 'Checked In At'])\n\n    # Write data\n    for session in sessions:\n        # Member records\n        records = AttendanceRecord.query.filter_by(session_id=session.id).all()\n        for record in records:\n            writer.writerow([\n                session.session_date.strftime('%Y-%m-%d') if session.session_date else '',\n                session.title,\n                f\"{record.user.first_name} {record.user.last_name}\".strip() or record.user.username,\n                record.user.email,\n                'Member',\n                record.checked_in_at.strftime('%Y-%m-%d %H:%M:%S') if record.checked_in_at else ''\n            ])\n\n        # Guest records\n        guests = AttendanceGuest.query.filter_by(session_id=session.id).all()\n        for guest in guests:\n            writer.writerow([\n                session.session_date.strftime('%Y-%m-%d') if session.session_date else '',\n                session.title,\n                guest.name,\n                guest.email or '',\n                'Guest',\n                guest.checked_in_at.strftime('%Y-%m-%d %H:%M:%S') if guest.checked_in_at else ''\n            ])\n\n    # Prepare file for download\n    output.seek(0)\n    csv_data = output.getvalue().encode('utf-8')\n    output_bytes = BytesIO(csv_data)\n\n    filename = f\"attendance_{club.name.replace(' ', '_')}_{datetime.now().strftime('%Y%m%d')}.csv\"\n\n    return send_file(\n        output_bytes,\n        mimetype='text/csv',\n        as_attachment=True,\n        download_name=filename\n    )\n\n\n@attendance_bp.route('/api/clubs/<int:club_id>/attendance/sessions/<int:session_id>/notes', methods=['POST'])\n@login_required\ndef update_session_notes(club_id, session_id):\n    \"\"\"Update notes for an attendance session\"\"\"\n    from app.models.user import create_audit_log\n    from app.utils.sanitization import sanitize_string\n\n    user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n    session = AttendanceSession.query.get_or_404(session_id)\n\n    # Verify session belongs to this club\n    if session.club_id != club_id:\n        return jsonify({'error': 'Session not found in this club'}), 404\n\n    # Verify user is a leader\n    if not verify_club_leadership(club, user):\n        return jsonify({'error': 'Only club leaders can update session notes'}), 403\n\n    data = request.get_json()\n    notes = sanitize_string(data.get('notes', ''), max_length=5000)\n\n    session.notes = notes\n    db.session.commit()\n\n    create_audit_log(\n        action_type='attendance_session_notes_update',\n        description=f'Updated notes for attendance session in {club.name}',\n        user=user,\n        target_type='attendance_session',\n        target_id=session_id,\n        category='club'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Session notes updated successfully',\n        'notes': notes\n    })\n","size_bytes":17909},"app/routes/__init__.py":{"content":"\"\"\"\nRoute blueprints for the Hack Club Dashboard.\n\nThis package contains all Flask blueprints organized by functionality:\n- main: Home, dashboard, gallery, leaderboard\n- auth: Login, signup, OAuth flows\n- clubs: Club management, shop, projects\n- admin: Admin panel, user/club management, settings\n- api: Public API endpoints, admin API\n- chat: Club chat messaging\n- attendance: Attendance tracking and reporting\n- status: Public status page\n- oauth: OAuth 2.0 authorization server\n\"\"\"\n\nfrom app.routes.main import main_bp\nfrom app.routes.auth import auth_bp\nfrom app.routes.clubs import clubs_bp\nfrom app.routes.admin import admin_bp\nfrom app.routes.api import api_bp\nfrom app.routes.chat import chat_bp\nfrom app.routes.attendance import attendance_bp\nfrom app.routes.status import status_bp\nfrom app.routes.oauth import oauth_bp\n\n__all__ = [\n    'main_bp',\n    'auth_bp',\n    'clubs_bp',\n    'admin_bp',\n    'api_bp',\n    'chat_bp',\n    'attendance_bp',\n    'status_bp',\n    'oauth_bp',\n]\n","size_bytes":990},"app/decorators/auth.py":{"content":"\"\"\"\nAuthentication decorators for the Hack Club Dashboard.\n\nThis module contains decorators for protecting routes that require authentication,\nspecific permissions, roles, or API access.\n\"\"\"\n\nfrom functools import wraps\nfrom datetime import datetime, timezone\nfrom flask import request, jsonify, flash, redirect, url_for, session\nimport logging\n\n\ndef login_required(f):\n    \"\"\"\n    Decorator to require user authentication.\n\n    Checks if the user is authenticated and not suspended before allowing access to the route.\n    For JSON requests, returns 401/403 errors. For HTML requests, redirects to login or suspended page.\n\n    Args:\n        f: The function to decorate\n\n    Returns:\n        The decorated function\n    \"\"\"\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        # Import here to avoid circular imports\n        from flask import current_app\n        from app.utils.auth_helpers import is_authenticated, get_current_user\n        from extensions import db\n        from app.models.user import User\n\n        authenticated = is_authenticated()\n        current_user = get_current_user()\n\n        current_app.logger.debug(f\"Auth check for {request.endpoint}: authenticated={authenticated}, user_id={session.get('user_id')}, logged_in={session.get('logged_in')}, current_user={current_user.username if current_user else None}\")\n\n        if not authenticated or not current_user:\n            current_app.logger.warning(f\"Authentication failed for {request.endpoint}: user_id={session.get('user_id')}, logged_in={session.get('logged_in')}\")\n            if request.is_json:\n                return jsonify({'error': 'Authentication required'}), 401\n            flash('Please log in to access this page.', 'info')\n            return redirect(url_for('auth.login'))\n\n        # Check if user is suspended (but allow access to suspended page and logout)\n        if current_user.is_suspended and request.endpoint not in ['suspended', 'logout']:\n            if request.is_json:\n                return jsonify({'error': 'Account suspended'}), 403\n            return redirect(url_for('suspended'))\n\n        return f(*args, **kwargs)\n    return decorated_function\n\n\ndef permission_required(*permissions):\n    \"\"\"\n    Decorator to check if user has specific permissions.\n\n    Checks if the authenticated user has at least one of the specified permissions.\n    Uses the RBAC (Role-Based Access Control) system.\n\n    Args:\n        *permissions: Variable number of permission names to check\n\n    Returns:\n        A decorator function\n    \"\"\"\n    def decorator(f):\n        @wraps(f)\n        def decorated_function(*args, **kwargs):\n            # Import here to avoid circular imports\n            from app.utils.auth_helpers import is_authenticated, get_current_user\n            from flask import current_app\n            from extensions import db\n            from app.models.user import User\n\n            authenticated = is_authenticated()\n            current_user = get_current_user()\n\n            if not authenticated or not current_user:\n                if request.is_json:\n                    return jsonify({'error': 'Authentication required'}), 401\n                flash('Please log in to access this page.', 'info')\n                return redirect(url_for('auth.login'))\n\n            # Check if user has at least one of the required permissions\n            has_permission = False\n            for perm in permissions:\n                if current_user.has_permission(perm):\n                    has_permission = True\n                    break\n\n            if not has_permission:\n                if request.is_json:\n                    return jsonify({'error': 'Insufficient permissions'}), 403\n                flash('You do not have permission to access this resource.', 'error')\n                return redirect(url_for('main.index'))\n\n            return f(*args, **kwargs)\n        return decorated_function\n    return decorator\n\n\ndef role_required(*roles):\n    \"\"\"\n    Decorator to check if user has specific roles.\n\n    Checks if the authenticated user has at least one of the specified roles.\n    Uses the RBAC (Role-Based Access Control) system.\n\n    Args:\n        *roles: Variable number of role names to check\n\n    Returns:\n        A decorator function\n    \"\"\"\n    def decorator(f):\n        @wraps(f)\n        def decorated_function(*args, **kwargs):\n            # Import here to avoid circular imports\n            from app.utils.auth_helpers import is_authenticated, get_current_user\n            from flask import current_app\n            from extensions import db\n            from app.models.user import User\n\n            authenticated = is_authenticated()\n            current_user = get_current_user()\n\n            if not authenticated or not current_user:\n                if request.is_json:\n                    return jsonify({'error': 'Authentication required'}), 401\n                flash('Please log in to access this page.', 'info')\n                return redirect(url_for('auth.login'))\n\n            # Check if user has at least one of the required roles\n            has_role = False\n            for role in roles:\n                if current_user.has_role(role):\n                    has_role = True\n                    break\n\n            if not has_role:\n                if request.is_json:\n                    return jsonify({'error': 'Insufficient permissions'}), 403\n                flash('You do not have permission to access this resource.', 'error')\n                return redirect(url_for('main.index'))\n\n            return f(*args, **kwargs)\n        return decorated_function\n    return decorator\n\n\ndef admin_required(f):\n    \"\"\"\n    Admin access decorator - checks for RBAC admin permissions.\n\n    Checks if the user has admin-level permissions through the RBAC system.\n    Accepts users with 'admin.access_dashboard' permission or specific admin roles.\n\n    Args:\n        f: The function to decorate\n\n    Returns:\n        The decorated function\n    \"\"\"\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        # Import here to avoid circular imports\n        from app.utils.auth_helpers import is_authenticated, get_current_user\n        from flask import current_app\n        from extensions import db\n        from app.models.user import User\n\n        authenticated = is_authenticated()\n        current_user = get_current_user()\n\n        if not authenticated or not current_user:\n            if request.is_json:\n                return jsonify({'error': 'Authentication required'}), 401\n            flash('Please log in to access this page.', 'info')\n            return redirect(url_for('auth.login'))\n\n        # Check RBAC permissions\n        has_admin_access = (\n            current_user.has_permission('admin.access_dashboard') or\n            current_user.has_role('super-admin') or\n            current_user.has_role('admin') or\n            current_user.has_role('users-admin')\n        )\n\n        if not has_admin_access:\n            if request.is_json:\n                return jsonify({'error': 'Admin access required'}), 403\n            flash('Admin access required', 'error')\n            return redirect(url_for('main.index'))\n\n        return f(*args, **kwargs)\n    return decorated_function\n\n\ndef reviewer_required(f):\n    \"\"\"\n    Reviewer access decorator - checks for RBAC reviewer permissions.\n\n    Checks if the user has reviewer-level permissions through the RBAC system.\n    Accepts users with 'reviews.submit' permission or specific reviewer/admin roles.\n\n    Args:\n        f: The function to decorate\n\n    Returns:\n        The decorated function\n    \"\"\"\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        # Import here to avoid circular imports\n        from app.utils.auth_helpers import is_authenticated, get_current_user\n        from flask import current_app\n        from extensions import db\n        from app.models.user import User\n\n        authenticated = is_authenticated()\n        current_user = get_current_user()\n\n        if not authenticated or not current_user:\n            if request.is_json:\n                return jsonify({'error': 'Authentication required'}), 401\n            flash('Please log in to access this page.', 'info')\n            return redirect(url_for('auth.login'))\n\n        # Check RBAC permissions\n        has_reviewer_access = (\n            current_user.has_permission('reviews.submit') or\n            current_user.has_role('super-admin') or\n            current_user.has_role('admin') or\n            current_user.has_role('reviewer')\n        )\n\n        if not has_reviewer_access:\n            if request.is_json:\n                return jsonify({'error': 'Reviewer access required'}), 403\n            flash('Reviewer access required', 'error')\n            return redirect(url_for('main.index'))\n\n        return f(*args, **kwargs)\n    return decorated_function\n\n\ndef api_key_required(scopes=None):\n    \"\"\"\n    Decorator to require API key authentication.\n\n    Validates API key from Authorization header (Bearer token format).\n    Optionally checks if the API key has required scopes.\n    Updates the key's last_used_at timestamp on successful authentication.\n\n    Args:\n        scopes: Optional list of required scopes\n\n    Returns:\n        A decorator function\n\n    Usage:\n        @api_key_required(scopes=['read', 'write'])\n        def protected_endpoint():\n            # Access request.api_key to get the validated API key object\n            pass\n    \"\"\"\n    def decorator(f):\n        @wraps(f)\n        def decorated_function(*args, **kwargs):\n            # Import here to avoid circular imports\n            from flask import current_app\n            from extensions import db\n            from app.models.auth import APIKey\n\n            auth_header = request.headers.get('Authorization')\n            if not auth_header:\n                return jsonify({\n                    'error': 'Missing Authorization header',\n                    'error_code': 'MISSING_AUTH_HEADER',\n                    'message': 'The Authorization header is required for API access',\n                    'how_to_fix': 'Include the Authorization header in your request: \"Authorization: Bearer YOUR_API_KEY\"'\n                }), 401\n\n            if not auth_header.startswith('Bearer '):\n                return jsonify({\n                    'error': 'Invalid Authorization header format',\n                    'error_code': 'INVALID_AUTH_FORMAT',\n                    'message': 'Authorization header must use Bearer token format',\n                    'how_to_fix': 'Use the format: \"Authorization: Bearer YOUR_API_KEY\"',\n                    'received': f'Authorization: {auth_header[:50]}...' if len(auth_header) > 50 else f'Authorization: {auth_header}'\n                }), 401\n\n            try:\n                api_key = auth_header.split(' ')[1]\n            except IndexError:\n                return jsonify({\n                    'error': 'Malformed Authorization header',\n                    'error_code': 'MALFORMED_AUTH_HEADER',\n                    'message': 'Authorization header is missing the API key',\n                    'how_to_fix': 'Ensure your header follows the format: \"Authorization: Bearer YOUR_API_KEY\"'\n                }), 401\n\n            if not api_key or len(api_key) < 10:\n                return jsonify({\n                    'error': 'Invalid API key format',\n                    'error_code': 'INVALID_KEY_FORMAT',\n                    'message': 'API key appears to be malformed or too short',\n                    'how_to_fix': 'Ensure you are using the complete API key provided by your administrator'\n                }), 401\n\n            key_obj = APIKey.query.filter_by(key=api_key, is_active=True).first()\n\n            if not key_obj:\n                # Check if key exists but is inactive\n                inactive_key = APIKey.query.filter_by(key=api_key, is_active=False).first()\n                if inactive_key:\n                    return jsonify({\n                        'error': 'API key is disabled',\n                        'error_code': 'KEY_DISABLED',\n                        'message': 'This API key has been disabled by an administrator',\n                        'how_to_fix': 'Contact your administrator to reactivate the API key or request a new one'\n                    }), 401\n                else:\n                    return jsonify({\n                        'error': 'Invalid API key',\n                        'error_code': 'INVALID_API_KEY',\n                        'message': 'The provided API key does not exist or has been revoked',\n                        'how_to_fix': 'Verify your API key is correct, or contact your administrator for a new one'\n                    }), 401\n\n            # Check scopes if provided\n            if scopes:\n                key_scopes = key_obj.get_scopes()\n                if not any(scope in key_scopes for scope in scopes):\n                    return jsonify({\n                        'error': 'Insufficient permissions',\n                        'error_code': 'INSUFFICIENT_SCOPES',\n                        'message': f'API key does not have required scopes: {\", \".join(scopes)}',\n                        'required_scopes': scopes,\n                        'available_scopes': key_scopes,\n                        'how_to_fix': 'Contact your administrator to add the required scopes to your API key'\n                    }), 403\n\n            # Update last used timestamp\n            try:\n                key_obj.last_used_at = datetime.now(timezone.utc)\n                db.session.commit()\n            except Exception as e:\n                current_app.logger.error(f\"Failed to update API key last_used_at: {e}\")\n\n            # Add key info to request context\n            request.api_key = key_obj\n            return f(*args, **kwargs)\n        return decorated_function\n    return decorator\n\n\ndef oauth_required(scopes=None):\n    \"\"\"\n    Decorator to require OAuth token authentication.\n\n    Validates OAuth access token from Authorization header (Bearer token format).\n    Checks token expiration and optionally validates required scopes.\n\n    Args:\n        scopes: Optional list of required OAuth scopes\n\n    Returns:\n        A decorator function\n\n    Usage:\n        @oauth_required(scopes=['read:user', 'write:posts'])\n        def protected_endpoint():\n            # Access request.oauth_token and request.oauth_user for validated objects\n            pass\n    \"\"\"\n    def decorator(f):\n        @wraps(f)\n        def decorated_function(*args, **kwargs):\n            # Import here to avoid circular imports\n            from flask import current_app\n            from extensions import db\n            from app.models.auth import OAuthToken\n\n            auth_header = request.headers.get('Authorization')\n            if not auth_header:\n                return jsonify({\n                    'error': 'Missing Authorization header',\n                    'error_code': 'MISSING_AUTH_HEADER',\n                    'message': 'OAuth access token is required',\n                    'how_to_fix': 'Include the Authorization header: \"Authorization: Bearer YOUR_ACCESS_TOKEN\"'\n                }), 401\n\n            if not auth_header.startswith('Bearer '):\n                return jsonify({\n                    'error': 'Invalid Authorization header format',\n                    'error_code': 'INVALID_AUTH_FORMAT',\n                    'message': 'Authorization header must use Bearer token format for OAuth',\n                    'how_to_fix': 'Use the format: \"Authorization: Bearer YOUR_ACCESS_TOKEN\"',\n                    'received': f'Authorization: {auth_header[:50]}...' if len(auth_header) > 50 else f'Authorization: {auth_header}'\n                }), 401\n\n            try:\n                access_token = auth_header.split(' ')[1]\n            except IndexError:\n                return jsonify({\n                    'error': 'Malformed Authorization header',\n                    'error_code': 'MALFORMED_AUTH_HEADER',\n                    'message': 'Authorization header is missing the access token',\n                    'how_to_fix': 'Ensure your header follows the format: \"Authorization: Bearer YOUR_ACCESS_TOKEN\"'\n                }), 401\n\n            if not access_token or len(access_token) < 10:\n                return jsonify({\n                    'error': 'Invalid access token format',\n                    'error_code': 'INVALID_TOKEN_FORMAT',\n                    'message': 'Access token appears to be malformed or too short',\n                    'how_to_fix': 'Ensure you are using the complete access token from the OAuth flow'\n                }), 401\n\n            token_obj = OAuthToken.query.filter_by(\n                access_token=access_token,\n                is_active=True\n            ).first()\n\n            if not token_obj:\n                # Check if token exists but is inactive\n                inactive_token = OAuthToken.query.filter_by(access_token=access_token, is_active=False).first()\n                if inactive_token:\n                    return jsonify({\n                        'error': 'Access token revoked',\n                        'error_code': 'TOKEN_REVOKED',\n                        'message': 'This access token has been revoked',\n                        'how_to_fix': 'Obtain a new access token by repeating the OAuth authorization flow'\n                    }), 401\n                else:\n                    return jsonify({\n                        'error': 'Invalid OAuth token',\n                        'error_code': 'INVALID_ACCESS_TOKEN',\n                        'message': 'The provided access token does not exist',\n                        'how_to_fix': 'Verify your access token is correct, or obtain a new one through the OAuth flow'\n                    }), 401\n\n            # Check if token is expired\n            if token_obj.expires_at < datetime.now(timezone.utc):\n                return jsonify({\n                    'error': 'OAuth token expired',\n                    'error_code': 'TOKEN_EXPIRED',\n                    'message': f'Access token expired at {token_obj.expires_at.isoformat()}',\n                    'expires_at': token_obj.expires_at.isoformat(),\n                    'how_to_fix': 'Use your refresh token to obtain a new access token, or repeat the OAuth authorization flow'\n                }), 401\n\n            # Check scopes if provided\n            if scopes:\n                token_scopes = token_obj.get_scopes()\n                if not any(scope in token_scopes for scope in scopes):\n                    return jsonify({\n                        'error': 'Insufficient permissions',\n                        'error_code': 'INSUFFICIENT_SCOPES',\n                        'message': f'Access token does not have required scopes: {\", \".join(scopes)}',\n                        'required_scopes': scopes,\n                        'available_scopes': token_scopes,\n                        'how_to_fix': 'Request authorization with the required scopes during the OAuth flow'\n                    }), 403\n\n            # Add token and user info to request context\n            request.oauth_token = token_obj\n            request.oauth_user = token_obj.user\n            return f(*args, **kwargs)\n        return decorated_function\n    return decorator\n","size_bytes":19246},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.12\"\ndependencies = [\n    \"flask>=3.1.1\",\n    \"flask-limiter>=3.12\",\n    \"flask-login>=0.6.3\",\n    \"flask-sqlalchemy>=3.1.1\",\n    \"psycopg2-binary>=2.9.10\",\n    \"requests>=2.32.3\",\n    \"werkzeug>=3.1.3\",\n]\n","size_bytes":326},"app/models/economy.py":{"content":"\"\"\"\nEconomy and quest models for club token system.\nIncludes transactions, project submissions, weekly quests, and leaderboard exclusions.\n\"\"\"\nfrom datetime import datetime, timedelta, timezone\nfrom flask import current_app\nfrom extensions import db\n\n\nclass ClubTransaction(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True)  # User who triggered the transaction\n    transaction_type = db.Column(db.String(50), nullable=False)  # 'credit', 'debit', 'grant', 'purchase', 'refund', 'manual'\n    amount = db.Column(db.Integer, nullable=False)  # Amount in tokens (positive for credits, negative for debits)\n    description = db.Column(db.Text, nullable=False)\n    balance_after = db.Column(db.Integer, nullable=False)  # Club balance after this transaction\n    reference_id = db.Column(db.String(100), nullable=True)  # Reference to related record (project_id, order_id, etc.)\n    reference_type = db.Column(db.String(50), nullable=True)  # 'project', 'shop_order', 'admin_action', etc.\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), nullable=False)\n    created_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True)  # Admin who created the transaction\n\n    # Relationships\n    club = db.relationship('Club', backref=db.backref('transactions', lazy=True, order_by='ClubTransaction.created_at.desc()'))\n    user = db.relationship('User', foreign_keys=[user_id], backref=db.backref('club_transactions', lazy=True))\n    created_by_user = db.relationship('User', foreign_keys=[created_by])\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'club_id': self.club_id,\n            'user_id': self.user_id,\n            'transaction_type': self.transaction_type,\n            'amount': self.amount,\n            'description': self.description,\n            'balance_after': self.balance_after,\n            'reference_id': self.reference_id,\n            'reference_type': self.reference_type,\n            'created_at': self.created_at.isoformat(),\n            'created_by': self.created_by,\n            'user': {\n                'id': self.user.id,\n                'username': self.user.username,\n                'first_name': self.user.first_name,\n                'last_name': self.user.last_name,\n                'email': self.user.email\n            } if self.user else None,\n            'created_by_user': {\n                'id': self.created_by_user.id,\n                'username': self.created_by_user.username,\n                'first_name': self.created_by_user.first_name,\n                'last_name': self.created_by_user.last_name,\n                'email': self.created_by_user.email\n            } if self.created_by_user else None\n        }\n\n\nclass ProjectSubmission(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    project_id = db.Column(db.Integer, db.ForeignKey('club_project.id'), nullable=True)  # Link to actual project if available\n    project_name = db.Column(db.String(200), nullable=False)\n    project_url = db.Column(db.String(500))\n    submitted_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), nullable=False)\n    approved_at = db.Column(db.DateTime)\n    approved_by = db.Column(db.Integer, db.ForeignKey('user.id'))\n\n    # Relationships\n    user = db.relationship('User', foreign_keys=[user_id], backref=db.backref('project_submissions', lazy=True))\n    club = db.relationship('Club', backref=db.backref('project_submissions', lazy=True))\n    project = db.relationship('ClubProject', backref=db.backref('submissions', lazy=True))\n    approver = db.relationship('User', foreign_keys=[approved_by], backref=db.backref('approved_submissions', lazy=True))\n\n\nclass WeeklyQuest(db.Model):\n    __tablename__ = 'weekly_quests'\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(255), nullable=False)\n    description = db.Column(db.Text, nullable=False)\n    reward_tokens = db.Column(db.Integer, nullable=False)\n    quest_type = db.Column(db.String(50), nullable=False)  # gallery_post, member_projects\n    is_active = db.Column(db.Boolean, default=True)\n    created_at = db.Column(db.DateTime, default=datetime.utcnow)\n\n\nclass ClubQuestProgress(db.Model):\n    __tablename__ = 'club_quest_progress'\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    quest_id = db.Column(db.Integer, db.ForeignKey('weekly_quests.id'), nullable=False)\n    week_start = db.Column(db.Date, nullable=False)\n    progress = db.Column(db.Integer, default=0)\n    target = db.Column(db.Integer, nullable=False)\n    completed = db.Column(db.Boolean, default=False)\n    completed_at = db.Column(db.DateTime, nullable=True)\n    reward_claimed = db.Column(db.Boolean, default=False)\n    created_at = db.Column(db.DateTime, default=datetime.utcnow)\n    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\n    club = db.relationship('Club', backref=db.backref('quest_progress', lazy=True))\n    quest = db.relationship('WeeklyQuest', backref=db.backref('progress_records', lazy=True))\n\n    __table_args__ = (db.UniqueConstraint('club_id', 'quest_id', 'week_start', name='_club_quest_week_uc'),)\n\n\nclass LeaderboardExclusion(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    leaderboard_type = db.Column(db.String(50), nullable=False)  # 'total_tokens', 'monthly_tokens', etc.\n    excluded_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    excluded_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), nullable=False)\n    reason = db.Column(db.Text)\n\n    # Relationships\n    club = db.relationship('Club', backref=db.backref('leaderboard_exclusions', lazy=True))\n    excluded_by_user = db.relationship('User', backref=db.backref('leaderboard_exclusions', lazy=True))\n\n\n# Helper functions\n\ndef create_club_transaction(club_id, transaction_type, amount, description, user_id=None, reference_id=None, reference_type=None, created_by=None):\n    \"\"\"Create a new club transaction and update the club balance\"\"\"\n    try:\n        # Import here to avoid circular dependency\n        from app.models.club import Club\n\n        # Use SELECT FOR UPDATE to lock the club record and prevent race conditions\n        club = Club.query.filter_by(id=club_id).with_for_update().first()\n        if not club:\n            return False, \"Club not found\"\n\n        # For debit transactions, check if sufficient balance exists\n        if amount < 0 and club.tokens + amount < 0:\n            return False, f\"Insufficient balance. Current: {club.tokens} tokens, Required: {abs(amount)} tokens\"\n\n        # Update club balance atomically\n        club.tokens += amount\n        # Keep balance field in sync (convert tokens to USD)\n        club.balance = club.tokens / 100.0\n\n        # Create transaction record\n        transaction = ClubTransaction(\n            club_id=club_id,\n            user_id=user_id,\n            transaction_type=transaction_type,\n            amount=amount,\n            description=description,\n            balance_after=club.tokens,\n            reference_id=reference_id,\n            reference_type=reference_type,\n            created_by=created_by\n        )\n\n        db.session.add(transaction)\n        db.session.commit()\n\n        return True, transaction\n    except Exception as e:\n        db.session.rollback()\n        return False, str(e)\n\n\ndef get_current_week_start():\n    \"\"\"Get the start of the current week (Monday)\"\"\"\n    today = datetime.now().date()\n    days_since_monday = today.weekday()\n    week_start = today - timedelta(days=days_since_monday)\n    return week_start\n\n\ndef update_quest_progress(club_id, quest_type, increment=1):\n    \"\"\"Update quest progress for a club\"\"\"\n    try:\n        # Import here to avoid circular dependency\n        from app.models.club import Club\n\n        week_start = get_current_week_start()\n\n        # Find the quest by type\n        quest = WeeklyQuest.query.filter_by(quest_type=quest_type, is_active=True).first()\n        if not quest:\n            return False, \"Quest not found\"\n\n        # Set target based on quest type\n        target = 1 if quest_type == 'gallery_post' else 5\n\n        # Get or create quest progress record\n        progress_record = ClubQuestProgress.query.filter_by(\n            club_id=club_id,\n            quest_id=quest.id,\n            week_start=week_start\n        ).first()\n\n        if not progress_record:\n            progress_record = ClubQuestProgress(\n                club_id=club_id,\n                quest_id=quest.id,\n                week_start=week_start,\n                progress=0,\n                target=target,\n                completed=False,\n                reward_claimed=False\n            )\n            db.session.add(progress_record)\n\n        # Update progress\n        progress_record.progress += increment\n        progress_record.updated_at = datetime.utcnow()\n\n        # Check if quest is completed\n        if progress_record.progress >= target and not progress_record.completed:\n            progress_record.completed = True\n            progress_record.completed_at = datetime.utcnow()\n\n            # Get club with lock to check piggy bank balance\n            club = Club.query.filter_by(id=club_id).with_for_update().first()\n            if not club:\n                current_app.logger.error(f\"Club {club_id} not found when completing quest\")\n                return False, \"Club not found\"\n\n            # Check if piggy bank has enough tokens\n            if club.piggy_bank_tokens >= quest.reward_tokens:\n                # Transfer tokens from piggy bank to regular balance\n                club.piggy_bank_tokens -= quest.reward_tokens\n\n                # Award tokens to regular balance\n                success, transaction = create_club_transaction(\n                    club_id=club_id,\n                    transaction_type='credit',\n                    amount=quest.reward_tokens,\n                    description=f'Weekly quest reward: {quest.name} (transferred from piggy bank)',\n                    reference_type='weekly_quest',\n                    reference_id=str(quest.id),\n                    created_by=None\n                )\n\n                if success:\n                    # Create piggy bank debit transaction record\n                    try:\n                        piggy_success, piggy_transaction = create_club_transaction(\n                            club_id=club_id,\n                            transaction_type='piggy_bank_debit',\n                            amount=-quest.reward_tokens,\n                            description=f'Piggy bank deduction for quest reward: {quest.name}',\n                            reference_type='weekly_quest',\n                            reference_id=str(quest.id),\n                            created_by=None\n                        )\n                        if piggy_success:\n                            progress_record.reward_claimed = True\n                            current_app.logger.info(f\"Club {club_id} completed quest {quest.name} and received {quest.reward_tokens} tokens from piggy bank (remaining piggy bank: {club.piggy_bank_tokens})\")\n                        else:\n                            current_app.logger.error(f\"Failed to record piggy bank debit transaction: {piggy_transaction}\")\n                            # Still mark as claimed since the main transaction succeeded\n                            progress_record.reward_claimed = True\n                    except Exception as piggy_error:\n                        current_app.logger.error(f\"Error recording piggy bank transaction: {str(piggy_error)}\")\n                        # Still mark as claimed since the main transaction succeeded\n                        progress_record.reward_claimed = True\n                else:\n                    # Restore piggy bank tokens if main transaction failed\n                    club.piggy_bank_tokens += quest.reward_tokens\n                    current_app.logger.error(f\"Failed to award quest tokens: {transaction}\")\n            else:\n                # Not enough tokens in piggy bank - don't award anything\n                current_app.logger.warning(f\"Club {club_id} completed quest {quest.name} but piggy bank has insufficient tokens ({club.piggy_bank_tokens} < {quest.reward_tokens}). No reward given.\")\n                # Still mark as completed but not rewarded\n                progress_record.reward_claimed = False\n\n        db.session.commit()\n        return True, \"Quest progress updated\"\n\n    except Exception as e:\n        db.session.rollback()\n        current_app.logger.error(f\"Error updating quest progress: {str(e)}\")\n        return False, str(e)\n","size_bytes":13089},"config.py":{"content":"\"\"\"\nApplication configuration.\n\"\"\"\nimport os\nimport hashlib\nfrom dotenv import load_dotenv\n\n# Load environment variables from .env file\nload_dotenv()\n\n\ndef get_database_url():\n    \"\"\"Get database URL from environment and convert old postgres:// to postgresql://\"\"\"\n    url = os.getenv('DATABASE_URL')\n    if url and url.startswith('postgres://'):\n        url = url.replace('postgres://', 'postgresql://', 1)\n    return url\n\n\ndef get_secret_key():\n    \"\"\"Get or generate secret key for Flask session management\"\"\"\n    secret_key = os.getenv('SECRET_KEY')\n    if not secret_key:\n        # In production, this should be set via environment variable\n        # For development/fallback, use a deterministic key based on database URL\n        db_url = get_database_url()\n        secret_key = hashlib.sha256(f\"hackclub-dashboard-{db_url}\".encode()).hexdigest()\n    return secret_key\n\n\nclass Config:\n    \"\"\"Base configuration\"\"\"\n    SECRET_KEY = get_secret_key()\n    SQLALCHEMY_DATABASE_URI = get_database_url()\n    SQLALCHEMY_TRACK_MODIFICATIONS = False\n\n    # Add any other configuration variables here\n    MAX_CONTENT_LENGTH = 16 * 1024 * 1024  # 16MB max file size\n","size_bytes":1160},"main.py":{"content":"\"\"\"\nHack Club Dashboard - Application Entry Point\nMain entry point for the Flask application using the modularized structure.\n\"\"\"\nimport os\nfrom app import create_app\n\n# Create the Flask application instance\napp = create_app()\n\nif __name__ == '__main__':\n    # Initialize database tables\n    from extensions import db\n    \n    try:\n        with app.app_context():\n            db.create_all()\n            app.logger.info(\"Database tables created successfully\")\n    except Exception as e:\n        app.logger.error(f\"Database setup error: {e}\")\n    \n    # Get port from environment variable or use default\n    port = int(os.getenv('PORT', 5000))\n    app.logger.info(f\"Starting Hack Club Dashboard on port {port}\")\n    \n    # Run the application\n    app.run(host='0.0.0.0', port=port, debug=os.getenv('FLASK_DEBUG', 'False').lower() == 'true')\n","size_bytes":840},"app/models/user.py":{"content":"\"\"\"\nUser and RBAC models for the application.\nIncludes User, Role, Permission, RolePermission, UserRole, and AuditLog models.\n\"\"\"\nimport json\nfrom datetime import datetime, timezone\nfrom flask import request\nfrom werkzeug.security import generate_password_hash, check_password_hash\nfrom extensions import db\n\n# Note: Some circular import issues will be resolved when we refactor utilities\n\n\ndef get_real_ip():\n    \"\"\"Get the real client IP address, accounting for proxies and load balancers\"\"\"\n    # Check common proxy headers in order of preference\n    if request.headers.get('CF-Connecting-IP'):\n        return request.headers.get('CF-Connecting-IP')\n    elif request.headers.get('X-Real-IP'):\n        return request.headers.get('X-Real-IP')\n    elif request.headers.get('X-Forwarded-For'):\n        # X-Forwarded-For can contain multiple IPs, get the first one (original client)\n        forwarded_ips = request.headers.get('X-Forwarded-For').split(',')\n        return forwarded_ips[0].strip()\n    elif request.headers.get('X-Forwarded-Proto'):\n        return request.headers.get('X-Client-IP', request.remote_addr)\n    else:\n        return request.remote_addr\n\n\nclass User(db.Model):\n    __tablename__ = 'users'\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(80), unique=True, nullable=False, index=True)\n    email = db.Column(db.String(120), unique=True, nullable=False, index=True)\n    password_hash = db.Column(db.String(255), nullable=False)\n    first_name = db.Column(db.String(50))\n    last_name = db.Column(db.String(50))\n    birthday = db.Column(db.Date)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    last_login = db.Column(db.DateTime)\n    is_suspended = db.Column(db.Boolean, default=False, nullable=False)\n    hackatime_api_key = db.Column(db.String(255))\n    slack_user_id = db.Column(db.String(255), unique=True)\n    identity_token = db.Column(db.String(500))\n    identity_verified = db.Column(db.Boolean, default=False, nullable=False)\n\n    # IP address tracking for security\n    registration_ip = db.Column(db.String(45))  # IPv6 addresses can be up to 45 chars\n    last_login_ip = db.Column(db.String(45))\n    all_ips = db.Column(db.Text)  # JSON array of all IPs used by this user\n\n    # RBAC relationships - specify foreign_keys to avoid ambiguity with assigned_by\n    roles = db.relationship('Role', secondary='user_role',\n                           primaryjoin='User.id==UserRole.user_id',\n                           secondaryjoin='Role.id==UserRole.role_id',\n                           backref='users', lazy='dynamic')\n\n    def set_password(self, password):\n        self.password_hash = generate_password_hash(password)\n\n    def check_password(self, password):\n        return check_password_hash(self.password_hash, password)\n\n    def is_root_user(self):\n        \"\"\"Check if user is the root user (ethan@hackclub.com) - cannot be demoted\"\"\"\n        return self.email == 'ethan@hackclub.com'\n\n    def has_role(self, role_name):\n        \"\"\"Check if user has a specific role\"\"\"\n        return self.roles.filter_by(name=role_name).first() is not None\n\n    def has_permission(self, permission_name):\n        \"\"\"Check if user has a specific permission through any of their roles\"\"\"\n        # Root user has all permissions\n        if self.is_root_user():\n            return True\n\n        for role in self.roles:\n            if role.has_permission(permission_name):\n                return True\n        return False\n\n    def get_all_permissions(self):\n        \"\"\"Get all permissions from all user's roles\"\"\"\n        permissions = set()\n        for role in self.roles:\n            for permission in role.permissions:\n                permissions.add(permission.name)\n        return list(permissions)\n\n    def assign_role(self, role, assigned_by_user=None):\n        \"\"\"Assign a role to this user\"\"\"\n        if not self.has_role(role.name):\n            user_role = UserRole(user_id=self.id, role_id=role.id)\n            if assigned_by_user:\n                user_role.assigned_by = assigned_by_user.id\n            db.session.add(user_role)\n            return True\n        return False\n\n    def remove_role(self, role_name):\n        \"\"\"Remove a role from this user\"\"\"\n        # Root user cannot lose super-admin role\n        if self.is_root_user() and role_name == 'super-admin':\n            return False\n\n        user_role = UserRole.query.filter_by(\n            user_id=self.id,\n            role_id=Role.query.filter_by(name=role_name).first().id\n        ).first()\n        if user_role:\n            db.session.delete(user_role)\n            return True\n        return False\n\n    @property\n    def is_admin(self):\n        \"\"\"Backward compatibility property - checks if user has admin permissions\"\"\"\n        return (self.is_root_user() or\n                self.has_role('super-admin') or\n                self.has_role('admin') or\n                self.has_role('users-admin'))\n\n    @property\n    def is_reviewer(self):\n        \"\"\"Backward compatibility property - checks if user has reviewer permissions\"\"\"\n        return (self.has_role('reviewer') or\n                self.has_permission('reviews.submit') or\n                self.is_admin)\n\n    def get_all_ips(self):\n        \"\"\"Get all IPs used by this user as a list\"\"\"\n        try:\n            return json.loads(self.all_ips) if self.all_ips else []\n        except:\n            return []\n\n    def add_ip(self, ip_address):\n        \"\"\"Add an IP address to the user's IP history\"\"\"\n        if not ip_address:\n            return\n\n        current_ips = self.get_all_ips()\n\n        # Add IP if not already in list\n        if ip_address not in current_ips:\n            current_ips.append(ip_address)\n            # Keep only last 50 IPs to prevent unlimited growth\n            if len(current_ips) > 50:\n                current_ips = current_ips[-50:]\n            self.all_ips = json.dumps(current_ips)\n\n        # Update last login IP\n        self.last_login_ip = ip_address\n\n\n# Role-Based Access Control (RBAC) Models\nclass Role(db.Model):\n    \"\"\"Roles that can be assigned to users\"\"\"\n    __tablename__ = 'role'\n\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(50), unique=True, nullable=False, index=True)\n    display_name = db.Column(db.String(100), nullable=False)\n    description = db.Column(db.Text)\n    is_system_role = db.Column(db.Boolean, default=False, nullable=False)  # System roles can't be deleted\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), onupdate=lambda: datetime.now(timezone.utc))\n\n    # Relationships\n    permissions = db.relationship('Permission', secondary='role_permission', backref='roles', lazy='dynamic')\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'name': self.name,\n            'display_name': self.display_name,\n            'description': self.description,\n            'is_system_role': self.is_system_role,\n            'permissions': [p.name for p in self.permissions]\n        }\n\n    def has_permission(self, permission_name):\n        \"\"\"Check if role has a specific permission\"\"\"\n        return self.permissions.filter_by(name=permission_name).first() is not None\n\n\nclass Permission(db.Model):\n    \"\"\"Individual permissions that can be granted to roles\"\"\"\n    __tablename__ = 'permission'\n\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100), unique=True, nullable=False, index=True)\n    display_name = db.Column(db.String(150), nullable=False)\n    description = db.Column(db.Text)\n    category = db.Column(db.String(50), nullable=False, index=True)  # users, clubs, content, system, etc.\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'name': self.name,\n            'display_name': self.display_name,\n            'description': self.description,\n            'category': self.category\n        }\n\n\nclass RolePermission(db.Model):\n    \"\"\"Many-to-many relationship between roles and permissions\"\"\"\n    __tablename__ = 'role_permission'\n\n    id = db.Column(db.Integer, primary_key=True)\n    role_id = db.Column(db.Integer, db.ForeignKey('role.id'), nullable=False, index=True)\n    permission_id = db.Column(db.Integer, db.ForeignKey('permission.id'), nullable=False, index=True)\n    granted_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    __table_args__ = (\n        db.UniqueConstraint('role_id', 'permission_id', name='uq_role_permission'),\n    )\n\n\nclass UserRole(db.Model):\n    \"\"\"Many-to-many relationship between users and roles\"\"\"\n    __tablename__ = 'user_role'\n\n    id = db.Column(db.Integer, primary_key=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False, index=True)\n    role_id = db.Column(db.Integer, db.ForeignKey('role.id'), nullable=False, index=True)\n    assigned_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True)\n    assigned_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    __table_args__ = (\n        db.UniqueConstraint('user_id', 'role_id', name='uq_user_role'),\n    )\n\n    assigner = db.relationship('User', foreign_keys=[assigned_by])\n\n\nclass AuditLog(db.Model):\n    \"\"\"Comprehensive audit log for all system activities\"\"\"\n    __tablename__ = 'audit_log'\n\n    id = db.Column(db.Integer, primary_key=True)\n    timestamp = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc), nullable=False, index=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True, index=True)  # Nullable for system actions\n    action_type = db.Column(db.String(50), nullable=False, index=True)  # signup, login, create_post, suspend_user, etc.\n    action_category = db.Column(db.String(30), nullable=False, index=True)  # auth, user, club, admin, security\n    target_type = db.Column(db.String(30), nullable=True)  # user, club, post, etc.\n    target_id = db.Column(db.Integer, nullable=True)  # ID of the target object\n    description = db.Column(db.Text, nullable=False)  # Human readable description\n    details = db.Column(db.Text)  # JSON string with additional details\n    ip_address = db.Column(db.String(45), nullable=True)  # IPv6 compatible\n    user_agent = db.Column(db.Text, nullable=True)\n    severity = db.Column(db.String(20), default='info')  # info, warning, error, critical\n    admin_action = db.Column(db.Boolean, default=False, index=True)  # Mark admin actions\n\n    # Relationships\n    user = db.relationship('User', backref=db.backref('audit_logs', lazy='dynamic'))\n\n    def to_dict(self):\n        return {\n            'id': self.id,\n            'timestamp': self.timestamp.isoformat() if self.timestamp else None,\n            'user_id': self.user_id,\n            'username': self.user.username if self.user else 'System',\n            'action_type': self.action_type,\n            'action_category': self.action_category,\n            'target_type': self.target_type,\n            'target_id': self.target_id,\n            'description': self.description,\n            'details': json.loads(self.details) if self.details else {},\n            'ip_address': self.ip_address,\n            'user_agent': self.user_agent,\n            'severity': self.severity,\n            'admin_action': self.admin_action\n        }\n\n\ndef create_audit_log(action_type, description, user=None, target_type=None, target_id=None,\n                    details=None, severity='info', admin_action=False, category=None):\n    \"\"\"Create an audit log entry\"\"\"\n    # Import app here to avoid circular import\n    from flask import current_app as app\n\n    try:\n        # Auto-determine category if not provided\n        if not category:\n            if action_type in ['signup', 'login', 'logout', 'password_change']:\n                category = 'auth'\n            elif action_type in ['user_suspend', 'user_unsuspend', 'user_promote', 'user_demote']:\n                category = 'user'\n            elif action_type in ['club_create', 'club_update', 'club_delete', 'member_add', 'member_remove']:\n                category = 'club'\n            elif action_type in ['project_review', 'project_submission', 'project_grant_override', 'project_delete']:\n                category = 'project'\n            elif action_type in ['admin_login', 'admin_action', 'system_config']:\n                category = 'admin'\n            elif action_type in ['security_violation', 'exploit_attempt', 'profanity_violation']:\n                category = 'security'\n            else:\n                category = 'other'\n\n        log_entry = AuditLog(\n            user_id=user.id if user else None,\n            action_type=action_type,\n            action_category=category,\n            target_type=target_type,\n            target_id=target_id,\n            description=description,\n            details=json.dumps(details) if details else None,\n            ip_address=get_real_ip() if request else None,\n            user_agent=request.headers.get('User-Agent') if request else None,\n            severity=severity,\n            admin_action=admin_action\n        )\n\n        db.session.add(log_entry)\n        db.session.commit()\n\n        return log_entry\n    except Exception as e:\n        app.logger.error(f\"Failed to create audit log: {str(e)}\")\n        # Try to rollback if commit failed\n        try:\n            db.session.rollback()\n        except:\n            pass\n        return None\n\n\ndef initialize_rbac_system():\n    \"\"\"Initialize the RBAC system with predefined roles and permissions\"\"\"\n\n    # Define all permissions\n    permissions_data = [\n        # System permissions\n        ('system.manage_roles', 'Manage Roles', 'Create, edit, and delete roles', 'system'),\n        ('system.manage_permissions', 'Manage Permissions', 'Assign permissions to roles', 'system'),\n        ('system.view_audit_logs', 'View Audit Logs', 'View system audit logs', 'system'),\n        ('system.manage_settings', 'Manage System Settings', 'Modify system configuration', 'system'),\n\n        # User management permissions\n        ('users.view', 'View Users', 'View user list and profiles', 'users'),\n        ('users.create', 'Create Users', 'Create new user accounts', 'users'),\n        ('users.edit', 'Edit Users', 'Modify user information', 'users'),\n        ('users.delete', 'Delete Users', 'Delete user accounts', 'users'),\n        ('users.suspend', 'Suspend Users', 'Suspend and unsuspend users', 'users'),\n        ('users.assign_roles', 'Assign Roles', 'Assign roles to users', 'users'),\n        ('users.impersonate', 'Impersonate Users', 'Login as another user', 'users'),\n\n        # Club management permissions\n        ('clubs.view', 'View Clubs', 'View club list and details', 'clubs'),\n        ('clubs.create', 'Create Clubs', 'Create new clubs', 'clubs'),\n        ('clubs.edit', 'Edit Clubs', 'Modify club information', 'clubs'),\n        ('clubs.delete', 'Delete Clubs', 'Delete clubs', 'clubs'),\n        ('clubs.manage_members', 'Manage Club Members', 'Add/remove club members', 'clubs'),\n        ('clubs.transfer_leadership', 'Transfer Club Leadership', 'Transfer club ownership', 'clubs'),\n\n        # Content management permissions\n        ('content.view', 'View Content', 'View posts and projects', 'content'),\n        ('content.create', 'Create Content', 'Create posts and projects', 'content'),\n        ('content.edit', 'Edit Content', 'Edit posts and projects', 'content'),\n        ('content.delete', 'Delete Content', 'Delete posts and projects', 'content'),\n        ('content.moderate', 'Moderate Content', 'Flag and remove inappropriate content', 'content'),\n\n        # Review permissions\n        ('reviews.view', 'View Reviews', 'View project reviews', 'reviews'),\n        ('reviews.submit', 'Submit Reviews', 'Review and approve projects', 'reviews'),\n        ('reviews.override', 'Override Reviews', 'Override review decisions', 'reviews'),\n\n        # Order review permissions\n        ('orders.view', 'View Orders', 'View order submissions in review', 'orders'),\n        ('orders.approve', 'Approve Orders', 'Review and approve order status changes', 'orders'),\n\n        # Admin dashboard permissions\n        ('admin.access_dashboard', 'Access Admin Dashboard', 'Access the admin dashboard', 'admin'),\n        ('admin.view_stats', 'View Statistics', 'View system statistics and overview', 'admin'),\n        ('admin.view_activity', 'View Activity Logs', 'View activity feed and system logs', 'admin'),\n        ('admin.manage_api_keys', 'Manage API Keys', 'Create and manage API keys', 'admin'),\n        ('admin.manage_oauth_apps', 'Manage OAuth Apps', 'Create and manage OAuth applications', 'admin'),\n        ('admin.export_data', 'Export Data', 'Export users, clubs, and other data', 'admin'),\n        ('admin.view_ip_groups', 'View IP Groups', 'View users grouped by IP address', 'admin'),\n        ('admin.reset_passwords', 'Reset User Passwords', 'Reset passwords for any user', 'admin'),\n        ('admin.login_as_user', 'Login As User', 'Impersonate other users (same as users.impersonate)', 'admin'),\n    ]\n\n    # Create permissions\n    permission_objects = {}\n    for perm_name, display_name, description, category in permissions_data:\n        perm = Permission.query.filter_by(name=perm_name).first()\n        if not perm:\n            perm = Permission(\n                name=perm_name,\n                display_name=display_name,\n                description=description,\n                category=category\n            )\n            db.session.add(perm)\n        permission_objects[perm_name] = perm\n\n    db.session.flush()\n\n    # Define roles with their permissions (all are custom/editable now)\n    roles_data = {\n        'super-admin': {\n            'display_name': 'Super Administrator',\n            'description': 'Full system access with all permissions',\n            'is_system_role': False,  # Changed to allow editing\n            'permissions': [perm for perm in permission_objects.keys()]  # All permissions\n        },\n        'admin': {\n            'display_name': 'Administrator',\n            'description': 'General administrative access',\n            'is_system_role': False,  # Changed to allow editing\n            'permissions': [\n                'admin.access_dashboard', 'admin.view_stats', 'admin.view_activity',\n                'admin.manage_api_keys', 'admin.manage_oauth_apps', 'admin.export_data',\n                'admin.view_ip_groups', 'admin.reset_passwords',\n                'users.view', 'users.edit', 'users.suspend', 'users.create', 'users.delete',\n                'clubs.view', 'clubs.edit', 'clubs.delete', 'clubs.create', 'clubs.manage_members', 'clubs.transfer_leadership',\n                'content.view', 'content.edit', 'content.delete', 'content.moderate', 'content.create',\n                'reviews.view', 'reviews.submit', 'reviews.override',\n                'orders.view', 'orders.approve',\n                'system.view_audit_logs', 'system.manage_settings',\n            ]\n        },\n        'users-admin': {\n            'display_name': 'User Administrator',\n            'description': 'Manage users and their roles',\n            'is_system_role': False,  # Changed to allow editing\n            'permissions': [\n                'admin.access_dashboard', 'admin.view_stats', 'admin.view_ip_groups',\n                'admin.reset_passwords', 'admin.export_data',\n                'users.view', 'users.create', 'users.edit', 'users.suspend', 'users.assign_roles', 'users.delete',\n                'system.view_audit_logs',\n            ]\n        },\n        'reviewer': {\n            'display_name': 'Reviewer',\n            'description': 'Review and approve projects',\n            'is_system_role': False,  # Changed to allow editing\n            'permissions': [\n                'admin.access_dashboard', 'admin.view_stats',\n                'reviews.view', 'reviews.submit',\n                'orders.view',\n                'content.view',\n                'clubs.view',\n                'users.view',\n            ]\n        },\n        'user': {\n            'display_name': 'User',\n            'description': 'Basic user with standard permissions',\n            'is_system_role': False,  # Changed to allow editing\n            'permissions': [\n                'content.view', 'content.create',\n                'clubs.view', 'clubs.create',\n            ]\n        },\n    }\n\n    # Create roles and assign permissions\n    for role_name, role_data in roles_data.items():\n        role = Role.query.filter_by(name=role_name).first()\n        if not role:\n            role = Role(\n                name=role_name,\n                display_name=role_data['display_name'],\n                description=role_data['description'],\n                is_system_role=role_data['is_system_role']\n            )\n            db.session.add(role)\n            db.session.flush()\n        else:\n            # Update existing roles to be editable\n            role.is_system_role = role_data['is_system_role']\n            role.display_name = role_data['display_name']\n            role.description = role_data['description']\n\n        # Assign permissions to role\n        for perm_name in role_data['permissions']:\n            if perm_name in permission_objects:\n                perm = permission_objects[perm_name]\n                # Check if role already has this permission\n                existing = RolePermission.query.filter_by(\n                    role_id=role.id,\n                    permission_id=perm.id\n                ).first()\n                if not existing:\n                    role_perm = RolePermission(role_id=role.id, permission_id=perm.id)\n                    db.session.add(role_perm)\n\n    # Ensure root user (ethan@hackclub.com) has super-admin role\n    root_user = User.query.filter_by(email='ethan@hackclub.com').first()\n    if root_user:\n        super_admin_role = Role.query.filter_by(name='super-admin').first()\n        if super_admin_role and not root_user.has_role('super-admin'):\n            root_user.assign_role(super_admin_role)\n\n    db.session.commit()\n    print(\"RBAC system initialized successfully!\")\n\n\ndef migrate_existing_users_to_rbac():\n    \"\"\"Migrate existing users from old boolean-based permissions to new RBAC system\"\"\"\n    print(\"Starting user migration to RBAC system...\")\n\n    # Get all roles\n    super_admin_role = Role.query.filter_by(name='super-admin').first()\n    admin_role = Role.query.filter_by(name='admin').first()\n    reviewer_role = Role.query.filter_by(name='reviewer').first()\n    user_role = Role.query.filter_by(name='user').first()\n\n    if not all([super_admin_role, admin_role, reviewer_role, user_role]):\n        print(\"ERROR: Roles not found. Please initialize the RBAC system first.\")\n        return\n\n    # Get all users\n    users = User.query.all()\n    migrated_count = 0\n\n    for user in users:\n        # Skip if user already has roles\n        if user.roles.count() > 0:\n            continue\n\n        # Assign roles based on old boolean flags\n        roles_assigned = []\n\n        # Root user always gets super-admin\n        if user.is_root_user():\n            user.assign_role(super_admin_role)\n            roles_assigned.append('super-admin')\n        elif user.is_admin:\n            user.assign_role(admin_role)\n            roles_assigned.append('admin')\n        elif user.is_reviewer:\n            user.assign_role(reviewer_role)\n            roles_assigned.append('reviewer')\n\n        # All users get the basic user role\n        if not user.is_suspended:\n            user.assign_role(user_role)\n            roles_assigned.append('user')\n\n        if roles_assigned:\n            migrated_count += 1\n            print(f\"Migrated user {user.username} ({user.email}) -> Roles: {', '.join(roles_assigned)}\")\n\n    db.session.commit()\n    print(f\"\\nMigration complete! {migrated_count} users migrated to RBAC system.\")\n","size_bytes":23975},"app/models/shop.py":{"content":"\"\"\"\nShop and Order models for the Hack Club Dashboard.\nHandles shop items and order management.\n\"\"\"\n\nfrom datetime import datetime\nfrom extensions import db\n\n\nclass ShopItem(db.Model):\n    \"\"\"Shop item model\"\"\"\n    __tablename__ = 'shop_items'\n\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(200), nullable=False)\n    description = db.Column(db.Text)\n    price = db.Column(db.Integer, nullable=False, default=0)  # Price in tokens\n    image_url = db.Column(db.String(500))\n    category = db.Column(db.String(100))\n    stock = db.Column(db.Integer, default=0)\n    is_active = db.Column(db.Boolean, default=True)\n    created_at = db.Column(db.DateTime, default=datetime.utcnow)\n    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\n    # Relationships\n    orders = db.relationship('Order', backref='shop_item', lazy='dynamic', cascade='all, delete-orphan')\n\n    def to_dict(self):\n        \"\"\"Convert to dictionary\"\"\"\n        return {\n            'id': self.id,\n            'name': self.name,\n            'description': self.description,\n            'price': self.price,\n            'image_url': self.image_url,\n            'category': self.category,\n            'stock': self.stock,\n            'is_active': self.is_active,\n            'created_at': self.created_at.isoformat() if self.created_at else None,\n            'updated_at': self.updated_at.isoformat() if self.updated_at else None\n        }\n\n\nclass Order(db.Model):\n    \"\"\"Order model\"\"\"\n    __tablename__ = 'orders'\n\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('clubs.id'), nullable=False)\n    user_id = db.Column(db.Integer, db.ForeignKey('users.id'), nullable=False)\n    shop_item_id = db.Column(db.Integer, db.ForeignKey('shop_items.id'))\n\n    # Order details\n    status = db.Column(db.String(50), default='pending')  # pending, approved, rejected, completed, refunded\n    quantity = db.Column(db.Integer, default=1)\n    total_price = db.Column(db.Integer, nullable=False)\n\n    # Shipping information\n    shipping_name = db.Column(db.String(200))\n    shipping_address = db.Column(db.Text)\n    shipping_city = db.Column(db.String(100))\n    shipping_state = db.Column(db.String(100))\n    shipping_zip = db.Column(db.String(20))\n    shipping_country = db.Column(db.String(100))\n\n    # Order tracking\n    notes = db.Column(db.Text)\n    admin_notes = db.Column(db.Text)\n    tracking_number = db.Column(db.String(200))\n\n    # Timestamps\n    created_at = db.Column(db.DateTime, default=datetime.utcnow)\n    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n    approved_at = db.Column(db.DateTime)\n    completed_at = db.Column(db.DateTime)\n\n    # Relationships (backrefs defined in club.py and user.py)\n\n    def to_dict(self):\n        \"\"\"Convert to dictionary\"\"\"\n        return {\n            'id': self.id,\n            'club_id': self.club_id,\n            'club_name': self.club.name if self.club else 'Unknown',\n            'user_id': self.user_id,\n            'username': self.user.username if self.user else 'Unknown',\n            'shop_item_id': self.shop_item_id,\n            'shop_item_name': self.shop_item.name if self.shop_item else 'Custom Order',\n            'status': self.status,\n            'quantity': self.quantity,\n            'total_price': self.total_price,\n            'shipping_name': self.shipping_name,\n            'shipping_address': self.shipping_address,\n            'shipping_city': self.shipping_city,\n            'shipping_state': self.shipping_state,\n            'shipping_zip': self.shipping_zip,\n            'shipping_country': self.shipping_country,\n            'notes': self.notes,\n            'admin_notes': self.admin_notes,\n            'tracking_number': self.tracking_number,\n            'created_at': self.created_at.isoformat() if self.created_at else None,\n            'updated_at': self.updated_at.isoformat() if self.updated_at else None,\n            'approved_at': self.approved_at.isoformat() if self.approved_at else None,\n            'completed_at': self.completed_at.isoformat() if self.completed_at else None\n        }\n","size_bytes":4186},"app/services/airtable.py":{"content":"\"\"\"\nAirtable Service for Pizza Grants and Club Management\n\"\"\"\nimport os\nimport json\nimport logging\nimport requests\nimport urllib.parse\nimport secrets\nimport string\nfrom datetime import datetime, timezone\n\n# This will be properly initialized when imported by the app\napp = None\ndb = None\nUser = None\nClub = None\nfilter_profanity_comprehensive = None\n\n\ndef init_service(flask_app, database, user_model, club_model, profanity_filter):\n    \"\"\"Initialize the service with app context and dependencies\"\"\"\n    global app, db, User, Club, filter_profanity_comprehensive\n    app = flask_app\n    db = database\n    User = user_model\n    Club = club_model\n    filter_profanity_comprehensive = profanity_filter\n\n\nclass AirtableService:\n    def __init__(self):\n        self.api_token = os.environ.get('AIRTABLE_TOKEN')\n        self.base_id = os.environ.get('AIRTABLE_BASE_ID', 'appSnnIu0BhjI3E1p')\n        self.table_name = os.environ.get('AIRTABLE_TABLE_NAME', 'Grants')\n        # New club management base\n        self.clubs_base_id = os.environ.get('AIRTABLE_CLUBS_BASE_ID', 'appSUAc40CDu6bDAp')\n        self.clubs_table_id = os.environ.get('AIRTABLE_CLUBS_TABLE_ID', 'tbl5saCV1f7ZWjsn0')\n        self.clubs_table_name = os.environ.get('AIRTABLE_CLUBS_TABLE_NAME', 'Clubs Dashboard')\n        # Email verification table\n        self.email_verification_table_name = 'Dashboard Email Verification'\n        self.headers = {\n            'Authorization': f'Bearer {self.api_token}',\n            'Content-Type': 'application/json'\n        }\n        encoded_table_name = urllib.parse.quote(self.table_name)\n        self.base_url = f'https://api.airtable.com/v0/{self.base_id}/{encoded_table_name}'\n\n        # Club management URLs - use table ID for direct access\n        self.clubs_base_url = f'https://api.airtable.com/v0/{self.clubs_base_id}/{self.clubs_table_id}'\n        # Email verification URL\n        self.email_verification_url = f'https://api.airtable.com/v0/{self.clubs_base_id}/{urllib.parse.quote(self.email_verification_table_name)}'\n\n    def _validate_airtable_url(self, url):\n        \"\"\"Validate that URL is a legitimate Airtable API URL to prevent SSRF\"\"\"\n        try:\n            parsed = urllib.parse.urlparse(url)\n            return (parsed.scheme in ['https'] and\n                   parsed.hostname == 'api.airtable.com' and\n                   parsed.path.startswith('/v0/'))\n        except:\n            return False\n\n    def _safe_request(self, method, url, **kwargs):\n        \"\"\"Make a safe HTTP request with URL validation and timeout\"\"\"\n        if not self._validate_airtable_url(url):\n            raise ValueError(f\"Invalid Airtable URL: {url}\")\n\n        # Add timeout to prevent hanging requests - longer for email operations\n        kwargs.setdefault('timeout', 60)\n\n        if method.upper() == 'GET':\n            return requests.get(url, **kwargs)\n        elif method.upper() == 'POST':\n            return requests.post(url, **kwargs)\n        elif method.upper() == 'PATCH':\n            return requests.patch(url, **kwargs)\n        elif method.upper() == 'DELETE':\n            return requests.delete(url, **kwargs)\n        else:\n            raise ValueError(f\"Unsupported HTTP method: {method}\")\n\n    def _check_school_variations(self, club_name, venue):\n        \"\"\"Check for common school name variations\"\"\"\n        # Remove common words that might cause mismatches\n        common_words = ['high', 'school', 'college', 'university', 'academy', 'the', 'of', 'at']\n\n        # Extract main words from both names\n        club_words = [word for word in club_name.split() if word not in common_words and len(word) > 2]\n        venue_words = [word for word in venue.split() if word not in common_words and len(word) > 2]\n\n        # Check if any significant words match\n        for club_word in club_words:\n            for venue_word in venue_words:\n                if (club_word in venue_word or venue_word in club_word or\n                    # Check for common abbreviations\n                    (club_word.startswith(venue_word[:3]) and len(venue_word) > 3) or\n                    (venue_word.startswith(club_word[:3]) and len(club_word) > 3)):\n                    return True\n\n        return False\n\n    def verify_club_leader(self, email, club_name):\n        if not self.api_token:\n            app.logger.error(\"Airtable API token not configured\")\n            return False\n\n        if not self.clubs_base_id or not self.clubs_table_name:\n            app.logger.error(\"Airtable clubs base ID or table name not configured\")\n            return False\n\n        # Validate email format to prevent injection\n        if not email or '@' not in email or len(email) < 3:\n            app.logger.error(\"Invalid email format for verification\")\n            return False\n\n        # Escape email for safe use in formula - prevent wildcard matching\n        escaped_email = email.replace('\"', '\"\"').replace(\"'\", \"''\")\n\n        # Validate email contains proper domain\n        if email.count('@') != 1:\n            app.logger.error(\"Invalid email format - multiple @ symbols\")\n            return False\n\n        try:\n            # Use exact email matching instead of FIND to prevent wildcard abuse\n            email_filter_params = {\n                'filterByFormula': f'{{Current Leaders\\' Emails}} = \"{escaped_email}\"'\n            }\n\n            app.logger.info(f\"Verifying club leader: email={email}, club={club_name}\")\n            app.logger.debug(f\"Airtable URL: {self.clubs_base_url}\")\n            app.logger.debug(f\"Email filter formula: {email_filter_params['filterByFormula']}\")\n\n            # Validate the URL to prevent SSRF\n            parsed_url = urllib.parse.urlparse(self.clubs_base_url)\n            if parsed_url.hostname not in ['api.airtable.com']:\n                app.logger.error(f\"Invalid Airtable URL hostname: {parsed_url.hostname}\")\n                return False\n\n            response = self._safe_request('GET', self.clubs_base_url, headers=self.headers, params=email_filter_params)\n\n            app.logger.info(f\"Airtable response status: {response.status_code}\")\n            app.logger.debug(f\"Airtable response headers: {dict(response.headers)}\")\n            app.logger.debug(f\"Airtable response content length: {len(response.content) if response.content else 0}\")\n\n            if response.status_code == 200:\n                try:\n                    data = response.json()\n                    app.logger.debug(f\"Airtable response data keys: {list(data.keys()) if data else 'None'}\")\n                    records = data.get('records', [])\n                    app.logger.info(f\"Found {len(records)} records with email {email}\")\n                    if records:\n                        app.logger.debug(f\"First record fields: {list(records[0].get('fields', {}).keys()) if records else 'None'}\")\n                except ValueError as json_error:\n                    app.logger.error(f\"Failed to parse Airtable JSON response: {json_error}\")\n                    app.logger.error(f\"Raw response content: {response.text[:500]}...\")\n                    return False\n\n                if len(records) == 0:\n                    app.logger.info(\"No records found with that email address\")\n                    return False\n\n                # Check if any of the records match the club name (case-insensitive partial match)\n                club_name_lower = club_name.lower().strip()\n\n                # Log all available club names for debugging\n                club_names = [record.get('fields', {}).get('Club Name', '') for record in records]\n                app.logger.info(f\"Available club names for {email}: {club_names}\")\n                app.logger.debug(f\"Full record data for debugging: {[record.get('fields', {}) for record in records]}\")\n\n                for record in records:\n                    fields = record.get('fields', {})\n                    venue = fields.get('Club Name', '').lower().strip()\n                    app.logger.debug(f\"Checking club name: '{venue}' against requested club name: '{club_name_lower}'\")\n\n                    # Try multiple matching strategies with more flexible matching\n                    if (club_name_lower in venue or\n                        venue.find(club_name_lower) >= 0 or\n                        # Check if club name words are in venue\n                        any(word.strip() in venue for word in club_name_lower.split() if len(word.strip()) > 2) or\n                        # Check if venue words are in club name\n                        any(word.strip() in club_name_lower for word in venue.split() if len(word.strip()) > 2) or\n                        # Check for common school/high school variations\n                        self._check_school_variations(club_name_lower, venue)):\n                        app.logger.info(f\"Found matching club: {fields.get('Club Name', '')}\")\n                        return True\n\n                app.logger.info(f\"No club name match found for '{club_name}' in available clubs: {club_names}\")\n                return False\n\n            elif response.status_code == 403:\n                app.logger.error(f\"Airtable 403 Forbidden - check API token permissions. Response: {response.text}\")\n                return False\n            elif response.status_code == 404:\n                app.logger.error(f\"Airtable 404 Not Found - check base ID and table name. Response: {response.text}\")\n                return False\n            else:\n                app.logger.error(f\"Airtable API error {response.status_code}: {response.text}\")\n                return False\n\n        except Exception as e:\n            app.logger.error(f\"Exception during Airtable verification: {str(e)}\")\n            return False\n\n    def log_pizza_grant(self, submission_data):\n        if not self.api_token:\n            app.logger.error(\"Airtable API token not configured\")\n            return None\n\n        try:\n            hours = float(submission_data.get('project_hours', 0))\n\n            # New detailed earning structure: $5 per hour, capped at $20\n            # Must be in-person meeting and have 3+ members to redeem\n            grant_amount = min(hours * 5, 20)  # $5/hour, max $20\n\n            # Round down to nearest dollar for clean amounts\n            grant_amount = int(grant_amount)\n\n            # Ensure minimum requirements are met for any grant\n            if grant_amount > 0:\n                # Check if club meets requirements (will be validated on submission)\n                is_in_person = submission_data.get('is_in_person_meeting', False)\n                club_member_count = submission_data.get('club_member_count', 0)\n\n                if not is_in_person:\n                    grant_amount = 0\n                    app.logger.info(f\"Grant denied: Not an in-person meeting\")\n                elif club_member_count < 3:\n                    grant_amount = 0\n                    app.logger.info(f\"Grant denied: Club has {club_member_count} members, need 3+\")\n                else:\n                    app.logger.info(f\"Grant approved: ${grant_amount} for {hours} hours (in-person meeting, {club_member_count} members)\")\n\n            # Use YSWS Project Submission table fields - updated field names to match actual table\n            project_table_name = urllib.parse.quote('YSWS Project Submission')\n            project_url = f'https://api.airtable.com/v0/{self.base_id}/{project_table_name}'\n\n            fields = {\n                'Code URL': submission_data.get('github_url', ''),\n                'Playable URL': submission_data.get('live_url', ''),\n                'First Name': submission_data.get('first_name', ''),\n                'Last Name': submission_data.get('last_name', ''),\n                'Email': submission_data.get('email', ''),\n                'Age': submission_data.get('age', ''),\n                'Status': 'Pending',\n                'Decision Reason': '',\n                'How did you hear about this?': 'Through Club Leader',\n                'What are we doing well?': submission_data.get('doing_well', ''),\n                'How can we improve?': submission_data.get('improve', ''),\n                'Screenshot': [{'url': submission_data.get('screenshot_url', '')}] if submission_data.get('screenshot_url') else [],\n                'Description': submission_data.get('project_description', ''),\n                'GitHub Username': submission_data.get('github_username', ''),\n                'Address (Line 1)': submission_data.get('address_1', ''),\n                'Address (Line 2)': submission_data.get('address_2', ''),\n                'City': submission_data.get('city', ''),\n                'State / Province': submission_data.get('state', ''),\n                'Country': submission_data.get('country', ''),\n                'ZIP / Postal Code': submission_data.get('zip', ''),\n                'Birthday': submission_data.get('birthday', ''),\n                'Hackatime Project': submission_data.get('project_name', ''),\n                'Hours': float(hours),\n                'Grant Amount': float(grant_amount),\n                'Club Name': submission_data.get('club_name', ''),\n                'Leader Email': submission_data.get('leader_email', ''),\n                'In-Person Meeting': 'Yes' if submission_data.get('is_in_person_meeting', False) else 'No',\n                'Club Member Count': str(submission_data.get('club_member_count', 0)),\n                'Meeting Requirements Met': 'Yes' if (submission_data.get('is_in_person_meeting', False) and submission_data.get('club_member_count', 0) >= 3) else 'No'\n            }\n\n            # Debug log submission data\n            app.logger.debug(f\"Club name in submission_data: '{submission_data.get('club_name', 'NOT_FOUND')}'\")\n            app.logger.debug(f\"Leader email in submission_data: '{submission_data.get('leader_email', 'NOT_FOUND')}'\")\n\n            # Remove empty fields to avoid validation issues\n            fields_before_filter = fields.copy()\n            fields = {k: v for k, v in fields.items() if v not in [None, '', []]}\n\n            # Log which fields were filtered out\n            filtered_out = set(fields_before_filter.keys()) - set(fields.keys())\n            if filtered_out:\n                app.logger.debug(f\"Fields filtered out due to empty values: {filtered_out}\")\n\n            payload = {'records': [{'fields': fields}]}\n\n            app.logger.info(f\"Submitting to Airtable: {project_url}\")\n            app.logger.debug(f\"Airtable payload fields: {list(fields.keys())}\")\n            app.logger.info(f\"Screenshot field value: {fields.get('Screenshot', 'NOT_FOUND')}\")\n            app.logger.debug(f\"Full payload: {payload}\")\n\n            response = requests.post(project_url, headers=self.headers, json=payload)\n\n            app.logger.info(f\"Airtable response status: {response.status_code}\")\n            if response.status_code not in [200, 201]:\n                app.logger.error(f\"Airtable submission failed: {response.text}\")\n                return None\n\n            app.logger.info(\"Successfully submitted to Airtable\")\n            return response.json()\n\n        except Exception as e:\n            app.logger.error(f\"Exception in log_pizza_grant: {str(e)}\")\n            return None\n\n    def submit_pizza_grant(self, grant_data):\n        \"\"\"Submit pizza grant to Grants table\"\"\"\n        if not self.api_token:\n            return None\n\n        # Use Grants table instead\n        grants_table_name = urllib.parse.quote('Grants')\n        grants_url = f'https://api.airtable.com/v0/{self.base_id}/{grants_table_name}'\n\n        fields = {\n            'Club': grant_data.get('club_name', ''),\n            'Email': grant_data.get('contact_email', ''),\n            'Status': 'In progress',\n            'Grant Amount': float(grant_data.get('grant_amount', 0)),\n            'Grant Type': 'Pizza Card',\n            'Address': grant_data.get('club_address', ''),\n            'Order ID': grant_data.get('order_id', '')\n        }\n\n        payload = {'records': [{'fields': fields}]}\n\n        try:\n            response = requests.post(grants_url, headers=self.headers, json=payload)\n            app.logger.debug(f\"Airtable response status: {response.status_code}\")\n            app.logger.debug(f\"Airtable response body: {response.text}\")\n            if response.status_code in [200, 201]:\n                return response.json()\n            else:\n                app.logger.error(f\"Airtable error: {response.text}\")\n                return None\n        except Exception as e:\n            app.logger.error(f\"Exception submitting to Airtable: {str(e)}\")\n            return None\n\n    def submit_purchase_request(self, purchase_data):\n        \"\"\"Submit purchase request to Grant Fulfillment table\"\"\"\n        if not self.api_token:\n            return None\n\n        # Use Grant Fulfillment table\n        fulfillment_table_name = urllib.parse.quote('Grant Fulfillment')\n        fulfillment_url = f'https://api.airtable.com/v0/{self.base_id}/{fulfillment_table_name}'\n\n        fields = {\n            'Leader First Name': purchase_data.get('leader_first_name', ''),\n            'Leader Last Name': purchase_data.get('leader_last_name', ''),\n            'Leader Email': purchase_data.get('leader_email', ''),\n            'Purchase Type': purchase_data.get('purchase_type', ''),\n            'Purchase Description': purchase_data.get('description', ''),\n            'Purchase Reason': purchase_data.get('reason', ''),\n            'Fulfillment Method': purchase_data.get('fulfillment_method', ''),\n            'Status': 'Pending',\n            'Club Name': purchase_data.get('club_name', ''),\n            'Amount': str(purchase_data.get('amount', 0))\n        }\n\n        payload = {'records': [{'fields': fields}]}\n\n        try:\n            response = requests.post(fulfillment_url, headers=self.headers, json=payload)\n            app.logger.debug(f\"Airtable Grant Fulfillment response status: {response.status_code}\")\n            app.logger.debug(f\"Airtable Grant Fulfillment response body: {response.text}\")\n            if response.status_code in [200, 201]:\n                return response.json()\n            else:\n                app.logger.error(f\"Airtable Grant Fulfillment error: {response.text}\")\n                return None\n        except Exception as e:\n            app.logger.error(f\"Exception submitting to Airtable Grant Fulfillment: {str(e)}\")\n            return None\n\n    def get_pizza_grant_submissions(self):\n        if not self.api_token:\n            return []\n\n        try:\n            # Use YSWS Project Submission table\n            project_table_name = urllib.parse.quote('YSWS Project Submission')\n            project_url = f'https://api.airtable.com/v0/{self.base_id}/{project_table_name}'\n\n            response = requests.get(project_url, headers=self.headers)\n            if response.status_code == 200:\n                data = response.json()\n                records = data.get('records', [])\n\n                submissions = []\n                for record in records:\n                    fields = record.get('fields', {})\n                    submissions.append({\n                        'id': record['id'],\n                        'project_name': fields.get('Hackatime Project', ''),\n                        'first_name': fields.get('First Name', ''),\n                        'last_name': fields.get('Last Name', ''),\n                        'email': fields.get('Email', ''),\n                        'club_name': fields.get('Club Name', fields.get('Hack Club', '')),\n                        'description': fields.get('Description', ''),\n                        'github_url': fields.get('Code URL', ''),\n                        'live_url': fields.get('Playable URL', ''),\n                        'doing_well': fields.get('What are we doing well?', ''),\n                        'improve': fields.get('How can we improve?', ''),\n                        'address_1': fields.get('Address (Line 1)', ''),\n                        'city': fields.get('City', ''),\n                        'state': fields.get('State / Province', ''),\n                        'zip': fields.get('ZIP / Postal Code', ''),\n                        'country': fields.get('Country', ''),\n                        'hours': fields.get('Hours', 0),\n                        'grant_amount': fields.get('Grant Amount Override') or fields.get('Grant Amount', ''),\n                        'status': fields.get('Status', fields.get('Grant Status', fields.get('Review Status', 'Pending'))),\n                        'created_time': record.get('createdTime', '')\n                    })\n\n                return submissions\n            else:\n                app.logger.error(f\"Failed to fetch submissions: {response.status_code} - {response.text}\")\n                return []\n        except Exception as e:\n            app.logger.error(f\"Error fetching pizza grant submissions: {str(e)}\")\n            return []\n\n    def get_submission_by_id(self, submission_id):\n        if not self.api_token:\n            return None\n\n        try:\n            # Use YSWS Project Submission table\n            project_table_name = urllib.parse.quote('YSWS Project Submission')\n            project_url = f'https://api.airtable.com/v0/{self.base_id}/{project_table_name}'\n            url = f\"{project_url}/{submission_id}\"\n\n            response = requests.get(url, headers=self.headers)\n            if response.status_code == 200:\n                data = response.json()\n                fields = data.get('fields', {})\n                return {\n                    'id': data['id'],\n                    'project_name': fields.get('Hackatime Project', ''),\n                    'hours': fields.get('Hours', 0),\n                    'status': 'Submitted'\n                }\n            return None\n        except Exception as e:\n            app.logger.error(f\"Error fetching submission {submission_id}: {str(e)}\")\n            return None\n\n    def update_submission_status(self, submission_id, action):\n        if not self.api_token:\n            return False\n\n        try:\n            # Use YSWS Project Submission table\n            project_table_name = urllib.parse.quote('YSWS Project Submission')\n            project_url = f'https://api.airtable.com/v0/{self.base_id}/{project_table_name}'\n            url = f\"{project_url}/{submission_id}\"\n\n            # Map action to status\n            status = 'Approved' if action == 'approve' else 'Rejected'\n\n            # First, try to get the current record to see what fields exist\n            get_response = requests.get(url, headers=self.headers)\n            if get_response.status_code == 200:\n                current_record = get_response.json()\n                fields = current_record.get('fields', {})\n                app.logger.info(f\"Current record fields: {list(fields.keys())}\")\n\n            # Try different status field names one by one\n            possible_status_fields = ['Status', 'Grant Status', 'Review Status', 'Approval Status']\n\n            for field_name in possible_status_fields:\n                update_data = {\n                    'fields': {\n                        field_name: status\n                    }\n                }\n\n                response = requests.patch(url, headers=self.headers, json=update_data)\n\n                if response.status_code == 200:\n                    app.logger.info(f\"Submission {submission_id} status updated to {status} using field '{field_name}'\")\n                    return True\n                else:\n                    app.logger.debug(f\"Failed to update with field '{field_name}': {response.status_code} - {response.text}\")\n\n            # If no field worked, log the error and return False\n            app.logger.error(f\"Failed to update submission status with any field name. Last response: {response.status_code} - {response.text}\")\n            return False\n        except Exception as e:\n            app.logger.error(f\"Error updating submission status: {str(e)}\")\n            return False\n\n    def delete_submission(self, submission_id):\n        if not self.api_token:\n            return False\n\n        try:\n            # Use YSWS Project Submission table\n            project_table_name = urllib.parse.quote('YSWS Project Submission')\n            project_url = f'https://api.airtable.com/v0/{self.base_id}/{project_table_name}'\n            url = f\"{project_url}/{submission_id}\"\n\n            response = requests.delete(url, headers=self.headers)\n            return response.status_code == 200\n        except Exception as e:\n            app.logger.error(f\"Error deleting submission: {str(e)}\")\n            return False\n\n    def get_all_clubs_from_airtable(self):\n        \"\"\"Fetch all clubs from Airtable\"\"\"\n        if not self.api_token:\n            app.logger.error(\"Cannot fetch clubs from Airtable: API token not configured\")\n            return []\n\n        try:\n            app.logger.info(\"Starting to fetch all clubs from Airtable\")\n            app.logger.debug(f\"Using Airtable URL: {self.clubs_base_url}\")\n            all_records = []\n            offset = None\n            page_count = 0\n\n            while True:\n                page_count += 1\n                params = {}\n                if offset:\n                    params['offset'] = offset\n\n                app.logger.debug(f\"Fetching page {page_count} with offset: {offset}\")\n                response = requests.get(self.clubs_base_url, headers=self.headers, params=params)\n                app.logger.debug(f\"Page {page_count} response status: {response.status_code}\")\n\n                if response.status_code != 200:\n                    app.logger.error(f\"Airtable API error on page {page_count}: {response.status_code} - {response.text}\")\n                    app.logger.error(f\"Request headers: {self.headers}\")\n                    app.logger.error(f\"Request params: {params}\")\n                    break\n\n                try:\n                    data = response.json()\n                    page_records = data.get('records', [])\n                    all_records.extend(page_records)\n                    app.logger.debug(f\"Page {page_count}: Retrieved {len(page_records)} records, total so far: {len(all_records)}\")\n\n                    offset = data.get('offset')\n                    if not offset:\n                        app.logger.info(f\"Completed fetching all clubs from Airtable. Total records: {len(all_records)}\")\n                        break\n                except ValueError as json_error:\n                    app.logger.error(f\"Failed to parse Airtable JSON response on page {page_count}: {json_error}\")\n                    app.logger.error(f\"Raw response content: {response.text[:500]}...\")\n                    break\n\n            clubs = []\n            app.logger.debug(f\"Processing {len(all_records)} Airtable records into club data\")\n            for i, record in enumerate(all_records):\n                fields = record.get('fields', {})\n                app.logger.debug(f\"Processing record {i+1}/{len(all_records)}: ID={record.get('id')}, Fields keys: {list(fields.keys())}\")\n\n                # Extract club information from Airtable fields\n                club_data = {\n                    'airtable_id': record['id'],\n                    'name': fields.get('Club Name', '').strip(),\n                    'leader_email': fields.get(\"Current Leaders' Emails\", '').split(',')[0].strip() if fields.get(\"Current Leaders' Emails\") else '',\n                    'location': fields.get('Location', '').strip(),\n                    'description': fields.get('Description', '').strip(),\n                    'status': fields.get('Status', '').strip(),\n                    'meeting_day': fields.get('Meeting Day', '').strip(),\n                    'meeting_time': fields.get('Meeting Time', '').strip(),\n                    'website': fields.get('Website', '').strip(),\n                    'slack_channel': fields.get('Slack Channel', '').strip(),\n                    'github': fields.get('GitHub', '').strip(),\n                    'latitude': fields.get('Latitude'),\n                    'longitude': fields.get('Longitude'),\n                    'country': fields.get('Country', '').strip(),\n                    'region': fields.get('Region', '').strip(),\n                    'timezone': fields.get('Timezone', '').strip(),\n                    'primary_leader': fields.get('Primary Leader', '').strip(),\n                    'co_leaders': fields.get('Co-Leaders', '').strip(),\n                    'meeting_notes': fields.get('Meeting Notes', '').strip(),\n                    'club_applications_link': fields.get('Club Applications Link', '').strip(),\n                }\n\n                # Only include clubs with valid names and leader emails\n                if club_data['name'] and club_data['leader_email']:\n                    clubs.append(club_data)\n                    app.logger.debug(f\"Added valid club: {club_data['name']} ({club_data['leader_email']})\")\n                else:\n                    app.logger.debug(f\"Skipped invalid club record - Name: '{club_data['name']}', Email: '{club_data['leader_email']}'\")\n\n            app.logger.info(f\"Successfully processed {len(clubs)} valid clubs from {len(all_records)} Airtable records\")\n            return clubs\n\n        except Exception as e:\n            app.logger.error(f\"Error fetching clubs from Airtable: {str(e)}\")\n            return []\n\n    def sync_club_with_airtable(self, club_id, airtable_data):\n        \"\"\"Sync a specific club with Airtable data\"\"\"\n        try:\n            app.logger.info(f\"Starting sync for club ID {club_id} with Airtable data\")\n            app.logger.debug(f\"Airtable data keys: {list(airtable_data.keys()) if airtable_data else 'None'}\")\n\n            club = Club.query.get(club_id)\n            if not club:\n                app.logger.error(f\"Club with ID {club_id} not found in database\")\n                return False\n\n            app.logger.debug(f\"Found club: {club.name} (current location: {club.location})\")\n\n            # Update club fields with Airtable data\n            if 'name' in airtable_data and airtable_data['name']:\n                filtered_name = filter_profanity_comprehensive(airtable_data['name'])\n                club.name = filtered_name\n            else:\n                club.name = club.name\n            club.location = airtable_data.get('location', club.location)\n            if 'description' in airtable_data and airtable_data['description']:\n                filtered_description = filter_profanity_comprehensive(airtable_data['description'])\n                club.description = filtered_description\n            else:\n                club.description = club.description\n\n            # Store additional Airtable metadata as JSON in a new field\n            club.airtable_data = json.dumps({\n                'airtable_id': airtable_data.get('airtable_id'),\n                'status': airtable_data.get('status'),\n                'meeting_day': airtable_data.get('meeting_day'),\n                'meeting_time': airtable_data.get('meeting_time'),\n                'website': airtable_data.get('website'),\n                'slack_channel': airtable_data.get('slack_channel'),\n                'github': airtable_data.get('github'),\n                'latitude': airtable_data.get('latitude'),\n                'longitude': airtable_data.get('longitude'),\n                'country': airtable_data.get('country'),\n                'region': airtable_data.get('region'),\n                'timezone': airtable_data.get('timezone'),\n                'primary_leader': airtable_data.get('primary_leader'),\n                'co_leaders': airtable_data.get('co_leaders'),\n                'meeting_notes': airtable_data.get('meeting_notes'),\n                'club_applications_link': airtable_data.get('club_applications_link'),\n            })\n\n            club.updated_at = datetime.now(timezone.utc)\n            app.logger.debug(f\"Updated club fields for {club.name}\")\n\n            db.session.commit()\n            app.logger.info(f\"Successfully synced club {club_id} ({club.name}) with Airtable data\")\n            return True\n\n        except Exception as e:\n            app.logger.error(f\"Error syncing club {club_id} with Airtable: {str(e)}\")\n            app.logger.error(f\"Exception type: {type(e).__name__}\")\n            app.logger.error(f\"Exception details: {str(e)}\")\n            db.session.rollback()\n            return False\n\n    def create_club_from_airtable(self, airtable_data):\n        \"\"\"Create a new club from Airtable data\"\"\"\n        try:\n            app.logger.info(f\"Creating new club from Airtable data\")\n            app.logger.debug(f\"Airtable data: {airtable_data}\")\n\n            # Find or create leader by email\n            leader_email = airtable_data.get('leader_email')\n            if not leader_email:\n                app.logger.error(\"Cannot create club: no leader email provided in Airtable data\")\n                return None\n\n            app.logger.debug(f\"Looking for leader with email: {leader_email}\")\n\n            leader = User.query.filter_by(email=leader_email).first()\n            if not leader:\n                # Create a placeholder leader account\n                username = leader_email.split('@')[0]\n                # Ensure username is unique\n                counter = 1\n                original_username = username\n                while User.query.filter_by(username=username).first():\n                    username = f\"{original_username}{counter}\"\n                    counter += 1\n\n                leader = User(\n                    username=username,\n                    email=leader_email,\n                    first_name=airtable_data.get('primary_leader', '').split(' ')[0] if airtable_data.get('primary_leader') else '',\n                    last_name=' '.join(airtable_data.get('primary_leader', '').split(' ')[1:]) if airtable_data.get('primary_leader') else ''\n                )\n                leader.set_password(secrets.token_urlsafe(16))  # Random password\n                db.session.add(leader)\n                db.session.flush()\n\n            # Create club\n            filtered_name = filter_profanity_comprehensive(airtable_data.get('name'))\n\n            # Check for duplicate club names\n            existing_club = Club.query.filter_by(name=filtered_name).first()\n            if existing_club:\n                app.logger.warning(f\"Skipping club creation from Airtable - duplicate name: {filtered_name}\")\n                return None\n\n            default_desc = f\"Official {filtered_name} Hack Club\"\n            club_desc = airtable_data.get('description', default_desc)\n            filtered_description = filter_profanity_comprehensive(club_desc)\n            club = Club(\n                name=filtered_name,\n                description=filtered_description,\n                location=airtable_data.get('location'),\n                leader_id=leader.id,\n                airtable_data=json.dumps({\n                    'airtable_id': airtable_data.get('airtable_id'),\n                    'status': airtable_data.get('status'),\n                    'meeting_day': airtable_data.get('meeting_day'),\n                    'meeting_time': airtable_data.get('meeting_time'),\n                    'website': airtable_data.get('website'),\n                    'slack_channel': airtable_data.get('slack_channel'),\n                    'github': airtable_data.get('github'),\n                    'latitude': airtable_data.get('latitude'),\n                    'longitude': airtable_data.get('longitude'),\n                    'country': airtable_data.get('country'),\n                    'region': airtable_data.get('region'),\n                    'timezone': airtable_data.get('timezone'),\n                    'primary_leader': airtable_data.get('primary_leader'),\n                    'co_leaders': airtable_data.get('co_leaders'),\n                    'meeting_notes': airtable_data.get('meeting_notes'),\n                    'club_applications_link': airtable_data.get('club_applications_link'),\n                })\n            )\n            club.generate_join_code()\n\n            db.session.add(club)\n            db.session.commit()\n\n            app.logger.info(f\"Successfully created club '{club.name}' from Airtable data (ID: {club.id})\")\n            return club\n\n        except Exception as e:\n            app.logger.error(f\"Error creating club from Airtable data: {str(e)}\")\n            app.logger.error(f\"Exception type: {type(e).__name__}\")\n            app.logger.error(f\"Airtable data that caused error: {airtable_data}\")\n            db.session.rollback()\n            return None\n\n    def update_club_in_airtable(self, airtable_record_id, fields):\n        \"\"\"Update a specific club record in Airtable\"\"\"\n        if not self.api_token or not airtable_record_id:\n            return False\n\n        try:\n            update_url = f\"{self.clubs_base_url}/{airtable_record_id}\"\n            payload = {'fields': fields}\n\n            response = requests.patch(update_url, headers=self.headers, json=payload)\n\n            if response.status_code == 200:\n                return True\n            else:\n                app.logger.error(f\"Airtable update error: {response.status_code} - {response.text}\")\n                return False\n\n        except Exception as e:\n            app.logger.error(f\"Error updating Airtable record: {str(e)}\")\n            return False\n\n    def send_email_verification(self, email):\n        \"\"\"Send email verification code to Airtable for automation with retry logic\"\"\"\n        if not self.api_token:\n            app.logger.error(\"Airtable API token not configured for email verification\")\n            return None\n\n        # Generate 5-digit verification code\n        verification_code = ''.join(secrets.choice(string.digits) for _ in range(5))\n\n        # Retry logic for network timeouts\n        max_retries = 3\n        retry_count = 0\n\n        while retry_count < max_retries:\n            try:\n                # First, check if there's an existing pending verification for this email\n                existing_params = {\n                    'filterByFormula': f'AND({{Email}} = \"{email}\", {{Status}} = \"Pending\")'\n                }\n\n                existing_response = self._safe_request('GET', self.email_verification_url, headers=self.headers, params=existing_params, timeout=90)\n\n                if existing_response.status_code == 200:\n                    existing_data = existing_response.json()\n                    existing_records = existing_data.get('records', [])\n\n                    # Update existing pending record instead of creating new one\n                    if existing_records:\n                        record_id = existing_records[0]['id']\n                        update_url = f\"{self.email_verification_url}/{record_id}\"\n\n                        payload = {\n                            'fields': {\n                                'Code': verification_code,\n                                'Status': 'Pending'\n                            }\n                        }\n\n                        response = self._safe_request('PATCH', update_url, headers=self.headers, json=payload, timeout=90)\n                    else:\n                        # Create new verification record\n                        payload = {\n                            'records': [{\n                                'fields': {\n                                    'Email': email,\n                                    'Code': verification_code,\n                                    'Status': 'Pending'\n                                }\n                            }]\n                        }\n\n                        response = self._safe_request('POST', self.email_verification_url, headers=self.headers, json=payload, timeout=90)\n                else:\n                    # Create new verification record if we can't check existing\n                    payload = {\n                        'records': [{\n                            'fields': {\n                                'Email': email,\n                                'Code': verification_code,\n                                'Status': 'Pending'\n                            }\n                        }]\n                    }\n\n                    response = self._safe_request('POST', self.email_verification_url, headers=self.headers, json=payload, timeout=90)\n\n                if response.status_code in [200, 201]:\n                    app.logger.info(f\"Email verification code sent for {email}\")\n                    return verification_code\n                else:\n                    app.logger.error(f\"Failed to send email verification: {response.status_code} - {response.text}\")\n                    return None\n\n            except requests.exceptions.ReadTimeout as e:\n                retry_count += 1\n                app.logger.warning(f\"Email verification timeout, attempt {retry_count}/{max_retries}: {str(e)}\")\n                if retry_count >= max_retries:\n                    app.logger.error(f\"Email verification failed after {max_retries} attempts due to timeout\")\n                    return None\n                # Wait before retrying\n                import time\n                time.sleep(2 ** retry_count)  # Exponential backoff\n\n            except Exception as e:\n                app.logger.error(f\"Exception sending email verification: {str(e)}\")\n                return None\n\n        return None\n\n    def verify_email_code(self, email, code):\n        \"\"\"Verify the email verification code\"\"\"\n        if not self.api_token:\n            app.logger.error(\"Airtable API token not configured for email verification\")\n            return False\n\n        try:\n            # Find the verification record\n            filter_params = {\n                'filterByFormula': f'AND({{Email}} = \"{email}\", {{Code}} = \"{code}\", {{Status}} = \"Pending\")'\n            }\n\n            response = self._safe_request('GET', self.email_verification_url, headers=self.headers, params=filter_params, timeout=90)\n\n            if response.status_code == 200:\n                data = response.json()\n                records = data.get('records', [])\n\n                if records:\n                    # Mark as verified\n                    record_id = records[0]['id']\n                    update_url = f\"{self.email_verification_url}/{record_id}\"\n\n                    payload = {\n                        'fields': {\n                            'Status': 'Verified'\n                        }\n                    }\n\n                    update_response = self._safe_request('PATCH', update_url, headers=self.headers, json=payload, timeout=90)\n\n                    if update_response.status_code == 200:\n                        app.logger.info(f\"Email verification successful for {email}\")\n                        return True\n                    else:\n                        app.logger.error(f\"Failed to update verification status: {update_response.status_code}\")\n                        return False\n                else:\n                    app.logger.warning(f\"No pending verification found for {email} with code {code}\")\n                    return False\n            else:\n                app.logger.error(f\"Error checking verification code: {response.status_code} - {response.text}\")\n                return False\n\n        except Exception as e:\n            app.logger.error(f\"Exception verifying email code: {str(e)}\")\n            return False\n\n    def check_email_code(self, email, code):\n        \"\"\"Check if email verification code is valid without marking as verified\"\"\"\n        if not self.api_token:\n            app.logger.error(\"Airtable API token not configured for email verification\")\n            return False\n\n        try:\n            # Find the verification record\n            filter_params = {\n                'filterByFormula': f'AND({{Email}} = \"{email}\", {{Code}} = \"{code}\", {{Status}} = \"Pending\")'\n            }\n\n            response = self._safe_request('GET', self.email_verification_url, headers=self.headers, params=filter_params, timeout=90)\n\n            if response.status_code == 200:\n                data = response.json()\n                records = data.get('records', [])\n\n                if records:\n                    app.logger.info(f\"Email verification code check successful for {email}\")\n                    return True\n                else:\n                    app.logger.warning(f\"No pending verification found for {email} with code {code}\")\n                    return False\n            else:\n                app.logger.error(f\"Error checking verification code: {response.status_code} - {response.text}\")\n                return False\n\n        except Exception as e:\n            app.logger.error(f\"Exception checking email code: {str(e)}\")\n            return False\n\n    def sync_all_clubs_with_airtable(self):\n        \"\"\"Sync all clubs with Airtable data\"\"\"\n        try:\n            airtable_clubs = self.get_all_clubs_from_airtable()\n\n            created_count = 0\n            updated_count = 0\n\n            for airtable_club in airtable_clubs:\n                # Try to find existing club by leader email\n                leader_email = airtable_club.get('leader_email')\n                if not leader_email:\n                    continue\n\n                leader = User.query.filter_by(email=leader_email).first()\n                existing_club = None\n\n                if leader:\n                    existing_club = Club.query.filter_by(leader_id=leader.id).first()\n\n                if existing_club:\n                    # Update existing club\n                    if self.sync_club_with_airtable(existing_club.id, airtable_club):\n                        updated_count += 1\n                else:\n                    # Create new club\n                    new_club = self.create_club_from_airtable(airtable_club)\n                    if new_club:\n                        created_count += 1\n\n            return {\n                'success': True,\n                'created': created_count,\n                'updated': updated_count,\n                'total_airtable_clubs': len(airtable_clubs)\n            }\n\n        except Exception as e:\n            app.logger.error(f\"Error syncing all clubs with Airtable: {str(e)}\")\n            return {\n                'success': False,\n                'error': str(e)\n            }\n\n    def submit_project_data(self, submission_data):\n        \"\"\"Submit project submission data to Airtable\"\"\"\n        if not self.api_token:\n            app.logger.error(\"AIRTABLE: API token not configured\")\n            return None\n\n        try:\n            # Use YSWS Project Submission table\n            project_table_name = urllib.parse.quote('YSWS Project Submission')\n            project_url = f'https://api.airtable.com/v0/{self.base_id}/{project_table_name}'\n\n            app.logger.info(f\"AIRTABLE: Submitting to URL: {project_url}\")\n\n            fields = {\n                'Address (Line 1)': submission_data.get('address_1', ''),\n                'Birthday': submission_data.get('birthday', ''),\n                'City': submission_data.get('city', ''),\n                'Club Name': submission_data.get('club_name', ''),\n                'Code URL': submission_data.get('github_url', ''),\n                'Country': submission_data.get('country', ''),\n                'Description': submission_data.get('project_description', ''),\n                'Email': submission_data.get('email', ''),\n                'First Name': submission_data.get('first_name', ''),\n                'GitHub Username': submission_data.get('github_username', ''),\n                'Hackatime Project': submission_data.get('project_name', ''),\n                'Hours': float(str(submission_data.get('project_hours', '0')).strip()),\n                'How can we improve?': submission_data.get('improve', ''),\n                'How did you hear about this?': 'Through Club Leader Dashboard',\n                'Last Name': submission_data.get('last_name', ''),\n                'Leader Email': submission_data.get('leader_email', ''),\n                'Playable URL': submission_data.get('live_url', ''),\n                'State / Province': submission_data.get('state', ''),\n                'Status': 'Pending',\n                'What are we doing well?': submission_data.get('doing_well', ''),\n                'ZIP / Postal Code': submission_data.get('zip', '')\n            }\n\n            # Remove empty fields to avoid validation issues\n            fields = {k: v for k, v in fields.items() if v not in [None, '', []]}\n\n            app.logger.info(f\"AIRTABLE: Submitting fields: {list(fields.keys())}\")\n            app.logger.info(f\"AIRTABLE: Project name: {fields.get('Hackatime Project', 'NOT_FOUND')}\")\n            app.logger.info(f\"AIRTABLE: Hours: {fields.get('Hours', 'NOT_FOUND')}\")\n\n            payload = {'records': [{'fields': fields}]}\n\n            response = self._safe_request('POST', project_url, headers=self.headers, json=payload)\n\n            app.logger.info(f\"AIRTABLE: Response status: {response.status_code}\")\n            if response.status_code not in [200, 201]:\n                app.logger.error(f\"AIRTABLE: Submission failed: {response.text}\")\n                return None\n\n            result = response.json()\n            app.logger.info(f\"AIRTABLE: Successfully submitted project! Record ID: {result.get('records', [{}])[0].get('id', 'UNKNOWN')}\")\n            return result\n\n        except Exception as e:\n            app.logger.error(f\"AIRTABLE: Exception in submit_project_data: {str(e)}\")\n            return None\n\n    def get_ysws_project_submissions(self):\n        \"\"\"Get all YSWS project submissions from Airtable\"\"\"\n        if not self.api_token:\n            app.logger.error(\"AIRTABLE: API token not configured\")\n            return []\n\n        try:\n            project_table_name = urllib.parse.quote('YSWS Project Submission')\n            project_url = f'https://api.airtable.com/v0/{self.base_id}/{project_table_name}'\n\n            all_records = []\n            offset = None\n\n            while True:\n                params = {}\n                if offset:\n                    params['offset'] = offset\n\n                response = self._safe_request('GET', project_url, headers=self.headers, params=params)\n\n                if response.status_code != 200:\n                    app.logger.error(f\"AIRTABLE: Failed to fetch project submissions: {response.text}\")\n                    break\n\n                data = response.json()\n                records = data.get('records', [])\n                all_records.extend(records)\n\n                offset = data.get('offset')\n                if not offset:\n                    break\n\n            # Transform records to a more usable format\n            submissions = []\n            for record in all_records:\n                fields = record.get('fields', {})\n                submission = {\n                    'id': record.get('id'),\n                    'firstName': fields.get('First Name', ''),\n                    'lastName': fields.get('Last Name', ''),\n                    'email': fields.get('Email', ''),\n                    'age': fields.get('Age', ''),\n                    'codeUrl': fields.get('Code URL', ''),\n                    'playableUrl': fields.get('Playable URL', ''),\n                    'description': fields.get('Description', ''),\n                    'githubUsername': fields.get('GitHub Username', ''),\n                    'addressLine1': fields.get('Address (Line 1)', ''),\n                    'addressLine2': fields.get('Address (Line 2)', ''),\n                    'city': fields.get('City', ''),\n                    'country': fields.get('Country', ''),\n                    'zipCode': fields.get('ZIP / Postal Code', ''),\n                    'birthday': fields.get('Birthday', ''),\n                    'hackatimeProject': fields.get('Hackatime Project', ''),\n                    'hours': fields.get('Hours', ''),\n                    'grantAmount': fields.get('Grant Amount Override') or fields.get('Grant Amount', ''),\n                    'clubName': fields.get('Club Name', ''),\n                    'leaderEmail': fields.get('Leader Email', ''),\n                    'status': fields.get('Status', 'Pending'),\n                    'autoReviewStatus': fields.get('Auto Review Status', ''),\n                    'decisionReason': fields.get('Decision Reason', ''),\n                    'howDidYouHear': fields.get('How did you hear about this?', ''),\n                    'whatAreWeDoingWell': fields.get('What are we doing well?', ''),\n                    'howCanWeImprove': fields.get('How can we improve?', ''),\n                    'screenshot': fields.get('Screenshot', ''),\n                    'grantOverrideReason': fields.get('Grant Override Reason', ''),\n                    'createdTime': record.get('createdTime', '')\n                }\n\n                # Handle screenshot attachment if it's an array\n                if isinstance(submission['screenshot'], list) and len(submission['screenshot']) > 0:\n                    submission['screenshot'] = submission['screenshot'][0].get('url', '')\n                elif not isinstance(submission['screenshot'], str):\n                    submission['screenshot'] = ''\n\n                submissions.append(submission)\n\n            app.logger.info(f\"AIRTABLE: Fetched {len(submissions)} project submissions\")\n            return submissions\n\n        except Exception as e:\n            app.logger.error(f\"AIRTABLE: Exception in get_ysws_project_submissions: {str(e)}\")\n            return []\n\n    def update_ysws_project_submission(self, record_id, fields):\n        \"\"\"Update a YSWS project submission in Airtable\"\"\"\n        if not self.api_token or not record_id:\n            app.logger.error(\"AIRTABLE: API token not configured or no record ID provided\")\n            return False\n\n        try:\n            project_table_name = urllib.parse.quote('YSWS Project Submission')\n            update_url = f'https://api.airtable.com/v0/{self.base_id}/{project_table_name}/{record_id}'\n\n            # Only include fields that we're allowed to update\n            allowed_fields = {\n                'Status', 'Decision Reason', 'Grant Amount Override', 'Auto Review Status', 'Grant Override Reason'\n            }\n\n            update_fields = {k: v for k, v in fields.items() if k in allowed_fields}\n\n            payload = {'fields': update_fields}\n\n            response = self._safe_request('PATCH', update_url, headers=self.headers, json=payload)\n\n            if response.status_code == 200:\n                app.logger.info(f\"AIRTABLE: Successfully updated project submission {record_id}\")\n                return True\n            else:\n                app.logger.error(f\"AIRTABLE: Failed to update project submission: {response.text}\")\n                return False\n\n        except Exception as e:\n            app.logger.error(f\"AIRTABLE: Exception in update_ysws_project_submission: {str(e)}\")\n            return False\n\n    def delete_ysws_project_submission(self, record_id):\n        \"\"\"Delete a YSWS project submission from Airtable\"\"\"\n        if not self.api_token or not record_id:\n            app.logger.error(\"AIRTABLE: API token not configured or no record ID provided\")\n            return False\n\n        try:\n            project_table_name = urllib.parse.quote('YSWS Project Submission')\n            delete_url = f'https://api.airtable.com/v0/{self.base_id}/{project_table_name}/{record_id}'\n\n            response = self._safe_request('DELETE', delete_url, headers=self.headers)\n\n            if response.status_code == 200:\n                app.logger.info(f\"AIRTABLE: Successfully deleted project submission {record_id}\")\n                return True\n            else:\n                app.logger.error(f\"AIRTABLE: Failed to delete project submission: {response.text}\")\n                return False\n\n        except Exception as e:\n            app.logger.error(f\"AIRTABLE: Exception in delete_ysws_project_submission: {str(e)}\")\n            return False\n\n    def submit_order(self, order_data):\n        \"\"\"Submit order to Orders table\"\"\"\n        if not self.api_token:\n            return None\n\n        # Use Orders table in the shop base\n        shop_base_id = 'app7OFpfZceddfK17'\n        orders_table_name = urllib.parse.quote('Orders')\n        orders_url = f'https://api.airtable.com/v0/{shop_base_id}/{orders_table_name}'\n\n        fields = {\n            'Club Name': order_data.get('club_name', ''),\n            'Leader First Name': order_data.get('leader_first_name', ''),\n            'Leader Last Name': order_data.get('leader_last_name', ''),\n            'Leader Email': order_data.get('leader_email', ''),\n            'Club Member Amount': order_data.get('club_member_amount', 0),\n            'Product(s)': order_data.get('products', ''),\n            'Total Estimated Cost': order_data.get('total_estimated_cost', 0),\n            'Delivery Address Line 1': order_data.get('delivery_address_line_1', ''),\n            'Delivery Address Line 2': order_data.get('delivery_address_line_2', ''),\n            'City': order_data.get('delivery_city', ''),\n            'Delivery ZIP/Postal Code': order_data.get('delivery_zip', ''),\n            'Delivery State/Area': order_data.get('delivery_state', ''),\n            'Delivery Country': order_data.get('delivery_country', ''),\n            'Special Notes': order_data.get('special_notes', ''),\n            'Usage Reason': order_data.get('usage_reason', ''),\n            'Order Sources': order_data.get('order_sources', []),\n            'Shipment Status': 'Pending'\n        }\n\n        payload = {'records': [{'fields': fields}]}\n\n        try:\n            response = requests.post(orders_url, headers=self.headers, json=payload)\n            app.logger.debug(f\"Airtable Orders response status: {response.status_code}\")\n            app.logger.debug(f\"Airtable Orders response body: {response.text}\")\n            if response.status_code in [200, 201]:\n                return response.json()\n            else:\n                app.logger.error(f\"Airtable Orders error: {response.text}\")\n                return None\n        except Exception as e:\n            app.logger.error(f\"Exception submitting to Airtable Orders: {str(e)}\")\n            return None\n\n    def get_orders_for_club(self, club_name):\n        \"\"\"Get all orders for a specific club\"\"\"\n        if not self.api_token:\n            return []\n\n        shop_base_id = 'app7OFpfZceddfK17'\n        orders_table_name = urllib.parse.quote('Orders')\n        orders_url = f'https://api.airtable.com/v0/{shop_base_id}/{orders_table_name}'\n\n        try:\n            # Filter by club name\n            params = {\n                'filterByFormula': f\"{{Club Name}} = '{club_name}'\"\n            }\n\n            response = requests.get(orders_url, headers=self.headers, params=params)\n            if response.status_code == 200:\n                data = response.json()\n                records = data.get('records', [])\n\n                orders = []\n                for record in records:\n                    fields = record.get('fields', {})\n                    orders.append({\n                        'id': record['id'],\n                        'club_name': fields.get('Club Name', ''),\n                        'leader_first_name': fields.get('Leader First Name', ''),\n                        'leader_last_name': fields.get('Leader Last Name', ''),\n                        'leader_email': fields.get('Leader Email', ''),\n                        'club_member_amount': fields.get('Club Member Amount', 0),\n                        'products': fields.get('Product(s)', ''),\n                        'total_estimated_cost': fields.get('Total Estimated Cost', 0),\n                        'delivery_address_line_1': fields.get('Delivery Address Line 1', ''),\n                        'delivery_address_line_2': fields.get('Delivery Address Line 2', ''),\n                        'delivery_city': fields.get('City', ''),\n                        'delivery_zip': fields.get('Delivery ZIP/Postal Code', ''),\n                        'delivery_state': fields.get('Delivery State/Area', ''),\n                        'delivery_country': fields.get('Delivery Country', ''),\n                        'special_notes': fields.get('Special Notes', ''),\n                        'usage_reason': fields.get('Usage Reason', ''),\n                        'order_sources': fields.get('Order Sources', []),\n                        'shipment_status': fields.get('Shipment Status', 'Pending'),\n                        'created_time': record.get('createdTime', '')\n                    })\n\n                return orders\n            else:\n                app.logger.error(f\"Failed to fetch orders: {response.status_code} - {response.text}\")\n                return []\n        except Exception as e:\n            app.logger.error(f\"Error fetching orders for club {club_name}: {str(e)}\")\n            return []\n\n    def get_all_orders(self):\n        \"\"\"Get all orders for admin review\"\"\"\n        if not self.api_token:\n            return []\n\n        shop_base_id = 'app7OFpfZceddfK17'\n        orders_table_name = urllib.parse.quote('Orders')\n        orders_url = f'https://api.airtable.com/v0/{shop_base_id}/{orders_table_name}'\n\n        try:\n            all_orders = []\n            offset = None\n\n            while True:\n                params = {}\n                if offset:\n                    params['offset'] = offset\n\n                response = requests.get(orders_url, headers=self.headers, params=params)\n                if response.status_code == 200:\n                    data = response.json()\n                    records = data.get('records', [])\n\n                    for record in records:\n                        fields = record.get('fields', {})\n                        all_orders.append({\n                            'id': record['id'],\n                            'club_name': fields.get('Club Name', ''),\n                            'leader_first_name': fields.get('Leader First Name', ''),\n                            'leader_last_name': fields.get('Leader Last Name', ''),\n                            'leader_email': fields.get('Leader Email', ''),\n                            'club_member_amount': fields.get('Club Member Amount', 0),\n                            'products': fields.get('Product(s)', ''),\n                            'total_estimated_cost': fields.get('Total Estimated Cost', 0),\n                            'delivery_address_line_1': fields.get('Delivery Address Line 1', ''),\n                            'delivery_address_line_2': fields.get('Delivery Address Line 2', ''),\n                            'delivery_city': fields.get('City', ''),\n                            'delivery_zip': fields.get('Delivery ZIP/Postal Code', ''),\n                            'delivery_state': fields.get('Delivery State/Area', ''),\n                            'delivery_country': fields.get('Delivery Country', ''),\n                            'special_notes': fields.get('Special Notes', ''),\n                            'usage_reason': fields.get('Usage Reason', ''),\n                            'order_sources': fields.get('Order Sources', []),\n                            'shipment_status': fields.get('Shipment Status', 'Pending'),\n                            'reviewer_reason': fields.get('Reviewer Reason', ''),\n                            'created_time': record.get('createdTime', '')\n                        })\n\n                    offset = data.get('offset')\n                    if not offset:\n                        break\n                else:\n                    app.logger.error(f\"Failed to fetch all orders: {response.status_code} - {response.text}\")\n                    break\n\n            return all_orders\n        except Exception as e:\n            app.logger.error(f\"Error fetching all orders: {str(e)}\")\n            return []\n\n    def update_order_status(self, order_id, status, reviewer_reason):\n        \"\"\"Update order status and reviewer reason\"\"\"\n        if not self.api_token:\n            return False\n\n        shop_base_id = 'app7OFpfZceddfK17'\n        orders_table_name = urllib.parse.quote('Orders')\n        update_url = f'https://api.airtable.com/v0/{shop_base_id}/{orders_table_name}/{order_id}'\n\n        fields = {\n            'Shipment Status': status,\n            'Reviewer Reason': reviewer_reason\n        }\n\n        payload = {'fields': fields}\n\n        try:\n            response = requests.patch(update_url, headers=self.headers, json=payload)\n            app.logger.debug(f\"Airtable order update response status: {response.status_code}\")\n            app.logger.debug(f\"Airtable order update response body: {response.text}\")\n            if response.status_code == 200:\n                return response.json()\n            else:\n                app.logger.error(f\"Airtable order update error: {response.text}\")\n                return False\n        except Exception as e:\n            app.logger.error(f\"Exception updating order status: {str(e)}\")\n            return False\n\n    def delete_order(self, order_id):\n        \"\"\"Delete an order record\"\"\"\n        if not self.api_token:\n            return False\n\n        shop_base_id = 'app7OFpfZceddfK17'\n        orders_table_name = urllib.parse.quote('Orders')\n        delete_url = f'https://api.airtable.com/v0/{shop_base_id}/{orders_table_name}/{order_id}'\n\n        try:\n            response = requests.delete(delete_url, headers=self.headers)\n            app.logger.debug(f\"Airtable order delete response status: {response.status_code}\")\n            app.logger.debug(f\"Airtable order delete response body: {response.text}\")\n            if response.status_code == 200:\n                return response.json()\n            else:\n                app.logger.error(f\"Airtable order delete error: {response.text}\")\n                return False\n        except Exception as e:\n            app.logger.error(f\"Exception deleting order: {str(e)}\")\n            return False\n\n    def log_gallery_post(self, post_title, description, photos, club_name, author_username):\n        \"\"\"Log gallery post to Airtable Gallery table\"\"\"\n        if not self.api_token:\n            app.logger.error(\"AIRTABLE: API token not configured for gallery logging\")\n            return False\n\n        try:\n            gallery_base_id = 'app7OFpfZceddfK17'  # Base ID provided by user\n            gallery_table_name = urllib.parse.quote('Gallary')  # Table name provided by user (note the spelling)\n            gallery_url = f'https://api.airtable.com/v0/{gallery_base_id}/{gallery_table_name}'\n\n            # Format photos as comma-separated string (imgurl1, imgurl2, etc)\n            photos_formatted = ', '.join(photos) if photos else ''\n\n            fields = {\n                'Post Title': post_title,\n                'Description': description,\n                'Photos': photos_formatted,\n                'Club Name': club_name\n            }\n\n            payload = {'fields': fields}\n\n            app.logger.info(f\"AIRTABLE: Logging gallery post to {gallery_url}\")\n            app.logger.debug(f\"AIRTABLE: Gallery post payload: {payload}\")\n\n            response = self._safe_request('POST', gallery_url, headers=self.headers, json=payload)\n\n            app.logger.info(f\"AIRTABLE: Gallery post response status: {response.status_code}\")\n\n            if response.status_code == 200:\n                result = response.json()\n                app.logger.info(f\"AIRTABLE: Successfully logged gallery post! Record ID: {result.get('id', 'UNKNOWN')}\")\n                return True\n            else:\n                app.logger.error(f\"AIRTABLE: Gallery post logging failed: {response.text}\")\n                return False\n\n        except Exception as e:\n            app.logger.error(f\"AIRTABLE: Exception in log_gallery_post: {str(e)}\")\n            return False\n\n    def get_pizza_grants(self):\n        \"\"\"Get all pizza grants from Grants table\"\"\"\n        if not self.api_token:\n            app.logger.error(\"AIRTABLE: API token not configured\")\n            return []\n\n        try:\n            grants_table_name = urllib.parse.quote('Grants')\n            grants_url = f'https://api.airtable.com/v0/{self.base_id}/{grants_table_name}'\n\n            all_records = []\n            offset = None\n\n            while True:\n                params = {}\n                if offset:\n                    params['offset'] = offset\n\n                response = self._safe_request('GET', grants_url, headers=self.headers, params=params)\n\n                if response.status_code != 200:\n                    app.logger.error(f\"AIRTABLE: Failed to fetch pizza grants: {response.text}\")\n                    break\n\n                data = response.json()\n                records = data.get('records', [])\n                all_records.extend(records)\n\n                offset = data.get('offset')\n                if not offset:\n                    break\n\n            # Transform records to a more usable format\n            grants = []\n            for record in all_records:\n                fields = record.get('fields', {})\n                grants.append({\n                    'id': record.get('id'),\n                    'club': fields.get('Club', ''),\n                    'email': fields.get('Email', ''),\n                    'status': fields.get('Status', ''),\n                    'grant_amount': fields.get('Grant Amount', 0),\n                    'grant_type': fields.get('Grant Type', ''),\n                    'address': fields.get('Address', ''),\n                    'order_id': fields.get('Order ID', ''),\n                    'created_time': record.get('createdTime', '')\n                })\n\n            app.logger.info(f\"AIRTABLE: Fetched {len(grants)} pizza grants\")\n            return grants\n\n        except Exception as e:\n            app.logger.error(f\"AIRTABLE: Exception in get_pizza_grants: {str(e)}\")\n            return []\n\n    def update_pizza_grant(self, grant_id, status, notes, reviewer_username):\n        \"\"\"Update a pizza grant status\"\"\"\n        if not self.api_token or not grant_id:\n            app.logger.error(\"AIRTABLE: API token not configured or no grant ID provided\")\n            return False\n\n        try:\n            grants_table_name = urllib.parse.quote('Grants')\n            update_url = f'https://api.airtable.com/v0/{self.base_id}/{grants_table_name}/{grant_id}'\n\n            fields = {\n                'Status': status.capitalize(),\n                'Reviewer': reviewer_username\n            }\n\n            if notes:\n                fields['Notes'] = notes\n\n            payload = {'fields': fields}\n\n            response = self._safe_request('PATCH', update_url, headers=self.headers, json=payload)\n\n            if response.status_code == 200:\n                app.logger.info(f\"AIRTABLE: Successfully updated pizza grant {grant_id}\")\n                return True\n            else:\n                app.logger.error(f\"AIRTABLE: Failed to update pizza grant: {response.text}\")\n                return False\n\n        except Exception as e:\n            app.logger.error(f\"AIRTABLE: Exception in update_pizza_grant: {str(e)}\")\n            return False\n\n    def delete_pizza_grant(self, grant_id):\n        \"\"\"Delete a pizza grant from Grants table\"\"\"\n        if not self.api_token or not grant_id:\n            app.logger.error(\"AIRTABLE: API token not configured or no grant ID provided\")\n            return False\n\n        try:\n            grants_table_name = urllib.parse.quote('Grants')\n            delete_url = f'https://api.airtable.com/v0/{self.base_id}/{grants_table_name}/{grant_id}'\n\n            response = self._safe_request('DELETE', delete_url, headers=self.headers)\n\n            if response.status_code == 200:\n                app.logger.info(f\"AIRTABLE: Successfully deleted pizza grant {grant_id}\")\n                return True\n            else:\n                app.logger.error(f\"AIRTABLE: Failed to delete pizza grant: {response.text}\")\n                return False\n\n        except Exception as e:\n            app.logger.error(f\"AIRTABLE: Exception in delete_pizza_grant: {str(e)}\")\n            return False\n\n\n# Create singleton instance\nairtable_service = AirtableService()\n","size_bytes":71972},"app/services/hackatime.py":{"content":"\"\"\"\nHackatime Service for fetching user statistics and projects\n\"\"\"\nimport os\nimport requests\n\n# This will be properly initialized when imported by the app\napp = None\n\n\ndef init_service(flask_app):\n    \"\"\"Initialize the service with app context\"\"\"\n    global app\n    app = flask_app\n\n\nclass HackatimeService:\n    def __init__(self):\n        self.base_url = \"https://hackatime.hackclub.com/api/v1\"\n        self.bypass_token = os.environ.get('HACKATIME_RL_BYPASS')\n\n    def get_user_stats(self, api_key):\n        if not api_key:\n            app.logger.warning(\"get_user_stats: No API key provided\")\n            return None\n\n        # Mask API key for logging (show first 8 and last 4 characters)\n        masked_key = f\"{api_key[:8]}...{api_key[-4:]}\" if len(api_key) > 12 else \"***\"\n        app.logger.info(f\"get_user_stats: Making request to Hackatime API with key {masked_key}\")\n\n        url = f\"{self.base_url}/users/my/stats?features=projects\"\n        headers = {\"Authorization\": f\"Bearer {api_key}\"}\n\n        # Add rate limit bypass header if available\n        if self.bypass_token:\n            headers[\"Rack-Attack-Bypass\"] = self.bypass_token\n\n        try:\n            app.logger.info(f\"get_user_stats: Requesting URL: {url}\")\n            response = requests.get(url, headers=headers, timeout=10)\n            app.logger.info(f\"get_user_stats: Response status: {response.status_code}\")\n\n            if response.status_code == 200:\n                data = response.json()\n                app.logger.info(f\"get_user_stats: Success - received data with keys: {list(data.keys()) if isinstance(data, dict) else 'non-dict response'}\")\n                if isinstance(data, dict) and 'data' in data:\n                    projects_count = len(data['data'].get('projects', []))\n                    app.logger.info(f\"get_user_stats: Found {projects_count} projects in response\")\n                else:\n                    app.logger.warning(\"get_user_stats: Response missing 'data' key or not a dict\")\n                return data\n            else:\n                app.logger.error(f\"get_user_stats: API request failed with status {response.status_code}\")\n                try:\n                    error_body = response.text[:500]  # Limit error body length\n                    app.logger.error(f\"get_user_stats: Error response body: {error_body}\")\n                except:\n                    app.logger.error(\"get_user_stats: Could not read error response body\")\n                return None\n        except requests.exceptions.Timeout:\n            app.logger.error(\"get_user_stats: Request timed out after 10 seconds\")\n            return None\n        except requests.exceptions.RequestException as e:\n            app.logger.error(f\"get_user_stats: Request exception: {str(e)}\")\n            return None\n        except Exception as e:\n            app.logger.error(f\"get_user_stats: Unexpected error: {str(e)}\")\n            return None\n\n    def get_user_projects(self, api_key):\n        masked_key = f\"{api_key[:8]}...{api_key[-4:]}\" if len(api_key) > 12 else \"***\"\n        app.logger.info(f\"get_user_projects: Starting for API key {masked_key}\")\n\n        stats = self.get_user_stats(api_key)\n        if not stats:\n            app.logger.warning(\"get_user_projects: get_user_stats returned None\")\n            return []\n\n        if 'data' not in stats:\n            app.logger.warning(f\"get_user_projects: stats missing 'data' key. Stats keys: {list(stats.keys())}\")\n            return []\n\n        projects = stats['data'].get('projects', [])\n        app.logger.info(f\"get_user_projects: Found {len(projects)} total projects\")\n\n        if not projects:\n            app.logger.info(\"get_user_projects: No projects found in API response\")\n            return []\n\n        # Log project details for debugging\n        for i, project in enumerate(projects[:5]):  # Log first 5 projects\n            project_name = project.get('name', 'unnamed')\n            total_seconds = project.get('total_seconds', 0)\n            app.logger.info(f\"get_user_projects: Project {i+1}: '{project_name}' with {total_seconds} seconds\")\n\n        active_projects = [p for p in projects if p.get('total_seconds', 0) > 0]\n        app.logger.info(f\"get_user_projects: {len(active_projects)} projects have activity (>0 seconds)\")\n\n        active_projects.sort(key=lambda x: x.get('total_seconds', 0), reverse=True)\n\n        for project in active_projects:\n            total_seconds = project.get('total_seconds', 0)\n            project['formatted_time'] = self.format_duration(total_seconds)\n\n        app.logger.info(f\"get_user_projects: Returning {len(active_projects)} active projects\")\n        return active_projects\n\n    def format_duration(self, total_seconds):\n        if total_seconds < 60:\n            return f\"{total_seconds}s\"\n        minutes = total_seconds // 60\n        hours = minutes // 60\n        days = hours // 24\n        remaining_hours = hours % 24\n        remaining_minutes = minutes % 60\n        parts = []\n        if days > 0:\n            parts.append(f\"{days}d\")\n        if remaining_hours > 0:\n            parts.append(f\"{remaining_hours}h\")\n        if remaining_minutes > 0:\n            parts.append(f\"{remaining_minutes}m\")\n        return \" \".join(parts) if parts else \"0m\"\n","size_bytes":5250},"static/js/dash-mobile.js":{"content":"// Mobile Club Dashboard JavaScript\n\n\nclass MobileClubDashboard {\n    constructor() {\n        this.clubId = null;\n        this.joinCode = null;\n        this.isLeader = false;\n        this.currentSection = 'dashboard';\n        this.isLoading = true;\n        this.loadingTimeout = null;\n        this.data = {\n            posts: [],\n            assignments: [],\n            meetings: [],\n            projects: [],\n            resources: [],\n            submissions: []\n        };\n\n        this.init();\n    }\n\n    async init() {\n        try {\n            // Show loading screen\n            this.showLoadingScreen();\n\n            // Get club data\n            this.extractClubData();\n\n            // Set up event listeners\n            this.setupEventListeners();\n\n            // Initialize PWA functionality\n            this.initPWA();\n\n            // Add enhanced interactions\n            this.addRippleEffect();\n            this.createActiveIndicator();\n\n            // Load initial data\n            await this.loadInitialData();\n        } catch (error) {\n            console.error('Error initializing mobile dashboard:', error);\n        } finally {\n            // Always hide loading screen\n            this.hideLoadingScreen();\n        }\n    }\n\n    extractClubData() {\n        const dashboard = document.getElementById('mobileDashboard');\n        if (dashboard) {\n            this.clubId = dashboard.dataset.clubId;\n            this.joinCode = dashboard.dataset.joinCode;\n            this.isLeader = window.clubData?.isLeader || false;\n\n        }\n    }\n\n    showLoadingScreen() {\n        const loadingScreen = document.getElementById('mobileLoadingScreen');\n        const dashboard = document.getElementById('mobileDashboard');\n\n        if (loadingScreen && dashboard) {\n            loadingScreen.style.display = 'flex';\n            dashboard.style.display = 'none';\n            document.body.classList.add('mobile-dashboard-active');\n        }\n    }\n\n    hideLoadingScreen() {\n        const loadingScreen = document.getElementById('mobileLoadingScreen');\n        const dashboard = document.getElementById('mobileDashboard');\n\n        if (loadingScreen && dashboard) {\n            loadingScreen.style.opacity = '0';\n            setTimeout(() => {\n                loadingScreen.style.display = 'none';\n                dashboard.style.display = 'flex';\n                this.isLoading = false;\n\n                // Trigger entrance animations\n                this.triggerEntranceAnimations();\n            }, 300);\n        }\n    }\n\n    triggerEntranceAnimations() {\n        // Immediate animations - no delays\n        const statCards = document.querySelectorAll('.stat-card');\n        statCards.forEach((card) => {\n            card.style.animationDelay = '0s';\n        });\n\n        // Immediate animations - no delays\n        const quickActions = document.querySelectorAll('.quick-action-btn');\n        quickActions.forEach((button) => {\n            button.style.animationDelay = '0s';\n        });\n\n        // Add scroll animations\n        this.setupScrollAnimations();\n    }\n\n    addRippleEffect() {\n        // Enhanced ripple effect for all interactive elements\n        const selectors = [\n            '.mobile-btn-primary',\n            '.quick-action-btn',\n            '.stat-card',\n            '.mobile-card',\n            '.nav-tab',\n            '.action-btn',\n            '.member-card'\n        ];\n        \n        selectors.forEach(selector => {\n            document.addEventListener('click', (e) => {\n                const element = e.target.closest(selector);\n                if (!element) return;\n                \n                this.createRipple(element, e);\n            });\n        });\n    }\n\n    createRipple(element, event) {\n        const ripple = document.createElement('span');\n        const rect = element.getBoundingClientRect();\n        const size = Math.max(rect.width, rect.height) * 1.5;\n        const x = event.clientX - rect.left - size / 2;\n        const y = event.clientY - rect.top - size / 2;\n        \n        ripple.className = 'ripple-effect';\n        ripple.style.cssText = `\n            position: absolute;\n            border-radius: 50%;\n            background: rgba(255, 255, 255, 0.3);\n            transform: scale(0);\n            animation: superRipple 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n            width: ${size}px;\n            height: ${size}px;\n            left: ${x}px;\n            top: ${y}px;\n            pointer-events: none;\n            z-index: 1000;\n        `;\n        \n        element.style.position = 'relative';\n        element.style.overflow = 'hidden';\n        element.appendChild(ripple);\n        \n        setTimeout(() => {\n            if (ripple.parentNode) {\n                ripple.remove();\n            }\n        }, 400);\n    }\n\n    setupScrollAnimations() {\n        const observerOptions = {\n            threshold: 0.1,\n            rootMargin: '0px 0px -50px 0px'\n        };\n\n        const observer = new IntersectionObserver((entries) => {\n            entries.forEach(entry => {\n                if (entry.isIntersecting) {\n                    entry.target.style.opacity = '1';\n                    entry.target.style.transform = 'translateY(0)';\n                } else {\n                    entry.target.style.opacity = '0';\n                    entry.target.style.transform = 'translateY(20px)';\n                }\n            });\n        }, observerOptions);\n\n        // Observe cards for scroll animations\n        const animatedElements = document.querySelectorAll('.mobile-card');\n        animatedElements.forEach(el => {\n            el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';\n            observer.observe(el);\n        });\n    }\n\n    setupEventListeners() {\n        // Navigation tabs\n        document.querySelectorAll('.nav-tab').forEach(tab => {\n            tab.addEventListener('click', (e) => {\n                e.preventDefault();\n                const section = tab.dataset.section;\n                this.openTab(section);\n            });\n        });\n\n        // Touch gestures for better mobile experience\n        this.setupTouchGestures();\n\n        // Form submissions\n        this.setupFormHandlers();\n\n        // Pull to refresh\n        this.setupPullToRefresh();\n    }\n\n    setupTouchGestures() {\n        let startY = 0;\n        let startX = 0;\n        const content = document.getElementById('mobileContent');\n\n        if (content) {\n            content.addEventListener('touchstart', (e) => {\n                startY = e.touches[0].clientY;\n                startX = e.touches[0].clientX;\n            }, { passive: true });\n\n            content.addEventListener('touchmove', (e) => {\n                // Prevent rubber band effect on iOS\n                if (content.scrollTop === 0 && e.touches[0].clientY > startY) {\n                    e.preventDefault();\n                }\n            }, { passive: false });\n        }\n    }\n\n    setupFormHandlers() {\n        // Mobile club settings form\n        const settingsForm = document.getElementById('mobileClubSettingsForm');\n        if (settingsForm) {\n            settingsForm.addEventListener('submit', (e) => {\n                e.preventDefault();\n                this.saveClubSettings();\n            });\n        }\n    }\n\n    setupPullToRefresh() {\n        let startY = 0;\n        let pullDistance = 0;\n        const content = document.getElementById('mobileContent');\n        const threshold = 80;\n\n        if (content) {\n            content.addEventListener('touchstart', (e) => {\n                if (content.scrollTop === 0) {\n                    startY = e.touches[0].clientY;\n                }\n            }, { passive: true });\n\n            content.addEventListener('touchmove', (e) => {\n                if (content.scrollTop === 0 && startY > 0) {\n                    pullDistance = e.touches[0].clientY - startY;\n                    if (pullDistance > 0 && pullDistance < threshold * 2) {\n                        content.style.transform = `translateY(${pullDistance * 0.5}px)`;\n                        content.style.opacity = `${1 - (pullDistance / threshold) * 0.3}`;\n                    }\n                }\n            }, { passive: true });\n\n            content.addEventListener('touchend', () => {\n                if (pullDistance > threshold) {\n                    this.refreshData();\n                }\n                content.style.transform = '';\n                content.style.opacity = '';\n                startY = 0;\n                pullDistance = 0;\n            }, { passive: true });\n        }\n    }\n\n    async refreshData() {\n        await this.loadAllData();\n    }\n\n    openTab(sectionName) {\n        if (this.isLoading) return;\n\n\n        // Handle detail sections\n        if (['schedule', 'resources', 'pizza', 'shop', 'ysws', 'settings'].includes(sectionName)) {\n            this.openDetailSection(sectionName);\n            return;\n        }\n\n        // Update active tab with sliding indicator\n        document.querySelectorAll('.nav-tab').forEach(tab => {\n            tab.classList.remove('active');\n        });\n\n        const activeTab = document.querySelector(`.nav-tab[data-section=\"${sectionName}\"]`);\n        if (activeTab) {\n            activeTab.classList.add('active');\n            this.updateActiveIndicator(activeTab);\n        }\n\n        // Fast section switching without complex animations\n        document.querySelectorAll('.mobile-section').forEach(section => {\n            section.classList.remove('active');\n        });\n\n        const targetSection = document.getElementById(`${sectionName}Section`);\n        if (targetSection) {\n            targetSection.classList.add('active');\n            this.currentSection = sectionName;\n\n            // Load section data if needed\n            this.loadSectionData(sectionName);\n        }\n    }\n\n    updateActiveIndicator(activeTab) {\n        const indicator = document.querySelector('.nav-active-indicator') || this.createActiveIndicator();\n        const tabRect = activeTab.getBoundingClientRect();\n        const navRect = document.querySelector('.nav-tabs').getBoundingClientRect();\n        \n        const left = tabRect.left - navRect.left;\n        const width = tabRect.width;\n        \n        indicator.style.transform = `translateX(${left}px)`;\n        indicator.style.width = `${width}px`;\n    }\n\n    createActiveIndicator() {\n        const indicator = document.createElement('div');\n        indicator.className = 'nav-active-indicator';\n        document.querySelector('.nav-tabs').appendChild(indicator);\n        return indicator;\n    }\n\n    openDetailSection(sectionName) {\n        const detailSection = document.getElementById(`${sectionName}Detail`);\n        if (detailSection) {\n            // Add body class to hide header/nav\n            document.body.classList.add('detail-section-open');\n            \n            detailSection.style.display = 'flex';\n            detailSection.style.transform = 'translateX(100%)';\n            detailSection.style.transition = 'transform 0.2s ease';\n            detailSection.classList.add('active');\n\n            setTimeout(() => {\n                detailSection.style.transform = 'translateX(0)';\n            }, 10);\n\n            // Load section data\n            this.loadSectionData(sectionName);\n        }\n    }\n\n    closeDetailSection() {\n        const activeDetail = document.querySelector('.detail-section.active, .detail-section[style*=\"flex\"]');\n        if (activeDetail) {\n            activeDetail.style.transform = 'translateX(100%)';\n            activeDetail.classList.remove('active');\n            \n            setTimeout(() => {\n                activeDetail.style.display = 'none';\n                // Remove body class to show header/nav again\n                document.body.classList.remove('detail-section-open');\n            }, 200);\n        }\n    }\n\n    async loadInitialData() {\n        await this.loadAllData();\n        this.updateStats();\n    }\n\n    async loadAllData() {\n        try {\n            const promises = [\n                this.fetchData('posts'),\n                this.fetchData('assignments'),\n                this.fetchData('meetings'),\n                this.fetchData('projects')\n            ];\n\n            await Promise.all(promises);\n        } catch (error) {\n            console.error('Error loading data:', error);\n            this.showToast('Error loading data', 'error');\n        }\n    }\n\n    async loadSectionData(sectionName) {\n        switch (sectionName) {\n            case 'stream':\n                await this.loadPosts();\n                break;\n            case 'assignments':\n                await this.loadAssignments();\n                break;\n            case 'projects':\n                await this.loadProjects();\n                break;\n            case 'schedule':\n                await this.loadMeetings();\n                break;\n            case 'resources':\n                await this.loadResources();\n                break;\n            case 'pizza':\n                await this.loadSubmissions();\n                break;\n        }\n    }\n\n    async fetchData(endpoint) {\n        try {\n            const response = await fetch(`/api/clubs/${this.clubId}/${endpoint}`);\n            if (response.ok) {\n                const data = await response.json();\n                \n                // Handle different response formats\n                let arrayData;\n                if (Array.isArray(data)) {\n                    arrayData = data;\n                } else if (data && typeof data === 'object') {\n                    // Try common array property names\n                    arrayData = data.items || data.data || data[endpoint] || data.results || [];\n                    \n                    // If it's still not an array, wrap single object in array\n                    if (!Array.isArray(arrayData)) {\n                        arrayData = [data];\n                    }\n                } else {\n                    arrayData = [];\n                }\n                \n                this.data[endpoint] = arrayData;\n                return arrayData;\n            } else {\n                console.error(`Failed to fetch ${endpoint}: ${response.status} ${response.statusText}`);\n                throw new Error(`Failed to fetch ${endpoint}: ${response.status}`);\n            }\n        } catch (error) {\n            console.error(`Error fetching ${endpoint}:`, error);\n            throw error;\n        }\n    }\n\n    async loadPosts() {\n        const container = document.getElementById('mobilePostsList');\n        if (!container) return;\n\n        this.showSectionLoading(container, 'Loading posts...');\n\n        try {\n            const posts = await this.fetchData('posts');\n\n            if (!Array.isArray(posts) || posts.length === 0) {\n                container.innerHTML = this.getEmptyState('stream', 'No posts yet', 'Be the first to share something!');\n            } else {\n                container.innerHTML = posts.map(post => this.renderPost(post)).join('');\n            }\n        } catch (error) {\n            console.error('Error loading posts:', error);\n            console.error('Mobile error details:', {\n                message: error.message,\n                stack: error.stack,\n                timestamp: new Date().toISOString()\n            });\n            \n            let errorMessage = 'Please try again later';\n            if (error.message && error.message.includes('JSON')) {\n                errorMessage = 'Server error - check console for details';\n            }\n            \n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading posts', errorMessage);\n        }\n    }\n\n    async loadAssignments() {\n        const container = document.getElementById('mobileAssignmentsList');\n        if (!container) return;\n\n        this.showSectionLoading(container, 'Loading assignments...');\n\n        try {\n            const assignments = await this.fetchData('assignments');\n\n            if (!Array.isArray(assignments) || assignments.length === 0) {\n                container.innerHTML = this.getEmptyState('tasks', 'No assignments yet', 'Check back for new coding challenges!');\n            } else {\n                container.innerHTML = assignments.map(assignment => this.renderAssignment(assignment)).join('');\n            }\n        } catch (error) {\n            console.error('Error loading assignments:', error);\n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading assignments', 'Please try again later');\n        }\n    }\n\n    async loadMeetings() {\n        const container = document.getElementById('mobileMeetingsList');\n        if (!container) return;\n\n        this.showSectionLoading(container, 'Loading meetings...');\n\n        try {\n            const meetings = await this.fetchData('meetings');\n\n            if (!Array.isArray(meetings) || meetings.length === 0) {\n                container.innerHTML = this.getEmptyState('calendar-times', 'No meetings scheduled', 'Check back for upcoming events!');\n            } else {\n                container.innerHTML = meetings.map(meeting => this.renderMeeting(meeting)).join('');\n            }\n        } catch (error) {\n            console.error('Error loading meetings:', error);\n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading meetings', 'Please try again later');\n        }\n    }\n\n    async loadProjects() {\n        // Projects are handled differently - they show Hackatime integration\n        const projects = await this.fetchData('projects');\n        this.updateProjectsCount(projects);\n    }\n\n    async loadHackatimeProjects() {\n        const memberId = document.getElementById('mobileHackatimeMemberSelect').value;\n        const container = document.getElementById('mobileHackatimeProjectsList');\n        \n        if (!memberId || !container) {\n            container.innerHTML = this.getEmptyState('user', 'Select a member', 'Choose a member to view their coding projects');\n            return;\n        }\n\n        this.showSectionLoading(container, 'Loading Hackatime projects...');\n\n        try {\n            const response = await fetch(`/api/hackatime/projects/${memberId}`);\n            const data = await response.json();\n            \n            if (data.error) {\n                container.innerHTML = this.getEmptyState('exclamation-triangle', 'Unable to load projects', data.error);\n                return;\n            }\n            \n            if (data.projects && data.projects.length > 0) {\n                const title = `<h4 style=\"margin-bottom: 1rem; color: #1a202c;\">${data.username}'s Hackatime Projects</h4>`;\n                const projectsHtml = data.projects.map(project => this.renderHackatimeProject(project)).join('');\n                container.innerHTML = title + projectsHtml;\n            } else {\n                container.innerHTML = this.getEmptyState('clock', 'No projects found', `${data.username} hasn't logged any coding time yet on Hackatime`);\n            }\n        } catch (error) {\n            console.error('Error loading Hackatime projects:', error);\n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading projects', 'Failed to fetch Hackatime data. Please try again.');\n        }\n    }\n\n    renderHackatimeProject(project) {\n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;\">\n                    <h4 style=\"margin: 0; color: #1a202c; font-size: 1rem;\">\n                        <i class=\"fas fa-code\"></i> ${project.name}\n                    </h4>\n                    <span style=\"background: #10b981; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">${project.formatted_time}</span>\n                </div>\n                <div style=\"display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem; color: #6b7280;\">\n                    <span style=\"display: flex; align-items: center; gap: 0.25rem;\">\n                        <i class=\"fas fa-clock\"></i> ${project.total_seconds.toLocaleString()} seconds\n                    </span>\n                    ${project.percent ? `<span style=\"display: flex; align-items: center; gap: 0.25rem;\"><i class=\"fas fa-chart-pie\"></i> ${project.percent.toFixed(1)}% of total time</span>` : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    async loadResources() {\n        const container = document.getElementById('mobileResourcesList');\n        if (!container) return;\n\n        this.showSectionLoading(container, 'Loading resources...');\n\n        try {\n            const resources = await this.fetchData('resources');\n\n            if (!Array.isArray(resources) || resources.length === 0) {\n                container.innerHTML = this.getEmptyState('book', 'No resources yet', 'Add helpful links and materials!');\n            } else {\n                container.innerHTML = resources.map(resource => this.renderResource(resource)).join('');\n            }\n        } catch (error) {\n            console.error('Error loading resources:', error);\n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading resources', 'Please try again later');\n        }\n    }\n\n    renderPost(post) {\n        const isLeader = window.clubData && window.clubData.isLeader;\n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem;\">\n                    <div style=\"display: flex; align-items: center; gap: 0.75rem;\">\n                        <div style=\"width: 40px; height: 40px; background: #3b82f6; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;\">\n                            ${post.user.username[0].toUpperCase()}\n                        </div>\n                        <div>\n                            <div style=\"font-weight: 600; color: #1a202c; font-size: 0.9rem;\">${post.user.username}</div>\n                            <div style=\"color: #6b7280; font-size: 0.75rem;\">${new Date(post.created_at).toLocaleDateString()}</div>\n                        </div>\n                    </div>\n                    ${isLeader ? `\n                        <button onclick=\"deletePost(${post.id}, '${post.content.replace(/'/g, \"\\\\'\")}'); this.closest('.mobile-card').remove();\" \n                                style=\"background: none; border: none; color: #ef4444; cursor: pointer; padding: 0.25rem;\">\n                            <i class=\"fas fa-trash\"></i>\n                        </button>\n                    ` : ''}\n                </div>\n                <div class=\"mobile-post-content\" style=\"color: #374151; line-height: 1.6;\">\n                    ${post.content_html || post.content.replace(/\\n/g, '<br>')}\n                </div>\n            </div>\n        `;\n    }\n\n    // Initialize PWA functionality\n    initPWA() {\n        // Register service worker if available\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.register('/static/sw.js')\n                .then(registration => {\n                    console.log('ServiceWorker registration successful:', registration.scope);\n                })\n                .catch(err => {\n                    console.log('ServiceWorker registration failed:', err);\n                });\n        }\n\n        // Handle install prompt\n        let deferredPrompt;\n        window.addEventListener('beforeinstallprompt', (e) => {\n            e.preventDefault();\n            deferredPrompt = e;\n            // Could show install button here if needed\n        });\n    }\n\n    // Show loading state in a section\n    showSectionLoading(container, message = 'Loading...') {\n        if (!container) return;\n        \n        container.innerHTML = `\n            <div style=\"display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 3rem; text-align: center;\">\n                <div class=\"loading-spinner\" style=\"width: 40px; height: 40px; border: 3px solid #e2e8f0; border-radius: 50%; border-top-color: #ec3750; animation: spin 1s linear infinite; margin-bottom: 1rem;\"></div>\n                <p style=\"color: #6b7280; font-size: 0.875rem;\">${message}</p>\n            </div>\n        `;\n    }\n\n    renderAssignment(assignment) {\n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;\">\n                    <h4 style=\"margin: 0; color: #1a202c; font-size: 1rem;\">\n                        <i class=\"fas fa-tasks\"></i> ${assignment.title}\n                    </h4>\n                    ${assignment.due_date ? `\n                        <span style=\"background: #f59e0b; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">\n                            Due ${new Date(assignment.due_date).toLocaleDateString()}\n                        </span>\n                    ` : ''}\n                </div>\n                <p style=\"margin: 0; color: #6b7280; font-size: 0.875rem; line-height: 1.5;\">\n                    ${assignment.description}\n                </p>\n            </div>\n        `;\n    }\n\n    renderMeeting(meeting) {\n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;\">\n                    <h4 style=\"margin: 0; color: #1a202c; font-size: 1rem;\">\n                        <i class=\"fas fa-calendar\"></i> ${meeting.title}\n                    </h4>\n                    <span style=\"background: #10b981; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">\n                        ${new Date(meeting.datetime).toLocaleDateString()}\n                    </span>\n                </div>\n                <p style=\"margin: 0; color: #6b7280; font-size: 0.875rem; line-height: 1.5;\">\n                    ${meeting.description || 'No description provided'}\n                </p>\n                ${meeting.location ? `\n                    <div style=\"margin-top: 0.5rem; color: #6b7280; font-size: 0.75rem;\">\n                        <i class=\"fas fa-map-marker-alt\"></i> ${meeting.location}\n                    </div>\n                ` : ''}\n            </div>\n        `;\n    }\n\n    renderResource(resource) {\n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;\">\n                    <h4 style=\"margin: 0; color: #1a202c; font-size: 1rem;\">\n                        <i class=\"fas fa-book\"></i> ${resource.title}\n                    </h4>\n                </div>\n                <p style=\"margin: 0 0 0.75rem 0; color: #6b7280; font-size: 0.875rem; line-height: 1.5;\">\n                    ${resource.description || 'No description provided'}\n                </p>\n                <a href=\"${resource.url}\" target=\"_blank\" \n                   style=\"display: inline-flex; align-items: center; gap: 0.5rem; color: #3b82f6; text-decoration: none; font-size: 0.875rem; font-weight: 500;\">\n                    <i class=\"fas fa-external-link-alt\"></i> Open Resource\n                </a>\n            </div>\n        `;\n    }\n}\n\n// Initialize mobile dashboard when DOM is ready\ndocument.addEventListener('DOMContentLoaded', function() {\n    window.mobileDashboard = new MobileClubDashboard();\n});\n\n","size_bytes":27817},"app/utils/sanitization.py":{"content":"\"\"\"\nSanitization utilities for the Hack Club Dashboard.\nContains functions for sanitizing various types of user input to prevent XSS and injection attacks.\n\"\"\"\n\nimport html\nimport re\nimport urllib.parse\nimport markdown\nfrom markdown.extensions import codehilite\nimport bleach\n\n\ndef sanitize_string(value, max_length=None, allow_html=False):\n    \"\"\"Sanitize string input to prevent XSS and injection attacks\"\"\"\n    if not value:\n        return value\n\n    # Convert to string if not already\n    value = str(value).strip()\n\n    # Limit length if specified\n    if max_length and len(value) > max_length:\n        value = value[:max_length]\n\n    # Remove or escape HTML/script tags\n    if not allow_html:\n        # Remove script tags completely\n        value = re.sub(r'<script[^>]*>.*?</script>', '', value, flags=re.IGNORECASE | re.DOTALL)\n        # Remove other potentially dangerous tags\n        value = re.sub(r'<(script|iframe|object|embed|form|input|button|link|style)[^>]*>', '', value, flags=re.IGNORECASE)\n        # Escape remaining HTML\n        value = html.escape(value)\n\n    # Remove null bytes and other control characters\n    value = re.sub(r'[\\x00-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]', '', value)\n\n    return value\n\n\ndef sanitize_css_value(value, max_length=None):\n    \"\"\"Sanitize CSS values to prevent CSS injection attacks\"\"\"\n    if not value:\n        return value\n\n    value = str(value).strip()\n\n    # Limit length if specified\n    if max_length and len(value) > max_length:\n        value = value[:max_length]\n\n    # Remove dangerous CSS patterns that could lead to XSS\n    # Remove javascript: URLs\n    value = re.sub(r'javascript:', '', value, flags=re.IGNORECASE)\n    # Remove data: URLs (except safe image types)\n    value = re.sub(r'data:(?!image/(png|jpeg|jpg|gif|webp|svg\\+xml))', '', value, flags=re.IGNORECASE)\n    # Remove expression() which can execute JavaScript in IE\n    value = re.sub(r'expression\\s*\\(', '', value, flags=re.IGNORECASE)\n    # Remove @import which could load external CSS\n    value = re.sub(r'@import', '', value, flags=re.IGNORECASE)\n    # Remove url() with non-safe protocols\n    value = re.sub(r'url\\s*\\(\\s*[\"\\']?(?!https?:)[^)]*[\"\\']?\\s*\\)', '', value, flags=re.IGNORECASE)\n    # Remove semicolons and other characters that could break out of CSS context\n    value = re.sub(r'[;\"{}]', '', value)\n    # Remove control characters\n    value = re.sub(r'[\\x00-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]', '', value)\n\n    return value\n\n\ndef sanitize_css_color(value):\n    \"\"\"Sanitize CSS color values specifically\"\"\"\n    if not value:\n        return value\n\n    value = str(value).strip()\n\n    # Only allow safe color formats\n    # Hex colors (#rgb, #rrggbb, #rrggbbaa)\n    hex_pattern = r'^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$'\n    # RGB/RGBA colors\n    rgb_pattern = r'^rgba?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*(?:,\\s*[01]?\\.?\\d*)?\\s*\\)$'\n    # HSL/HSLA colors\n    hsl_pattern = r'^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})%\\s*,\\s*(\\d{1,3})%\\s*(?:,\\s*[01]?\\.?\\d*)?\\s*\\)$'\n    # Named colors (basic set)\n    named_colors = ['transparent', 'black', 'white', 'red', 'green', 'blue', 'yellow', 'orange', 'purple', 'pink', 'gray', 'grey', 'brown']\n\n    if re.match(hex_pattern, value):\n        return value\n    elif re.match(rgb_pattern, value):\n        return value\n    elif re.match(hsl_pattern, value):\n        return value\n    elif value.lower() in named_colors:\n        return value\n    else:\n        # Return a safe default if the color format is invalid\n        return '#000000'\n\n\ndef sanitize_html_attribute(value, max_length=None):\n    \"\"\"Sanitize values for HTML attributes to prevent attribute injection\"\"\"\n    if not value:\n        return value\n\n    value = str(value).strip()\n\n    # Limit length if specified\n    if max_length and len(value) > max_length:\n        value = value[:max_length]\n\n    # Remove quotes and other characters that could break out of attribute context\n    value = re.sub(r'[\"\\'><=&]', '', value)\n    # Remove control characters\n    value = re.sub(r'[\\x00-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]', '', value)\n    # Remove potential JavaScript event attributes\n    value = re.sub(r'\\bon[a-z]+\\s*=', '', value, flags=re.IGNORECASE)\n\n    return value\n\n\ndef sanitize_url(value, max_length=None):\n    \"\"\"Sanitize URLs to prevent JavaScript injection and other attacks\"\"\"\n    if not value:\n        return value\n\n    value = str(value).strip()\n\n    # Limit length if specified\n    if max_length and len(value) > max_length:\n        value = value[:max_length]\n\n    # Only allow safe URL schemes\n    allowed_schemes = ['http', 'https', 'mailto', 'tel']\n\n    # Parse URL to check scheme\n    try:\n        parsed = urllib.parse.urlparse(value)\n        if parsed.scheme and parsed.scheme.lower() not in allowed_schemes:\n            return '#'  # Return safe default\n\n        # Ensure the URL doesn't contain dangerous patterns\n        if 'javascript:' in value.lower() or 'data:' in value.lower() or 'vbscript:' in value.lower():\n            return '#'\n\n        return value\n    except:\n        return '#'  # Return safe default if URL parsing fails\n\n\ndef markdown_to_html(markdown_content):\n    \"\"\"Convert markdown to safe HTML for club posts\"\"\"\n    if not markdown_content:\n        return \"\"\n    \n    # Configure markdown with safe extensions\n    md = markdown.Markdown(extensions=['extra', 'codehilite', 'nl2br'], \n                          extension_configs={\n                              'codehilite': {\n                                  'css_class': 'highlight',\n                                  'use_pygments': False\n                              }\n                          })\n    \n    # Convert markdown to HTML\n    html_content = md.convert(markdown_content)\n    \n    # Define allowed HTML tags and attributes for club posts\n    allowed_tags = [\n        'p', 'br', 'strong', 'b', 'em', 'i', 'u', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',\n        'ul', 'ol', 'li', 'blockquote', 'code', 'pre', 'a', 'img',\n        'table', 'thead', 'tbody', 'tr', 'th', 'td', 'hr', 'del', 'ins'\n    ]\n    \n    allowed_attributes = {\n        'a': ['href', 'title'],\n        'img': ['src', 'alt', 'title', 'width', 'height'],\n        'code': ['class'],\n        'pre': ['class'],\n        'th': ['align'],\n        'td': ['align']\n    }\n    \n    # Clean HTML with bleach to prevent XSS\n    clean_html = bleach.clean(html_content, \n                             tags=allowed_tags, \n                             attributes=allowed_attributes,\n                             protocols=['http', 'https', 'mailto'])\n    \n    return clean_html\n","size_bytes":6560},"extensions.py":{"content":"\"\"\"\nFlask extensions initialization.\nExtensions are created here and initialized later in the app factory.\n\"\"\"\nfrom flask_sqlalchemy import SQLAlchemy\nfrom flask_limiter import Limiter\nfrom flask_limiter.util import get_remote_address\n\n# Initialize extensions without app context\ndb = SQLAlchemy()\nlimiter = Limiter(\n    key_func=get_remote_address,\n    default_limits=[\"1000 per hour\"],\n    storage_uri=\"memory://\"\n)\n","size_bytes":418},"app/services/__init__.py":{"content":"\"\"\"\nExternal service integrations for the Hack Club Dashboard.\n\"\"\"\n\nfrom app.services.airtable import AirtableService\nfrom app.services.hackatime import HackatimeService\nfrom app.services.identity import HackClubIdentityService\nfrom app.services.slack_oauth import SlackOAuthService\n\n__all__ = [\n    'AirtableService',\n    'HackatimeService',\n    'HackClubIdentityService',\n    'SlackOAuthService',\n]\n","size_bytes":401},"app/decorators/__init__.py":{"content":"\"\"\"\nDecorators for the Hack Club Dashboard.\n\nThis package contains various decorators for authentication, authorization,\nrate limiting, and feature toggling.\n\"\"\"\n\nfrom app.decorators.auth import (\n    login_required,\n    permission_required,\n    role_required,\n    admin_required,\n    reviewer_required,\n    api_key_required,\n    oauth_required\n)\nfrom app.decorators.economy import economy_required\n\n__all__ = [\n    # Authentication decorators\n    'login_required',\n    'permission_required',\n    'role_required',\n    'admin_required',\n    'reviewer_required',\n    'api_key_required',\n    'oauth_required',\n    # Economy decorators\n    'economy_required',\n]\n","size_bytes":658},"app/services/slack_oauth.py":{"content":"\"\"\"\nSlack OAuth Service for Slack authentication\n\"\"\"\nimport os\nimport urllib.parse\nimport requests\nimport secrets\n\n# This will be properly initialized when imported by the app\napp = None\nsession = None\nSLACK_CLIENT_ID = None\nSLACK_CLIENT_SECRET = None\n\n\ndef init_service(flask_app, flask_session, client_id, client_secret):\n    \"\"\"Initialize the service with app context and configuration\"\"\"\n    global app, session, SLACK_CLIENT_ID, SLACK_CLIENT_SECRET\n    app = flask_app\n    session = flask_session\n    SLACK_CLIENT_ID = client_id\n    SLACK_CLIENT_SECRET = client_secret\n\n\nclass SlackOAuthService:\n    def __init__(self):\n        self.client_id = SLACK_CLIENT_ID\n        self.client_secret = SLACK_CLIENT_SECRET\n        self.base_url = \"https://slack.com/api\"\n\n    def get_auth_url(self, redirect_uri):\n        params = {\n            'client_id': self.client_id,\n            'scope': 'users:read,users:read.email,users.profile:read',\n            'user_scope': 'identity.basic,identity.email,identity.avatar',\n            'redirect_uri': redirect_uri,\n            'state': secrets.token_urlsafe(32)\n        }\n        session['oauth_state'] = params['state']\n        return f\"https://slack.com/oauth/v2/authorize?{urllib.parse.urlencode(params)}\"\n\n    def exchange_code(self, code, redirect_uri):\n        data = {\n            'client_id': self.client_id,\n            'client_secret': self.client_secret,\n            'code': code,\n            'redirect_uri': redirect_uri\n        }\n        try:\n            response = requests.post('https://slack.com/api/oauth.v2.access', data=data)\n            return response.json()\n        except:\n            return {'ok': False, 'error': 'Request failed'}\n\n    def get_user_info(self, access_token):\n        headers = {'Authorization': f'Bearer {access_token}'}\n        identity_url = f'{self.base_url}/users.identity'\n        identity_response = requests.get(identity_url, headers=headers)\n        if identity_response.status_code != 200:\n            return None\n        try:\n            identity_data = identity_response.json()\n            if not identity_data.get('ok'):\n                return None\n            user_id = identity_data['user']['id']\n            profile_url = f'{self.base_url}/users.info'\n            profile_params = {'user': user_id}\n            profile_response = requests.get(profile_url, headers=headers, params=profile_params)\n            if profile_response.status_code == 200:\n                try:\n                    profile_data = profile_response.json()\n                    if profile_data.get('ok'):\n                        identity_data['user']['profile'] = profile_data['user']['profile']\n                except:\n                    pass\n            return identity_data\n        except:\n            return None\n","size_bytes":2783},"app/utils/club_helpers.py":{"content":"\"\"\"\nClub helper utilities for the Hack Club Dashboard.\nContains functions for club membership and leadership verification.\n\"\"\"\n\n\ndef is_user_co_leader(club, user):\n    \"\"\"\n    Check if a user is a co-leader of the given club through the membership system.\n    \"\"\"\n    if not user or not club:\n        return False\n\n    # Import here to avoid circular imports\n    from app.models.club import ClubMembership\n\n    membership = ClubMembership.query.filter_by(club_id=club.id, user_id=user.id, role='co-leader').first()\n    return membership is not None\n\n\ndef verify_club_leadership(club, user, require_leader_only=False):\n    \"\"\"\n    Verify that a user has leadership privileges for a specific club.\n    Returns (is_authorized, role) tuple.\n    \"\"\"\n    if not user or not club:\n        return False, None\n\n    is_leader = club.leader_id == user.id\n    is_co_leader = is_user_co_leader(club, user)\n\n    if require_leader_only:\n        return is_leader, 'leader' if is_leader else None\n    else:\n        is_authorized = is_leader or is_co_leader\n        role = 'leader' if is_leader else ('co-leader' if is_co_leader else None)\n        return is_authorized, role\n\n\ndef club_has_gallery_post(club_id):\n    \"\"\"\n    Check if a club has made at least one gallery post.\n    Returns True if the club has at least one gallery post, False otherwise.\n    NOTE: Gallery post requirement has been disabled - always returns True.\n    \"\"\"\n    # Gallery post requirement disabled - always return True to allow shop access\n    return True\n","size_bytes":1518},"static/sw.js":{"content":"// Service Worker for Hack Club Dashboard PWA\nconst CACHE_NAME = 'hackclub-dashboard-v1';\nconst STATIC_CACHE_URLS = [\n  '/',\n  '/static/css/dash.css',\n  '/static/css/dash-mobile.css',\n  '/static/js/dash.js',\n  '/static/js/dash-mobile.js',\n  '/static/assets/logo-rounded.png',\n  '/static/manifest.json',\n  'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',\n  'https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js'\n];\n\n// Install event - cache static resources\nself.addEventListener('install', event => {\n  console.log('Service Worker installing...');\n  event.waitUntil(\n    caches.open(CACHE_NAME)\n      .then(cache => {\n        console.log('Caching static resources');\n        return cache.addAll(STATIC_CACHE_URLS.map(url => new Request(url, {\n          cache: 'reload'\n        })));\n      })\n      .catch(error => {\n        console.error('Error caching static resources:', error);\n      })\n  );\n  self.skipWaiting();\n});\n\n// Activate event - clean up old caches\nself.addEventListener('activate', event => {\n  console.log('Service Worker activating...');\n  event.waitUntil(\n    caches.keys().then(cacheNames => {\n      return Promise.all(\n        cacheNames.map(cacheName => {\n          if (cacheName !== CACHE_NAME) {\n            console.log('Deleting old cache:', cacheName);\n            return caches.delete(cacheName);\n          }\n        })\n      );\n    })\n  );\n  self.clients.claim();\n});\n\n// Fetch event - serve from cache, fallback to network\nself.addEventListener('fetch', event => {\n  // Skip non-GET requests\n  if (event.request.method !== 'GET') {\n    return;\n  }\n\n  // Skip requests to external domains (except CDNs)\n  const url = new URL(event.request.url);\n  if (url.origin !== self.location.origin && \n      !url.hostname.includes('cdnjs.cloudflare.com') && \n      !url.hostname.includes('cdn.jsdelivr.net')) {\n    return;\n  }\n\n  event.respondWith(\n    caches.match(event.request)\n      .then(response => {\n        // Return cached version if available\n        if (response) {\n          return response;\n        }\n\n        // Clone the request for fetching\n        const fetchRequest = event.request.clone();\n\n        return fetch(fetchRequest)\n          .then(response => {\n            // Check if valid response\n            if (!response || response.status !== 200 || response.type !== 'basic') {\n              return response;\n            }\n\n            // Clone the response for caching\n            const responseToCache = response.clone();\n\n            // Cache the response\n            caches.open(CACHE_NAME)\n              .then(cache => {\n                cache.put(event.request, responseToCache);\n              });\n\n            return response;\n          })\n          .catch(error => {\n            console.error('Fetch failed:', error);\n            \n            // Return offline page for navigation requests\n            if (event.request.mode === 'navigate') {\n              return caches.match('/offline.html').then(offlineResponse => {\n                return offlineResponse || new Response('You are offline', {\n                  status: 200,\n                  headers: { 'Content-Type': 'text/plain' }\n                });\n              });\n            }\n            \n            throw error;\n          });\n      })\n  );\n});\n\n// Background sync for offline actions\nself.addEventListener('sync', event => {\n  if (event.tag === 'background-sync') {\n    console.log('Background sync triggered');\n    event.waitUntil(\n      // Handle any offline actions that need to be synced\n      Promise.resolve()\n    );\n  }\n});\n\n// Push notifications (for future use)\nself.addEventListener('push', event => {\n  if (event.data) {\n    const data = event.data.json();\n    const options = {\n      body: data.body,\n      icon: '/static/assets/logo-rounded.png',\n      badge: '/static/assets/logo-rounded.png',\n      vibrate: [200, 100, 200],\n      data: {\n        url: data.url || '/'\n      },\n      actions: [\n        {\n          action: 'open',\n          title: 'Open App'\n        },\n        {\n          action: 'close',\n          title: 'Close'\n        }\n      ]\n    };\n\n    event.waitUntil(\n      self.registration.showNotification(data.title || 'Hack Club Dashboard', options)\n    );\n  }\n});\n\n// Handle notification clicks\nself.addEventListener('notificationclick', event => {\n  event.notification.close();\n\n  if (event.action === 'open' || !event.action) {\n    const url = event.notification.data?.url || '/';\n    event.waitUntil(\n      clients.matchAll({ type: 'window' }).then(clientList => {\n        // Check if app is already open\n        for (const client of clientList) {\n          if (client.url === url && 'focus' in client) {\n            return client.focus();\n          }\n        }\n        // Open new window\n        if (clients.openWindow) {\n          return clients.openWindow(url);\n        }\n      })\n    );\n  }\n});","size_bytes":4877},"gunicorn.conf.py":{"content":"\nimport os\n\n# Bind to the port specified by the environment variable\nbind = f\"0.0.0.0:{os.getenv('PORT', '5000')}\"\n\n# Worker configuration\nworkers = 4\nworker_class = \"sync\"\nworker_connections = 1000\ntimeout = 120\nkeepalive = 5\n\n# Logging configuration\nloglevel = \"info\"\naccesslog = \"-\"  # Log to stdout\nerrorlog = \"-\"   # Log to stderr\ncapture_output = True\nenable_stdio_inheritance = True\n\n# Log format\naccess_log_format = '%(h)s %(l)s %(u)s %(t)s \"%(r)s\" %(s)s %(b)s \"%(f)s\" \"%(a)s\" %(D)s'\n\n# Preload application\npreload_app = True\n\n# Process naming\nproc_name = \"hackclub-dashboard\"\n\n# Security\nforwarded_allow_ips = \"127.0.0.1\"\nproxy_allow_ips = \"127.0.0.1\"\n\n# Maximum request size (10MB)\nmax_requests = 1000\nmax_requests_jitter = 50\n\ndef when_ready(server):\n    server.log.info(\"Server is ready. Spawning workers\")\n\ndef worker_int(worker):\n    worker.log.info(\"worker received INT or QUIT signal\")\n\ndef pre_fork(server, worker):\n    server.log.info(\"Worker spawned (pid: %s)\", worker.pid)\n\ndef post_fork(server, worker):\n    server.log.info(\"Worker spawned (pid: %s)\", worker.pid)\n","size_bytes":1085},"app/utils/auth_helpers.py":{"content":"\"\"\"\nAuthentication helper utilities for the Hack Club Dashboard.\nContains functions for user authentication and session management.\n\"\"\"\n\nfrom datetime import datetime, timezone\nfrom flask import session, request, current_app\nfrom extensions import db\nfrom app.models.user import User\nimport logging\n\n\ndef get_current_user():\n    \"\"\"\n    Get the currently authenticated user from the session.\n\n    Returns:\n        User object if authenticated, None otherwise\n    \"\"\"\n    user_id = session.get('user_id')\n    logged_in = session.get('logged_in')\n\n    if not user_id or not logged_in:\n        return None\n\n    try:\n        user = db.session.get(User, int(user_id))\n        if not user:\n            # Clear invalid session\n            session.clear()\n            return None\n        return user\n    except Exception as e:\n        current_app.logger.error(f\"Error getting current user: {e}\")\n        try:\n            db.session.rollback()\n            # Create a new session for retry\n            db.session.close()\n            user = db.session.get(User, int(user_id))\n            if not user:\n                session.clear()\n            return user\n        except Exception as e2:\n            if True:\n                current_app.logger.error(f\"Error on retry getting current user: {e2}\")\n            else:\n                logging.error(f\"Error on retry getting current user: {e2}\")\n            session.clear()\n            return None\n\n\ndef login_user(user, remember=False, db=None, app=None, create_audit_log=None, get_real_ip_func=None):\n    \"\"\"\n    Log in a user by setting session variables and updating login timestamp.\n\n    Args:\n        user: User object to log in\n        remember: Whether to make the session permanent\n        db: SQLAlchemy database instance\n        app: Flask application instance for logging\n        create_audit_log: Function to create audit log entries\n        get_real_ip_func: Function to get the real IP address\n    \"\"\"\n    session['user_id'] = user.id\n    session['logged_in'] = True\n    if remember:\n        session.permanent = True\n    user.last_login = datetime.now(timezone.utc)\n\n    # Get real IP address\n    if get_real_ip_func:\n        real_ip = get_real_ip_func()\n    else:\n        from .security import get_real_ip\n        real_ip = get_real_ip()\n\n    user.add_ip(real_ip)  # Add current IP to user's IP history\n\n    try:\n        if db:\n            db.session.commit()\n        if True:\n            current_app.logger.info(f\"User login: {user.username} (ID: {user.id}) from IP: {real_ip}\")\n\n        # Create audit log for login\n        if create_audit_log:\n            create_audit_log(\n                action_type='login',\n                description=f\"User {user.username} logged in\",\n                user=user,\n                details={\n                    'remember_me': remember,\n                    'user_agent': request.headers.get('User-Agent') if request else None\n                },\n                category='auth'\n            )\n    except Exception as e:\n        if db:\n            db.session.rollback()\n        if True:\n            current_app.logger.error(f\"Failed to update last_login for user {user.id}: {str(e)}\")\n        else:\n            logging.error(f\"Failed to update last_login for user {user.id}: {str(e)}\")\n\n\ndef logout_user():\n    \"\"\"\n    Log out the current user by clearing the session.\n    \"\"\"\n    session.pop('user_id', None)\n    session.pop('logged_in', None)\n    session.clear()\n\n\ndef is_authenticated():\n    \"\"\"\n    Check if a user is currently authenticated.\n\n    Returns:\n        bool: True if user is authenticated, False otherwise\n    \"\"\"\n    return session.get('logged_in') and session.get('user_id')\n","size_bytes":3678},"app/models/club.py":{"content":"\"\"\"\nClub models for managing clubs, memberships, and cosmetics.\n\"\"\"\nimport json\nimport secrets\nimport string\nfrom datetime import datetime, timezone\nfrom extensions import db\n\n\nclass Club(db.Model):\n    __tablename__ = 'clubs'\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(100), nullable=False)\n    description = db.Column(db.Text)\n    location = db.Column(db.String(255))\n    leader_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    co_leader_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True)\n    join_code = db.Column(db.String(8), unique=True, nullable=False, index=True)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    updated_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    balance = db.Column(db.Numeric(10, 2), default=0.00)\n    tokens = db.Column(db.Integer, default=0, nullable=False)\n    piggy_bank_tokens = db.Column(db.Integer, default=0, nullable=False)\n    # Add check constraint to prevent negative balances\n    __table_args__ = (\n        db.CheckConstraint('tokens >= 0', name='check_tokens_non_negative'),\n        db.CheckConstraint('piggy_bank_tokens >= 0', name='check_piggy_bank_tokens_non_negative'),\n    )\n    is_suspended = db.Column(db.Boolean, default=False, nullable=False)\n    sync_immune = db.Column(db.Boolean, default=False, nullable=False)  # If True, bypasses intrusive connection popup\n    background_image_url = db.Column(db.String(500), nullable=True)  # Custom background image URL\n    background_blur = db.Column(db.Integer, default=0)  # Blur intensity (0-100)\n    airtable_data = db.Column(db.Text)  # JSON field for additional Airtable metadata\n\n    leader = db.relationship('User', foreign_keys=[leader_id], backref='led_clubs')\n    co_leader = db.relationship('User', foreign_keys=[co_leader_id], backref='co_led_clubs')\n    members = db.relationship('ClubMembership', back_populates='club', cascade='all, delete-orphan')\n\n    def generate_join_code(self):\n        self.join_code = ''.join(secrets.choice(string.ascii_uppercase + string.digits) for _ in range(8))\n\n    def get_airtable_data(self):\n        \"\"\"Get parsed Airtable data\"\"\"\n        try:\n            return json.loads(self.airtable_data) if self.airtable_data else {}\n        except:\n            return {}\n\n    def set_airtable_data(self, data):\n        \"\"\"Set Airtable data as JSON\"\"\"\n        self.airtable_data = json.dumps(data)\n    \n    @property\n    def total_tokens(self):\n        \"\"\"Alias for tokens field for template compatibility\"\"\"\n        return self.tokens\n\n\nclass ClubMembership(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    role = db.Column(db.String(20), default='member')\n    joined_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    user = db.relationship('User', backref='club_memberships')\n    club = db.relationship('Club', back_populates='members')\n\n\n# Cosmetics models\nclass ClubCosmetic(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    cosmetic_id = db.Column(db.String(100), nullable=False)  # e.g., 'rainbow_name', 'vip_role'\n    cosmetic_type = db.Column(db.String(50), nullable=False)  # 'name_effect', 'role', 'badge', 'effect'\n    cosmetic_name = db.Column(db.String(200), nullable=False)\n    price_paid = db.Column(db.Float, nullable=False)  # USD amount paid\n    purchased_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    expires_at = db.Column(db.DateTime)  # For time-limited cosmetics\n    is_active = db.Column(db.Boolean, default=True, nullable=False)\n\n    # Relationships\n    club = db.relationship('Club', backref=db.backref('cosmetics', lazy=True))\n\n\nclass MemberCosmetic(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    club_cosmetic_id = db.Column(db.Integer, db.ForeignKey('club_cosmetic.id'), nullable=False)\n    assigned_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    assigned_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)  # Leader who assigned it\n    is_active = db.Column(db.Boolean, default=True, nullable=False)\n\n    # Relationships\n    user = db.relationship('User', foreign_keys=[user_id], backref=db.backref('member_cosmetics', lazy=True))\n    club = db.relationship('Club', backref=db.backref('member_cosmetics', lazy=True))\n    club_cosmetic = db.relationship('ClubCosmetic', backref=db.backref('member_assignments', lazy=True))\n    assigned_by_user = db.relationship('User', foreign_keys=[assigned_by])\n","size_bytes":4948},"static/css/dash.css":{"content":".club-dashboard {\n  min-height: 100vh;\n  background: #f5f7fa url(../assets/Dinos.jpg) center center / cover no-repeat fixed;\n  position: relative;\n}\n\n.club-dashboard > * {\n  filter: blur(0);\n}\n\n.club-header {\n  background: white;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  padding: 1.5rem 0;\n  margin-bottom: 2rem;\n  border-bottom: 1px solid #e2e8f0;\n  position: sticky;\n  top: 70px;\n  z-index: 100;\n}\n\n.club-info {\n  display: grid;\n  grid-template-columns: auto 1fr auto;\n  gap: 1.5rem;\n  align-items: center;\n}\n\n.club-avatar {\n  width: 60px;\n  height: 60px;\n  background: linear-gradient(135deg, #ec3750, #d63146);\n  border-radius: 12px;\n  display: flex;\n\n\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-size: 1.5rem;\n  box-shadow: 0 4px 15px rgba(236, 55, 80, 0.3);\n  flex-shrink: 0;\n}\n\n.club-details {\n  min-width: 0;\n  overflow: hidden;\n}\n\n.club-details h1 {\n  margin: 0 0 0.25rem 0;\n  color: #1a202c;\n  font-size: clamp(1.25rem, 3vw, 1.75rem);\n  font-weight: 700;\n  word-wrap: break-word;\n  line-height: 1.2;\n}\n\n.club-meta {\n  display: flex;\n  gap: 1rem;\n  margin-top: 0.25rem;\n  color: #718096;\n  flex-wrap: wrap;\n}\n\n.club-meta span {\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  font-size: 0.85rem;\n  min-width: 0;\n}\n\n.club-meta span:first-child {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  max-width: 250px;\n}\n\n.club-actions {\n  display: flex;\n  flex-direction: row;\n  gap: 0.5rem;\n  align-items: center;\n  flex-shrink: 0;\n  flex-wrap: wrap;\n}\n\n.club-detail-item {\n  background: white;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  padding: 0.375rem 0.75rem;\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  font-weight: 500;\n  font-size: 0.8rem;\n  transition: all 0.2s ease;\n  white-space: nowrap;\n}\n\n.club-detail-item i {\n  font-size: 0.8rem;\n  opacity: 0.7;\n}\n\n.join-code-display {\n  background: #ec3750;\n  color: white;\n  border-color: #ec3750;\n  font-family: 'SF Mono', Consolas, monospace;\n  letter-spacing: 0.5px;\n  font-weight: 600;\n}\n\n.balance-display {\n  background: #16a34a;\n  color: white;\n  border-color: #16a34a;\n  font-weight: 600;\n}\n\n.qr-button {\n  background: #ec3750;\n  color: white;\n  border: none;\n  border-radius: 6px;\n  padding: 0.375rem 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  font-size: 0.8rem;\n}\n\n.qr-button:hover {\n  background: #d63146;\n  transform: translateY(-1px);\n}\n\n.new-code-button {\n  background: white;\n  color: #6b7280;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  padding: 0.375rem 0.75rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  display: flex;\n  align-items: center;\n  gap: 0.4rem;\n  font-size: 0.8rem;\n}\n\n.new-code-button:hover {\n  border-color: #ec3750;\n  color: #ec3750;\n  transform: translateY(-1px);\n}\n\n/* Dashboard Layout */\n.dashboard-layout {\n  display: flex;\n  min-height: calc(100vh - 200px);\n  gap: 2rem;\n}\n\n.dashboard-sidebar {\n  width: 280px;\n  background: white;\n  border-right: 1px solid #e2e8f0;\n  border-radius: 16px;\n  padding: 0;\n  height: calc(100vh - 190px);\n  overflow-y: auto;\n  position: sticky;\n  top: 190px;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(156, 163, 175, 0.3) transparent;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\n.dashboard-sidebar::-webkit-scrollbar {\n  width: 6px;\n}\n\n.dashboard-sidebar::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.dashboard-sidebar::-webkit-scrollbar-thumb {\n  background: rgba(156, 163, 175, 0.3);\n  border-radius: 3px;\n}\n\n.dashboard-sidebar::-webkit-scrollbar-thumb:hover {\n  background: rgba(156, 163, 175, 0.5);\n}\n\n.sidebar-nav {\n  padding: 1.5rem 0;\n}\n\n.nav-section {\n  margin-bottom: 1.5rem;\n}\n\n.nav-section:last-child {\n  margin-bottom: 1.5rem;\n}\n\n.nav-section-title {\n  color: #6b7280;\n  font-size: 0.6875rem;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.1em;\n  margin: 0 0 0.5rem 1.5rem;\n  padding: 0.75rem 0 0.5rem 0;\n  position: relative;\n}\n\n.nav-section:first-child .nav-section-title {\n  padding-top: 0;\n}\n\n.nav-section-title::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 1.5rem;\n  height: 1px;\n  background: linear-gradient(90deg, #e2e8f0 0%, transparent 100%);\n}\n\n.nav-section ul {\n  list-style: none;\n  padding: 0;\n  margin: 0;\n}\n\n.nav-section li {\n  margin-bottom: 0.25rem;\n}\n\n.dashboard-sidebar .nav-link {\n  display: flex;\n  align-items: center;\n  gap: 0.875rem;\n  padding: 0.875rem 1.5rem;\n  color: #64748b;\n  text-decoration: none;\n  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);\n  border-left: 3px solid transparent;\n  font-size: 0.875rem;\n  font-weight: 500;\n  position: relative;\n  margin: 0 0.75rem 0.25rem 0;\n  border-radius: 0 8px 8px 0;\n}\n\n.dashboard-sidebar .nav-link::before {\n  content: '';\n  position: absolute;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  width: 0;\n  background: linear-gradient(135deg, #ec3750, #d63146);\n  transition: width 0.15s cubic-bezier(0.4, 0, 0.2, 1);\n  border-radius: 0 4px 4px 0;\n}\n\n.dashboard-sidebar .nav-link:hover {\n  background: #f8fafc;\n  color: #374151;\n  transform: translateX(2px);\n  border-left-color: rgba(236, 55, 80, 0.2);\n}\n\n.dashboard-sidebar .nav-link:hover::before {\n  width: 3px;\n  opacity: 0.3;\n}\n\n.dashboard-sidebar .nav-link.active {\n  background: linear-gradient(90deg, rgba(236, 55, 80, 0.08) 0%, rgba(236, 55, 80, 0.02) 100%);\n  color: #ec3750;\n  border-left-color: #ec3750;\n  font-weight: 600;\n  transform: translateX(4px);\n}\n\n.dashboard-sidebar .nav-link.active::before {\n  width: 3px;\n  opacity: 1;\n}\n\n.dashboard-sidebar .nav-link i {\n  width: 18px;\n  text-align: center;\n  font-size: 0.875rem;\n  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);\n  opacity: 0.8;\n}\n\n.dashboard-sidebar .nav-link:hover i {\n  opacity: 1;\n  transform: scale(1.1);\n}\n\n.dashboard-sidebar .nav-link.active i {\n  opacity: 1;\n  transform: scale(1.05);\n}\n\n/* Gold highlight for submit project tab */\n.dashboard-sidebar .nav-link.project-link-highlight {\n  background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.05) 100%);\n  color: #DAA520;\n  border-left: 3px solid #DAA520;\n  font-weight: 600;\n  transform: translateX(4px);\n}\n\n.dashboard-sidebar .nav-link.project-link-highlight::before {\n  width: 3px;\n  opacity: 1;\n  background: #DAA520;\n}\n\n.dashboard-sidebar .nav-link.project-link-highlight i {\n  color: #DAA520;\n  opacity: 1;\n  transform: scale(1.05);\n}\n\n/* Main Content */\n.dashboard-main {\n  flex: 1;\n  background: white;\n  border-radius: 16px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  padding: 2rem;\n  height: fit-content;\n  border: 1px solid #e2e8f0;\n}\n\n.section-header {\n  margin-bottom: 2rem;\n  text-align: center;\n}\n\n.section-header h2 {\n  color: #1a202c;\n  margin-bottom: 0.5rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  font-size: 1.875rem;\n  font-weight: 700;\n}\n\n.section-header p {\n  color: #718096;\n}\n\n/* Dashboard Cards */\n.dashboard-cards {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n  gap: 1.5rem;\n  margin-bottom: 2rem;\n}\n\n.dashboard-card {\n  background: white;\n  border-radius: 16px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  overflow: hidden;\n  transition: all 0.2s ease;\n  border: 2px solid #e2e8f0;\n}\n\n.dashboard-card:hover {\n  transform: translateY(-3px);\n  box-shadow: 0 8px 25px rgba(0,0,0,0.15);\n  border-color: #ec3750;\n}\n\n.dashboard-card-header {\n  padding: 1.5rem;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.card-icon {\n  width: 50px;\n  height: 50px;\n  border-radius: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.5rem;\n  color: white;\n}\n\n.card-icon.members { background: #ec3750; }\n.card-icon.meetings { background: #f59e0b; }\n.card-icon.assignments { background: #3b82f6; }\n.card-icon.projects { background: #10b981; }\n\n.card-content h3 {\n  margin: 0;\n  color: #1a202c;\n  font-size: 1.25rem;\n  font-weight: 600;\n}\n\n.card-content p {\n  margin: 0.5rem 0 0 0;\n  color: #718096;\n  font-size: 0.9rem;\n}\n\n.card-metric {\n  font-size: 2rem;\n  font-weight: bold;\n  color: #ec3750;\n  margin: 0.5rem 0;\n}\n\n.dashboard-card-actions {\n  padding: 1rem 1.5rem;\n  background: #f7fafc;\n  border-top: 1px solid #e2e8f0;\n}\n\n/* Sections */\n.club-section {\n  display: none;\n}\n\n.club-section.active {\n  display: block;\n}\n\n.content-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 2rem;\n  padding-bottom: 1rem;\n  border-bottom: 1px solid #e2e8f0;\n}\n\n.post-composer {\n  background: white;\n  border-radius: 16px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  margin-bottom: 2rem;\n  overflow: hidden;\n  border: 1px solid #e2e8f0;\n}\n\n.post-composer-header {\n  padding: 1.5rem;\n  border-bottom: 1px solid #e2e8f0;\n  font-weight: 600;\n  color: #1a202c;\n}\n\n.post-composer-body {\n  padding: 1.5rem;\n}\n\n.post-composer textarea {\n  width: 100%;\n  min-height: 120px;\n  border: 2px solid #e2e8f0;\n  border-radius: 12px;\n  padding: 1rem;\n  resize: vertical;\n  font-family: inherit;\n  transition: all 0.2s ease;\n}\n\n.post-composer textarea:focus {\n  outline: none;\n  border-color: #ec3750;\n  box-shadow: 0 0 0 3px rgba(236, 55, 80, 0.1);\n}\n\n.post-composer-actions {\n  margin-top: 1rem;\n  display: flex;\n  justify-content: flex-end;\n}\n\n.posts-list {\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n\n.post-card {\n  background: white;\n  border-radius: 16px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  overflow: hidden;\n  border: 1px solid #e2e8f0;\n}\n\n.post-header {\n  padding: 1.5rem;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  border-bottom: 1px solid #e2e8f0;\n}\n\n.post-avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #ec3750, #d63146);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-weight: bold;\n}\n\n.post-info h4 {\n  margin: 0;\n  font-size: 1rem;\n  color: #1a202c;\n}\n\n.post-date {\n  color: #718096;\n  font-size: 0.875rem;\n}\n\n.post-content {\n  padding: 1.5rem;\n}\n\n/* Responsive */\n@media (max-width: 968px) {\n  .club-info {\n      grid-template-columns: 1fr;\n      gap: 1rem;\n      text-align: center;\n  }\n\n  .club-details {\n      order: 1;\n  }\n\n  .club-avatar {\n      order: 0;\n      justify-self: center;\n  }\n\n  .club-actions {\n      order: 2;\n      flex-direction: row;\n      justify-content: center;\n      align-items: center;\n      flex-wrap: wrap;\n      gap: 0.5rem;\n  }\n\n  .club-meta {\n      justify-content: center;\n      gap: 0.75rem;\n      flex-wrap: wrap;\n  }\n\n  .club-meta span:first-child {\n      max-width: none;\n      white-space: normal;\n  }\n}\n\n@media (max-width: 768px) {\n  .dashboard-layout {\n      flex-direction: column;\n  }\n\n  .dashboard-sidebar {\n      width: 100%;\n      position: static;\n  }\n\n  .dashboard-cards {\n      grid-template-columns: 1fr;\n  }\n\n  .content-header {\n      flex-direction: column;\n      gap: 1rem;\n      align-items: stretch;\n  }\n\n  .club-actions {\n      flex-direction: column;\n      gap: 0.5rem;\n  }\n\n  .club-detail-item {\n      font-size: 0.8rem;\n      padding: 0.4rem 0.8rem;\n  }\n}\n\n/* Assignment and project cards */\n.assignment-card {\n  background: white;\n  border: 1px solid #e2e8f0;\n  border-radius: 12px;\n  overflow: hidden;\n  margin-bottom: 1rem;\n  transition: all 0.2s ease;\n}\n\n.assignment-card:hover {\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  transform: translateY(-1px);\n}\n\n.assignment-header {\n  padding: 1.25rem;\n  border-bottom: 1px solid #f3f4f6;\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n}\n\n.assignment-header h3 {\n  margin: 0;\n  font-size: 1.125rem;\n  color: #1f2937;\n  font-weight: 600;\n}\n\n.assignment-status {\n  padding: 0.25rem 0.75rem;\n  border-radius: 12px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.assignment-body {\n  padding: 1.25rem;\n}\n\n.assignment-body p {\n  margin-bottom: 1rem;\n  color: #6b7280;\n  line-height: 1.5;\n}\n\n.assignment-meta {\n  display: flex;\n  gap: 1rem;\n  flex-wrap: wrap;\n  font-size: 0.875rem;\n  color: #6b7280;\n}\n\n.assignment-meta span {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n}\n\n.assignment-meta i {\n  opacity: 0.7;\n}\n\n.members-table {\n  border-radius: 16px;\n  overflow: hidden;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\n.members-table th {\n  background: #f7fafc;\n  color: #1a202c;\n}\n\n.role-badge {\n  padding: 0.25rem 0.75rem;\n  border-radius: 20px;\n  font-size: 0.75rem;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.role-badge-leader {\n    background: #fbbf24;\n    color: #92400e;\n}\n\n.role-badge-co-leader {\n    background: #a78bfa;\n    color: #5b21b6;\n}\n\n\n\n.role-badge-member {\n  background: rgba(59, 130, 246, 0.1);\n  color: #3b82f6;\n  border: 1px solid rgba(59, 130, 246, 0.2);\n}\n\n/* Form styles - added to align with new design */\n.form-group {\n  margin-bottom: 1.25rem;\n}\n\n.form-label {\n  display: block;\n  margin-bottom: 0.5rem;\n  color: #4a5568;\n  font-weight: 500;\n  font-size: 0.9rem;\n}\n\n.form-control {\n  width: 100%;\n  padding: 0.75rem 1rem;\n  border: 2px solid #e2e8f0;\n  border-radius: 12px;\n  font-family: inherit;\n  font-size: 1rem;\n  transition: all 0.2s ease;\n}\n\n.form-control:focus {\n  outline: none;\n  border-color: #ec3750;\n  box-shadow: 0 0 0 3px rgba(236, 55, 80, 0.1);\n}\n\ntextarea.form-control {\n  min-height: 120px;\n  resize: vertical;\n}\n\n/* Shop Styles */\n.shop-nav-tabs {\n    background: none;\n    border: none;\n    padding: 0;\n}\n\n.shop-tab {\n    background: none;\n    border: none;\n    padding: 1rem 1.5rem;\n    cursor: pointer;\n    color: #6b7280;\n    font-weight: 500;\n    border-bottom: 2px solid transparent;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.shop-tab:hover {\n    color: #ec3750;\n    background: rgba(236, 55, 80, 0.05);\n}\n\n.shop-tab.active {\n    color: #ec3750;\n    border-bottom-color: #ec3750;\n    background: rgba(236, 55, 80, 0.05);\n}\n\n.shop-tab-content {\n    display: none;\n}\n\n.shop-tab-content.active {\n    display: block;\n}\n\n.shop-items-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));\n    gap: 1.5rem;\n}\n\n.shop-items-list {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n\n.shop-item-card.list-view {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    padding: 1rem;\n}\n\n.shop-item-image {\n    width: 100%;\n    height: 180px;\n    background: linear-gradient(135deg, #f8fafc, #e2e8f0);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: #9ca3af;\n    border-bottom: 1px solid #e2e8f0;\n}\n\n.shop-item-card.list-view .shop-item-image {\n    width: 120px;\n    height: 80px;\n    border-radius: 8px;\n    border-bottom: none;\n    margin-right: 1rem;\n    flex-shrink: 0;\n}\n\n.shop-item-content {\n    padding: 1.5rem;\n    flex: 1;\n}\n\n.shop-item-card.list-view .shop-item-content {\n    padding: 0;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    width: 100%;\n}\n\n.shop-item-title {\n    font-size: 1.1rem;\n    font-weight: 600;\n    color: #1a202c;\n    margin: 0 0 0.5rem 0;\n}\n\n.shop-item-description {\n    color: #6b7280;\n    font-size: 0.9rem;\n    margin: 0 0 1rem 0;\n    line-height: 1.4;\n}\n\n.shop-item-price {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    margin-bottom: 1rem;\n}\n\n.shell-price {\n    font-size: 1.5rem;\n    font-weight: bold;\n    color: #ec3750;\n    display: flex;\n    align-items: center;\n    gap: 0.25rem;\n}\n\n.shell-icon {\n    width: 20px;\n    height: 20px;\n    background: #ec3750;\n    border-radius: 50%;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 0.8rem;\n    font-weight: bold;\n}\n\n.hours-needed {\n    font-size: 0.8rem;\n    color: #6b7280;\n    background: #f3f4f6;\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n}\n\n.shop-item-actions {\n    display: flex;\n    gap: 0.5rem;\n    align-items: center;\n}\n\n.add-to-cart-btn {\n    background: #ec3750;\n    color: white;\n    border: none;\n    padding: 0.75rem 1rem;\n    border-radius: 8px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    flex: 1;\n}\n\n.add-to-cart-btn:hover {\n    background: #d63146;\n    transform: translateY(-1px);\n}\n\n.add-to-cart-btn:disabled {\n    background: #9ca3af;\n    cursor: not-allowed;\n    transform: none;\n}\n\n.quantity-controls {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    background: #f3f4f6;\n    border-radius: 6px;\n    padding: 0.25rem;\n}\n\n.quantity-btn {\n    background: none;\n    border: none;\n    width: 28px;\n    height: 28px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.quantity-btn:hover {\n    background: #e5e7eb;\n}\n\n.quantity-display {\n    min-width: 40px;\n    text-align: center;\n    font-weight: 600;\n    font-size: 0.9rem;\n}\n\n.stock-indicator {\n    position: absolute;\n    top: 0.5rem;\n    right: 0.5rem;\n    background: #10b981;\n    color: white;\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    font-size: 0.7rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.stock-indicator.limited {\n    background: #f59e0b;\n}\n\n.stock-indicator.out-of-stock {\n    background: #ef4444;\n}\n\n/* Cart Modal Styles */\n.cart-modal .modal-content {\n    max-width: 700px;\n    max-height: 80vh;\n    margin-top: 120px !important;\n    z-index: 1001 !important;\n}\n\n.cart-modal .modal-body {\n    max-height: 60vh;\n    overflow-y: auto;\n}\n\n.cart-item {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem;\n    border-bottom: 1px solid #e2e8f0;\n    transition: background-color 0.2s ease;\n}\n\n.cart-item:hover {\n    background-color: #f8fafc;\n}\n\n.cart-item:last-child {\n    border-bottom: none;\n}\n\n.cart-item-image {\n    width: 60px;\n    height: 60px;\n    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #6b7280;\n    flex-shrink: 0;\n    font-size: 1.5rem;\n}\n\n.cart-item-details {\n    flex: 1;\n}\n\n.cart-item-title {\n    font-weight: 600;\n    color: #1a202c;\n    margin: 0 0 0.25rem 0;\n    font-size: 1rem;\n}\n\n.cart-item-price {\n    color: #6b7280;\n    font-size: 0.875rem;\n}\n\n.cart-item-quantity {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.cart-item-total {\n    font-weight: 600;\n    color: #ec3750;    font-size: 1.1rem;\n    min-width: 80px;\n    text-align: right;\n}\n\n.cart-total {\n    border-top: 2px solid #e2e8f0;\n    padding-top: 1rem;\n    margin-top: 1rem;\n    text-align: right;\n    background: #f8fafc;\n    margin: 1rem -1.5rem 0 -1.5rem;\n    padding: 1.5rem;\n}\n\n.cart-total-amount {\n    font-size: 1.75rem;\n    font-weight: bold;\n    color: #ec3750;\n    display: flex;\n    align-items: center;\n    justify-content: flex-end;\n    gap: 0.5rem;\n}\n\n.cart-total::before {\n    content: 'Total: ';\n    font-size: 1rem;\n    color: #6b7280;\n    font-weight: 500;\n    margin-right: 0.5rem;\n}\n\n/* Enhanced shop item styles */\n.shop-item-card {\n    background: white;\n    border: 2px solid #e2e8f0;\n    border-radius: 16px;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    position: relative;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n}\n\n.shop-item-card:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 20px 40px rgba(0,0,0,0.1);\n    border-color: #ec3750;\n}\n\n.shop-item-image {\n    width: 100%;\n    height: 140px;\n    background: linear-gradient(135deg, #f8fafc, #e2e8f0);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 2.5rem;\n    color: #6b7280;\n    border-bottom: 1px solid #e2e8f0;\n    position: relative;\n    overflow: hidden;\n}\n\n.shop-item-image::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(45deg, transparent 30%, rgba(236, 55, 80, 0.05) 50%, transparent 70%);\n    transform: translateX(-100%);\n    transition: transform 0.6s ease;\n}\n\n.shop-item-card:hover .shop-item-image::before {\n    transform: translateX(100%);\n}\n\n.shop-item-content {\n    padding: 1.5rem;\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n}\n\n.shop-item-title {\n    font-size: 1.1rem;\n    font-weight: 600;\n    color: #1a202c;\n    margin: 0 0 0.5rem 0;\n    line-height: 1.3;\n}\n\n.shop-item-description {\n    color: #6b7280;\n    font-size: 0.875rem;\n    margin: 0 0 1rem 0;\n    line-height: 1.4;\n    flex: 1;\n}\n\n.shop-item-price {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 1rem;\n    padding: 0.75rem;\n    background: #f8fafc;\n    border-radius: 8px;\n    border: 1px solid #e2e8f0;\n}\n\n.shell-price {\n    font-size: 1.25rem;\n    font-weight: bold;\n    color: #ec3750;\n    display: flex;\n    align-items: center;\n    gap: 0.25rem;\n}\n\n.shell-icon {\n    width: 18px;\n    height: 18px;\n    background: #ec3750;\n    border-radius: 50%;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 0.75rem;\n    font-weight: bold;\n}\n\n.hours-needed {\n    font-size: 0.75rem;\n    color: #6b7280;\n    background: #e2e8f0;\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    font-weight: 500;\n}\n\n.stock-indicator {\n    position: absolute;\n    top: 0.5rem;\n    right: 0.5rem;\n    background: #10b981;\n    color: white;\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    font-size: 0.7rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.stock-indicator.limited {\n    background: #f59e0b;\n}\n\n.stock-indicator.out-of-stock {\n    background: #ef4444;\n}\n\n.shop-item-actions {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n    margin-top: auto;\n}\n\n.quantity-controls {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n    background: #f3f4f6;\n    border-radius: 8px;\n    padding: 0.5rem;\n    border: 1px solid #e2e8f0;\n}\n\n.quantity-btn {\n    background: white;\n    border: 1px solid #d1d5db;\n    width: 32px;\n    height: 32px;\n    border-radius: 6px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    color: #6b7280;\n}\n\n.quantity-btn:hover {\n    background: #ec3750;\n    border-color: #ec3750;\n    color: white;\n    transform: scale(1.1);\n}\n\n.quantity-btn:active {\n    transform: scale(0.95);\n}\n\n.quantity-display {\n    min-width: 40px;\n    text-align: center;\n    font-weight: 600;\n    font-size: 1rem;\n    color: #1a202c;\n}\n\n.add-to-cart-btn {\n    background: #ec3750;\n    color: white;\n    border: none;\n    padding: 0.75rem 1rem;\n    border-radius: 8px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    font-size: 0.875rem;\n}\n\n.add-to-cart-btn:hover:not(:disabled) {\n    background: #d63146;\n    transform: translateY(-2px);\n    box-shadow: 0 8px 20px rgba(236, 55, 80, 0.3);\n}\n\n.add-to-cart-btn:active {\n    transform: translateY(0);\n}\n\n.add-to-cart-btn:disabled {\n    background: #9ca3af;\n    cursor: not-allowed;\n    transform: none;\n    box-shadow: none;\n}\n\n/* List view styles */\n.shop-items-list .shop-item-card {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    padding: 1rem;\n    height: auto;\n}\n\n.shop-items-list .shop-item-image {\n    width: 100px;\n    height: 80px;\n    border-radius: 8px;\n    border-bottom: none;\n    margin-right: 1rem;\n    flex-shrink: 0;\n}\n\n.shop-items-list .shop-item-content {\n    padding: 0;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: space-between;\n    width: 100%;\n    gap: 2rem;\n}\n\n.shop-items-list .shop-item-details {\n    flex: 1;\n}\n\n.shop-items-list .shop-item-price {\n    background: none;\n    border: none;\n    padding: 0;\n}\n\n.shop-items-list .shop-item-actions {\n    flex-direction: row;\n    align-items: center;\n    margin-top: 0;\n    gap: 1rem;\n}\n\n/* Enhanced form controls for shop */\n#shopSearch {\n    border: 2px solid #e2e8f0;\n    border-radius: 8px;\n    padding: 0.75rem 1rem;\n    font-size: 0.875rem;\n    transition: all 0.2s ease;\n}\n\n#shopSearch:focus {\n    border-color: #ec3750;\n    box-shadow: 0 0 0 3px rgba(236, 55, 80, 0.1);\n    outline: none;\n}\n\n#priceFilter {\n    appearance: none;\n    background: linear-gradient(to right, #ec3750 0%, #ec3750 var(--value, 0%), #e2e8f0 var(--value, 0%), #e2e8f0 100%);\n    border-radius: 8px;\n    height: 8px;\n    outline: none;\n    cursor: pointer;\n}\n\n#priceFilter::-webkit-slider-thumb {\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #ec3750;\n    cursor: pointer;\n    border: 2px solid white;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);\n}\n\n#priceFilter::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background: #ec3750;\n    cursor: pointer;\n    border: 2px solid white;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);\n}\n\n/* Cart button animations */\n#cartButton {\n    animation: cartPulse 2s infinite;\n}\n\n@keyframes cartPulse {\n    0%, 100% { transform: scale(1); }\n    50% { transform: scale(1.05); }\n}\n\n/* Mobile responsiveness for shop */\n@media (max-width: 768px) {\n    .shop-items-grid {\n        grid-template-columns: 1fr;\n    }\n\n    .shop-items-list .shop-item-card {\n        flex-direction: column;\n        text-align: center;\n    }\n\n    .shop-items-list .shop-item-image {\n        margin-right: 0;\n        margin-bottom: 1rem;\n    }\n\n    .shop-items-list .shop-item-content {\n        flex-direction: column;\n        gap: 1rem;\n    }\n}\n\n/* Button styles - added to align with new design */\n.btn {\n  border-radius: 12px;\n  padding: 0.75rem 1.25rem;\n  font-weight: 600;\n  transition: all 0.2s ease;\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  justify-content: center;\n  border: none;\n  cursor: pointer;\n}\n\n.btn i {\n  font-size: 1rem;\n}\n\n.btn-primary {\n  background: #ec3750;\n  color: white;\n}\n\n.btn-primary:hover {\n  background: #d63146;\n  transform: translateY(-1px);\n  box-shadow: 0 2px 8px rgba(236, 55, 80, 0.2);\n}\n\n.btn-secondary {\n  background: white;\n  color: #4a5568;\n  border: 2px solid #e2e8f0;\n}\n\n.btn-secondary:hover {\n  border-color: #ec3750;\n  color: #ec3750;\n  transform: translateY(-2px);\n}\n\n.btn-sm {\n  padding: 0.5rem 1rem;\n  font-size: 0.875rem;\n}\n\n/* Empty state styles */\n.empty-state {\n  text-align: center;\n  color: #718096;\n  padding: 2rem;\n}\n\n.empty-state i {\n  font-size: 3rem;\n  margin-bottom: 1rem;\n}\n\n/* Members Section - Modern Card Grid Layout */\n.members-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));\n  gap: 1.5rem;\n  width: 100%;\n}\n\n.member-card {\n  background: white;\n  border-radius: 16px;\n  border: 2px solid #f1f5f9;\n  padding: 1.5rem;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n  overflow: hidden;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);\n}\n\n.member-card::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 4px;\n  background: linear-gradient(90deg, #ec3750, #ff6b7a);\n  transform: scaleX(0);\n  transform-origin: left;\n  transition: transform 0.3s ease;\n}\n\n.member-card:hover {\n  transform: translateY(-4px);\n  border-color: #ec3750;\n  box-shadow: 0 12px 32px rgba(236, 55, 80, 0.15);\n}\n\n.member-card:hover::before {\n  transform: scaleX(1);\n}\n\n.member-info {\n  display: flex;\n  align-items: flex-start;\n  gap: 1rem;\n  margin-bottom: 1rem;\n}\n\n.member-avatar {\n  width: 50px;\n  height: 50px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n  color: white;\n  font-weight: 700;\n  font-size: 1.125rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  border: 3px solid white;\n  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);\n}\n\n.member-details {\n  flex: 1;\n  min-width: 0;\n}\n\n.member-name {\n  font-weight: 700;\n  color: #1e293b;\n  font-size: 1.125rem;\n  line-height: 1.4;\n  margin: 0 0 0.25rem 0;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n}\n\n.member-email {\n  font-size: 0.875rem;\n  color: #64748b;\n  margin: 0;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  opacity: 0.8;\n}\n\n.member-meta {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-top: 1rem;\n  padding-top: 1rem;\n  border-top: 1px solid #f1f5f9;\n}\n\n.member-role-info {\n  display: flex;\n  flex-direction: column;\n  gap: 0.375rem;\n}\n\n.member-joined {\n  font-size: 0.75rem;\n  color: #94a3b8;\n  margin: 0;\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n}\n\n.member-joined::before {\n  content: '';\n  font-size: 0.75rem;\n}\n\n.member-actions {\n  display: flex;\n  gap: 0.375rem;\n  align-items: center;\n}\n\n/* Role badges styling */\n.role-badge {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.375rem;\n  padding: 0.5rem 0.875rem;\n  border-radius: 25px;\n  font-size: 0.75rem;\n  font-weight: 700;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n  border: 2px solid;\n  position: relative;\n  overflow: hidden;\n}\n\n.role-badge::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: -100%;\n  width: 100%;\n  height: 100%;\n  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);\n  transition: left 0.5s ease;\n}\n\n.role-badge:hover::before {\n  left: 100%;\n}\n\n.role-badge-leader {\n  background: linear-gradient(135deg, #fbbf24, #f59e0b);\n  color: #92400e;\n  border-color: #f59e0b;\n  box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);\n}\n\n.role-badge-co-leader {\n  background: linear-gradient(135deg, #8b5cf6, #7c3aed);\n  color: white;\n  border-color: #7c3aed;\n  box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.role-badge-member {\n  background: linear-gradient(135deg, #64748b, #475569);\n  color: white;\n  border-color: #475569;\n  box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3);\n}\n\n/* Action buttons */\n.btn-icon {\n  width: 36px;\n  height: 36px;\n  border: 2px solid;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  font-size: 0.875rem;\n  position: relative;\n  overflow: hidden;\n}\n\n.btn-icon i {\n  position: relative;\n  z-index: 1;\n}\n\n.btn-icon::before {\n  content: '';\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 0;\n  height: 0;\n  border-radius: 50%;\n  transition: all 0.3s ease;\n  transform: translate(-50%, -50%);\n  z-index: -1;\n}\n\n.btn-icon:hover::before {\n  width: 100%;\n  height: 100%;\n}\n\n.btn-icon-success {\n  background: transparent;\n  color: #16a34a;\n  border-color: #16a34a;\n}\n\n.btn-icon-success::before {\n  background: #16a34a;\n}\n\n.btn-icon-success:hover {\n  color: white;\n  transform: translateY(-2px) scale(1.05);\n  box-shadow: 0 8px 20px rgba(22, 163, 74, 0.3);\n}\n\n.btn-icon-warning {\n  background: transparent;\n  color: #ea580c;\n  border-color: #ea580c;\n}\n\n.btn-icon-warning::before {\n  background: #ea580c;\n}\n\n.btn-icon-warning:hover {\n  color: white;\n  transform: translateY(-2px) scale(1.05);\n  box-shadow: 0 8px 20px rgba(234, 88, 12, 0.3);\n}\n\n.btn-icon-danger {\n  background: transparent;\n  color: #dc2626;\n  border-color: #dc2626;\n}\n\n.btn-icon-danger::before {\n  background: #dc2626;\n}\n\n.btn-icon-danger:hover {\n  color: white;\n  transform: translateY(-2px) scale(1.05);\n  box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);\n}\n\n/* Mobile responsive */\n@media (max-width: 768px) {\n  .members-list {\n    grid-template-columns: 1fr;\n    gap: 1rem;\n  }\n\n  .member-card {\n    padding: 1.25rem;\n  }\n\n  .member-info {\n    gap: 0.875rem;\n    margin-bottom: 0.875rem;\n  }\n\n  .member-avatar {\n    width: 45px;\n    height: 45px;\n    font-size: 1rem;\n  }\n\n  .member-name {\n    font-size: 1rem;\n  }\n\n  .member-email {\n    font-size: 0.8125rem;\n  }\n\n  .member-meta {\n    margin-top: 0.875rem;\n    padding-top: 0.875rem;\n  }\n\n  .btn-icon {\n    width: 32px;\n    height: 32px;\n    font-size: 0.8125rem;\n  }\n}\n\n/* Tablet responsive */\n@media (max-width: 1024px) and (min-width: 769px) {\n  .members-list {\n    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n  }\n\n  .member-card {\n    padding: 1.375rem;\n  }\n}\n\n.old-btn-icon {\n  border: none;\n  border-radius: 50%;\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: background-color 0.2s ease;\n}\n\n.old-btn-icon i {\n  font-size: 1rem;\n}\n\n.old-btn-icon-danger {\n  background-color: rgba(220, 53, 69, 0.1);\n  color: #dc3545;\n}\n\n.old-btn-icon-danger:hover {\n  background-color: rgba(220, 53, 69, 0.3);\n}\n\n.old-btn-icon-edit {\n  background-color: rgba(59, 130, 246, 0.1);\n  color: #3b82f6;\n}\n\n.old-btn-icon-edit:hover {\n  background-color: rgba(59, 130, 246, 0.3);\n}\n\n/* Modal Styles */\n.modal {\n    display: none;\n    position: fixed;\n    z-index: 1000;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(5px);\n}\n\n.modal[style*=\"display: block\"] {\n    display: flex !important;\n    align-items: center;\n    justify-content: center;\n}\n\n.modal-content {\n    background-color: white;\n    margin: 120px auto auto auto;\n    padding: 0;\n    border-radius: 12px;\n    width: 90%;\n    max-width: 500px;\n    max-height: 90vh;\n    overflow-y: auto;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\n    animation: modalSlideIn 0.3s ease-out;\n    position: relative;\n    z-index: 1001;\n}\n\n@keyframes modalSlideIn {\n    from {\n        opacity: 0;\n        transform: translateY(-30px) scale(0.9);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n    }\n}\n\n.modal-header {\n    padding: 1.5rem;\n    border-bottom: 1px solid #e2e8f0;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.modal-header h3 {\n    margin: 0;\n    color: #1a202c;\n}\n\n.modal-body {\n    padding: 1.5rem;\n}\n\n.modal-footer {\n    padding: 1rem 1.5rem;\n    border-top: 1px solid #e2e8f0;\n    display: flex;\n    justify-content: flex-end;\n    gap: 0.5rem;\n}\n\n.close {\n    color: #a0aec0;\n    font-size: 28px;\n    font-weight: bold;\n    cursor: pointer;\n    line-height: 1;\n}\n\n.close:hover {\n    color: #718096;\n}\n\n/* Delete Button Styles */\n.delete-btn-icon {\n    background: none;\n    border: none;\n    padding: 0.5rem;\n    border-radius: 6px;\n    cursor: pointer;\n    color: #6b7280;\n    transition: all 0.2s ease;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.delete-btn-icon:hover {\n    background-color: #f3f4f6;\n    color: #374151;\n}\n\n.delete-btn {\n    color: #ef4444;\n}\n\n.delete-btn:hover {\n    background-color: #fef2f2;\n    color: #dc2626;\n}\n\n/* Card Action Styling */\n.assignment-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin-bottom: 0.75rem;\n}\n\n.assignment-actions {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.meeting-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin-bottom: 0.75rem;\n}\n\n.meeting-actions {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.resource-actions {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    margin-top: 0.75rem;\n}\n\n.post-header {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    margin-bottom: 0.75rem;\n}\n\n/* Navigation Styles */\n.navbar {\n    background: rgba(255, 255, 255, 0.95);\n    backdrop-filter: blur(20px);\n    border-bottom: 1px solid rgba(236, 55, 80, 0.1);\n    padding: 1rem 0;\n    position: sticky;\n    top: 0;\n    z-index: 100;\n}\n\n.navbar-brand {\n    display: flex;\n    align-items: center;\n    font-weight: 700;\n    font-size: 1.5rem;\n    color: #1a202c;\n    text-decoration: none;\n}\n\n.navbar-brand img {\n    width: 40px;\n    height: 40px;\n    margin-right: 0.75rem;\n    border-radius: 8px;\n}\n\n.navbar-nav {\n    display: flex;\n    align-items: center;\n    gap: 2rem;\n    margin-left: auto;\n}\n\n.navbar .nav-link {\n    color: #64748b;\n    text-decoration: none;\n    font-weight: 500;\n    padding: 0.5rem 1rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    border: none;\n    background: none;\n    cursor: pointer;\n}\n\n.navbar .nav-link:hover {\n    color: #ec3750;\n    background: rgba(236, 55, 80, 0.1);\n}\n\n.navbar .nav-link.active {\n    color: #ec3750;\n    background: rgba(236, 55, 80, 0.1);\n}\n\n/* Cosmetic Effects for Member Names */\n\n.cosmetic-rainbow {\n    background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #80ff00, #00ff00, #00ff80, #00ffff, #0080ff, #0000ff, #8000ff, #ff00ff, #ff0080);\n    background-size: 400% 400%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: rainbow-wave 3s ease-in-out infinite;\n    font-weight: 600;\n}\n\n@keyframes rainbow-wave {\n    0%, 100% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n}\n\n.cosmetic-gold {\n    background: linear-gradient(45deg, #ffd700, #ffed4a, #fff59d, #ffd700);\n    background-size: 300% 300%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: gold-shine 2s ease-in-out infinite;\n    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);\n    font-weight: 600;\n}\n\n@keyframes gold-shine {\n    0%, 100% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n}\n\n.cosmetic-fire {\n    background: linear-gradient(45deg, #ff4500, #ff6347, #ff8c00, #ffa500, #ff0000);\n    background-size: 300% 300%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: fire-flicker 1.5s ease-in-out infinite;\n    text-shadow: 0 0 15px rgba(255, 69, 0, 0.7);\n    font-weight: 600;\n}\n\n@keyframes fire-flicker {\n    0%, 100% { \n        background-position: 0% 50%;\n        filter: brightness(1);\n    }\n    25% { \n        background-position: 50% 0%;\n        filter: brightness(1.2);\n    }\n    50% { \n        background-position: 100% 50%;\n        filter: brightness(0.9);\n    }\n    75% { \n        background-position: 50% 100%;\n        filter: brightness(1.1);\n    }\n}\n\n.cosmetic-ice {\n    background: linear-gradient(45deg, #00bfff, #87ceeb, #b0e0e6, #e0f6ff, #00bfff);\n    background-size: 300% 300%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: ice-crystal 2.5s ease-in-out infinite;\n    text-shadow: 0 0 10px rgba(0, 191, 255, 0.6);\n    font-weight: 600;\n}\n\n@keyframes ice-crystal {\n    0%, 100% { \n        background-position: 0% 50%;\n        filter: brightness(1);\n    }\n    50% { \n        background-position: 100% 50%;\n        filter: brightness(1.3);\n    }\n}\n\n.cosmetic-neon {\n    color: #00ff41;\n    text-shadow: \n        0 0 5px #00ff41,\n        0 0 10px #00ff41,\n        0 0 15px #00ff41,\n        0 0 20px #00ff41,\n        0 0 35px #00ff41,\n        0 0 40px #00ff41;\n    animation: neon-pulse 2s ease-in-out infinite alternate;\n    font-weight: 600;\n}\n\n@keyframes neon-pulse {\n    from {\n        text-shadow: \n            0 0 5px #00ff41,\n            0 0 10px #00ff41,\n            0 0 15px #00ff41,\n            0 0 20px #00ff41,\n            0 0 35px #00ff41,\n            0 0 40px #00ff41;\n    }\n    to {\n        text-shadow: \n            0 0 2px #00ff41,\n            0 0 5px #00ff41,\n            0 0 8px #00ff41,\n            0 0 12px #00ff41,\n            0 0 18px #00ff41,\n            0 0 25px #00ff41;\n    }\n}\n\n.cosmetic-gradient {\n    background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);\n    background-size: 300% 300%;\n    -webkit-background-clip: text;\n    background-clip: text;\n    -webkit-text-fill-color: transparent;\n    animation: gradient-shift 4s ease-in-out infinite;\n    font-weight: 600;\n}\n\n@keyframes gradient-shift {\n    0%, 100% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n}\n\n.cosmetic-sparkle {\n    color: #9333ea;\n    position: relative;\n    font-weight: 600;\n    animation: sparkle-text 2s ease-in-out infinite;\n}\n\n.cosmetic-sparkle::before {\n    content: '';\n    position: absolute;\n    left: -20px;\n    animation: sparkle-float 1.5s ease-in-out infinite;\n}\n\n.cosmetic-sparkle::after {\n    content: '';\n    position: absolute;\n    right: -20px;\n    animation: sparkle-float 1.5s ease-in-out infinite 0.5s;\n}\n\n@keyframes sparkle-text {\n    0%, 100% { filter: brightness(1); }\n    50% { filter: brightness(1.3); }\n}\n\n@keyframes sparkle-float {\n    0%, 100% { \n        transform: translateY(0px);\n        opacity: 0.7;\n    }\n    50% { \n        transform: translateY(-5px);\n        opacity: 1;\n    }\n}\n\n.cosmetic-shadow {\n    color: #4a5568;\n    text-shadow: \n        2px 2px 4px rgba(0, 0, 0, 0.5),\n        -1px -1px 2px rgba(255, 255, 255, 0.3);\n    font-weight: 600;\n    animation: shadow-depth 3s ease-in-out infinite;\n}\n\n@keyframes shadow-depth {\n    0%, 100% {\n        text-shadow: \n            2px 2px 4px rgba(0, 0, 0, 0.5),\n            -1px -1px 2px rgba(255, 255, 255, 0.3);\n    }\n    50% {\n        text-shadow: \n            4px 4px 8px rgba(0, 0, 0, 0.7),\n            -2px -2px 4px rgba(255, 255, 255, 0.5);\n    }\n}\n\n/* Alert Card Styles */\n.alert-card {\n    background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);\n    border: 1px solid #fb923c;\n    border-radius: 12px;\n    padding: 1.5rem;\n    margin-bottom: 2rem;\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n    box-shadow: 0 4px 6px rgba(251, 146, 60, 0.1);\n}\n\n.alert-icon {\n    flex-shrink: 0;\n    width: 48px;\n    height: 48px;\n    background: linear-gradient(135deg, #fb923c, #f97316);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 1.25rem;\n    box-shadow: 0 2px 8px rgba(251, 146, 60, 0.3);\n}\n\n.alert-content {\n    flex: 1;\n}\n\n.alert-content h4 {\n    margin: 0 0 0.5rem 0;\n    color: #9a3412;\n    font-size: 1.125rem;\n    font-weight: 600;\n}\n\n.alert-content p {\n    margin: 0 0 1rem 0;\n    color: #9a3412;\n    font-size: 0.9rem;\n    line-height: 1.5;\n}\n\n.alert-btn {\n    background: linear-gradient(135deg, #fb923c, #f97316);\n    color: white;\n    padding: 0.5rem 1rem;\n    border-radius: 8px;\n    text-decoration: none;\n    font-weight: 600;\n    font-size: 0.875rem;\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n    transition: all 0.2s ease;\n    box-shadow: 0 2px 4px rgba(251, 146, 60, 0.2);\n}\n\n.alert-btn:hover {\n    background: linear-gradient(135deg, #f97316, #ea580c);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 8px rgba(251, 146, 60, 0.3);\n    text-decoration: none;\n    color: white;\n}\n\n/* Utility classes */\n.text-success {\n    color: #28a745;\n}\n\n.text-warning {\n    color: #ffc107;\n}\n\n.text-danger {\n    color: #dc3545;\n}\n\n.text-info {\n    color: #17a2b8;\n}\n\n.text-muted {\n    color: #6c757d;\n}\n\n.old-icon-btn {\n    background: none;\n    border: none;\n    padding: 0.5rem;\n    cursor: pointer;\n    border-radius: 0.25rem;\n    transition: background-color 0.2s;\n}\n\n.old-icon-btn:hover {\n    background-color: rgba(0, 0, 0, 0.1);\n}\n\n.old-icon-btn-primary {\n    color: #007bff;\n}\n\n.old-icon-btn-secondary {\n    color: #6c757d;\n}\n\n.old-icon-btn-success {\n    color: #28a745;\n}\n\n.old-icon-btn-warning {\n    color: #ffc107;\n}\n\n.old-icon-btn-danger {\n    color: #dc3545;\n}\n\n.old-icon-btn-info {\n    color: #17a2b8;\n}\n\n.delete-btn {\n    color: #dc3545;\n    opacity: 0.7;\n    transition: opacity 0.2s;\n}\n\n.delete-btn:hover {\n    opacity: 1;\n    background-color: rgba(220, 53, 69, 0.1);\n}\n\n/* Transaction Styles */\n.balance-info {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n}\n\n.current-balance {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 0.75rem 1.5rem;\n    border-radius: 50px;\n    font-weight: 600;\n    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);\n}\n\n.balance-label {\n    font-size: 0.9rem;\n    opacity: 0.9;\n}\n\n.balance-amount {\n    font-size: 1.1rem;\n    font-weight: 700;\n    margin-left: 0.5rem;\n}\n\n.transactions-filters {\n    display: flex;\n    gap: 1rem;\n    margin-bottom: 1.5rem;\n    flex-wrap: wrap;\n}\n\n.filter-group {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n}\n\n.filter-group label {\n    font-size: 0.9rem;\n    font-weight: 600;\n    color: #495057;\n}\n\n.filter-group select {\n    padding: 0.5rem;\n    border: 1px solid #dee2e6;\n    border-radius: 0.375rem;\n    font-size: 0.9rem;\n    min-width: 150px;\n}\n\n.transaction-card {\n    background: white;\n    border: 1px solid #dee2e6;\n    border-radius: 12px;\n    padding: 1.5rem;\n    margin-bottom: 1rem;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n    transition: all 0.3s ease;\n}\n\n.transaction-card:hover {\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n    transform: translateY(-2px);\n}\n\n.transaction-header {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n}\n\n.transaction-icon {\n    width: 48px;\n    height: 48px;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.2rem;\n    color: white;\n    flex-shrink: 0;\n}\n\n.transaction-icon.credit {\n    background: linear-gradient(135deg, #28a745, #20c997);\n}\n\n.transaction-icon.debit {\n    background: linear-gradient(135deg, #dc3545, #e74c3c);\n}\n\n.transaction-icon.grant {\n    background: linear-gradient(135deg, #ffc107, #fd7e14);\n}\n\n.transaction-icon.purchase {\n    background: linear-gradient(135deg, #6f42c1, #e83e8c);\n}\n\n.transaction-icon.refund {\n    background: linear-gradient(135deg, #17a2b8, #138496);\n}\n\n.transaction-icon.manual {\n    background: linear-gradient(135deg, #6c757d, #495057);\n}\n\n.transaction-info {\n    flex: 1;\n}\n\n.transaction-description {\n    font-size: 1.1rem;\n    font-weight: 600;\n    color: #212529;\n    margin: 0 0 0.5rem 0;\n}\n\n.transaction-meta {\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n    font-size: 0.85rem;\n    color: #6c757d;\n}\n\n.transaction-type {\n    background: #f8f9fa;\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    font-weight: 500;\n    text-transform: capitalize;\n}\n\n.transaction-user {\n    font-style: italic;\n}\n\n.transaction-date {\n    font-weight: 500;\n}\n\n.transaction-amount {\n    font-size: 1.2rem;\n    font-weight: 700;\n    white-space: nowrap;\n}\n\n.transaction-amount.positive {\n    color: #28a745;\n}\n\n.transaction-amount.negative {\n    color: #dc3545;\n}\n\n.pagination-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-top: 2rem;\n    padding: 1rem;\n    background: #f8f9fa;\n    border-radius: 8px;\n}\n\n.pagination-container button {\n    padding: 0.5rem 1rem;\n    border: 1px solid #dee2e6;\n    background: white;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 500;\n    transition: all 0.2s ease;\n}\n\n.pagination-container button:hover:not(:disabled) {\n    background: #e9ecef;\n    border-color: #adb5bd;\n}\n\n.pagination-container button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.loading-state {\n    text-align: center;\n    padding: 3rem;\n    color: #6c757d;\n}\n\n.loading-state i {\n    font-size: 2rem;\n    margin-bottom: 1rem;\n    color: #007bff;\n}\n\n@media (max-width: 768px) {\n    .transaction-header {\n        flex-direction: column;\n        align-items: flex-start;\n        gap: 1rem;\n    }\n\n    .transaction-amount {\n        align-self: flex-end;\n    }\n\n    .transactions-filters {\n        flex-direction: column;\n    }\n\n    .filter-group select {\n        min-width: 100%;\n    }\n\n    .pagination-container {\n        flex-direction: column;\n        gap: 1rem;\n    }\n}\n\n/* Notification dot for new transactions */\n.notification-dot {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    width: 8px;\n    height: 8px;\n    background: #dc3545;\n    border-radius: 50%;\n    border: 2px solid white;\n    box-shadow: 0 0 0 1px rgba(220, 53, 69, 0.5);\n    animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n    0% {\n        box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);\n    }\n    70% {\n        box-shadow: 0 0 0 4px rgba(220, 53, 69, 0);\n    }\n    100% {\n        box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);\n    }\n}\n\n/* Weekly Quests Styles */\n.quest-timer {\n    text-align: right;\n    color: #6b7280;\n}\n\n.timer-label {\n    font-size: 0.875rem;\n    margin-bottom: 0.25rem;\n}\n\n.timer-countdown {\n    font-size: 1.125rem;\n    font-weight: 600;\n    color: #ec3750;\n}\n\n.quests-container {\n    display: grid;\n    gap: 1.5rem;\n    margin-bottom: 2rem;\n}\n\n.quest-card {\n    background: white;\n    border-radius: 12px;\n    padding: 1.5rem;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    border: 1px solid #e2e8f0;\n    transition: all 0.3s ease;\n}\n\n.quest-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n}\n\n.quest-header {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n    margin-bottom: 1rem;\n}\n\n.quest-icon {\n    width: 48px;\n    height: 48px;\n    background: linear-gradient(135deg, #ec3750, #d63146);\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 1.25rem;\n    flex-shrink: 0;\n}\n\n.quest-info {\n    flex: 1;\n}\n\n.quest-info h3 {\n    margin: 0 0 0.5rem 0;\n    color: #1a202c;\n    font-size: 1.125rem;\n    font-weight: 600;\n}\n\n.quest-info p {\n    margin: 0;\n    color: #6b7280;\n    font-size: 0.875rem;\n    line-height: 1.4;\n}\n\n.quest-reward {\n    text-align: right;\n    flex-shrink: 0;\n}\n\n.reward-amount {\n    font-size: 1.125rem;\n    font-weight: 700;\n    color: #059669;\n    margin-bottom: 0.25rem;\n}\n\n.reward-label {\n    font-size: 0.75rem;\n    color: #6b7280;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.quest-progress {\n    margin-top: 1rem;\n}\n\n.progress-bar {\n    width: 100%;\n    height: 8px;\n    background: #f3f4f6;\n    border-radius: 4px;\n    overflow: hidden;\n    margin-bottom: 0.75rem;\n}\n\n.progress-fill {\n    height: 100%;\n    background: linear-gradient(90deg, #10b981, #059669);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n}\n\n.progress-text {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-size: 0.875rem;\n}\n\n.quest-status {\n    padding: 0.25rem 0.75rem;\n    border-radius: 6px;\n    font-weight: 500;\n    font-size: 0.75rem;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.quest-status.pending {\n    background: #fef3c7;\n    color: #92400e;\n}\n\n.quest-status.completed {\n    background: #d1fae5;\n    color: #065f46;\n}\n\n.quest-status.claimed {\n    background: #e0e7ff;\n    color: #3730a3;\n}\n\n.quest-info-box {\n    background: #f8fafc;\n    border: 1px solid #e2e8f0;\n    border-radius: 12px;\n    padding: 1.5rem;\n    display: flex;\n    gap: 1rem;\n    align-items: flex-start;\n}\n\n.info-icon {\n    width: 40px;\n    height: 40px;\n    background: #dbeafe;\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: #2563eb;\n    font-size: 1.125rem;\n    flex-shrink: 0;\n}\n\n.info-content h4 {\n    margin: 0 0 0.75rem 0;\n    color: #1a202c;\n    font-size: 1rem;\n    font-weight: 600;\n}\n\n.info-content ul {\n    margin: 0;\n    padding-left: 1.25rem;\n    color: #4b5563;\n    font-size: 0.875rem;\n    line-height: 1.5;\n}\n\n.info-content li {\n    margin-bottom: 0.5rem;\n}\n\n.info-content li:last-child {\n    margin-bottom: 0;\n}\n\n@media (max-width: 768px) {\n    .quest-timer {\n        text-align: left;\n        margin-top: 1rem;\n    }\n\n    .quest-header {\n        flex-direction: column;\n        gap: 0.75rem;\n    }\n\n    .quest-reward {\n        text-align: left;\n        margin-top: 0.5rem;\n    }\n\n    .progress-text {\n        flex-direction: column;\n        gap: 0.5rem;\n        align-items: flex-start;\n    }\n\n    .quest-info-box {\n        flex-direction: column;\n        gap: 0.75rem;\n    }\n}\n\n.nav-link {\n    position: relative;\n}\n\n/* Slack Integration Styles */\n.slack-setup-container {\n    display: flex;\n    flex-direction: column;\n    gap: 2rem;\n}\n\n.slack-info-card {\n    background: linear-gradient(135deg, #4A154B 0%, #36C5F0 100%);\n    border-radius: 16px;\n    padding: 2rem;\n    color: white;\n    position: relative;\n    overflow: hidden;\n}\n\n.slack-info-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 200px;\n    height: 200px;\n    background: rgba(255, 255, 255, 0.1);\n    border-radius: 50%;\n    transform: translate(50%, -50%);\n}\n\n.slack-info-header {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    margin-bottom: 1rem;\n    position: relative;\n    z-index: 2;\n}\n\n.slack-logo {\n    font-size: 3rem;\n    color: #36C5F0;\n}\n\n.slack-info-header h3 {\n    margin: 0;\n    font-size: 1.5rem;\n    font-weight: 600;\n}\n\n.slack-info-content {\n    position: relative;\n    z-index: 2;\n}\n\n.slack-info-content p {\n    font-size: 1.1rem;\n    margin-bottom: 1.5rem;\n    opacity: 0.95;\n}\n\n.slack-requirements {\n    background: rgba(255, 255, 255, 0.15);\n    border-radius: 12px;\n    padding: 1.5rem;\n    backdrop-filter: blur(10px);\n}\n\n.slack-requirements h4 {\n    margin: 0 0 1rem 0;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-size: 1rem;\n    color: #FFE066;\n}\n\n.slack-requirements ul {\n    margin: 0;\n    padding-left: 1.5rem;\n}\n\n.slack-requirements li {\n    margin-bottom: 0.5rem;\n    line-height: 1.5;\n}\n\n.slack-settings-card,\n.slack-invite-card {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);\n    overflow: hidden;\n}\n\n.btn-slack {\n    background: #4A154B;\n    color: white;\n    border: none;\n    padding: 0.75rem 1.5rem;\n    border-radius: 8px;\n    font-weight: 600;\n    transition: all 0.2s ease;\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.btn-slack:hover {\n    background: #36C5F0;\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(74, 21, 75, 0.3);\n}\n\n.invite-options {\n    display: flex;\n    flex-direction: column;\n    gap: 2rem;\n}\n\n.invite-option {\n    padding: 1.5rem;\n    border: 2px solid #E5E7EB;\n    border-radius: 12px;\n    transition: all 0.2s ease;\n}\n\n.invite-option:hover {\n    border-color: #4A154B;\n    background: #F9FAFB;\n}\n\n.invite-option h4 {\n    margin: 0 0 0.5rem 0;\n    color: #1F2937;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.invite-option p {\n    margin: 0 0 1rem 0;\n    color: #6B7280;\n}\n\n.invite-divider {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    margin: 1rem 0;\n}\n\n.invite-divider::before {\n    content: '';\n    position: absolute;\n    left: 0;\n    right: 0;\n    height: 1px;\n    background: #E5E7EB;\n}\n\n.invite-divider span {\n    background: white;\n    padding: 0 1rem;\n    color: #9CA3AF;\n    font-weight: 600;\n    font-size: 0.875rem;\n}\n\n.individual-invite-form {\n    margin-top: 1rem;\n}\n\n.current-channel-info {\n    margin-top: 2rem;\n    padding-top: 2rem;\n    border-top: 1px solid #E5E7EB;\n}\n\n.channel-info-box {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem;\n    background: #F3F4F6;\n    border-radius: 8px;\n}\n\n.channel-info-box i {\n    font-size: 1.5rem;\n    color: #4A154B;\n}\n\n.form-help {\n    display: block;\n    margin-top: 0.5rem;\n    font-size: 0.875rem;\n    color: #6B7280;\n}\n\n.form-help i {\n    margin-right: 0.25rem;\n    color: #9CA3AF;\n}\n\n@media (max-width: 768px) {\n    .slack-setup-container {\n        gap: 1.5rem;\n    }\n\n    .slack-info-card {\n        padding: 1.5rem;\n    }\n\n    .slack-info-header {\n        flex-direction: column;\n        text-align: center;\n        gap: 0.5rem;\n    }\n\n    .slack-logo {\n        font-size: 2.5rem;\n    }\n\n    .invite-options {\n        gap: 1.5rem;\n    }\n\n    .invite-option {\n        padding: 1rem;\n    }\n\n    .individual-invite-form > div {\n        flex-direction: column !important;\n        gap: 1rem !important;\n    }\n}\n\n/* Advertising Section */\n.poster-templates {\n    margin-top: 2rem;\n}\n\n.template-grid {\n    margin-top: 1rem;\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 1.5rem;\n}\n\n.template-card {\n    background: white;\n    border: 1px solid #e2e8f0;\n    border-radius: 12px;\n    padding: 1.5rem;\n    text-align: center;\n    transition: all 0.3s ease;\n    cursor: pointer;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\n.template-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.15);\n    border-color: #ec3750;\n}\n\n.template-preview {\n    margin-bottom: 1.5rem;\n}\n\n.template-icon {\n    width: 60px;\n    height: 60px;\n    background: linear-gradient(135deg, #ec3750, #d63146);\n    border-radius: 12px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 1.5rem;\n    margin: 0 auto 1rem;\n    box-shadow: 0 4px 15px rgba(236, 55, 80, 0.3);\n}\n\n.template-card h4 {\n    margin: 0 0 0.5rem 0;\n    color: #1a202c;\n    font-size: 1.1rem;\n    font-weight: 600;\n}\n\n.template-card p {\n    margin: 0;\n    color: #718096;\n    font-size: 0.9rem;\n}\n\n/* Compact template styles */\n.template-grid.compact {\n    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n    gap: 1rem;\n}\n\n.template-card.compact {\n    padding: 1rem;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-height: 80px;\n}\n\n.template-card.compact i {\n    font-size: 1.5rem;\n    color: #ec3750;\n}\n\n.template-card.compact span {\n    font-size: 0.9rem;\n    font-weight: 500;\n    color: #1a202c;\n}\n\n.template-card.compact button {\n    background: none;\n    border: none;\n    color: #718096;\n    font-size: 0.9rem;\n    cursor: pointer;\n    padding: 0.25rem;\n    border-radius: 4px;\n    transition: all 0.2s ease;\n}\n\n.template-card.compact button:hover {\n    background: #f7fafc;\n    color: #ec3750;\n}\n\n/* Branding section styles */\n.branding-section {\n    margin-top: 2rem;\n    padding-top: 2rem;\n    border-top: 1px solid #e2e8f0;\n}\n\n.branding-header-actions {\n    display: flex;\n    gap: 0.5rem;\n    align-items: center;\n    flex-wrap: wrap;\n}\n\n.branding-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 1.5rem;\n    margin-top: 1rem;\n}\n\n.branding-item {\n    background: white;\n    border: 1px solid #e2e8f0;\n    border-radius: 12px;\n    padding: 1.5rem;\n    text-align: center;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n}\n\n.branding-preview {\n    margin-bottom: 1rem;\n    min-height: 80px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.logo-preview {\n    max-width: 120px;\n    max-height: 60px;\n    object-fit: contain;\n}\n\n.color-palette {\n    display: grid;\n    grid-template-columns: repeat(4, 1fr);\n    gap: 0.5rem;\n}\n\n.color-swatch {\n    width: 30px;\n    height: 30px;\n    border-radius: 6px;\n    border: 2px solid white;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n    cursor: pointer;\n    transition: transform 0.2s ease;\n}\n\n.color-swatch:hover {\n    transform: scale(1.1);\n}\n\n.sticker-preview .sticker-sample {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 0.25rem;\n    align-items: center;\n}\n\n.sticker-sample img {\n    width: 30px;\n    height: 30px;\n    object-fit: cover;\n    border-radius: 4px;\n}\n\n.more-indicator {\n    font-size: 0.7rem;\n    color: #718096;\n    font-weight: 500;\n    grid-column: span 3;\n    margin-top: 0.25rem;\n}\n\n.branding-info h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 1rem;\n    font-weight: 600;\n    color: #1a202c;\n}\n\n.branding-info p {\n    margin: 0 0 1rem 0;\n    font-size: 0.8rem;\n    color: #718096;\n}\n\n.btn.btn-outline {\n    background: transparent;\n    border: 1px solid #ec3750;\n    color: #ec3750;\n}\n\n.btn.btn-outline:hover {\n    background: #ec3750;\n    color: white;\n}\n\n.btn.btn-sm {\n    padding: 0.5rem 1rem;\n    font-size: 0.8rem;\n}\n\n/* Button groups for stickers and posters */\n.sticker-buttons, .poster-buttons {\n    display: flex;\n    gap: 0.5rem;\n    justify-content: center;\n    flex-wrap: wrap;\n}\n\n.sticker-buttons .btn, .poster-buttons .btn {\n    flex: 1;\n    min-width: 0;\n    white-space: nowrap;\n}\n\n.poster-buttons {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n}\n\n.order-buttons {\n    display: flex;\n    gap: 0.5rem;\n    justify-content: center;\n}\n\n.order-buttons .btn {\n    flex: 1;\n    min-width: 0;\n    white-space: nowrap;\n}\n\n/* Poster sample styling */\n.poster-sample {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.poster-formats {\n    display: flex;\n    gap: 0.25rem;\n}\n\n.format-badge {\n    background: #f7fafc;\n    border: 1px solid #e2e8f0;\n    border-radius: 4px;\n    padding: 0.125rem 0.375rem;\n    font-size: 0.7rem;\n    font-weight: 500;\n    color: #4a5568;\n}\n\n/* Modal styles for branding */\n.modal.large .modal-content {\n    max-width: 800px;\n    width: 90%;\n}\n\n.sticker-library-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n    gap: 1rem;\n    margin-top: 1rem;\n    max-height: 400px;\n    overflow-y: auto;\n}\n\n.sticker-library-item {\n    position: relative;\n    background: white;\n    border: 1px solid #e2e8f0;\n    border-radius: 8px;\n    padding: 0.5rem;\n    text-align: center;\n    transition: all 0.2s ease;\n}\n\n.sticker-library-item:hover {\n    border-color: #ec3750;\n    transform: translateY(-2px);\n}\n\n.sticker-library-item img {\n    width: 60px;\n    height: 60px;\n    object-fit: contain;\n    margin-bottom: 0.5rem;\n}\n\n.poster-library-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));\n    gap: 1rem;\n    margin-top: 1rem;\n    max-height: 400px;\n    overflow-y: auto;\n}\n\n.poster-item {\n    position: relative;\n    background: white;\n    border: 1px solid #e2e8f0;\n    border-radius: 8px;\n    padding: 0.5rem;\n    text-align: center;\n    transition: all 0.2s ease;\n    cursor: pointer;\n}\n\n.poster-item:hover {\n    border-color: #ec3750;\n    transform: translateY(-2px);\n}\n\n.poster-item img {\n    width: 100%;\n    height: 100px;\n    object-fit: contain;\n    margin-bottom: 0.5rem;\n}\n\n.download-btn {\n    background: #ec3750;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    padding: 0.25rem 0.5rem;\n    font-size: 0.7rem;\n    cursor: pointer;\n    transition: background 0.2s ease;\n}\n\n.download-btn:hover {\n    background: #d63146;\n}\n\n.color-palette-detailed {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1rem;\n    margin-top: 1rem;\n}\n\n.color-item {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    background: white;\n    border: 1px solid #e2e8f0;\n    border-radius: 8px;\n    padding: 1rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.color-item:hover {\n    border-color: #ec3750;\n    transform: translateY(-1px);\n}\n\n.color-preview {\n    width: 40px;\n    height: 40px;\n    border-radius: 6px;\n    border: 2px solid white;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n}\n\n.color-info strong {\n    display: block;\n    font-weight: 600;\n    color: #1a202c;\n    margin-bottom: 0.25rem;\n}\n\n.color-info code {\n    background: #f7fafc;\n    padding: 0.2rem 0.4rem;\n    border-radius: 4px;\n    font-family: monospace;\n    font-size: 0.8rem;\n    color: #4a5568;\n}\n\n.poster-creator-modal {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0,0,0,0.5);\n    z-index: 10000;\n    overflow-y: auto;\n}\n\n.poster-creator-content {\n    background: white;\n    margin: 6rem auto 2rem;\n    padding: 0;\n    border-radius: 12px;\n    max-width: 1200px;\n    width: 90%;\n    max-height: calc(90vh - 4rem);\n    overflow: hidden;\n    display: flex;\n    flex-direction: column;\n}\n\n.poster-creator-header {\n    padding: 1.5rem;\n    border-bottom: 1px solid #e2e8f0;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    background: #f8fafc;\n}\n\n.poster-creator-header h3 {\n    margin: 0;\n    color: #1a202c;\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n\n.poster-creator-body {\n    flex: 1;\n    display: grid;\n    grid-template-columns: 300px 1fr;\n    height: 600px;\n    overflow: hidden;\n}\n\n.poster-controls {\n    padding: 1.5rem;\n    border-right: 1px solid #e2e8f0;\n    background: #f8fafc;\n    overflow-y: auto;\n}\n\n.poster-preview {\n    padding: 1.5rem;\n    background: white;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    overflow: hidden;\n}\n\n.poster-canvas {\n    width: 400px;\n    height: 600px;\n    background: white;\n    border: 1px solid #e2e8f0;\n    border-radius: 8px;\n    position: relative;\n    overflow: hidden;\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n}\n\n.control-section {\n    margin-bottom: 2rem;\n}\n\n.control-section h4 {\n    margin: 0 0 1rem 0;\n    color: #1a202c;\n    font-size: 1rem;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.control-group {\n    margin-bottom: 1rem;\n}\n\n.control-group label {\n    display: block;\n    margin-bottom: 0.5rem;\n    font-weight: 500;\n    color: #374151;\n    font-size: 0.9rem;\n}\n\n.control-group input,\n.control-group select,\n.control-group textarea {\n    width: 100%;\n    padding: 0.5rem;\n    border: 1px solid #d1d5db;\n    border-radius: 6px;\n    font-size: 0.9rem;\n    transition: border-color 0.3s ease;\n}\n\n.control-group input:focus,\n.control-group select:focus,\n.control-group textarea:focus {\n    outline: none;\n    border-color: #ec3750;\n}\n\n.color-picker {\n    display: flex;\n    gap: 0.5rem;\n    align-items: center;\n}\n\n.color-picker input[type=\"color\"] {\n    width: 40px;\n    height: 40px;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n}\n\n.font-size-slider {\n    width: 100%;\n}\n\n.stickers-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));\n    gap: 0.5rem;\n    max-height: 200px;\n    overflow-y: auto;\n    margin-bottom: 1rem;\n    padding: 0.5rem;\n    border: 1px solid #e2e8f0;\n    border-radius: 6px;\n    background: #f8fafc;\n}\n\n.sticker-item {\n    width: 50px;\n    height: 50px;\n    cursor: pointer;\n    border: 2px solid transparent;\n    border-radius: 6px;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: white;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n}\n\n.sticker-item:hover {\n    border-color: #ec3750;\n    transform: scale(1.05);\n}\n\n.sticker-item img {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    border-radius: 4px;\n}\n\n.poster-sticker {\n    position: absolute;\n    cursor: move;\n    user-select: none;\n    z-index: 10;\n    border: 2px solid transparent;\n    border-radius: 4px;\n    transition: border-color 0.2s ease;\n}\n\n.poster-sticker:hover {\n    border-color: #ec3750;\n}\n\n.poster-sticker.selected {\n    border-color: #ec3750;\n}\n\n.poster-sticker img {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    pointer-events: none;\n}\n\n.sticker-controls {\n    position: absolute;\n    top: -30px;\n    right: 0;\n    display: none;\n    gap: 0.25rem;\n}\n\n.poster-sticker.selected .sticker-controls {\n    display: flex;\n}\n\n.sticker-control-btn {\n    background: #ec3750;\n    color: white;\n    border: none;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 0.7rem;\n}\n\n.sticker-resize-handle {\n    position: absolute;\n    bottom: -5px;\n    right: -5px;\n    width: 10px;\n    height: 10px;\n    background: #ec3750;\n    border: 2px solid white;\n    border-radius: 50%;\n    cursor: nw-resize;\n    display: none;\n}\n\n.poster-sticker.selected .sticker-resize-handle {\n    display: block;\n}\n\n.sticker-rotate-handle {\n    position: absolute;\n    top: -15px;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 10px;\n    height: 10px;\n    background: #3b82f6;\n    border: 2px solid white;\n    border-radius: 50%;\n    cursor: crosshair;\n    display: none;\n}\n\n.poster-sticker.selected .sticker-rotate-handle {\n    display: block;\n}\n\n/* QR Code resize handle */\n.qr-resize-handle {\n    position: absolute;\n    bottom: -5px;\n    right: -5px;\n    width: 10px;\n    height: 10px;\n    background: #ec3750;\n    border: 2px solid white;\n    border-radius: 50%;\n    cursor: nw-resize;\n    display: none;\n}\n\n.qr-code.selected .qr-resize-handle {\n    display: block;\n}\n\n.design-elements {\n    margin-top: 1rem;\n}\n\n.design-element-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));\n    gap: 0.5rem;\n    margin-bottom: 1rem;\n}\n\n.design-element-item {\n    width: 40px;\n    height: 40px;\n    cursor: pointer;\n    border: 2px solid transparent;\n    border-radius: 6px;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: white;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n    font-size: 1.2rem;\n}\n\n.design-element-item:hover {\n    border-color: #ec3750;\n    transform: scale(1.05);\n}\n\n.poster-design-element {\n    position: absolute;\n    cursor: move;\n    user-select: none;\n    z-index: 8;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border: 2px solid transparent;\n    border-radius: 4px;\n    transition: border-color 0.2s ease;\n}\n\n.poster-design-element:hover {\n    border-color: #3b82f6;\n}\n\n.poster-design-element.selected {\n    border-color: #3b82f6;\n}\n\n.hack-club-logo {\n    position: absolute;\n    top: 1rem;\n    right: 1rem;\n    width: 60px;\n    height: auto;\n    opacity: 0.8;\n    z-index: 5;\n}\n\n.qr-code {\n    position: absolute;\n    background: white;\n    padding: 8px;\n    border-radius: 8px;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n    z-index: 6;\n    cursor: move;\n    border: 2px solid transparent;\n    transition: border-color 0.2s ease;\n    user-select: none;\n}\n\n.qr-code:hover {\n    border-color: #3b82f6;\n}\n\n.qr-code.selected {\n    border-color: #3b82f6;\n}\n\n.qr-code .sticker-controls {\n    position: absolute;\n    top: -30px;\n    right: 0;\n    display: none;\n    gap: 0.25rem;\n}\n\n.qr-code.selected .sticker-controls {\n    display: flex;\n}\n\n.poster-actions {\n    padding: 1.5rem;\n    border-top: 1px solid #e2e8f0;\n    background: #f8fafc;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.export-options {\n    display: flex;\n    gap: 1rem;\n}\n\n@media (max-width: 768px) {\n    .template-grid {\n        grid-template-columns: 1fr;\n    }\n\n    .poster-creator-body {\n        grid-template-columns: 1fr;\n        height: auto;\n    }\n\n    .poster-controls {\n        border-right: none;\n        border-bottom: 1px solid #e2e8f0;\n    }\n\n    .poster-canvas {\n        width: 100%;\n        max-width: 300px;\n        height: 450px;\n    }\n}\n\n/* Piggy Bank Section */\n#piggy-bank .content-header {\n    margin-bottom: 2rem;\n}\n\n.piggy-bank-balance {\n    background: #ffffff;\n    border: 2px solid #dee2e6;\n    border-radius: 8px;\n    padding: 20px;\n    text-align: center;\n    margin-bottom: 20px;\n}\n\n.piggy-bank-balance .balance-label {\n    display: block;\n    font-size: 14px;\n    color: #6c757d;\n    margin-bottom: 8px;\n    font-weight: 500;\n}\n\n.piggy-bank-balance .balance-amount {\n    display: block;\n    font-size: 28px;\n    font-weight: 700;\n    color: #495057;\n}\n\n.piggy-bank-info {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 1.5rem;\n    margin-bottom: 2.5rem;\n}\n\n.info-card {\n    background: var(--surface, #ffffff);\n    border: 1px solid var(--border, #e2e8f0);\n    border-radius: var(--border-radius, 8px);\n    padding: 1.5rem;\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n    transition: all 0.2s ease;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.info-card:hover {\n    box-shadow: var(--shadow-hover, 0 4px 12px rgba(0, 0, 0, 0.15));\n    transform: translateY(-2px);\n}\n\n.info-icon {\n    flex-shrink: 0;\n    width: 48px;\n    height: 48px;\n    background: linear-gradient(135deg, #e91e63, #f06292);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 1.25rem;\n}\n\n.info-content h3 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text, #1a202c);\n    font-size: 1.1rem;\n    font-weight: 600;\n}\n\n.info-content p {\n    margin: 0;\n    color: var(--text-secondary, #718096);\n    font-size: 0.9rem;\n    line-height: 1.5;\n}\n\n.piggy-bank-transactions {\n    background: var(--surface, #ffffff);\n    border: 1px solid var(--border, #e2e8f0);\n    border-radius: var(--border-radius, 8px);\n    padding: 1.5rem;\n    margin-top: 2rem;\n}\n\n.transactions-header {\n    margin-bottom: 1.5rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border, #e2e8f0);\n}\n\n.transactions-header h3 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text, #1a202c);\n    font-size: 1.2rem;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.transactions-header p {\n    margin: 0;\n    color: var(--text-secondary, #718096);\n    font-size: 0.9rem;\n}\n\n.piggy-bank-filters {\n    margin-bottom: 1.5rem;\n    display: flex;\n    gap: 1rem;\n    flex-wrap: wrap;\n    align-items: end;\n}\n\n.piggy-bank-filters .filter-group {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n}\n\n.piggy-bank-filters label {\n    font-size: 0.9rem;\n    font-weight: 500;\n    color: var(--text, #1a202c);\n}\n\n.piggy-bank-filters select {\n    min-width: 150px;\n    padding: 0.5rem;\n    border: 1px solid var(--border, #e2e8f0);\n    border-radius: 4px;\n    background: var(--surface, #ffffff);\n}\n\n#piggyBankTransactionsTable {\n    margin-bottom: 1rem;\n    width: 100%;\n    border-collapse: collapse;\n    background: white;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\n#piggyBankTransactionsTable th {\n    background: #f8f9fa;\n    color: #495057;\n    font-weight: 600;\n    padding: 12px 16px;\n    border-bottom: 2px solid #dee2e6;\n}\n\n#piggyBankTransactionsTable td {\n    padding: 12px 16px;\n    border-bottom: 1px solid #e9ecef;\n    vertical-align: middle;\n    color: #495057;\n    font-size: 0.9rem;\n}\n\n#piggyBankTransactionsTable tr:nth-child(even) {\n    background-color: #f8f9fa;\n}\n\n#piggyBankTransactionsTable tr:hover {\n    background-color: #e9ecef;\n    transition: background-color 0.2s ease;\n}\n\n.pagination-controls {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-top: 20px;\n    gap: 10px;\n}\n\n.pagination-controls button {\n    padding: 8px 16px;\n    border: 2px solid #667eea;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    border-radius: 20px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-weight: 500;\n    font-size: 0.9rem;\n}\n\n.pagination-controls button:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n}\n\n.pagination-controls button:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    background: #6c757d;\n    border-color: #6c757d;\n}\n\n.pagination-controls button:disabled:hover {\n    transform: none;\n    box-shadow: none;\n}\n\n.pagination-controls span {\n    color: #495057;\n    font-weight: 500;\n    margin: 0 10px;\n}\n\n.transaction-date {\n    display: flex;\n    flex-direction: column;\n    gap: 0.25rem;\n}\n\n.transaction-description {\n    max-width: 200px;\n    word-wrap: break-word;\n}\n\n.badge {\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    font-size: 0.75rem;\n    font-weight: 500;\n    text-transform: uppercase;\n}\n\n.badge-success {\n    background: #d4edda;\n    color: #155724;\n    border: 1px solid #c3e6cb;\n}\n\n.badge-danger {\n    background: #f8d7da;\n    color: #721c24;\n    border: 1px solid #f5c6cb;\n}\n\n/* Toast notifications */\n.toast-container {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    z-index: 9999;\n}\n\n/* Chat Styles */\n.chat-container {\n    display: flex;\n    flex-direction: column;\n    height: 500px;\n    background: white;\n    border-radius: 8px;\n    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n    overflow: hidden;\n}\n\n.chat-messages {\n    flex: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    background: #f8f9fa;\n    scrollbar-width: thin;\n    scrollbar-color: #cbd5e0 transparent;\n}\n\n.chat-messages::-webkit-scrollbar {\n    width: 6px;\n}\n\n.chat-messages::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.chat-messages::-webkit-scrollbar-thumb {\n    background: #cbd5e0;\n    border-radius: 3px;\n}\n\n.chat-messages::-webkit-scrollbar-thumb:hover {\n    background: #a0aec0;\n}\n\n.chat-message {\n    margin-bottom: 1rem;\n    background: white;\n    border-radius: 8px;\n    padding: 0.75rem;\n    border: 1px solid #e2e8f0;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n    animation: slideIn 0.2s ease-out;\n}\n\n.chat-message:hover .delete-message-btn {\n    opacity: 1;\n}\n\n@keyframes slideIn {\n    from {\n        opacity: 0;\n        transform: translateY(-10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.message-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.5rem;\n    font-size: 0.875rem;\n}\n\n.message-username {\n    font-weight: 600;\n    color: #ec3750;\n}\n\n.message-time {\n    color: #718096;\n    font-size: 0.75rem;\n}\n\n.message-content {\n    color: #2d3748;\n    line-height: 1.5;\n    white-space: pre-wrap;\n    word-wrap: break-word;\n}\n\n.message-actions {\n    display: flex;\n    gap: 0.25rem;\n    opacity: 0;\n    transition: opacity 0.2s ease;\n}\n\n.chat-message:hover .message-actions {\n    opacity: 1;\n}\n\n.edit-message-btn,\n.delete-message-btn {\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    padding: 0.25rem;\n    border-radius: 4px;\n    font-size: 0.75rem;\n    min-width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.edit-message-btn {\n    color: #3182ce;\n}\n\n.edit-message-btn:hover {\n    background: #bee3f8;\n    color: #2c5282;\n}\n\n.delete-message-btn {\n    color: #e53e3e;\n}\n\n.delete-message-btn:hover {\n    background: #fed7d7;\n    color: #c53030;\n}\n\n.chat-input-area {\n    border-top: 1px solid #e2e8f0;\n    padding: 1rem;\n    background: white;\n}\n\n.chat-input-area .input-group {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n}\n\n.input-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    position: relative;\n}\n\n.input-actions {\n    display: flex;\n    align-items: center;\n    gap: 0.25rem;\n    position: absolute;\n    right: 0.5rem;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.input-actions .input-btn-icon {\n    background: none;\n    border: none;\n    color: #718096;\n    cursor: pointer;\n    padding: 0.5rem;\n    border-radius: 4px;\n    transition: all 0.2s ease;\n    font-size: 0.875rem;\n}\n\n.input-actions .input-btn-icon:hover:not(:disabled) {\n    background: #e2e8f0;\n    color: #4a5568;\n}\n\n.input-actions .input-btn-icon:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n}\n\n.chat-input-area .form-control {\n    flex: 1;\n    border: 1px solid #e2e8f0;\n    border-radius: 6px;\n    padding: 0.75rem;\n    font-size: 0.875rem;\n    resize: none;\n    outline: none;\n    transition: border-color 0.2s ease;\n}\n\n.chat-input-area .form-control:focus {\n    border-color: #ec3750;\n    box-shadow: 0 0 0 3px rgba(236, 55, 80, 0.1);\n}\n\n.chat-input-area .btn {\n    background: #ec3750;\n    color: white;\n    border: none;\n    border-radius: 6px;\n    padding: 0.75rem 1.5rem;\n    font-size: 0.875rem;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    white-space: nowrap;\n}\n\n.chat-input-area .btn:hover:not(:disabled) {\n    background: #d63146;\n    transform: translateY(-1px);\n}\n\n.chat-input-area .btn:disabled {\n    background: #a0aec0;\n    cursor: not-allowed;\n    transform: none;\n}\n\n.chat-status {\n    margin-top: 0.5rem;\n    font-size: 0.75rem;\n    color: #718096;\n    text-align: center;\n}\n\n.no-messages {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n    color: #718096;\n    font-style: italic;\n    text-align: center;\n}\n\n/* Chat Modal Styles */\n.message-preview {\n    background: #f7fafc;\n    border: 1px solid #e2e8f0;\n    border-radius: 6px;\n    padding: 0.75rem;\n    margin-top: 0.5rem;\n}\n\n.message-preview-text {\n    color: #4a5568;\n    font-style: italic;\n    white-space: pre-wrap;\n    word-wrap: break-word;\n}\n\n.character-count {\n    text-align: right;\n}\n\n#editMessageContent {\n    resize: vertical;\n    min-height: 100px;\n}\n\n/* Modal button styles */\n.btn-modal {\n    padding: 0.5rem 1rem;\n    border: none;\n    border-radius: 6px;\n    font-size: 0.875rem;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.btn-modal.btn-primary {\n    background: #3182ce;\n    color: white;\n}\n\n.btn-modal.btn-primary:hover {\n    background: #2c5282;\n}\n\n.btn-modal.btn-danger {\n    background: #e53e3e;\n    color: white;\n}\n\n.btn-modal.btn-danger:hover {\n    background: #c53030;\n}\n\n.btn-modal.btn-secondary {\n    background: #e2e8f0;\n    color: #4a5568;\n}\n\n.btn-modal.btn-secondary:hover {\n    background: #cbd5e0;\n}\n\n.modal-close {\n    background: none;\n    border: none;\n    font-size: 24px;\n    cursor: pointer;\n    color: #a0aec0;\n    transition: color 0.2s ease;\n    padding: 0;\n    line-height: 1;\n}\n\n.modal-close:hover {\n    color: #718096;\n}\n\n.modal-header.error h3 {\n    color: #e53e3e;\n}\n\n.modal-header.primary h3 {\n    color: #3182ce;\n}\n\n/* Mobile adjustments for images */\n@media (max-width: 768px) {\n    .input-wrapper {\n        flex-direction: column;\n        align-items: stretch;\n    }\n\n    .input-actions {\n        position: static;\n        transform: none;\n        margin-top: 0.5rem;\n        justify-content: center;\n    }\n\n    .message-image img {\n        max-height: 250px;\n    }\n\n    .image-preview-container {\n        max-width: 200px;\n    }\n\n    .image-preview-container img {\n        max-height: 150px;\n    }\n}\n\n/* Image Upload and Display Styles */\n.image-preview {\n    margin-top: 0.5rem;\n    padding: 0.75rem;\n    background: #f8f9fa;\n    border: 1px solid #e2e8f0;\n    border-radius: 6px;\n}\n\n.image-preview-container {\n    position: relative;\n    display: inline-block;\n    max-width: 300px;\n}\n\n.image-preview-container img {\n    max-width: 100%;\n    max-height: 200px;\n    border-radius: 4px;\n    object-fit: contain;\n}\n\n.remove-image-btn {\n    position: absolute;\n    top: -8px;\n    right: -8px;\n    background: #e53e3e;\n    color: white;\n    border: none;\n    border-radius: 50%;\n    width: 24px;\n    height: 24px;\n    font-size: 0.75rem;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n}\n\n.remove-image-btn:hover {\n    background: #c53030;\n    transform: scale(1.1);\n}\n\n.message-image {\n    margin-bottom: 0.5rem;\n}\n\n.message-image img {\n    max-width: 100%;\n    max-height: 300px;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: transform 0.2s ease;\n    object-fit: contain;\n    display: block;\n}\n\n.message-image img:hover {\n    transform: scale(1.02);\n}\n\n.message-text {\n    line-height: 1.5;\n    white-space: pre-wrap;\n    word-wrap: break-word;\n}\n\n/* Drag and Drop Styling */\n.chat-input-area.drag-over {\n    border-color: #3182ce;\n    background-color: #ebf8ff;\n}\n\n/* Image Modal for Full-Size Viewing */\n.image-modal {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 10000;\n}\n\n.image-modal-backdrop {\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.8);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n}\n\n.image-modal-content {\n    position: relative;\n    max-width: 90vw;\n    max-height: 90vh;\n    cursor: default;\n}\n\n.image-modal-content img {\n    max-width: 100%;\n    max-height: 100%;\n    object-fit: contain;\n    border-radius: 8px;\n}\n\n.image-modal-close {\n    position: absolute;\n    top: -15px;\n    right: -15px;\n    background: #e53e3e;\n    color: white;\n    border: none;\n    border-radius: 50%;\n    width: 30px;\n    height: 30px;\n    font-size: 1rem;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n}\n\n.image-modal-close:hover {\n    background: #c53030;\n    transform: scale(1.1);\n}\n\n/* Mobile adjustments for images */\n@media (max-width: 768px) {\n    .input-wrapper {\n        flex-direction: column;\n        align-items: stretch;\n    }\n\n    .input-actions {\n        position: static;\n        transform: none;\n        margin-top: 0.5rem;\n        justify-content: center;\n    }\n\n    .message-image img {\n        max-height: 250px;\n    }\n\n    .image-preview-container {\n        max-width: 200px;\n    }\n\n    .image-preview-container img {\n        max-height: 150px;\n    }\n}\n\n/* Hover effect for co-leader and remove icons */\n.role-badge-co-leader:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  background: rgba(234, 88, 12, 0.1);\n}\n\n.old-btn-icon-danger:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}","size_bytes":85259},"app/services/identity.py":{"content":"\"\"\"\nHack Club Identity Service for OAuth authentication\n\"\"\"\nimport os\nimport urllib.parse\nimport requests\n\n# This will be properly initialized when imported by the app\napp = None\nHACKCLUB_IDENTITY_URL = None\nHACKCLUB_IDENTITY_CLIENT_ID = None\nHACKCLUB_IDENTITY_CLIENT_SECRET = None\n\n\ndef init_service(flask_app, identity_url, client_id, client_secret):\n    \"\"\"Initialize the service with app context and configuration\"\"\"\n    global app, HACKCLUB_IDENTITY_URL, HACKCLUB_IDENTITY_CLIENT_ID, HACKCLUB_IDENTITY_CLIENT_SECRET\n    app = flask_app\n    HACKCLUB_IDENTITY_URL = identity_url\n    HACKCLUB_IDENTITY_CLIENT_ID = client_id\n    HACKCLUB_IDENTITY_CLIENT_SECRET = client_secret\n\n\nclass HackClubIdentityService:\n    def __init__(self):\n        self.base_url = HACKCLUB_IDENTITY_URL\n        self.client_id = HACKCLUB_IDENTITY_CLIENT_ID\n        self.client_secret = HACKCLUB_IDENTITY_CLIENT_SECRET\n\n    def get_auth_url(self, redirect_uri, state=None):\n        params = {\n            'client_id': self.client_id,\n            'redirect_uri': redirect_uri,\n            'response_type': 'code',\n            'scope': 'basic_info address'\n        }\n        if state:\n            params['state'] = state\n        return f\"{self.base_url}/oauth/authorize?{urllib.parse.urlencode(params)}\"\n\n    def exchange_code(self, code, redirect_uri):\n        data = {\n            'code': code,\n            'client_id': self.client_id,\n            'client_secret': self.client_secret,\n            'redirect_uri': redirect_uri,\n            'grant_type': 'authorization_code'\n        }\n        try:\n            response = requests.post(f'{self.base_url}/oauth/token', json=data)\n            return response.json()\n        except:\n            return {'error': 'Request failed'}\n\n    def get_user_identity(self, access_token):\n        headers = {'Authorization': f'Bearer {access_token}'}\n        try:\n            response = requests.get(f'{self.base_url}/api/v1/me', headers=headers)\n            if response.status_code == 200:\n                data = response.json()\n                app.logger.debug(f\"Identity API response: {data}\")\n                return data\n            else:\n                app.logger.warning(f\"Identity API error: {response.status_code} - {response.text}\")\n                return None\n        except Exception as e:\n            app.logger.error(f\"Identity API request failed: {str(e)}\")\n            return None\n","size_bytes":2407},"app/models/gallery.py":{"content":"\"\"\"\nGallery models for club photo posts.\n\"\"\"\nimport json\nfrom datetime import datetime, timezone\nfrom extensions import db\n\n\nclass GalleryPost(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    club_id = db.Column(db.Integer, db.ForeignKey('club.id'), nullable=False)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    title = db.Column(db.String(200), nullable=False)\n    description = db.Column(db.Text, nullable=False)\n    images = db.Column(db.Text)  # JSON array of image URLs\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    featured = db.Column(db.Boolean, default=False)\n\n    club = db.relationship('Club', backref='gallery_posts')\n    user = db.relationship('User', backref='gallery_posts')\n\n    def get_images(self):\n        \"\"\"Get parsed images as a list\"\"\"\n        try:\n            return json.loads(self.images) if self.images else []\n        except:\n            return []\n\n    def set_images(self, images_list):\n        \"\"\"Set images as JSON\"\"\"\n        self.images = json.dumps(images_list)\n","size_bytes":1088},"static/js/dash-mobile-member.js":{"content":"\n// Mobile Member Dashboard JavaScript\n\nclass MobileMemberDashboard {\n    constructor() {\n        this.clubId = null;\n        this.joinCode = null;\n        this.currentSection = 'dashboard';\n        this.data = {\n            posts: [],\n            assignments: [],\n            meetings: [],\n            projects: [],\n            resources: [],\n            submissions: []\n        };\n\n        this.init();\n    }\n\n    init() {\n\n        this.showLoadingScreen();\n        this.extractClubData();\n        this.setupEventListeners();\n        this.loadInitialData();\n        this.hideLoadingScreen();\n    }\n\n    extractClubData() {\n        const dashboard = document.getElementById('mobileDashboard');\n        if (dashboard) {\n            this.clubId = dashboard.dataset.clubId;\n            this.joinCode = dashboard.dataset.joinCode;\n        }\n    }\n\n    showLoadingScreen() {\n        const loadingScreen = document.getElementById('mobileLoadingScreen');\n        const dashboard = document.getElementById('mobileDashboard');\n\n        if (loadingScreen && dashboard) {\n            loadingScreen.style.display = 'flex';\n            dashboard.style.display = 'none';\n            document.body.classList.add('mobile-dashboard-active');\n        }\n    }\n\n    hideLoadingScreen() {\n        const loadingScreen = document.getElementById('mobileLoadingScreen');\n        const dashboard = document.getElementById('mobileDashboard');\n\n        if (loadingScreen && dashboard) {\n            loadingScreen.style.opacity = '0';\n            setTimeout(() => {\n                loadingScreen.style.display = 'none';\n                dashboard.style.display = 'flex';\n            }, 300);\n        }\n    }\n\n    setupEventListeners() {\n        document.querySelectorAll('.nav-tab').forEach(tab => {\n            tab.addEventListener('click', (e) => {\n                e.preventDefault();\n                const section = tab.dataset.section;\n                this.openTab(section);\n            });\n        });\n    }\n\n    openTab(sectionName) {\n\n        if (['schedule', 'resources', 'pizza'].includes(sectionName)) {\n            this.openDetailSection(sectionName);\n            return;\n        }\n\n        document.querySelectorAll('.nav-tab').forEach(tab => {\n            tab.classList.remove('active');\n        });\n\n        const activeTab = document.querySelector(`.nav-tab[data-section=\"${sectionName}\"]`);\n        if (activeTab) {\n            activeTab.classList.add('active');\n        }\n\n        document.querySelectorAll('.mobile-section').forEach(section => {\n            section.classList.remove('active');\n        });\n\n        const targetSection = document.getElementById(`${sectionName}Section`);\n        if (targetSection) {\n            targetSection.classList.add('active');\n            this.currentSection = sectionName;\n            this.loadSectionData(sectionName);\n        }\n    }\n\n    openDetailSection(sectionName) {\n        const detailSection = document.getElementById(`${sectionName}Detail`);\n        if (detailSection) {\n            document.body.classList.add('detail-section-open');\n            \n            detailSection.style.display = 'flex';\n            detailSection.style.transform = 'translateX(100%)';\n            detailSection.style.transition = 'transform 0.2s ease';\n            detailSection.classList.add('active');\n\n            setTimeout(() => {\n                detailSection.style.transform = 'translateX(0)';\n            }, 10);\n\n            this.loadSectionData(sectionName);\n        }\n    }\n\n    closeDetailSection() {\n        const activeDetail = document.querySelector('.detail-section.active, .detail-section[style*=\"flex\"]');\n        if (activeDetail) {\n            activeDetail.style.transform = 'translateX(100%)';\n            activeDetail.classList.remove('active');\n            \n            setTimeout(() => {\n                activeDetail.style.display = 'none';\n                document.body.classList.remove('detail-section-open');\n            }, 200);\n        }\n    }\n\n    async loadInitialData() {\n        await this.loadAllData();\n        this.updateStats();\n    }\n\n    async loadAllData() {\n        try {\n            const promises = [\n                this.fetchData('posts'),\n                this.fetchData('assignments'),\n                this.fetchData('meetings'),\n                this.fetchData('resources')\n            ];\n\n            await Promise.all(promises);\n        } catch (error) {\n            console.error('Error loading data:', error);\n        }\n    }\n\n    loadSectionData(sectionName) {\n        switch (sectionName) {\n            case 'stream':\n                this.loadPosts();\n                break;\n            case 'assignments':\n                this.loadAssignments();\n                break;\n            case 'projects':\n                this.loadMyProjects();\n                break;\n            case 'schedule':\n                this.loadMeetings();\n                break;\n            case 'resources':\n                this.loadResources();\n                break;\n            case 'pizza':\n                this.loadMySubmissions();\n                break;\n        }\n    }\n\n    async fetchData(endpoint) {\n        try {\n            const response = await fetch(`/api/clubs/${this.clubId}/${endpoint}`);\n            if (response.ok) {\n                const data = await response.json();\n                let arrayData = Array.isArray(data) ? data : (data.items || data.data || data[endpoint] || data.results || []);\n                this.data[endpoint] = arrayData;\n                return arrayData;\n            }\n        } catch (error) {\n            console.error(`Error fetching ${endpoint}:`, error);\n            throw error;\n        }\n    }\n\n    async loadPosts() {\n        const container = document.getElementById('mobilePostsList');\n        if (!container) return;\n\n        try {\n            const posts = await this.fetchData('posts');\n            \n            if (!Array.isArray(posts) || posts.length === 0) {\n                container.innerHTML = this.getEmptyState('stream', 'No announcements yet', 'Your club leaders will post updates here!');\n            } else {\n                container.innerHTML = posts.map(post => this.renderPost(post)).join('');\n            }\n        } catch (error) {\n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading posts', 'Please try again later');\n        }\n    }\n\n    async loadAssignments() {\n        const container = document.getElementById('mobileAssignmentsList');\n        if (!container) return;\n\n        try {\n            const assignments = await this.fetchData('assignments');\n            \n            if (!Array.isArray(assignments) || assignments.length === 0) {\n                container.innerHTML = this.getEmptyState('tasks', 'No assignments yet', 'Your leaders will assign coding challenges soon!');\n            } else {\n                container.innerHTML = assignments.map(assignment => this.renderAssignment(assignment)).join('');\n            }\n        } catch (error) {\n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading assignments', 'Please try again later');\n        }\n    }\n\n    async loadMeetings() {\n        const container = document.getElementById('mobileMeetingsList');\n        if (!container) return;\n\n        try {\n            const meetings = await this.fetchData('meetings');\n            \n            if (!Array.isArray(meetings) || meetings.length === 0) {\n                container.innerHTML = this.getEmptyState('calendar-times', 'No events scheduled', 'Check back for upcoming club events!');\n            } else {\n                container.innerHTML = meetings.map(meeting => this.renderMeeting(meeting)).join('');\n            }\n        } catch (error) {\n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading meetings', 'Please try again later');\n        }\n    }\n\n    async loadMyProjects() {\n        const container = document.getElementById('mobileMyHackatimeProjectsList');\n        if (!container) return;\n\n        try {\n            const response = await fetch(`/api/hackatime/projects/${window.currentUserId || ''}`);\n            const data = await response.json();\n            \n            if (data.error) {\n                container.innerHTML = this.getEmptyState('exclamation-triangle', 'Unable to load projects', data.error);\n                return;\n            }\n            \n            if (data.projects && data.projects.length > 0) {\n                const projectsHtml = data.projects.map(project => this.renderHackatimeProject(project)).join('');\n                container.innerHTML = projectsHtml;\n            } else {\n                container.innerHTML = this.getEmptyState('clock', 'No projects found', 'You haven\\'t logged any coding time yet');\n            }\n        } catch (error) {\n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading projects', 'Failed to fetch data');\n        }\n    }\n\n    async loadResources() {\n        const container = document.getElementById('mobileResourcesList');\n        if (!container) return;\n\n        try {\n            const resources = await this.fetchData('resources');\n            \n            if (!Array.isArray(resources) || resources.length === 0) {\n                container.innerHTML = this.getEmptyState('book', 'No resources yet', 'Your club leaders will share helpful resources here!');\n            } else {\n                container.innerHTML = resources.map(resource => this.renderResource(resource)).join('');\n            }\n        } catch (error) {\n            container.innerHTML = this.getEmptyState('exclamation-triangle', 'Error loading resources', 'Please try again later');\n        }\n    }\n\n    async loadMySubmissions() {\n        const container = document.getElementById('mobileMySubmissionsList');\n        if (!container) return;\n\n        // For now, show empty state - this would connect to actual submission API\n        container.innerHTML = this.getEmptyState('hand-holding-usd', 'No submissions yet', 'Submit your first project to get started!');\n    }\n\n    renderPost(post) {\n        const authorName = post.author_name || post.author || 'Unknown';\n        const content = post.content || 'No content';\n        const createdAt = post.created_at || new Date().toISOString();\n        \n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem;\">\n                <div style=\"display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;\">\n                    <div class=\"member-avatar\" style=\"width: 35px; height: 35px; font-size: 0.8rem;\">\n                        ${authorName.charAt(0).toUpperCase()}\n                    </div>\n                    <div>\n                        <div style=\"font-weight: 600; color: #1a202c; font-size: 0.9rem;\">${authorName}</div>\n                        <div style=\"font-size: 0.75rem; color: #6b7280;\">${this.timeAgo(createdAt)}</div>\n                    </div>\n                </div>\n                <p style=\"margin: 0; color: #4a5568; line-height: 1.4;\">${content}</p>\n            </div>\n        `;\n    }\n\n    renderAssignment(assignment) {\n        const title = assignment.title || 'Untitled Assignment';\n        const description = assignment.description || 'No description available';\n        const dueDate = assignment.due_date ? new Date(assignment.due_date) : null;\n        const isOverdue = dueDate && dueDate < new Date();\n\n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem; ${isOverdue ? 'border-left: 4px solid #ef4444;' : ''}\">\n                <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;\">\n                    <h4 style=\"margin: 0; color: #1a202c; font-size: 1rem;\">${title}</h4>\n                    ${dueDate ? `<span style=\"font-size: 0.75rem; color: ${isOverdue ? '#ef4444' : '#6b7280'}; white-space: nowrap;\">${this.formatDate(dueDate)}</span>` : ''}\n                </div>\n                <p style=\"margin: 0; color: #6b7280; font-size: 0.875rem; line-height: 1.4;\">${description.length > 100 ? description.substring(0, 100) + '...' : description}</p>\n                ${isOverdue ? '<div style=\"margin-top: 0.5rem; color: #ef4444; font-size: 0.75rem; font-weight: 600;\"><i class=\"fas fa-exclamation-triangle\"></i> Overdue</div>' : ''}\n            </div>\n        `;\n    }\n\n    renderMeeting(meeting) {\n        const title = meeting.title || 'Untitled Meeting';\n        const description = meeting.description || '';\n        const location = meeting.location || '';\n        const link = meeting.meeting_link || '';\n        const datetime = meeting.meeting_date || new Date().toISOString();\n        const meetingDate = new Date(datetime);\n\n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;\">\n                    <h4 style=\"margin: 0; color: #1a202c; font-size: 1rem;\">${title}</h4>\n                    <span style=\"font-size: 0.75rem; color: #6b7280; white-space: nowrap;\">\n                        ${this.formatDateTime(meetingDate)}\n                    </span>\n                </div>\n                ${description ? `<p style=\"margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.875rem;\">${description}</p>` : ''}\n                ${location ? `<div style=\"font-size: 0.75rem; color: #6b7280;\"><i class=\"fas fa-map-marker-alt\"></i> ${location}</div>` : ''}\n                ${link ? `<div style=\"margin-top: 0.5rem;\"><a href=\"${link}\" target=\"_blank\" style=\"color: #ec3750; font-size: 0.75rem; text-decoration: none;\"><i class=\"fas fa-external-link-alt\"></i> Join Meeting</a></div>` : ''}\n            </div>\n        `;\n    }\n\n    renderResource(resource) {\n        const title = resource.title || 'Untitled Resource';\n        const description = resource.description || '';\n        const url = resource.url || '#';\n        const icon = resource.icon || 'link';\n        \n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem;\">\n                <div style=\"display: flex; align-items: center; gap: 0.75rem;\">\n                    <div style=\"width: 35px; height: 35px; background: rgba(236, 55, 80, 0.1); color: #ec3750; border-radius: 8px; display: flex; align-items: center; justify-content: center;\">\n                        <i class=\"fas fa-${icon}\"></i>\n                    </div>\n                    <div style=\"flex: 1;\">\n                        <h4 style=\"margin: 0 0 0.25rem 0; color: #1a202c; font-size: 0.9rem;\">${title}</h4>\n                        ${description ? `<p style=\"margin: 0 0 0.5rem 0; color: #6b7280; font-size: 0.8rem;\">${description}</p>` : ''}\n                        <a href=\"${url}\" target=\"_blank\" style=\"color: #ec3750; font-size: 0.75rem; text-decoration: none;\">\n                            <i class=\"fas fa-external-link-alt\"></i> Visit Resource\n                        </a>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    renderHackatimeProject(project) {\n        return `\n            <div class=\"mobile-card\" style=\"margin-bottom: 1rem;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;\">\n                    <h4 style=\"margin: 0; color: #1a202c; font-size: 1rem;\">\n                        <i class=\"fas fa-code\"></i> ${project.name}\n                    </h4>\n                    <span style=\"background: #10b981; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;\">${project.formatted_time}</span>\n                </div>\n                <div style=\"display: flex; justify-content: space-between; align-items: center; font-size: 0.875rem; color: #6b7280;\">\n                    <span style=\"display: flex; align-items: center; gap: 0.25rem;\">\n                        <i class=\"fas fa-clock\"></i> ${project.total_seconds.toLocaleString()} seconds\n                    </span>\n                    ${project.percent ? `<span style=\"display: flex; align-items: center; gap: 0.25rem;\"><i class=\"fas fa-chart-pie\"></i> ${project.percent.toFixed(1)}%</span>` : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    updateStats() {\n        const counters = {\n            'mobileMembersAssignmentsCount': this.data.assignments?.length || 0,\n            'mobileMemberProjectsCount': 0, // Will be updated by loadMyProjects\n            'mobileMemberEventsCount': this.data.meetings?.length || 0,\n            'mobileMemberSubmissionsCount': 0 // Will be updated when submissions are loaded\n        };\n\n        Object.entries(counters).forEach(([id, count]) => {\n            const element = document.getElementById(id);\n            if (element) {\n                element.textContent = count;\n            }\n        });\n    }\n\n    getEmptyState(icon, title, description) {\n        return `\n            <div class=\"empty-state-mobile\">\n                <i class=\"fas fa-${icon}\"></i>\n                <h3>${title}</h3>\n                <p>${description}</p>\n            </div>\n        `;\n    }\n\n    timeAgo(dateString) {\n        const date = new Date(dateString);\n        const now = new Date();\n        const seconds = Math.floor((now - date) / 1000);\n\n        const intervals = {\n            year: 31536000,\n            month: 2592000,\n            week: 604800,\n            day: 86400,\n            hour: 3600,\n            minute: 60\n        };\n\n        for (const [unit, secondsInUnit] of Object.entries(intervals)) {\n            const interval = Math.floor(seconds / secondsInUnit);\n            if (interval >= 1) {\n                return `${interval} ${unit}${interval !== 1 ? 's' : ''} ago`;\n            }\n        }\n\n        return 'Just now';\n    }\n\n    formatDate(date) {\n        return date.toLocaleDateString('en-US', {\n            month: 'short',\n            day: 'numeric'\n        });\n    }\n\n    formatDateTime(date) {\n        return date.toLocaleDateString('en-US', {\n            month: 'short',\n            day: 'numeric',\n            hour: 'numeric',\n            minute: '2-digit'\n        });\n    }\n}\n\n// Global instance\nlet mobileMemberDashboard;\n\n// Global functions for compatibility\nfunction openTab(sectionName) {\n    if (mobileMemberDashboard) {\n        mobileMemberDashboard.openTab(sectionName);\n    }\n}\n\nfunction closeDetailSection() {\n    if (mobileMemberDashboard) {\n        mobileMemberDashboard.closeDetailSection();\n    }\n}\n\nfunction openPizzaGrantModal() {\n    const modal = document.getElementById('pizzaGrantModal');\n    if (modal) {\n        modal.style.display = 'block';\n    }\n}\n\nfunction closeMobileModal(modalId) {\n    const modal = document.getElementById(modalId);\n    if (modal) {\n        modal.style.display = 'none';\n    }\n}\n\n","size_bytes":18886},"app/routes/api.py":{"content":"\"\"\"\nAPI routes blueprint for the Hack Club Dashboard.\nHandles public API endpoints, admin API, and mobile app endpoints.\n\"\"\"\n\nimport html\nfrom flask import Blueprint, jsonify, request, current_app\nfrom extensions import db, limiter\nfrom app.decorators.auth import api_key_required, oauth_required, admin_required, login_required\nfrom app.utils.auth_helpers import get_current_user, is_authenticated\nfrom app.utils.club_helpers import is_user_co_leader\nfrom app.utils.sanitization import sanitize_string\nfrom app.utils.formatting import markdown_to_html\nfrom app.utils.security import validate_input_with_security\nfrom app.utils.economy_helpers import create_club_transaction, update_quest_progress\nfrom app.models.user import User, create_audit_log\nfrom app.models.club import Club, ClubMembership\nfrom app.models.club_content import ClubPost, ClubAssignment, ClubMeeting, ClubProject\nfrom app.models.gallery import GalleryPost\nfrom app.models.economy import ClubTransaction, ClubQuestProgress\nfrom app.models.system import SystemSettings\nfrom app.services.airtable import airtable_service\n\napi_bp = Blueprint('api', __name__, url_prefix='/api')\n\n\n@api_bp.route('/docs')\ndef api_documentation():\n    \"\"\"API documentation page\"\"\"\n    from flask import render_template\n    return render_template('api_docs.html')\n\n\n# ============================================================================\n# Public API Endpoints (require API key or OAuth)\n# ============================================================================\n\n@api_bp.route('/user', methods=['GET'])\n@oauth_required(scopes=['user:read'])\ndef get_user():\n    \"\"\"Get current user information (OAuth)\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    return jsonify({\n        'id': user.id,\n        'username': user.username,\n        'email': user.email,\n        'first_name': user.first_name,\n        'last_name': user.last_name,\n        'created_at': user.created_at.isoformat() if user.created_at else None\n    })\n\n\n@api_bp.route('/user/clubs', methods=['GET'])\n@oauth_required(scopes=['clubs:read'])\ndef get_user_clubs():\n    \"\"\"Get user's clubs (OAuth)\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    memberships = ClubMembership.query.filter_by(user_id=user.id).all()\n\n    clubs_data = []\n    for membership in memberships:\n        club = membership.club\n        clubs_data.append({\n            'id': club.id,\n            'name': club.name,\n            'description': club.description,\n            'tokens': club.tokens,\n            'is_leader': user.id == club.leader_id,\n            'is_co_leader': user.id == club.co_leader_id,\n            'joined_at': membership.joined_at.isoformat() if membership.joined_at else None\n        })\n\n    return jsonify({\n        'clubs': clubs_data,\n        'total': len(clubs_data)\n    })\n\n\n@api_bp.route('/user/assignments', methods=['GET'])\n@oauth_required(scopes=['assignments:read'])\ndef get_user_assignments():\n    \"\"\"Get user's club assignments (OAuth)\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    # Get all clubs user is a member of\n    memberships = ClubMembership.query.filter_by(user_id=user.id).all()\n    club_ids = [m.club_id for m in memberships]\n\n    # Get assignments from those clubs\n    assignments = ClubAssignment.query.filter(\n        ClubAssignment.club_id.in_(club_ids)\n    ).order_by(ClubAssignment.due_date.desc()).all()\n\n    assignments_data = []\n    for assignment in assignments:\n        assignments_data.append({\n            'id': assignment.id,\n            'club_id': assignment.club_id,\n            'club_name': assignment.club.name,\n            'title': assignment.title,\n            'description': assignment.description,\n            'due_date': assignment.due_date.isoformat() if assignment.due_date else None,\n            'created_at': assignment.created_at.isoformat() if assignment.created_at else None\n        })\n\n    return jsonify({\n        'assignments': assignments_data,\n        'total': len(assignments_data)\n    })\n\n\n@api_bp.route('/user/meetings', methods=['GET'])\n@oauth_required(scopes=['meetings:read'])\ndef get_user_meetings():\n    \"\"\"Get user's club meetings (OAuth)\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    # Get all clubs user is a member of\n    memberships = ClubMembership.query.filter_by(user_id=user.id).all()\n    club_ids = [m.club_id for m in memberships]\n\n    # Get meetings from those clubs\n    meetings = ClubMeeting.query.filter(\n        ClubMeeting.club_id.in_(club_ids)\n    ).order_by(ClubMeeting.meeting_date.desc()).all()\n\n    meetings_data = []\n    for meeting in meetings:\n        meetings_data.append({\n            'id': meeting.id,\n            'club_id': meeting.club_id,\n            'club_name': meeting.club.name,\n            'title': meeting.title,\n            'description': meeting.description,\n            'meeting_date': meeting.meeting_date.isoformat() if meeting.meeting_date else None,\n            'location': meeting.location,\n            'created_at': meeting.created_at.isoformat() if meeting.created_at else None\n        })\n\n    return jsonify({\n        'meetings': meetings_data,\n        'total': len(meetings_data)\n    })\n\n\n@api_bp.route('/user/projects', methods=['GET'])\n@oauth_required(scopes=['projects:read'])\ndef get_user_projects():\n    \"\"\"Get user's club projects (OAuth)\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    # Get all clubs user is a member of\n    memberships = ClubMembership.query.filter_by(user_id=user.id).all()\n    club_ids = [m.club_id for m in memberships]\n\n    # Get projects from those clubs\n    projects = ClubProject.query.filter(\n        ClubProject.club_id.in_(club_ids)\n    ).order_by(ClubProject.created_at.desc()).all()\n\n    projects_data = []\n    for project in projects:\n        projects_data.append({\n            'id': project.id,\n            'club_id': project.club_id,\n            'club_name': project.club.name,\n            'name': project.name,\n            'description': project.description,\n            'url': project.url,\n            'created_at': project.created_at.isoformat() if project.created_at else None\n        })\n\n    return jsonify({\n        'projects': projects_data,\n        'total': len(projects_data)\n    })\n\n\n# ============================================================================\n# Admin API Endpoints\n# ============================================================================\n\n@api_bp.route('/admin/users', methods=['GET'])\n@login_required\n@admin_required\n@limiter.limit(\"100 per minute\")\ndef admin_get_users():\n    \"\"\"Get all users (admin only)\"\"\"\n    page = request.args.get('page', 1, type=int)\n    per_page = request.args.get('per_page', 50, type=int)\n    per_page = min(per_page, 100)  # Max 100 per page\n\n    users_pagination = User.query.order_by(User.created_at.desc()).paginate(\n        page=page, per_page=per_page, error_out=False\n    )\n\n    users_data = []\n    for user in users_pagination.items:\n        # Count clubs led\n        from app.models.club import Club\n        clubs_led = Club.query.filter(\n            (Club.leader_id == user.id) | (Club.co_leader_id == user.id)\n        ).count()\n\n        # Count clubs joined\n        from app.models.club import ClubMembership\n        clubs_joined = ClubMembership.query.filter_by(user_id=user.id).count()\n\n        users_data.append({\n            'id': user.id,\n            'username': user.username,\n            'email': user.email,\n            'first_name': user.first_name,\n            'last_name': user.last_name,\n            'is_admin': user.is_admin,\n            'is_suspended': user.is_suspended,\n            'clubs_led': clubs_led,\n            'clubs_joined': clubs_joined,\n            'created_at': user.created_at.isoformat() if user.created_at else None\n        })\n\n    return jsonify({\n        'users': users_data,\n        'total': users_pagination.total,\n        'page': page,\n        'per_page': per_page,\n        'pages': users_pagination.pages\n    })\n\n\n@api_bp.route('/admin/clubs', methods=['GET'])\n@login_required\n@admin_required\n@limiter.limit(\"100 per minute\")\ndef admin_get_clubs():\n    \"\"\"Get all clubs (admin only)\"\"\"\n    page = request.args.get('page', 1, type=int)\n    per_page = request.args.get('per_page', 50, type=int)\n    per_page = min(per_page, 100)\n\n    clubs_pagination = Club.query.order_by(Club.created_at.desc()).paginate(\n        page=page, per_page=per_page, error_out=False\n    )\n\n    clubs_data = []\n    for club in clubs_pagination.items:\n        # Get leader info\n        leader_username = club.leader.username if club.leader else 'Unknown'\n        leader_email = club.leader.email if club.leader else 'Unknown'\n\n        # Count members\n        from app.models.club import ClubMembership\n        member_count = ClubMembership.query.filter_by(club_id=club.id).count()\n\n        clubs_data.append({\n            'id': club.id,\n            'name': club.name,\n            'description': club.description,\n            'leader': leader_username,\n            'leader_email': leader_email,\n            'member_count': member_count,\n            'location': club.location,\n            'tokens': club.tokens,\n            'balance': club.balance,\n            'created_at': club.created_at.isoformat() if club.created_at else None\n        })\n\n    return jsonify({\n        'clubs': clubs_data,\n        'total': clubs_pagination.total,\n        'page': page,\n        'per_page': per_page,\n        'pages': clubs_pagination.pages\n    })\n\n\n@api_bp.route('/admin/stats', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_stats():\n    \"\"\"Get system statistics (admin only)\"\"\"\n    from app.models.economy import ClubTransaction, ProjectSubmission\n\n    stats = {\n        'users': {\n            'total': User.query.count(),\n            'active': User.query.filter_by(is_suspended=False).count(),\n            'suspended': User.query.filter_by(is_suspended=True).count(),\n            'admins': User.query.filter_by(is_admin=True).count()\n        },\n        'clubs': {\n            'total': Club.query.count(),\n            'total_tokens': db.session.query(db.func.sum(Club.tokens)).scalar() or 0\n        },\n        'projects': {\n            'pending': ProjectSubmission.query.filter_by(approved_at=None).count(),\n            'approved': ProjectSubmission.query.filter(\n                ProjectSubmission.approved_at.isnot(None)\n            ).count()\n        },\n        'transactions': {\n            'total': ClubTransaction.query.count(),\n            'total_credits': db.session.query(\n                db.func.sum(ClubTransaction.amount)\n            ).filter(ClubTransaction.amount > 0).scalar() or 0\n        }\n    }\n\n    return jsonify(stats)\n\n\n@api_bp.route('/admin/settings', methods=['GET', 'POST'])\n@login_required\n@admin_required\ndef admin_settings():\n    \"\"\"Get/update system settings (admin only)\"\"\"\n    if request.method == 'GET':\n        return jsonify({\n            'maintenance_mode': SystemSettings.is_maintenance_mode(),\n            'economy_enabled': SystemSettings.is_economy_enabled(),\n            'registration_enabled': SystemSettings.is_user_registration_enabled(),\n            'mobile_enabled': SystemSettings.is_mobile_enabled(),\n            'club_creation_enabled': SystemSettings.is_club_creation_enabled(),\n            'announcement': SystemSettings.get_setting('announcement', '')\n        })\n\n    elif request.method == 'POST':\n        data = request.get_json()\n        current_user = get_current_user()\n\n        if 'maintenance_mode' in data:\n            SystemSettings.set_setting('maintenance_mode', str(data['maintenance_mode']).lower(), current_user.id)\n        if 'economy_enabled' in data:\n            SystemSettings.set_setting('economy_enabled', str(data['economy_enabled']).lower(), current_user.id)\n        if 'registration_enabled' in data:\n            SystemSettings.set_setting('user_registration_enabled', str(data['registration_enabled']).lower(), current_user.id)\n        if 'mobile_enabled' in data:\n            SystemSettings.set_setting('mobile_enabled', str(data['mobile_enabled']).lower(), current_user.id)\n        if 'club_creation_enabled' in data:\n            SystemSettings.set_setting('club_creation_enabled', str(data['club_creation_enabled']).lower(), current_user.id)\n        if 'announcement' in data:\n            SystemSettings.set_setting('announcement', data['announcement'], current_user.id)\n\n        return jsonify({\n            'success': True,\n            'message': 'Settings updated'\n        })\n\n\n@api_bp.route('/admin/activity', methods=['GET'])\n@login_required\n@admin_required\n@limiter.limit(\"100 per minute\")\ndef admin_get_activity():\n    \"\"\"Get recent activity (admin only)\"\"\"\n    from app.models.user import AuditLog\n\n    page = request.args.get('page', 1, type=int)\n    per_page = request.args.get('per_page', 50, type=int)\n    per_page = min(per_page, 100)\n\n    logs_pagination = AuditLog.query.order_by(\n        AuditLog.timestamp.desc()\n    ).paginate(page=page, per_page=per_page, error_out=False)\n\n    logs_data = []\n    for log in logs_pagination.items:\n        logs_data.append({\n            'id': log.id,\n            'user_id': log.user_id,\n            'action_type': log.action_type,\n            'description': log.description,\n            'target_type': log.target_type,\n            'target_id': log.target_id,\n            'severity': log.severity,\n            'category': log.action_category,\n            'timestamp': log.timestamp.isoformat() if log.timestamp else None\n        })\n\n    return jsonify({\n        'logs': logs_data,\n        'total': logs_pagination.total,\n        'page': page,\n        'per_page': per_page,\n        'pages': logs_pagination.pages\n    })\n\n\n@api_bp.route('/admin/rbac/roles', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_roles():\n    \"\"\"Get all roles (admin only)\"\"\"\n    from app.models.user import Role\n    roles = Role.query.all()\n    roles_data = []\n    for role in roles:\n        roles_data.append({\n            'id': role.id,\n            'name': role.name,\n            'display_name': role.display_name,\n            'description': role.description,\n            'is_system_role': role.is_system_role,\n            'permissions': [p.name for p in role.permissions.all()],\n            'user_count': len(role.users)\n        })\n    return jsonify({'roles': roles_data})\n\n\n@api_bp.route('/admin/rbac/permissions', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_permissions():\n    \"\"\"Get all permissions (admin only)\"\"\"\n    from app.models.user import Permission\n    permissions = Permission.query.all()\n\n    # Group by category\n    permissions_by_category = {}\n    for perm in permissions:\n        if perm.category not in permissions_by_category:\n            permissions_by_category[perm.category] = []\n        permissions_by_category[perm.category].append({\n            'id': perm.id,\n            'name': perm.name,\n            'display_name': perm.display_name,\n            'description': perm.description,\n            'category': perm.category\n        })\n\n    return jsonify({'permissions': permissions_by_category})\n\n\n@api_bp.route('/admin/rbac/users/<int:user_id>/roles', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_user_roles(user_id):\n    \"\"\"Get a specific user's roles and permissions (admin only)\"\"\"\n    from app.models.user import User, UserRole\n\n    user = User.query.get_or_404(user_id)\n\n    # Get user's roles\n    user_roles = UserRole.query.filter_by(user_id=user_id).all()\n    roles_data = []\n    permissions_data = []\n\n    for user_role in user_roles:\n        role = user_role.role\n        roles_data.append({\n            'id': role.id,\n            'name': role.name,\n            'display_name': role.display_name,\n            'description': role.description\n        })\n\n        # Collect all permissions from this role\n        for perm in role.permissions.all():\n            if perm.name not in [p['name'] for p in permissions_data]:\n                permissions_data.append({\n                    'id': perm.id,\n                    'name': perm.name,\n                    'display_name': perm.display_name,\n                    'category': perm.category\n                })\n\n    return jsonify({\n        'roles': roles_data,\n        'permissions': permissions_data,\n        'is_root': user.is_root if hasattr(user, 'is_root') else False\n    })\n\n\n@api_bp.route('/admin/apikeys', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_api_keys():\n    \"\"\"Get all API keys (admin only)\"\"\"\n    from app.models.auth import APIKey\n\n    keys = APIKey.query.order_by(APIKey.created_at.desc()).all()\n    keys_data = []\n    for key in keys:\n        keys_data.append({\n            'id': key.id,\n            'name': key.name,\n            'key_preview': key.key[:8] + '...' if key.key else '',\n            'user_id': key.user_id,\n            'username': key.user.username if key.user else None,\n            'scopes': key.get_scopes(),\n            'is_active': key.is_active,\n            'created_at': key.created_at.isoformat() if key.created_at else None,\n            'last_used_at': key.last_used_at.isoformat() if key.last_used_at else None\n        })\n\n    return jsonify({'api_keys': keys_data})\n\n\n@api_bp.route('/admin/oauthapps', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_oauth_apps():\n    \"\"\"Get all OAuth applications (admin only)\"\"\"\n    from app.models.auth import OAuthApplication\n\n    apps = OAuthApplication.query.order_by(OAuthApplication.created_at.desc()).all()\n    apps_data = []\n    for app in apps:\n        apps_data.append({\n            'id': app.id,\n            'name': app.name,\n            'client_id': app.client_id,\n            'owner_id': app.user_id,\n            'owner_username': app.user.username if app.user else None,\n            'redirect_uris': app.get_redirect_uris(),\n            'scopes': app.get_scopes(),\n            'is_active': app.is_active,\n            'created_at': app.created_at.isoformat() if app.created_at else None\n        })\n\n    return jsonify({'oauth_apps': apps_data})\n\n\n@api_bp.route('/admin/audit-logs', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_audit_logs():\n    \"\"\"Get audit logs (admin only)\"\"\"\n    from app.models.user import AuditLog\n\n    page = request.args.get('page', 1, type=int)\n    per_page = request.args.get('per_page', 50, type=int)\n    per_page = min(per_page, 100)\n\n    logs_pagination = AuditLog.query.order_by(\n        AuditLog.timestamp.desc()\n    ).paginate(page=page, per_page=per_page, error_out=False)\n\n    logs_data = []\n    for log in logs_pagination.items:\n        logs_data.append({\n            'id': log.id,\n            'user_id': log.user_id,\n            'username': log.user.username if log.user else 'System',\n            'action_type': log.action_type,\n            'description': log.description,\n            'target_type': log.target_type,\n            'target_id': log.target_id,\n            'severity': log.severity,\n            'action_category': log.action_category,\n            'ip_address': log.ip_address,\n            'timestamp': log.timestamp.isoformat() if log.timestamp else None\n        })\n\n    return jsonify({\n        'logs': logs_data,\n        'total': logs_pagination.total,\n        'page': page,\n        'per_page': per_page,\n        'pages': logs_pagination.pages\n    })\n\n\n# ============================================================================\n# Admin User Management Endpoints\n# ============================================================================\n\n@api_bp.route('/admin/users/<int:user_id>', methods=['PUT'])\n@login_required\n@admin_required\ndef admin_update_user(user_id):\n    \"\"\"Update user details (admin only)\"\"\"\n    user = User.query.get_or_404(user_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n\n    # Validate that root user cannot be modified (except by themselves for non-critical fields)\n    if user.is_root_user() and current_user.id != user.id:\n        return jsonify({'error': 'Cannot modify root user'}), 403\n\n    # Update allowed fields\n    if 'username' in data:\n        username = sanitize_string(data['username'], max_length=80)\n        if username != user.username:\n            # Check if username already exists\n            existing = User.query.filter_by(username=username).first()\n            if existing:\n                return jsonify({'error': 'Username already exists'}), 400\n            user.username = username\n\n    if 'email' in data:\n        email = sanitize_string(data['email'], max_length=120)\n        if email != user.email:\n            # Check if email already exists\n            existing = User.query.filter_by(email=email).first()\n            if existing:\n                return jsonify({'error': 'Email already exists'}), 400\n            user.email = email\n\n    if 'first_name' in data:\n        user.first_name = sanitize_string(data['first_name'], max_length=50)\n\n    if 'last_name' in data:\n        user.last_name = sanitize_string(data['last_name'], max_length=50)\n\n    db.session.commit()\n\n    create_audit_log(\n        action_type='user_update',\n        description=f'Admin {current_user.username} updated user {user.username}',\n        user=current_user,\n        target_type='user',\n        target_id=user_id,\n        details={'updated_fields': list(data.keys())},\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'User updated successfully',\n        'user': {\n            'id': user.id,\n            'username': user.username,\n            'email': user.email,\n            'first_name': user.first_name,\n            'last_name': user.last_name\n        }\n    })\n\n\n@api_bp.route('/admin/users/<int:user_id>/suspend', methods=['PUT'])\n@login_required\n@admin_required\ndef admin_suspend_user(user_id):\n    \"\"\"Suspend/unsuspend a user (admin only)\"\"\"\n    user = User.query.get_or_404(user_id)\n    current_user = get_current_user()\n\n    if user.is_root_user():\n        return jsonify({'error': 'Cannot suspend root user'}), 403\n\n    data = request.get_json()\n    suspend = data.get('suspended', True)\n    reason = sanitize_string(data.get('reason', ''), max_length=500)\n\n    user.is_suspended = suspend\n    db.session.commit()\n\n    action = 'suspended' if suspend else 'unsuspended'\n    create_audit_log(\n        action_type=f'user_{action}',\n        description=f'Admin {current_user.username} {action} user {user.username}',\n        user=current_user,\n        target_type='user',\n        target_id=user_id,\n        details={'reason': reason},\n        severity='warning' if suspend else 'info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': f'User {action} successfully',\n        'suspended': user.is_suspended\n    })\n\n\n@api_bp.route('/admin/users/<int:user_id>', methods=['DELETE'])\n@login_required\n@admin_required\ndef admin_delete_user(user_id):\n    \"\"\"Delete a user (admin only)\"\"\"\n    user = User.query.get_or_404(user_id)\n    current_user = get_current_user()\n\n    if user.is_root_user():\n        return jsonify({'error': 'Cannot delete root user'}), 403\n\n    username = user.username\n    email = user.email\n\n    # Delete user (cascade will handle related records)\n    db.session.delete(user)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='user_delete',\n        description=f'Admin {current_user.username} deleted user {username}',\n        user=current_user,\n        target_type='user',\n        target_id=user_id,\n        details={'username': username, 'email': email},\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'User deleted successfully'\n    })\n\n\n@api_bp.route('/admin/users/group-by-ip', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_users_by_ip():\n    \"\"\"Get users grouped by IP address (admin only)\"\"\"\n    # Get all users with their IPs\n    users = User.query.all()\n\n    ip_groups = {}\n    for user in users:\n        ips = user.get_all_ips()\n        for ip in ips:\n            if ip not in ip_groups:\n                ip_groups[ip] = []\n            ip_groups[ip].append({\n                'id': user.id,\n                'username': user.username,\n                'email': user.email,\n                'is_suspended': user.is_suspended,\n                'created_at': user.created_at.isoformat() if user.created_at else None\n            })\n\n    # Sort by number of users per IP (most suspicious first)\n    sorted_groups = sorted(\n        [{'ip': ip, 'users': users, 'count': len(users)}\n         for ip, users in ip_groups.items()],\n        key=lambda x: x['count'],\n        reverse=True\n    )\n\n    return jsonify({'ip_groups': sorted_groups})\n\n\n@api_bp.route('/admin/users/group-by-club', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_users_by_club():\n    \"\"\"Get users grouped by club (admin only)\"\"\"\n    from app.models.club import ClubMembership\n\n    clubs = Club.query.all()\n    club_groups = []\n\n    for club in clubs:\n        memberships = ClubMembership.query.filter_by(club_id=club.id).all()\n        members = []\n        for membership in memberships:\n            user = membership.user\n            members.append({\n                'id': user.id,\n                'username': user.username,\n                'email': user.email,\n                'is_leader': club.leader_id == user.id,\n                'is_co_leader': club.co_leader_id == user.id,\n                'joined_at': membership.joined_at.isoformat() if membership.joined_at else None\n            })\n\n        club_groups.append({\n            'club_id': club.id,\n            'club_name': club.name,\n            'member_count': len(members),\n            'members': members\n        })\n\n    return jsonify({'club_groups': club_groups})\n\n\n@api_bp.route('/admin/users/<int:user_id>/ips', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_user_ips(user_id):\n    \"\"\"Get IP history for a user (admin only)\"\"\"\n    user = User.query.get_or_404(user_id)\n\n    return jsonify({\n        'user_id': user.id,\n        'username': user.username,\n        'registration_ip': user.registration_ip,\n        'last_login_ip': user.last_login_ip,\n        'all_ips': user.get_all_ips()\n    })\n\n\n@api_bp.route('/admin/login-as-user/<int:user_id>', methods=['POST'])\n@login_required\n@admin_required\ndef admin_login_as_user(user_id):\n    \"\"\"Login as another user (admin only)\"\"\"\n    from flask import session\n\n    user = User.query.get_or_404(user_id)\n    current_user = get_current_user()\n\n    if user.is_root_user():\n        return jsonify({'error': 'Cannot impersonate root user'}), 403\n\n    # Store original user ID to allow switching back\n    if 'original_user_id' not in session:\n        session['original_user_id'] = current_user.id\n\n    session['user_id'] = user.id\n\n    create_audit_log(\n        action_type='admin_impersonate',\n        description=f'Admin {current_user.username} logged in as {user.username}',\n        user=current_user,\n        target_type='user',\n        target_id=user_id,\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': f'Now logged in as {user.username}',\n        'redirect': '/dashboard'\n    })\n\n\n@api_bp.route('/admin/reset-password/<int:user_id>', methods=['POST'])\n@login_required\n@admin_required\ndef admin_reset_password(user_id):\n    \"\"\"Reset a user's password (admin only)\"\"\"\n    import secrets\n\n    user = User.query.get_or_404(user_id)\n    current_user = get_current_user()\n\n    if user.is_root_user() and current_user.id != user.id:\n        return jsonify({'error': 'Cannot reset root user password'}), 403\n\n    # Generate a random password\n    new_password = secrets.token_urlsafe(16)\n    user.set_password(new_password)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='password_reset',\n        description=f'Admin {current_user.username} reset password for {user.username}',\n        user=current_user,\n        target_type='user',\n        target_id=user_id,\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Password reset successfully',\n        'new_password': new_password,\n        'user': {\n            'id': user.id,\n            'username': user.username,\n            'email': user.email\n        }\n    })\n\n\n# ============================================================================\n# Admin Club Management Endpoints\n# ============================================================================\n\n@api_bp.route('/admin/clubs/<int:club_id>', methods=['PUT'])\n@login_required\n@admin_required\ndef admin_update_club(club_id):\n    \"\"\"Update club details (admin only)\"\"\"\n    club = Club.query.get_or_404(club_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n\n    if 'name' in data:\n        club.name = sanitize_string(data['name'], max_length=100)\n\n    if 'description' in data:\n        club.description = sanitize_string(data['description'], max_length=1000)\n\n    if 'location' in data:\n        club.location = sanitize_string(data['location'], max_length=200)\n\n    if 'tokens' in data:\n        club.tokens = int(data['tokens'])\n\n    if 'balance' in data:\n        club.balance = int(data['balance'])\n\n    db.session.commit()\n\n    create_audit_log(\n        action_type='club_update',\n        description=f'Admin {current_user.username} updated club {club.name}',\n        user=current_user,\n        target_type='club',\n        target_id=club_id,\n        details={'updated_fields': list(data.keys())},\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Club updated successfully',\n        'club': {\n            'id': club.id,\n            'name': club.name,\n            'description': club.description,\n            'location': club.location,\n            'tokens': club.tokens,\n            'balance': club.balance\n        }\n    })\n\n\n@api_bp.route('/admin/clubs/<int:club_id>', methods=['DELETE'])\n@login_required\n@admin_required\ndef admin_delete_club(club_id):\n    \"\"\"Delete a club (admin only)\"\"\"\n    club = Club.query.get_or_404(club_id)\n    current_user = get_current_user()\n\n    club_name = club.name\n\n    # Delete club (cascade will handle related records)\n    db.session.delete(club)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='club_delete',\n        description=f'Admin {current_user.username} deleted club {club_name}',\n        user=current_user,\n        target_type='club',\n        target_id=club_id,\n        details={'club_name': club_name},\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Club deleted successfully'\n    })\n\n\n@api_bp.route('/admin/clubs/<int:club_id>/sync-immune', methods=['POST'])\n@login_required\n@admin_required\ndef admin_sync_club_immune(club_id):\n    \"\"\"Set club sync immunity status (admin only)\"\"\"\n    club = Club.query.get_or_404(club_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n    immune = data.get('immune', False)\n\n    # Add immune field if it doesn't exist\n    if not hasattr(club, 'sync_immune'):\n        # This would require a migration to add the field\n        return jsonify({'error': 'Sync immune feature not yet implemented'}), 501\n\n    club.sync_immune = immune\n    db.session.commit()\n\n    create_audit_log(\n        action_type='club_sync_immune',\n        description=f'Admin {current_user.username} set sync immune to {immune} for club {club.name}',\n        user=current_user,\n        target_type='club',\n        target_id=club_id,\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': f'Club sync immunity {\"enabled\" if immune else \"disabled\"}'\n    })\n\n\n@api_bp.route('/admin/clubs/<int:club_id>/transfer-leadership', methods=['POST'])\n@login_required\n@admin_required\ndef admin_transfer_club_leadership(club_id):\n    \"\"\"Transfer club leadership to another user (admin only)\"\"\"\n    club = Club.query.get_or_404(club_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n    new_leader_id = data.get('new_leader_id')\n\n    if not new_leader_id:\n        return jsonify({'error': 'new_leader_id is required'}), 400\n\n    new_leader = User.query.get_or_404(new_leader_id)\n\n    old_leader_id = club.leader_id\n    club.leader_id = new_leader_id\n    db.session.commit()\n\n    create_audit_log(\n        action_type='club_leadership_transfer',\n        description=f'Admin {current_user.username} transferred leadership of {club.name} to {new_leader.username}',\n        user=current_user,\n        target_type='club',\n        target_id=club_id,\n        details={'old_leader_id': old_leader_id, 'new_leader_id': new_leader_id},\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': f'Leadership transferred to {new_leader.username}'\n    })\n\n\n# ============================================================================\n# Admin Pizza Grants Endpoints\n# ============================================================================\n\n@api_bp.route('/admin/pizza-grants', methods=['GET'])\n@login_required\n@admin_required\ndef admin_get_pizza_grants():\n    \"\"\"Get all pizza grants from Airtable (admin only)\"\"\"\n    try:\n        grants = airtable_service.get_pizza_grants()\n        return jsonify({'grants': grants})\n    except Exception as e:\n        current_app.logger.error(f'Error fetching pizza grants: {str(e)}')\n        return jsonify({'error': 'Failed to fetch pizza grants', 'grants': []}), 500\n\n\n@api_bp.route('/admin/pizza-grants/review', methods=['POST'])\n@login_required\n@admin_required\ndef admin_review_pizza_grant():\n    \"\"\"Review a pizza grant (admin only)\"\"\"\n    current_user = get_current_user()\n    data = request.get_json()\n\n    grant_id = data.get('grant_id')\n    status = data.get('status')  # 'approved' or 'rejected'\n    notes = sanitize_string(data.get('notes', ''), max_length=1000)\n\n    if not grant_id or not status:\n        return jsonify({'error': 'grant_id and status are required'}), 400\n\n    try:\n        success = airtable_service.update_pizza_grant(grant_id, status, notes, current_user.username)\n\n        if success:\n            create_audit_log(\n                action_type='pizza_grant_review',\n                description=f'Admin {current_user.username} {status} pizza grant {grant_id}',\n                user=current_user,\n                target_type='pizza_grant',\n                target_id=grant_id,\n                details={'status': status, 'notes': notes},\n                severity='info',\n                admin_action=True,\n                category='admin'\n            )\n\n            return jsonify({'success': True, 'message': f'Grant {status}'})\n        else:\n            return jsonify({'error': 'Failed to update grant'}), 500\n    except Exception as e:\n        current_app.logger.error(f'Error reviewing pizza grant: {str(e)}')\n        return jsonify({'error': 'Failed to review grant'}), 500\n\n\n@api_bp.route('/admin/pizza-grants/<string:grant_id>', methods=['DELETE'])\n@login_required\n@admin_required\ndef admin_delete_pizza_grant(grant_id):\n    \"\"\"Delete a pizza grant (admin only)\"\"\"\n    current_user = get_current_user()\n\n    try:\n        success = airtable_service.delete_pizza_grant(grant_id)\n\n        if success:\n            create_audit_log(\n                action_type='pizza_grant_delete',\n                description=f'Admin {current_user.username} deleted pizza grant {grant_id}',\n                user=current_user,\n                target_type='pizza_grant',\n                target_id=grant_id,\n                severity='warning',\n                admin_action=True,\n                category='admin'\n            )\n\n            return jsonify({'success': True, 'message': 'Grant deleted'})\n        else:\n            return jsonify({'error': 'Failed to delete grant'}), 500\n    except Exception as e:\n        current_app.logger.error(f'Error deleting pizza grant: {str(e)}')\n        return jsonify({'error': 'Failed to delete grant'}), 500\n\n\n# ============================================================================\n# Admin API Keys & OAuth Endpoints\n# ============================================================================\n\n@api_bp.route('/admin/apikeys', methods=['POST'])\n@login_required\n@admin_required\ndef admin_create_api_key():\n    \"\"\"Create a new API key (admin only)\"\"\"\n    from app.models.auth import APIKey\n\n    current_user = get_current_user()\n    data = request.get_json()\n\n    name = sanitize_string(data.get('name', ''), max_length=200)\n    description = sanitize_string(data.get('description', ''), max_length=1000)\n    scopes = data.get('scopes', [])\n    target_user_id = data.get('user_id', current_user.id)\n\n    if not name:\n        return jsonify({'error': 'Name is required'}), 400\n\n    api_key = APIKey(\n        name=name,\n        description=description,\n        user_id=target_user_id\n    )\n    api_key.generate_key()\n    api_key.set_scopes(scopes)\n\n    db.session.add(api_key)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='api_key_create',\n        description=f'Admin {current_user.username} created API key \"{name}\"',\n        user=current_user,\n        target_type='api_key',\n        target_id=api_key.id,\n        details={'name': name, 'scopes': scopes},\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'API key created',\n        'api_key': {\n            'id': api_key.id,\n            'key': api_key.key,\n            'name': api_key.name,\n            'scopes': scopes\n        }\n    })\n\n\n@api_bp.route('/admin/api-keys/<int:key_id>', methods=['PUT'])\n@login_required\n@admin_required\ndef admin_update_api_key(key_id):\n    \"\"\"Update an API key (admin only)\"\"\"\n    from app.models.auth import APIKey\n\n    api_key = APIKey.query.get_or_404(key_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n\n    if 'name' in data:\n        api_key.name = sanitize_string(data['name'], max_length=200)\n\n    if 'description' in data:\n        api_key.description = sanitize_string(data['description'], max_length=1000)\n\n    if 'is_active' in data:\n        api_key.is_active = bool(data['is_active'])\n\n    if 'scopes' in data:\n        api_key.set_scopes(data['scopes'])\n\n    db.session.commit()\n\n    create_audit_log(\n        action_type='api_key_update',\n        description=f'Admin {current_user.username} updated API key \"{api_key.name}\"',\n        user=current_user,\n        target_type='api_key',\n        target_id=key_id,\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'API key updated'\n    })\n\n\n@api_bp.route('/admin/api-keys/<int:key_id>', methods=['DELETE'])\n@login_required\n@admin_required\ndef admin_delete_api_key(key_id):\n    \"\"\"Delete an API key (admin only)\"\"\"\n    from app.models.auth import APIKey\n\n    api_key = APIKey.query.get_or_404(key_id)\n    current_user = get_current_user()\n\n    key_name = api_key.name\n\n    db.session.delete(api_key)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='api_key_delete',\n        description=f'Admin {current_user.username} deleted API key \"{key_name}\"',\n        user=current_user,\n        target_type='api_key',\n        target_id=key_id,\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'API key deleted'\n    })\n\n\n@api_bp.route('/admin/oauthapps', methods=['POST'])\n@login_required\n@admin_required\ndef admin_create_oauth_app():\n    \"\"\"Create a new OAuth application (admin only)\"\"\"\n    from app.models.auth import OAuthApplication\n\n    current_user = get_current_user()\n    data = request.get_json()\n\n    name = sanitize_string(data.get('name', ''), max_length=200)\n    description = sanitize_string(data.get('description', ''), max_length=1000)\n    redirect_uris = data.get('redirect_uris', [])\n    scopes = data.get('scopes', [])\n    target_user_id = data.get('user_id', current_user.id)\n\n    if not name:\n        return jsonify({'error': 'Name is required'}), 400\n\n    oauth_app = OAuthApplication(\n        name=name,\n        description=description,\n        user_id=target_user_id\n    )\n    oauth_app.generate_credentials()\n    oauth_app.set_redirect_uris(redirect_uris)\n    oauth_app.set_scopes(scopes)\n\n    db.session.add(oauth_app)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='oauth_app_create',\n        description=f'Admin {current_user.username} created OAuth app \"{name}\"',\n        user=current_user,\n        target_type='oauth_app',\n        target_id=oauth_app.id,\n        details={'name': name, 'scopes': scopes},\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'OAuth application created',\n        'oauth_app': {\n            'id': oauth_app.id,\n            'client_id': oauth_app.client_id,\n            'client_secret': oauth_app.client_secret,\n            'name': oauth_app.name,\n            'redirect_uris': redirect_uris,\n            'scopes': scopes\n        }\n    })\n\n\n@api_bp.route('/admin/oauth-applications/<int:app_id>', methods=['PUT'])\n@login_required\n@admin_required\ndef admin_update_oauth_app(app_id):\n    \"\"\"Update an OAuth application (admin only)\"\"\"\n    from app.models.auth import OAuthApplication\n\n    oauth_app = OAuthApplication.query.get_or_404(app_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n\n    if 'name' in data:\n        oauth_app.name = sanitize_string(data['name'], max_length=200)\n\n    if 'description' in data:\n        oauth_app.description = sanitize_string(data['description'], max_length=1000)\n\n    if 'is_active' in data:\n        oauth_app.is_active = bool(data['is_active'])\n\n    if 'redirect_uris' in data:\n        oauth_app.set_redirect_uris(data['redirect_uris'])\n\n    if 'scopes' in data:\n        oauth_app.set_scopes(data['scopes'])\n\n    db.session.commit()\n\n    create_audit_log(\n        action_type='oauth_app_update',\n        description=f'Admin {current_user.username} updated OAuth app \"{oauth_app.name}\"',\n        user=current_user,\n        target_type='oauth_app',\n        target_id=app_id,\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'OAuth application updated'\n    })\n\n\n@api_bp.route('/admin/oauth-applications/<int:app_id>', methods=['DELETE'])\n@login_required\n@admin_required\ndef admin_delete_oauth_app(app_id):\n    \"\"\"Delete an OAuth application (admin only)\"\"\"\n    from app.models.auth import OAuthApplication\n\n    oauth_app = OAuthApplication.query.get_or_404(app_id)\n    current_user = get_current_user()\n\n    app_name = oauth_app.name\n\n    db.session.delete(oauth_app)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='oauth_app_delete',\n        description=f'Admin {current_user.username} deleted OAuth app \"{app_name}\"',\n        user=current_user,\n        target_type='oauth_app',\n        target_id=app_id,\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'OAuth application deleted'\n    })\n\n\n# ============================================================================\n# Admin RBAC Endpoints\n# ============================================================================\n\n@api_bp.route('/admin/rbac/users/<int:user_id>/roles', methods=['POST'])\n@login_required\n@admin_required\ndef admin_assign_role_to_user(user_id):\n    \"\"\"Assign a role to a user (admin only)\"\"\"\n    from app.models.user import Role\n\n    user = User.query.get_or_404(user_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n    role_name = data.get('role_name')\n\n    if not role_name:\n        return jsonify({'error': 'role_name is required'}), 400\n\n    role = Role.query.filter_by(name=role_name).first()\n    if not role:\n        return jsonify({'error': 'Role not found'}), 404\n\n    if user.has_role(role_name):\n        return jsonify({'error': 'User already has this role'}), 400\n\n    user.assign_role(role, current_user)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='role_assign',\n        description=f'Admin {current_user.username} assigned role \"{role_name}\" to {user.username}',\n        user=current_user,\n        target_type='user',\n        target_id=user_id,\n        details={'role': role_name},\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': f'Role \"{role_name}\" assigned to user'\n    })\n\n\n@api_bp.route('/admin/rbac/users/<int:user_id>/roles/<string:role_name>', methods=['DELETE'])\n@login_required\n@admin_required\ndef admin_remove_role_from_user(user_id, role_name):\n    \"\"\"Remove a role from a user (admin only)\"\"\"\n    user = User.query.get_or_404(user_id)\n    current_user = get_current_user()\n\n    if user.is_root_user() and role_name == 'super-admin':\n        return jsonify({'error': 'Cannot remove super-admin from root user'}), 403\n\n    if not user.has_role(role_name):\n        return jsonify({'error': 'User does not have this role'}), 400\n\n    user.remove_role(role_name)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='role_remove',\n        description=f'Admin {current_user.username} removed role \"{role_name}\" from {user.username}',\n        user=current_user,\n        target_type='user',\n        target_id=user_id,\n        details={'role': role_name},\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': f'Role \"{role_name}\" removed from user'\n    })\n\n\n@api_bp.route('/admin/rbac/initialize', methods=['POST'])\n@login_required\n@admin_required\ndef admin_initialize_rbac():\n    \"\"\"Initialize the RBAC system (admin only)\"\"\"\n    from app.models.user import initialize_rbac_system\n\n    current_user = get_current_user()\n\n    try:\n        initialize_rbac_system()\n\n        create_audit_log(\n            action_type='rbac_initialize',\n            description=f'Admin {current_user.username} initialized RBAC system',\n            user=current_user,\n            severity='warning',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'RBAC system initialized successfully'\n        })\n    except Exception as e:\n        current_app.logger.error(f'Error initializing RBAC: {str(e)}')\n        return jsonify({'error': 'Failed to initialize RBAC system'}), 500\n\n\n@api_bp.route('/admin/rbac/roles', methods=['POST'])\n@login_required\n@admin_required\ndef admin_create_role():\n    \"\"\"Create a new role (admin only)\"\"\"\n    from app.models.user import Role, Permission\n\n    current_user = get_current_user()\n    data = request.get_json()\n\n    name = sanitize_string(data.get('name', ''), max_length=50)\n    display_name = sanitize_string(data.get('display_name', ''), max_length=100)\n    description = sanitize_string(data.get('description', ''), max_length=500)\n    permission_names = data.get('permissions', [])\n\n    if not name or not display_name:\n        return jsonify({'error': 'name and display_name are required'}), 400\n\n    # Check if role already exists\n    existing_role = Role.query.filter_by(name=name).first()\n    if existing_role:\n        return jsonify({'error': 'Role already exists'}), 400\n\n    role = Role(\n        name=name,\n        display_name=display_name,\n        description=description,\n        is_system_role=False\n    )\n    db.session.add(role)\n    db.session.flush()\n\n    # Assign permissions\n    for perm_name in permission_names:\n        permission = Permission.query.filter_by(name=perm_name).first()\n        if permission:\n            from app.models.user import RolePermission\n            role_perm = RolePermission(role_id=role.id, permission_id=permission.id)\n            db.session.add(role_perm)\n\n    db.session.commit()\n\n    create_audit_log(\n        action_type='role_create',\n        description=f'Admin {current_user.username} created role \"{name}\"',\n        user=current_user,\n        target_type='role',\n        target_id=role.id,\n        details={'name': name, 'permissions': permission_names},\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Role created successfully',\n        'role': role.to_dict()\n    })\n\n\n@api_bp.route('/admin/rbac/roles/<int:role_id>', methods=['PUT'])\n@login_required\n@admin_required\ndef admin_update_role(role_id):\n    \"\"\"Update a role (admin only)\"\"\"\n    from app.models.user import Role, Permission, RolePermission\n\n    role = Role.query.get_or_404(role_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n\n    if 'display_name' in data:\n        role.display_name = sanitize_string(data['display_name'], max_length=100)\n\n    if 'description' in data:\n        role.description = sanitize_string(data['description'], max_length=500)\n\n    if 'permissions' in data:\n        # Remove all existing permissions\n        RolePermission.query.filter_by(role_id=role.id).delete()\n\n        # Add new permissions\n        for perm_name in data['permissions']:\n            permission = Permission.query.filter_by(name=perm_name).first()\n            if permission:\n                role_perm = RolePermission(role_id=role.id, permission_id=permission.id)\n                db.session.add(role_perm)\n\n    db.session.commit()\n\n    create_audit_log(\n        action_type='role_update',\n        description=f'Admin {current_user.username} updated role \"{role.name}\"',\n        user=current_user,\n        target_type='role',\n        target_id=role_id,\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Role updated successfully',\n        'role': role.to_dict()\n    })\n\n\n@api_bp.route('/admin/rbac/roles/<int:role_id>', methods=['DELETE'])\n@login_required\n@admin_required\ndef admin_delete_role(role_id):\n    \"\"\"Delete a role (admin only)\"\"\"\n    from app.models.user import Role, UserRole\n\n    role = Role.query.get_or_404(role_id)\n    current_user = get_current_user()\n\n    # Check if role is in use\n    users_with_role = UserRole.query.filter_by(role_id=role_id).count()\n    force = request.args.get('force') == 'true'\n\n    if users_with_role > 0 and not force:\n        return jsonify({\n            'error': f'Role is assigned to {users_with_role} users. Use force=true to delete anyway.',\n            'users_count': users_with_role\n        }), 400\n\n    role_name = role.name\n\n    # Delete role (cascade will handle permissions)\n    db.session.delete(role)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='role_delete',\n        description=f'Admin {current_user.username} deleted role \"{role_name}\"',\n        user=current_user,\n        target_type='role',\n        target_id=role_id,\n        details={'role_name': role_name, 'force': force},\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Role deleted successfully'\n    })\n\n\n# ============================================================================\n# Admin Banner Settings Endpoint\n# ============================================================================\n\n@api_bp.route('/admin/banner-settings', methods=['GET', 'POST'])\n@login_required\n@admin_required\ndef admin_banner_settings():\n    \"\"\"Get or update banner settings (admin only)\"\"\"\n    if request.method == 'GET':\n        banner_enabled = SystemSettings.get_setting('banner_enabled', 'false') == 'true'\n        banner_message = SystemSettings.get_setting('banner_message', '')\n        banner_type = SystemSettings.get_setting('banner_type', 'info')  # info, warning, error\n\n        return jsonify({\n            'enabled': banner_enabled,\n            'message': banner_message,\n            'type': banner_type\n        })\n\n    elif request.method == 'POST':\n        current_user = get_current_user()\n        data = request.get_json()\n\n        if 'enabled' in data:\n            SystemSettings.set_setting('banner_enabled', str(data['enabled']).lower(), current_user.id)\n\n        if 'message' in data:\n            message = sanitize_string(data['message'], max_length=500)\n            SystemSettings.set_setting('banner_message', message, current_user.id)\n\n        if 'type' in data:\n            banner_type = data['type']\n            if banner_type in ['info', 'warning', 'error']:\n                SystemSettings.set_setting('banner_type', banner_type, current_user.id)\n\n        create_audit_log(\n            action_type='banner_settings_update',\n            description=f'Admin {current_user.username} updated banner settings',\n            user=current_user,\n            severity='info',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Banner settings updated'\n        })\n\n\n# ============================================================================\n# Admin Order Management Endpoints\n# ============================================================================\n\n@api_bp.route('/admin/orders', methods=['GET'])\n@login_required\n@admin_required\n@limiter.limit(\"100 per minute\")\ndef admin_get_orders():\n    \"\"\"Get all orders (admin only)\"\"\"\n    from app.models.shop import Order\n\n    page = request.args.get('page', 1, type=int)\n    per_page = request.args.get('per_page', 50, type=int)\n    per_page = min(per_page, 100)\n\n    status_filter = request.args.get('status')\n    search = request.args.get('search')\n\n    query = Order.query\n\n    # Apply filters\n    if status_filter:\n        query = query.filter(Order.status == status_filter)\n\n    if search:\n        search_term = f'%{search}%'\n        query = query.join(User, Order.user_id == User.id).join(Club, Order.club_id == Club.id).filter(\n            db.or_(\n                User.username.ilike(search_term),\n                Club.name.ilike(search_term),\n                Order.shipping_name.ilike(search_term)\n            )\n        )\n\n    orders_pagination = query.order_by(Order.created_at.desc()).paginate(\n        page=page, per_page=per_page, error_out=False\n    )\n\n    orders_data = [order.to_dict() for order in orders_pagination.items]\n\n    return jsonify({\n        'orders': orders_data,\n        'total': orders_pagination.total,\n        'page': page,\n        'per_page': per_page,\n        'pages': orders_pagination.pages\n    })\n\n\n@api_bp.route('/admin/orders/<int:order_id>/status', methods=['PATCH'])\n@login_required\n@admin_required\ndef admin_update_order_status(order_id):\n    \"\"\"Update order status (admin only)\"\"\"\n    from app.models.shop import Order\n    from datetime import datetime\n\n    order = Order.query.get_or_404(order_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n    new_status = data.get('status')\n    admin_notes = data.get('admin_notes', '')\n    tracking_number = data.get('tracking_number')\n\n    if not new_status:\n        return jsonify({'error': 'status is required'}), 400\n\n    valid_statuses = ['pending', 'approved', 'rejected', 'completed', 'refunded']\n    if new_status not in valid_statuses:\n        return jsonify({'error': f'Invalid status. Must be one of: {\", \".join(valid_statuses)}'}), 400\n\n    old_status = order.status\n    order.status = new_status\n\n    if admin_notes:\n        order.admin_notes = sanitize_string(admin_notes, max_length=2000)\n\n    if tracking_number:\n        order.tracking_number = sanitize_string(tracking_number, max_length=200)\n\n    # Update timestamps based on status\n    if new_status == 'approved' and not order.approved_at:\n        order.approved_at = datetime.utcnow()\n    elif new_status == 'completed' and not order.completed_at:\n        order.completed_at = datetime.utcnow()\n\n    db.session.commit()\n\n    create_audit_log(\n        action_type='order_status_update',\n        description=f'Admin {current_user.username} changed order #{order_id} status from {old_status} to {new_status}',\n        user=current_user,\n        target_type='order',\n        target_id=order_id,\n        details={'old_status': old_status, 'new_status': new_status},\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Order status updated',\n        'order': order.to_dict()\n    })\n\n\n@api_bp.route('/admin/orders/<int:order_id>', methods=['DELETE'])\n@login_required\n@admin_required\ndef admin_delete_order(order_id):\n    \"\"\"Delete an order (admin only)\"\"\"\n    from app.models.shop import Order\n\n    order = Order.query.get_or_404(order_id)\n    current_user = get_current_user()\n\n    order_info = f'Order #{order.id} from {order.club.name if order.club else \"Unknown\"}'\n\n    db.session.delete(order)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='order_delete',\n        description=f'Admin {current_user.username} deleted {order_info}',\n        user=current_user,\n        target_type='order',\n        target_id=order_id,\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Order deleted successfully'\n    })\n\n\n@api_bp.route('/admin/orders/<int:order_id>/refund', methods=['POST'])\n@login_required\n@admin_required\ndef admin_refund_order(order_id):\n    \"\"\"Refund an order (admin only)\"\"\"\n    from app.models.shop import Order\n    from datetime import datetime\n\n    order = Order.query.get_or_404(order_id)\n    current_user = get_current_user()\n\n    if order.status == 'refunded':\n        return jsonify({'error': 'Order already refunded'}), 400\n\n    # Refund tokens to club\n    if order.club:\n        club = order.club\n        club.tokens += order.total_price\n\n        # Create transaction record\n        success, error_msg = create_club_transaction(\n            club_id=club.id,\n            transaction_type='credit',\n            amount=order.total_price,\n            description=f'Refund for order #{order.id}',\n            user_id=current_user.id,\n            reference_type='order_refund',\n            reference_id=order.id,\n            created_by=current_user.id\n        )\n\n        if not success:\n            return jsonify({'error': f'Failed to process refund: {error_msg}'}), 500\n\n    # Update order status\n    order.status = 'refunded'\n    db.session.commit()\n\n    create_audit_log(\n        action_type='order_refund',\n        description=f'Admin {current_user.username} refunded order #{order_id}',\n        user=current_user,\n        target_type='order',\n        target_id=order_id,\n        details={'refund_amount': order.total_price},\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Order refunded successfully',\n        'refund_amount': order.total_price\n    })\n\n\n# ============================================================================\n# Admin Shop Items Endpoints\n# ============================================================================\n\n@api_bp.route('/admin/shop-items', methods=['GET', 'POST'])\n@login_required\n@admin_required\ndef admin_shop_items():\n    \"\"\"Get or create shop items (admin only)\"\"\"\n    from app.models.shop import ShopItem\n\n    if request.method == 'GET':\n        items = ShopItem.query.order_by(ShopItem.created_at.desc()).all()\n\n        # Group by category for easier frontend handling\n        items_by_category = {}\n        for item in items:\n            category = item.category or 'Other'\n            if category not in items_by_category:\n                items_by_category[category] = []\n            items_by_category[category].append(item.to_dict())\n\n        return jsonify({\n            'items': items_by_category,\n            'all_items': [item.to_dict() for item in items]\n        })\n\n    elif request.method == 'POST':\n        current_user = get_current_user()\n        data = request.get_json()\n\n        name = sanitize_string(data.get('name', ''), max_length=200)\n        description = sanitize_string(data.get('description', ''), max_length=2000)\n        price = int(data.get('price', 0))\n        image_url = sanitize_string(data.get('image_url', ''), max_length=500)\n        category = sanitize_string(data.get('category', ''), max_length=100)\n        stock = int(data.get('stock', 0))\n        is_active = bool(data.get('is_active', True))\n\n        if not name or price < 0:\n            return jsonify({'error': 'Name is required and price must be positive'}), 400\n\n        shop_item = ShopItem(\n            name=name,\n            description=description,\n            price=price,\n            image_url=image_url,\n            category=category,\n            stock=stock,\n            is_active=is_active\n        )\n        db.session.add(shop_item)\n        db.session.commit()\n\n        create_audit_log(\n            action_type='shop_item_create',\n            description=f'Admin {current_user.username} created shop item \"{name}\"',\n            user=current_user,\n            target_type='shop_item',\n            target_id=shop_item.id,\n            severity='info',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Shop item created',\n            'item': shop_item.to_dict()\n        })\n\n\n@api_bp.route('/admin/shop-items/<int:item_id>', methods=['PUT', 'DELETE'])\n@login_required\n@admin_required\ndef admin_shop_item(item_id):\n    \"\"\"Update or delete a shop item (admin only)\"\"\"\n    from app.models.shop import ShopItem\n\n    shop_item = ShopItem.query.get_or_404(item_id)\n    current_user = get_current_user()\n\n    if request.method == 'PUT':\n        data = request.get_json()\n\n        if 'name' in data:\n            shop_item.name = sanitize_string(data['name'], max_length=200)\n        if 'description' in data:\n            shop_item.description = sanitize_string(data['description'], max_length=2000)\n        if 'price' in data:\n            shop_item.price = int(data['price'])\n        if 'image_url' in data:\n            shop_item.image_url = sanitize_string(data['image_url'], max_length=500)\n        if 'category' in data:\n            shop_item.category = sanitize_string(data['category'], max_length=100)\n        if 'stock' in data:\n            shop_item.stock = int(data['stock'])\n        if 'is_active' in data:\n            shop_item.is_active = bool(data['is_active'])\n\n        db.session.commit()\n\n        create_audit_log(\n            action_type='shop_item_update',\n            description=f'Admin {current_user.username} updated shop item \"{shop_item.name}\"',\n            user=current_user,\n            target_type='shop_item',\n            target_id=shop_item.id,\n            severity='info',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Shop item updated',\n            'item': shop_item.to_dict()\n        })\n\n    elif request.method == 'DELETE':\n        item_name = shop_item.name\n\n        db.session.delete(shop_item)\n        db.session.commit()\n\n        create_audit_log(\n            action_type='shop_item_delete',\n            description=f'Admin {current_user.username} deleted shop item \"{item_name}\"',\n            user=current_user,\n            target_type='shop_item',\n            target_id=item_id,\n            severity='warning',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Shop item deleted'\n        })\n\n\n# ============================================================================\n# Admin Leaderboard Endpoints\n# ============================================================================\n\n@api_bp.route('/admin/leaderboard/exclusions', methods=['GET', 'POST'])\n@login_required\n@admin_required\ndef admin_leaderboard_exclusions():\n    \"\"\"Get or manage leaderboard exclusions (admin only)\"\"\"\n    from app.models.economy import LeaderboardExclusion\n\n    if request.method == 'GET':\n        exclusions = LeaderboardExclusion.query.all()\n        exclusions_data = []\n        for exclusion in exclusions:\n            club = Club.query.get(exclusion.club_id) if exclusion.club_id else None\n            exclusions_data.append({\n                'id': exclusion.id,\n                'club_id': exclusion.club_id,\n                'club_name': club.name if club else 'Unknown',\n                'reason': exclusion.reason,\n                'created_at': exclusion.created_at.isoformat() if exclusion.created_at else None\n            })\n\n        return jsonify({'exclusions': exclusions_data})\n\n    elif request.method == 'POST':\n        current_user = get_current_user()\n        data = request.get_json()\n\n        club_id = data.get('club_id')\n        reason = sanitize_string(data.get('reason', ''), max_length=500)\n\n        if not club_id:\n            return jsonify({'error': 'club_id is required'}), 400\n\n        # Check if club exists\n        club = Club.query.get(club_id)\n        if not club:\n            return jsonify({'error': 'Club not found'}), 404\n\n        # Check if already excluded\n        existing = LeaderboardExclusion.query.filter_by(club_id=club_id).first()\n        if existing:\n            return jsonify({'error': 'Club already excluded from leaderboard'}), 400\n\n        # Create exclusion\n        exclusion = LeaderboardExclusion(club_id=club_id, reason=reason)\n        db.session.add(exclusion)\n        db.session.commit()\n\n        create_audit_log(\n            action_type='leaderboard_exclusion_add',\n            description=f'Admin {current_user.username} excluded club {club.name} from leaderboard',\n            user=current_user,\n            target_type='club',\n            target_id=club_id,\n            details={'reason': reason},\n            severity='info',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Club excluded from leaderboard'\n        })\n\n\n@api_bp.route('/admin/leaderboard/exclusions/<int:exclusion_id>', methods=['DELETE'])\n@login_required\n@admin_required\ndef admin_delete_leaderboard_exclusion(exclusion_id):\n    \"\"\"Remove a leaderboard exclusion (admin only)\"\"\"\n    from app.models.economy import LeaderboardExclusion\n\n    current_user = get_current_user()\n    exclusion = LeaderboardExclusion.query.get_or_404(exclusion_id)\n\n    club = Club.query.get(exclusion.club_id) if exclusion.club_id else None\n    club_name = club.name if club else 'Unknown'\n\n    db.session.delete(exclusion)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='leaderboard_exclusion_remove',\n        description=f'Admin {current_user.username} removed leaderboard exclusion for club {club_name}',\n        user=current_user,\n        target_type='club',\n        target_id=exclusion.club_id,\n        severity='info',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Leaderboard exclusion removed'\n    })\n\n\n# ============================================================================\n# User API Endpoints\n# ============================================================================\n\n@api_bp.route('/user/me', methods=['GET'])\n@login_required\ndef get_user_me():\n    \"\"\"Get current authenticated user information\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    return jsonify({\n        'id': user.id,\n        'username': user.username,\n        'email': user.email,\n        'first_name': user.first_name,\n        'last_name': user.last_name,\n        'is_admin': user.is_admin,\n        'is_suspended': user.is_suspended,\n        'created_at': user.created_at.isoformat() if user.created_at else None\n    })\n\n\n@api_bp.route('/user/update', methods=['POST'])\n@login_required\n@limiter.limit(\"20 per hour\")\ndef update_user():\n    \"\"\"Update current user's profile\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    data = request.get_json()\n\n    # Update allowed fields\n    if 'first_name' in data:\n        user.first_name = sanitize_string(data['first_name'], max_length=50)\n\n    if 'last_name' in data:\n        user.last_name = sanitize_string(data['last_name'], max_length=50)\n\n    if 'hackatime_api_key' in data:\n        user.hackatime_api_key = sanitize_string(data['hackatime_api_key'], max_length=500)\n\n    if 'avatar_url' in data:\n        user.avatar_url = sanitize_string(data['avatar_url'], max_length=500)\n\n    db.session.commit()\n\n    create_audit_log(\n        action_type='user_profile_update',\n        description=f'User {user.username} updated their profile',\n        user=user,\n        target_type='user',\n        target_id=user.id,\n        category='user'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Profile updated successfully'\n    })\n\n\n@api_bp.route('/user/unlink-slack', methods=['POST'])\n@login_required\ndef unlink_slack():\n    \"\"\"Unlink Slack account from user\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    # Clear Slack-related fields\n    user.slack_user_id = None\n    db.session.commit()\n\n    create_audit_log(\n        action_type='slack_unlink',\n        description=f'User {user.username} unlinked their Slack account',\n        user=user,\n        target_type='user',\n        target_id=user.id,\n        category='user'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Slack account unlinked successfully'\n    })\n\n\n# ============================================================================\n# Identity/OAuth API Endpoints\n# ============================================================================\n\n@api_bp.route('/identity/status', methods=['GET'])\n@login_required\ndef identity_status():\n    \"\"\"Get Hack Club identity status for current user\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    # Check if user has Hack Club identity linked\n    has_identity = bool(user.slack_user_id)  # Simplified check\n\n    return jsonify({\n        'linked': has_identity,\n        'slack_user_id': user.slack_user_id if has_identity else None\n    })\n\n\n@api_bp.route('/identity/authorize', methods=['POST'])\n@login_required\ndef identity_authorize():\n    \"\"\"Start Hack Club identity authorization flow\"\"\"\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    # TODO: Implement actual Hack Club identity OAuth flow\n    return jsonify({\n        'error': 'Identity authorization not yet implemented',\n        'message': 'This feature is coming soon'\n    }), 501\n\n\n# ============================================================================\n# Status API Endpoints\n# ============================================================================\n\n@api_bp.route('/status/banner', methods=['GET'])\ndef status_banner():\n    \"\"\"Get public banner settings\"\"\"\n    banner_enabled = SystemSettings.get_setting('banner_enabled', 'false') == 'true'\n    banner_message = SystemSettings.get_setting('banner_message', '')\n    banner_type = SystemSettings.get_setting('banner_type', 'info')\n\n    return jsonify({\n        'enabled': banner_enabled,\n        'message': banner_message,\n        'type': banner_type\n    })\n\n\n@api_bp.route('/status/summary', methods=['GET'])\ndef status_summary():\n    \"\"\"Get system status summary\"\"\"\n    # Get basic stats\n    total_users = User.query.count()\n    total_clubs = Club.query.count()\n\n    # Check system health\n    maintenance_mode = SystemSettings.is_maintenance_mode()\n\n    return jsonify({\n        'status': 'operational' if not maintenance_mode else 'maintenance',\n        'maintenance_mode': maintenance_mode,\n        'stats': {\n            'total_users': total_users,\n            'total_clubs': total_clubs\n        }\n    })\n\n\n@api_bp.route('/admin/status/incidents', methods=['GET', 'POST'])\n@login_required\n@admin_required\ndef admin_status_incidents():\n    \"\"\"Manage status incidents (admin only)\"\"\"\n    from app.models.system import StatusIncident, StatusUpdate\n    from datetime import datetime\n\n    if request.method == 'GET':\n        status_filter = request.args.get('status')  # investigating, identified, monitoring, resolved\n        limit = request.args.get('limit', 50, type=int)\n        limit = min(limit, 100)\n\n        query = StatusIncident.query\n\n        if status_filter:\n            query = query.filter(StatusIncident.status == status_filter)\n\n        incidents = query.order_by(StatusIncident.created_at.desc()).limit(limit).all()\n        incidents_data = [incident.to_dict() for incident in incidents]\n\n        return jsonify({\n            'incidents': incidents_data,\n            'total': len(incidents_data)\n        })\n\n    elif request.method == 'POST':\n        current_user = get_current_user()\n        data = request.get_json()\n\n        title = sanitize_string(data.get('title', ''), max_length=255)\n        description = sanitize_string(data.get('description', ''), max_length=5000)\n        status = data.get('status', 'investigating')\n        impact = data.get('impact', 'minor')\n        affected_services = data.get('affected_services', [])\n\n        if not title or not description:\n            return jsonify({'error': 'Title and description are required'}), 400\n\n        valid_statuses = ['investigating', 'identified', 'monitoring', 'resolved']\n        if status not in valid_statuses:\n            return jsonify({'error': f'Invalid status. Must be one of: {\", \".join(valid_statuses)}'}), 400\n\n        valid_impacts = ['minor', 'major', 'critical']\n        if impact not in valid_impacts:\n            return jsonify({'error': f'Invalid impact. Must be one of: {\", \".join(valid_impacts)}'}), 400\n\n        incident = StatusIncident(\n            title=title,\n            description=description,\n            status=status,\n            impact=impact,\n            created_by=current_user.id\n        )\n        incident.set_affected_services(affected_services)\n\n        db.session.add(incident)\n        db.session.commit()\n\n        create_audit_log(\n            action_type='status_incident_create',\n            description=f'Admin {current_user.username} created status incident \"{title}\"',\n            user=current_user,\n            target_type='status_incident',\n            target_id=incident.id,\n            severity='warning',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Status incident created',\n            'incident': incident.to_dict()\n        })\n\n\n@api_bp.route('/admin/status/incidents/<int:incident_id>', methods=['PUT', 'DELETE'])\n@login_required\n@admin_required\ndef admin_status_incident(incident_id):\n    \"\"\"Update or delete a status incident (admin only)\"\"\"\n    from app.models.system import StatusIncident\n    from datetime import datetime\n\n    incident = StatusIncident.query.get_or_404(incident_id)\n    current_user = get_current_user()\n\n    if request.method == 'PUT':\n        data = request.get_json()\n\n        if 'title' in data:\n            incident.title = sanitize_string(data['title'], max_length=255)\n        if 'description' in data:\n            incident.description = sanitize_string(data['description'], max_length=5000)\n        if 'status' in data:\n            new_status = data['status']\n            valid_statuses = ['investigating', 'identified', 'monitoring', 'resolved']\n            if new_status not in valid_statuses:\n                return jsonify({'error': f'Invalid status'}), 400\n            incident.status = new_status\n\n            # Mark as resolved if status is resolved\n            if new_status == 'resolved' and not incident.resolved_at:\n                incident.resolved_at = datetime.utcnow()\n\n        if 'impact' in data:\n            impact = data['impact']\n            valid_impacts = ['minor', 'major', 'critical']\n            if impact not in valid_impacts:\n                return jsonify({'error': f'Invalid impact'}), 400\n            incident.impact = impact\n\n        if 'affected_services' in data:\n            incident.set_affected_services(data['affected_services'])\n\n        db.session.commit()\n\n        create_audit_log(\n            action_type='status_incident_update',\n            description=f'Admin {current_user.username} updated status incident \"{incident.title}\"',\n            user=current_user,\n            target_type='status_incident',\n            target_id=incident.id,\n            severity='info',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Status incident updated',\n            'incident': incident.to_dict()\n        })\n\n    elif request.method == 'DELETE':\n        incident_title = incident.title\n\n        db.session.delete(incident)\n        db.session.commit()\n\n        create_audit_log(\n            action_type='status_incident_delete',\n            description=f'Admin {current_user.username} deleted status incident \"{incident_title}\"',\n            user=current_user,\n            target_type='status_incident',\n            target_id=incident_id,\n            severity='warning',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Status incident deleted'\n        })\n\n\n@api_bp.route('/admin/status/incidents/<int:incident_id>/updates', methods=['POST'])\n@login_required\n@admin_required\ndef admin_create_status_update(incident_id):\n    \"\"\"Add an update to a status incident (admin only)\"\"\"\n    from app.models.system import StatusIncident, StatusUpdate\n\n    incident = StatusIncident.query.get_or_404(incident_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n    message = sanitize_string(data.get('message', ''), max_length=5000)\n    status = data.get('status', incident.status)\n\n    if not message:\n        return jsonify({'error': 'Message is required'}), 400\n\n    valid_statuses = ['investigating', 'identified', 'monitoring', 'resolved']\n    if status not in valid_statuses:\n        return jsonify({'error': 'Invalid status'}), 400\n\n    update = StatusUpdate(\n        incident_id=incident.id,\n        message=message,\n        status=status,\n        created_by=current_user.id\n    )\n    db.session.add(update)\n\n    # Update incident status\n    incident.status = status\n    if status == 'resolved' and not incident.resolved_at:\n        incident.resolved_at = datetime.utcnow()\n\n    db.session.commit()\n\n    return jsonify({\n        'success': True,\n        'message': 'Status update added',\n        'update': update.to_dict()\n    })\n\n\n# ============================================================================\n# Project Review API Endpoints\n# ============================================================================\n\n@api_bp.route('/projects/review', methods=['GET'])\n@login_required\ndef get_projects_for_review():\n    \"\"\"Get projects pending review\"\"\"\n    from app.models.economy import ProjectSubmission\n\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    # Get user's pending projects\n    projects = ProjectSubmission.query.filter_by(\n        user_id=user.id,\n        approved_at=None\n    ).order_by(ProjectSubmission.created_at.desc()).all()\n\n    projects_data = []\n    for project in projects:\n        projects_data.append({\n            'id': project.id,\n            'name': project.name,\n            'description': project.description,\n            'url': project.url,\n            'github_url': project.github_url,\n            'created_at': project.created_at.isoformat() if project.created_at else None,\n            'status': 'pending'\n        })\n\n    return jsonify({\n        'projects': projects_data,\n        'total': len(projects_data)\n    })\n\n\n@api_bp.route('/projects/review/<int:project_id>', methods=['POST'])\n@login_required\n@admin_required\ndef review_project(project_id):\n    \"\"\"Review and approve/reject a project (admin only)\"\"\"\n    from app.models.economy import ProjectSubmission\n    from datetime import datetime\n\n    project = ProjectSubmission.query.get_or_404(project_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n    approved = data.get('approved', False)\n    token_amount = int(data.get('token_amount', 0))\n    admin_notes = sanitize_string(data.get('admin_notes', ''), max_length=2000)\n\n    if approved and token_amount > 0:\n        # Approve and grant tokens\n        project.approved_at = datetime.utcnow()\n        project.tokens_awarded = token_amount\n\n        # Grant tokens to club\n        if project.club:\n            project.club.tokens += token_amount\n\n            # Create transaction\n            create_club_transaction(\n                club_id=project.club_id,\n                transaction_type='credit',\n                amount=token_amount,\n                description=f'Project approved: {project.name}',\n                user_id=current_user.id,\n                reference_type='project_approval',\n                reference_id=project.id,\n                created_by=current_user.id\n            )\n\n        create_audit_log(\n            action_type='project_approval',\n            description=f'Admin {current_user.username} approved project \"{project.name}\"',\n            user=current_user,\n            target_type='project',\n            target_id=project_id,\n            details={'token_amount': token_amount},\n            severity='info',\n            admin_action=True,\n            category='admin'\n        )\n\n        message = 'Project approved and tokens granted'\n    else:\n        # Reject\n        project.rejected_at = datetime.utcnow()\n\n        create_audit_log(\n            action_type='project_rejection',\n            description=f'Admin {current_user.username} rejected project \"{project.name}\"',\n            user=current_user,\n            target_type='project',\n            target_id=project_id,\n            severity='info',\n            admin_action=True,\n            category='admin'\n        )\n\n        message = 'Project rejected'\n\n    if admin_notes:\n        project.admin_notes = admin_notes\n\n    db.session.commit()\n\n    return jsonify({\n        'success': True,\n        'message': message\n    })\n\n\n@api_bp.route('/projects/delete/<int:project_id>', methods=['DELETE'])\n@login_required\n@admin_required\ndef delete_project(project_id):\n    \"\"\"Delete a project submission (admin only)\"\"\"\n    from app.models.economy import ProjectSubmission\n\n    project = ProjectSubmission.query.get_or_404(project_id)\n    current_user = get_current_user()\n\n    project_name = project.name\n\n    db.session.delete(project)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='project_delete',\n        description=f'Admin {current_user.username} deleted project \"{project_name}\"',\n        user=current_user,\n        target_type='project',\n        target_id=project_id,\n        severity='warning',\n        admin_action=True,\n        category='admin'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': 'Project deleted'\n    })\n\n\n@api_bp.route('/projects/grant-override/<int:project_id>', methods=['POST'])\n@login_required\n@admin_required\ndef grant_override_project(project_id):\n    \"\"\"Force grant tokens for a project (admin only)\"\"\"\n    from app.models.economy import ProjectSubmission\n\n    project = ProjectSubmission.query.get_or_404(project_id)\n    current_user = get_current_user()\n\n    data = request.get_json()\n    token_amount = int(data.get('token_amount', 0))\n\n    if token_amount <= 0:\n        return jsonify({'error': 'Token amount must be positive'}), 400\n\n    # Grant tokens to club\n    if project.club:\n        project.club.tokens += token_amount\n        project.tokens_awarded = token_amount\n\n        # Create transaction\n        create_club_transaction(\n            club_id=project.club_id,\n            transaction_type='credit',\n            amount=token_amount,\n            description=f'Token override for project: {project.name}',\n            user_id=current_user.id,\n            reference_type='project_override',\n            reference_id=project.id,\n            created_by=current_user.id\n        )\n\n        db.session.commit()\n\n        create_audit_log(\n            action_type='project_override',\n            description=f'Admin {current_user.username} granted {token_amount} tokens override for project \"{project.name}\"',\n            user=current_user,\n            target_type='project',\n            target_id=project_id,\n            details={'token_amount': token_amount},\n            severity='warning',\n            admin_action=True,\n            category='admin'\n        )\n\n        return jsonify({\n            'success': True,\n            'message': 'Tokens granted successfully'\n        })\n\n    return jsonify({'error': 'Project has no associated club'}), 400\n\n\n# ============================================================================\n# Public Status Incidents API Endpoints\n# ============================================================================\n\n@api_bp.route('/status/incidents', methods=['GET'])\ndef get_public_status_incidents():\n    \"\"\"Get public status incidents (no auth required)\"\"\"\n    from app.models.system import StatusIncident\n\n    status_filter = request.args.get('status')\n    limit = request.args.get('limit', 20, type=int)\n    limit = min(limit, 100)\n\n    query = StatusIncident.query\n\n    if status_filter:\n        query = query.filter(StatusIncident.status == status_filter)\n\n    incidents = query.order_by(StatusIncident.created_at.desc()).limit(limit).all()\n    incidents_data = [incident.to_dict() for incident in incidents]\n\n    return jsonify({\n        'incidents': incidents_data,\n        'total': len(incidents_data)\n    })\n\n\n@api_bp.route('/status/incidents/<int:incident_id>', methods=['GET'])\ndef get_public_status_incident(incident_id):\n    \"\"\"Get a single public status incident (no auth required)\"\"\"\n    from app.models.system import StatusIncident\n\n    incident = StatusIncident.query.get_or_404(incident_id)\n\n    return jsonify({\n        'incident': incident.to_dict()\n    })\n\n\n# ============================================================================\n# OAuth v1 API Endpoints (for external apps)\n# ============================================================================\n\n@api_bp.route('/v1/users/<int:user_id>', methods=['GET'])\n@limiter.limit(\"100 per minute\")\ndef oauth_get_user(user_id):\n    \"\"\"Get user info via OAuth (requires valid OAuth token)\"\"\"\n    # TODO: Implement OAuth token validation\n    # For now, return basic public info\n    user = User.query.get_or_404(user_id)\n\n    return jsonify({\n        'id': user.id,\n        'username': user.username,\n        'created_at': user.created_at.isoformat() if user.created_at else None\n    })\n\n\n@api_bp.route('/v1/clubs/<int:club_id>', methods=['GET'])\n@limiter.limit(\"100 per minute\")\ndef oauth_get_club(club_id):\n    \"\"\"Get club info via OAuth (requires valid OAuth token)\"\"\"\n    # TODO: Implement OAuth token validation\n    club = Club.query.get_or_404(club_id)\n\n    return jsonify({\n        'id': club.id,\n        'name': club.name,\n        'description': club.description,\n        'tokens': club.tokens,\n        'created_at': club.created_at.isoformat() if club.created_at else None\n    })\n\n\n@api_bp.route('/v1/clubs/<int:club_id>/members', methods=['GET'])\n@limiter.limit(\"100 per minute\")\ndef oauth_get_club_members(club_id):\n    \"\"\"Get club members via OAuth (requires valid OAuth token)\"\"\"\n    # TODO: Implement OAuth token validation\n    club = Club.query.get_or_404(club_id)\n\n    memberships = ClubMembership.query.filter_by(club_id=club_id).all()\n\n    members_data = []\n    for m in memberships:\n        members_data.append({\n            'id': m.user.id,\n            'username': m.user.username,\n            'role': m.role,\n            'joined_at': m.joined_at.isoformat() if m.joined_at else None\n        })\n\n    return jsonify({\n        'members': members_data,\n        'total': len(members_data)\n    })\n\n\n@api_bp.route('/v1/clubs/<int:club_id>/projects', methods=['GET'])\n@limiter.limit(\"100 per minute\")\ndef oauth_get_club_projects(club_id):\n    \"\"\"Get club projects via OAuth (requires valid OAuth token)\"\"\"\n    # TODO: Implement OAuth token validation\n    from app.models.economy import ProjectSubmission\n\n    club = Club.query.get_or_404(club_id)\n\n    projects = ProjectSubmission.query.filter_by(club_id=club_id).order_by(\n        ProjectSubmission.created_at.desc()\n    ).all()\n\n    projects_data = []\n    for project in projects:\n        projects_data.append({\n            'id': project.id,\n            'name': project.name,\n            'description': project.description,\n            'url': project.url,\n            'created_at': project.created_at.isoformat() if project.created_at else None,\n            'approved': project.approved_at is not None\n        })\n\n    return jsonify({\n        'projects': projects_data,\n        'total': len(projects_data)\n    })\n\n\n# ============================================================================\n# Image Upload API Endpoint\n# ============================================================================\n\n@api_bp.route('/upload-images', methods=['POST'])\n@login_required\n@limiter.limit(\"10 per hour\")\ndef upload_images():\n    \"\"\"Upload images to Hack Club CDN (supports both FormData and JSON base64)\"\"\"\n    from app.utils.cdn_helpers import upload_to_hackclub_cdn, parse_base64_images\n    from werkzeug.utils import secure_filename\n    import os\n\n    user = get_current_user()\n    if not user:\n        return jsonify({'error': 'Not authenticated'}), 401\n\n    image_data_list = []\n    max_size = 10 * 1024 * 1024  # 10MB per image\n    allowed_extensions = {'png', 'jpg', 'jpeg', 'gif', 'webp'}\n\n    # Check if it's JSON with base64 images\n    if request.is_json:\n        data = request.get_json()\n        images = data.get('images', [])\n\n        if not images:\n            return jsonify({'error': 'No images provided'}), 400\n\n        if len(images) > 20:\n            return jsonify({'error': 'Maximum 20 images allowed per upload'}), 400\n\n        # Parse base64 images\n        image_data_list = parse_base64_images(images, max_size=max_size)\n\n    else:\n        # Handle FormData file uploads\n        if 'images' not in request.files:\n            return jsonify({'error': 'No images provided'}), 400\n\n        files = request.files.getlist('images')\n        if not files:\n            return jsonify({'error': 'No images provided'}), 400\n\n        if len(files) > 20:\n            return jsonify({'error': 'Maximum 20 images allowed per upload'}), 400\n\n        for file in files:\n            if file.filename == '':\n                continue\n\n            # Check file extension\n            filename = secure_filename(file.filename)\n            if '.' not in filename:\n                continue\n\n            ext = '.' + filename.rsplit('.', 1)[1].lower()\n            if ext[1:] not in allowed_extensions:\n                continue\n\n            try:\n                # Read file data\n                file.seek(0)\n                image_data = file.read()\n\n                # Check file size\n                if len(image_data) > max_size:\n                    current_app.logger.warning(f'File {filename} too large')\n                    continue\n\n                image_data_list.append((image_data, ext))\n\n            except Exception as e:\n                current_app.logger.error(f'Error processing file {filename}: {str(e)}')\n                continue\n\n    if not image_data_list:\n        return jsonify({'error': 'No valid images were processed'}), 400\n\n    # Upload to Hack Club CDN\n    success, result = upload_to_hackclub_cdn(image_data_list)\n\n    if not success:\n        return jsonify({'error': result}), 500\n\n    cdn_urls = result\n\n    create_audit_log(\n        action_type='images_upload',\n        description=f'User {user.username} uploaded {len(cdn_urls)} images to CDN',\n        user=user,\n        target_type='upload',\n        details={'image_count': len(cdn_urls)},\n        category='user'\n    )\n\n    return jsonify({\n        'success': True,\n        'message': f'{len(cdn_urls)} images uploaded successfully',\n        'urls': cdn_urls\n    })\n\n\n# ============================================================================\n# Analytics API Endpoints (for OAuth debug)\n# ============================================================================\n\n@api_bp.route('/v1/analytics/overview', methods=['GET'])\n@login_required\ndef analytics_overview():\n    \"\"\"Get analytics overview - PLACEHOLDER\"\"\"\n    # TODO: Implement analytics system\n    return jsonify({\n        'views': 0,\n        'unique_visitors': 0,\n        'message': 'Analytics not yet implemented'\n    })\n\n\n# ============================================================================\n# Club Content API Endpoints\n# ============================================================================\n\n@api_bp.route('/clubs/<int:club_id>/posts', methods=['GET', 'POST'])\n@login_required\n@limiter.limit(\"500 per hour\")\ndef club_posts(club_id):\n    \"\"\"Get or create club posts\"\"\"\n    current_user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    is_leader = club.leader_id == current_user.id\n    is_co_leader = is_user_co_leader(club, current_user)\n    is_member = ClubMembership.query.filter_by(club_id=club_id, user_id=current_user.id).first()\n    is_admin_access = request.args.get('admin') == 'true' and current_user.is_admin\n\n    if not is_leader and not is_co_leader and not is_member and not is_admin_access:\n        return jsonify({'error': 'Unauthorized'}), 403\n    \n    # Give admins leader privileges\n    if is_admin_access:\n        is_leader = True\n\n    if request.method == 'POST':\n        # Only leaders and co-leaders can create posts\n        if not is_leader and not is_co_leader:\n            return jsonify({'error': 'Only club leaders and co-leaders can create posts'}), 403\n            \n        data = request.get_json()\n        content = data.get('content')\n\n        if not content:\n            return jsonify({'error': 'Content is required'}), 400\n\n        # Security validation with auto-suspend\n        valid, result = validate_input_with_security(content, \"club_post\", current_user, max_length=5000,\n                                                     app=current_app)\n        if not valid:\n            return jsonify({'error': result}), 403\n\n        # For leaders, content is treated as markdown and converted to HTML\n        if is_leader or is_co_leader:\n            # Store raw markdown content (basic sanitization only)\n            markdown_content = sanitize_string(result, max_length=5000, allow_html=False)\n            # Convert markdown to safe HTML\n            html_content = markdown_to_html(markdown_content)\n        else:\n            # For regular members, treat as plain text\n            markdown_content = sanitize_string(result, max_length=5000, allow_html=False)\n            html_content = html.escape(markdown_content).replace('\\n', '<br>')\n\n        if not markdown_content.strip():\n            return jsonify({'error': 'Content cannot be empty after sanitization'}), 400\n\n        post = ClubPost(\n            club_id=club_id,\n            user_id=current_user.id,\n            content=markdown_content,\n            content_html=html_content\n        )\n        db.session.add(post)\n        db.session.commit()\n\n        # Create audit log for post creation\n        create_audit_log(\n            action_type='create_post',\n            description=f\"User {current_user.username} created a post in {club.name}\",\n            user=current_user,\n            target_type='club',\n            target_id=club_id,\n            details={\n                'club_name': club.name,\n                'post_id': post.id,\n                'content_length': len(markdown_content)\n            },\n            category='club'\n        )\n\n        return jsonify({'message': 'Post created successfully'})\n\n    # GET request\n    posts = ClubPost.query.filter_by(club_id=club_id).order_by(ClubPost.created_at.desc()).all()\n    posts_data = []\n    \n    for post in posts:\n        try:\n            # Handle content_html field safely (might be NULL for some posts)\n            content_html = post.content_html\n            if not content_html:\n                # For posts without HTML content, escape and convert newlines\n                content_html = html.escape(post.content).replace('\\n', '<br>')\n            \n            post_data = {\n                'id': post.id,\n                'content': post.content,  # Raw markdown content\n                'content_html': content_html,  # HTML content for display\n                'created_at': post.created_at.isoformat(),\n                'user': {\n                    'id': post.user.id,\n                    'username': post.user.username\n                }\n            }\n            posts_data.append(post_data)\n        except Exception as e:\n            current_app.logger.error(f\"Error processing post {post.id}: {e}\")\n            continue\n    \n    return jsonify({'posts': posts_data})\n\n\n@api_bp.route('/clubs/<int:club_id>/posts/<int:post_id>', methods=['DELETE'])\n@login_required\n@limiter.limit(\"100 per hour\")\ndef delete_club_post(club_id, post_id):\n    \"\"\"Delete a club post\"\"\"\n    current_user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n    post = ClubPost.query.get_or_404(post_id)\n\n    # Verify post belongs to this club\n    if post.club_id != club_id:\n        return jsonify({'error': 'Post not found in this club'}), 404\n\n    is_leader = club.leader_id == current_user.id\n    is_co_leader = is_user_co_leader(club, current_user)\n    is_post_author = post.user_id == current_user.id\n\n    # Only leaders, co-leaders, or post authors can delete\n    if not is_leader and not is_co_leader and not is_post_author and not current_user.is_admin:\n        return jsonify({'error': 'Unauthorized'}), 403\n\n    db.session.delete(post)\n    db.session.commit()\n\n    create_audit_log(\n        action_type='delete_post',\n        description=f\"User {current_user.username} deleted a post in {club.name}\",\n        user=current_user,\n        target_type='club',\n        target_id=club_id,\n        category='club'\n    )\n\n    return jsonify({'message': 'Post deleted successfully'})\n\n\n@api_bp.route('/clubs/<int:club_id>/assignments', methods=['GET', 'POST'])\n@login_required\n@limiter.limit(\"500 per hour\")\ndef club_assignments(club_id):\n    \"\"\"Get or create club assignments\"\"\"\n    current_user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    is_leader = club.leader_id == current_user.id\n    is_co_leader = is_user_co_leader(club, current_user)\n    is_member = ClubMembership.query.filter_by(club_id=club_id, user_id=current_user.id).first()\n\n    if not is_leader and not is_co_leader and not is_member:\n        return jsonify({'error': 'Unauthorized'}), 403\n\n    if request.method == 'POST':\n        # Only leaders and co-leaders can create assignments\n        if not is_leader and not is_co_leader:\n            return jsonify({'error': 'Only club leaders can create assignments'}), 403\n\n        data = request.get_json()\n        title = data.get('title')\n        description = data.get('description')\n        due_date = data.get('due_date')\n\n        if not title or not description:\n            return jsonify({'error': 'Title and description are required'}), 400\n\n        # Validate inputs\n        valid, result = validate_input_with_security(title, \"assignment_title\", current_user, max_length=200, app=current_app)\n        if not valid:\n            return jsonify({'error': result}), 403\n        title = result\n\n        valid, result = validate_input_with_security(description, \"assignment_description\", current_user, max_length=2000, app=current_app)\n        if not valid:\n            return jsonify({'error': result}), 403\n        description = result\n\n        assignment = ClubAssignment(\n            club_id=club_id,\n            title=title,\n            description=description,\n            due_date=due_date\n        )\n        db.session.add(assignment)\n        db.session.commit()\n\n        create_audit_log(\n            action_type='create_assignment',\n            description=f\"User {current_user.username} created assignment '{title}' in {club.name}\",\n            user=current_user,\n            target_type='club',\n            target_id=club_id,\n            category='club'\n        )\n\n        return jsonify({'message': 'Assignment created successfully', 'assignment_id': assignment.id})\n\n    # GET request\n    assignments = ClubAssignment.query.filter_by(club_id=club_id).order_by(ClubAssignment.due_date.desc()).all()\n    assignments_data = [{\n        'id': a.id,\n        'title': a.title,\n        'description': a.description,\n        'due_date': a.due_date.isoformat() if a.due_date else None,\n        'created_at': a.created_at.isoformat() if a.created_at else None\n    } for a in assignments]\n\n    return jsonify({'assignments': assignments_data})\n\n\n@api_bp.route('/clubs/<int:club_id>/assignments/<int:assignment_id>', methods=['DELETE'])\n@login_required\n@limiter.limit(\"100 per hour\")\ndef delete_club_assignment(club_id, assignment_id):\n    \"\"\"Delete a club assignment\"\"\"\n    current_user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n    assignment = ClubAssignment.query.get_or_404(assignment_id)\n\n    if assignment.club_id != club_id:\n        return jsonify({'error': 'Assignment not found in this club'}), 404\n\n    is_leader = club.leader_id == current_user.id\n    is_co_leader = is_user_co_leader(club, current_user)\n\n    if not is_leader and not is_co_leader and not current_user.is_admin:\n        return jsonify({'error': 'Unauthorized'}), 403\n\n    db.session.delete(assignment)\n    db.session.commit()\n\n    return jsonify({'message': 'Assignment deleted successfully'})\n\n\n@api_bp.route('/clubs/<int:club_id>/meetings', methods=['GET', 'POST'])\n@login_required\n@limiter.limit(\"500 per hour\")\ndef club_meetings(club_id):\n    \"\"\"Get or create club meetings\"\"\"\n    current_user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    is_leader = club.leader_id == current_user.id\n    is_co_leader = is_user_co_leader(club, current_user)\n    is_member = ClubMembership.query.filter_by(club_id=club_id, user_id=current_user.id).first()\n\n    if not is_leader and not is_co_leader and not is_member:\n        return jsonify({'error': 'Unauthorized'}), 403\n\n    if request.method == 'POST':\n        # Only leaders and co-leaders can create meetings\n        if not is_leader and not is_co_leader:\n            return jsonify({'error': 'Only club leaders can create meetings'}), 403\n\n        data = request.get_json()\n        title = data.get('title')\n        description = data.get('description')\n        meeting_date = data.get('meeting_date')\n        location = data.get('location')\n\n        if not title:\n            return jsonify({'error': 'Title is required'}), 400\n\n        # Validate inputs\n        valid, result = validate_input_with_security(title, \"meeting_title\", current_user, max_length=200, app=current_app)\n        if not valid:\n            return jsonify({'error': result}), 403\n        title = result\n\n        if description:\n            valid, result = validate_input_with_security(description, \"meeting_description\", current_user, max_length=2000, app=current_app)\n            if not valid:\n                return jsonify({'error': result}), 403\n            description = result\n\n        meeting = ClubMeeting(\n            club_id=club_id,\n            title=title,\n            description=description,\n            meeting_date=meeting_date,\n            location=location\n        )\n        db.session.add(meeting)\n        db.session.commit()\n\n        create_audit_log(\n            action_type='create_meeting',\n            description=f\"User {current_user.username} created meeting '{title}' in {club.name}\",\n            user=current_user,\n            target_type='club',\n            target_id=club_id,\n            category='club'\n        )\n\n        return jsonify({'message': 'Meeting created successfully', 'meeting_id': meeting.id})\n\n    # GET request\n    meetings = ClubMeeting.query.filter_by(club_id=club_id).order_by(ClubMeeting.meeting_date.desc()).all()\n    meetings_data = [{\n        'id': m.id,\n        'title': m.title,\n        'description': m.description,\n        'meeting_date': m.meeting_date.isoformat() if m.meeting_date else None,\n        'location': m.location,\n        'created_at': m.created_at.isoformat() if m.created_at else None\n    } for m in meetings]\n\n    return jsonify({'meetings': meetings_data})\n\n\n@api_bp.route('/clubs/<int:club_id>/meetings/<int:meeting_id>', methods=['DELETE'])\n@login_required\n@limiter.limit(\"100 per hour\")\ndef delete_club_meeting(club_id, meeting_id):\n    \"\"\"Delete a club meeting\"\"\"\n    current_user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n    meeting = ClubMeeting.query.get_or_404(meeting_id)\n\n    if meeting.club_id != club_id:\n        return jsonify({'error': 'Meeting not found in this club'}), 404\n\n    is_leader = club.leader_id == current_user.id\n    is_co_leader = is_user_co_leader(club, current_user)\n\n    if not is_leader and not is_co_leader and not current_user.is_admin:\n        return jsonify({'error': 'Unauthorized'}), 403\n\n    db.session.delete(meeting)\n    db.session.commit()\n\n    return jsonify({'message': 'Meeting deleted successfully'})\n\n\n@api_bp.route('/clubs/<int:club_id>/transactions', methods=['GET'])\n@login_required\n@limiter.limit(\"500 per hour\")\ndef club_transactions(club_id):\n    \"\"\"Get club transaction history\"\"\"\n    current_user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    is_leader = club.leader_id == current_user.id\n    is_co_leader = is_user_co_leader(club, current_user)\n    is_member = ClubMembership.query.filter_by(club_id=club_id, user_id=current_user.id).first()\n\n    if not is_leader and not is_co_leader and not is_member and not current_user.is_admin:\n        return jsonify({'error': 'Unauthorized'}), 403\n\n    page = request.args.get('page', 1, type=int)\n    per_page = request.args.get('per_page', 20, type=int)\n    per_page = min(per_page, 100)\n\n    transactions_pagination = ClubTransaction.query.filter_by(club_id=club_id).order_by(\n        ClubTransaction.created_at.desc()\n    ).paginate(page=page, per_page=per_page, error_out=False)\n\n    transactions_data = []\n    for t in transactions_pagination.items:\n        transactions_data.append({\n            'id': t.id,\n            'transaction_type': t.transaction_type,\n            'amount': t.amount,\n            'description': t.description,\n            'created_at': t.created_at.isoformat() if t.created_at else None,\n            'reference_type': t.reference_type,\n            'reference_id': t.reference_id\n        })\n\n    return jsonify({\n        'transactions': transactions_data,\n        'total': transactions_pagination.total,\n        'page': page,\n        'per_page': per_page,\n        'pages': transactions_pagination.pages\n    })\n\n\n@api_bp.route('/club/<int:club_id>/quests', methods=['GET'])\n@login_required\n@limiter.limit(\"500 per hour\")\ndef club_quests(club_id):\n    \"\"\"Get club quests and progress\"\"\"\n    current_user = get_current_user()\n    club = Club.query.get_or_404(club_id)\n\n    is_member = ClubMembership.query.filter_by(club_id=club_id, user_id=current_user.id).first()\n    if not is_member and not current_user.is_admin:\n        return jsonify({'error': 'Unauthorized'}), 403\n\n    quests = ClubQuestProgress.query.filter_by(club_id=club_id).all()\n    quests_data = [{\n        'id': q.id,\n        'quest_type': q.quest.quest_type if q.quest else 'unknown',\n        'quest_name': q.quest.name if q.quest else 'Unknown Quest',\n        'quest_description': q.quest.description if q.quest else '',\n        'progress': q.progress,\n        'goal': q.target,\n        'reward': q.quest.reward_tokens if q.quest else 0,\n        'completed': q.completed,\n        'reward_claimed': q.reward_claimed,\n        'completed_at': q.completed_at.isoformat() if q.completed_at else None\n    } for q in quests]\n\n    return jsonify({'quests': quests_data})\n\n\n# ============================================================================\n# Gallery API Endpoints\n# ============================================================================\n\n@api_bp.route('/gallery/posts', methods=['GET', 'POST'])\n@limiter.limit(\"100 per hour\")\ndef gallery_posts():\n    \"\"\"Get or create gallery posts\"\"\"\n    if request.method == 'POST':\n        if not is_authenticated():\n            return jsonify({'error': 'Authentication required'}), 401\n        \n        current_user = get_current_user()\n        data = request.get_json()\n        \n        club_id = data.get('club_id')\n        title = data.get('title')\n        description = data.get('description')\n        images = data.get('images', [])\n        custom_club_name = data.get('custom_club_name')  # Admin override for club name\n        \n        if not club_id or not title or not description:\n            return jsonify({'error': 'Club ID, title, and description are required'}), 400\n        \n        # Limit to 50 images max\n        if len(images) > 50:\n            images = images[:50]\n        \n        # Verify user is leader or co-leader of the club\n        club = Club.query.get_or_404(club_id)\n        is_leader = club.leader_id == current_user.id\n        is_co_leader = is_user_co_leader(club, current_user)\n        \n        if not is_leader and not is_co_leader:\n            return jsonify({'error': 'Only club leaders can create gallery posts'}), 403\n        \n        # Security validation\n        valid, result = validate_input_with_security(title, \"gallery_title\", current_user, max_length=200, app=current_app)\n        if not valid:\n            return jsonify({'error': result}), 403\n        title = result\n        \n        valid, result = validate_input_with_security(description, \"gallery_description\", current_user, max_length=2000, app=current_app)\n        if not valid:\n            return jsonify({'error': result}), 403\n        description = result\n        \n        # Create gallery post\n        post = GalleryPost(\n            club_id=club_id,\n            user_id=current_user.id,\n            title=title,\n            description=description\n        )\n        post.set_images(images)\n        \n        # Update quest progress for gallery post\n        update_quest_progress(club_id, 'gallery_post', 1)\n        \n        # Admin can override club name display\n        if current_user.is_admin and custom_club_name:\n            valid, result = validate_input_with_security(custom_club_name, \"custom_club_name\", current_user, max_length=100, app=current_app)\n            if not valid:\n                return jsonify({'error': result}), 403\n            # Store custom club name in a new field or use description field with a prefix\n            post.description = f\"[CUSTOM_CLUB:{result}] {description}\"\n        \n        db.session.add(post)\n        db.session.commit()\n        \n        current_app.logger.info(f\"Gallery post created: ID={post.id}, title='{title}', club_id={club_id}, images={len(images)}\")\n        \n        # Log gallery post to Airtable\n        try:\n            airtable_success = airtable_service.log_gallery_post(\n                post_title=title,\n                description=description,\n                photos=images,\n                club_name=club.name,\n                author_username=current_user.username\n            )\n            if airtable_success:\n                current_app.logger.info(f\"Gallery post {post.id} successfully logged to Airtable\")\n            else:\n                current_app.logger.warning(f\"Failed to log gallery post {post.id} to Airtable\")\n        except Exception as e:\n            current_app.logger.error(f\"Exception logging gallery post {post.id} to Airtable: {str(e)}\")\n        \n        # Create audit log for gallery post creation\n        create_audit_log(\n            action_type='gallery_post_create',\n            description=f\"User {current_user.username} created gallery post '{title}' for club '{club.name}'\",\n            user=current_user,\n            target_type='club',\n            target_id=str(club_id),\n            details={\n                'post_title': title,\n                'club_name': club.name,\n                'image_count': len(images),\n                'custom_club_name': custom_club_name if current_user.is_admin and custom_club_name else None\n            },\n            severity='info',\n            admin_action=current_user.is_admin and custom_club_name,\n            category='gallery'\n        )\n        \n        return jsonify({'message': 'Gallery post created successfully', 'post_id': post.id})\n    \n    # GET request - return all gallery posts\n    try:\n        posts = GalleryPost.query.order_by(GalleryPost.created_at.desc()).all()\n        posts_data = []\n        \n        current_app.logger.info(f\"Retrieved {len(posts)} gallery posts from database\")\n        \n        for post in posts:\n            try:\n                # Get club and user info safely\n                club = Club.query.get(post.club_id)\n                user = User.query.get(post.user_id)\n                \n                if not club or not user:\n                    current_app.logger.warning(f\"Skipping post {post.id}: missing club ({club}) or user ({user})\")\n                    continue\n                \n                # Check for admin custom club name override\n                display_club_name = club.name\n                display_description = post.description\n                \n                if post.description.startswith('[CUSTOM_CLUB:'):\n                    # Extract custom club name and actual description\n                    try:\n                        end_idx = post.description.find('] ')\n                        if end_idx != -1:\n                            custom_club_name = post.description[13:end_idx]  # Skip '[CUSTOM_CLUB:'\n                            display_club_name = custom_club_name\n                            display_description = post.description[end_idx + 2:]  # Skip '] '\n                    except:\n                        pass  # Fall back to original if parsing fails\n                \n                post_data = {\n                    'id': post.id,\n                    'title': post.title,\n                    'description': display_description,\n                    'images': post.get_images(),\n                    'club_name': display_club_name,\n                    'club': {\n                        'id': club.id,\n                        'name': display_club_name,\n                        'location': club.location or ''\n                    },\n                    'author': {\n                        'id': user.id,\n                        'username': user.username\n                    },\n                    'created_at': post.created_at.isoformat() if post.created_at else '',\n                    'featured': bool(post.featured)\n                }\n                posts_data.append(post_data)\n                current_app.logger.debug(f\"Gallery post {post.id}: '{post.title}' by {user.username} from {club.name}, {len(post.get_images())} images\")\n                \n            except Exception as e:\n                current_app.logger.error(f\"Error processing gallery post {post.id}: {str(e)}\")\n                continue\n        \n        current_app.logger.info(f\"Returning {len(posts_data)} gallery posts to frontend\")\n        return jsonify({'posts': posts_data})\n        \n    except Exception as e:\n        current_app.logger.error(f\"Error fetching gallery posts: {str(e)}\")\n        db.session.rollback()\n        return jsonify({'posts': []})\n\n\n@api_bp.route('/gallery/posts/<int:post_id>', methods=['DELETE'])\n@login_required\n@limiter.limit(\"50 per hour\")\ndef delete_gallery_post(post_id):\n    \"\"\"Delete a gallery post\"\"\"\n    current_user = get_current_user()\n    \n    # Only admins can delete gallery posts\n    if not current_user.is_admin:\n        return jsonify({'error': 'Admin access required'}), 403\n    \n    post = GalleryPost.query.get_or_404(post_id)\n    \n    try:\n        # Get images and related data before deletion\n        images = post.get_images()\n        post_title = post.title\n        post_author_name = post.user.username if post.user else 'Unknown'\n        club_name = post.club.name if post.club else 'Unknown'\n        club = post.club\n        \n        # Deduct 100 tokens from the club if it has enough tokens\n        if club and club.tokens >= 100:\n            success, error_msg = create_club_transaction(\n                club_id=club.id,\n                transaction_type='debit',\n                amount=-100,  # Negative amount for deduction\n                description=f'Gallery post deletion penalty: \"{post_title}\"',\n                user_id=current_user.id,\n                reference_type='gallery_post_deletion',\n                reference_id=post_id,\n                created_by=current_user.id\n            )\n            \n            if not success:\n                current_app.logger.warning(f\"Failed to deduct tokens for gallery post deletion: {error_msg}\")\n        \n        # Delete the post\n        db.session.delete(post)\n        db.session.commit()\n        \n        create_audit_log(\n            action_type='gallery_post_delete',\n            description=f\"Admin {current_user.username} deleted gallery post '{post_title}' by {post_author_name}\",\n            user=current_user,\n            target_type='gallery_post',\n            target_id=str(post_id),\n            details={\n                'post_title': post_title,\n                'club_name': club_name,\n                'author': post_author_name,\n                'image_count': len(images),\n                'token_penalty': 100 if club and club.tokens >= 100 else 0\n            },\n            severity='warning',\n            admin_action=True,\n            category='gallery'\n        )\n        \n        current_app.logger.info(f\"Gallery post {post_id} deleted by admin {current_user.username}\")\n        return jsonify({'message': 'Gallery post deleted successfully'})\n        \n    except Exception as e:\n        db.session.rollback()\n        current_app.logger.error(f\"Error deleting gallery post {post_id}: {str(e)}\")\n        return jsonify({'error': 'Failed to delete gallery post'}), 500\n","size_bytes":119577},"app/models/auth.py":{"content":"\"\"\"\nAuthentication models for API Keys and OAuth.\nIncludes APIKey, OAuthApplication, OAuthToken, and OAuthAuthorizationCode models.\n\"\"\"\nimport json\nimport secrets\nfrom datetime import datetime, timedelta, timezone\nfrom extensions import db\n\n\nclass APIKey(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    key = db.Column(db.String(64), unique=True, nullable=False, index=True)\n    name = db.Column(db.String(200), nullable=False)\n    description = db.Column(db.Text)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    last_used_at = db.Column(db.DateTime)\n    is_active = db.Column(db.Boolean, default=True)\n    rate_limit = db.Column(db.Integer, default=1000)  # requests per hour\n    scopes = db.Column(db.Text)  # JSON array of allowed scopes\n\n    user = db.relationship('User', backref=db.backref('api_keys', cascade='all, delete-orphan'))\n\n    def generate_key(self):\n        self.key = secrets.token_urlsafe(48)\n\n    def get_scopes(self):\n        try:\n            return json.loads(self.scopes) if self.scopes else []\n        except:\n            return []\n\n    def set_scopes(self, scopes_list):\n        self.scopes = json.dumps(scopes_list)\n\n\nclass OAuthApplication(db.Model):\n    __tablename__ = 'o_auth_application'\n\n    id = db.Column(db.Integer, primary_key=True)\n    client_id = db.Column(db.String(64), unique=True, nullable=False, index=True)\n    client_secret = db.Column(db.String(128), nullable=False)\n    name = db.Column(db.String(200), nullable=False)\n    description = db.Column(db.Text)\n    redirect_uris = db.Column(db.Text)  # JSON array of allowed redirect URIs\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    is_active = db.Column(db.Boolean, default=True)\n    scopes = db.Column(db.Text)  # JSON array of allowed scopes\n\n    # Relationships\n    tokens = db.relationship(\n        'OAuthToken',\n        primaryjoin='OAuthApplication.id == OAuthToken.application_id',\n        back_populates='application',\n        cascade='all, delete-orphan'\n    )\n    authorization_codes = db.relationship(\n        'OAuthAuthorizationCode',\n        primaryjoin='OAuthApplication.id == OAuthAuthorizationCode.application_id',\n        back_populates='application',\n        cascade='all, delete-orphan'\n    )\n\n    user = db.relationship('User', backref=db.backref('oauth_applications', cascade='all, delete-orphan'))\n\n    def generate_credentials(self):\n        self.client_id = secrets.token_urlsafe(32)\n        self.client_secret = secrets.token_urlsafe(64)\n\n    def get_redirect_uris(self):\n        try:\n            return json.loads(self.redirect_uris) if self.redirect_uris else []\n        except:\n            return []\n\n    def set_redirect_uris(self, uris_list):\n        self.redirect_uris = json.dumps(uris_list)\n\n    def get_scopes(self):\n        try:\n            return json.loads(self.scopes) if self.scopes else []\n        except:\n            return []\n\n    def set_scopes(self, scopes_list):\n        self.scopes = json.dumps(scopes_list)\n\n\nclass OAuthToken(db.Model):\n    __tablename__ = 'o_auth_token'\n\n    id = db.Column(db.Integer, primary_key=True)\n    access_token = db.Column(db.String(128), unique=True, nullable=False, index=True)\n    refresh_token = db.Column(db.String(128), unique=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    application_id = db.Column(db.Integer, db.ForeignKey('o_auth_application.id'), nullable=False)\n    scopes = db.Column(db.Text)  # JSON array of granted scopes\n    expires_at = db.Column(db.DateTime, nullable=False)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n    is_active = db.Column(db.Boolean, default=True)\n\n    user = db.relationship('User', backref=db.backref('oauth_tokens', cascade='all, delete-orphan'))\n    application = db.relationship('OAuthApplication', back_populates='tokens', foreign_keys=[application_id])\n\n    def generate_tokens(self):\n        self.access_token = secrets.token_urlsafe(48)\n        self.refresh_token = secrets.token_urlsafe(48)\n        self.expires_at = datetime.now(timezone.utc) + timedelta(hours=1)\n\n    def get_scopes(self):\n        try:\n            return json.loads(self.scopes) if self.scopes else []\n        except:\n            return []\n\n    def set_scopes(self, scopes_list):\n        self.scopes = json.dumps(scopes_list)\n\n\nclass OAuthAuthorizationCode(db.Model):\n    __tablename__ = 'o_auth_authorization_code'\n\n    id = db.Column(db.Integer, primary_key=True)\n    code = db.Column(db.String(128), unique=True, nullable=False, index=True)\n    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)\n    application_id = db.Column(db.Integer, db.ForeignKey('o_auth_application.id'), nullable=False)\n    redirect_uri = db.Column(db.String(500), nullable=False)\n    scopes = db.Column(db.Text)  # JSON array of requested scopes\n    state = db.Column(db.String(500))\n    expires_at = db.Column(db.DateTime, nullable=False)\n    used = db.Column(db.Boolean, default=False)\n    created_at = db.Column(db.DateTime, default=lambda: datetime.now(timezone.utc))\n\n    user = db.relationship('User', backref=db.backref('oauth_authorization_codes', cascade='all, delete-orphan'))\n    application = db.relationship('OAuthApplication', back_populates='authorization_codes', foreign_keys=[application_id])\n\n    def generate_code(self):\n        self.code = secrets.token_urlsafe(32)\n        self.expires_at = datetime.now(timezone.utc) + timedelta(minutes=10)\n\n    def get_scopes(self):\n        try:\n            return json.loads(self.scopes) if self.scopes else []\n        except:\n            return []\n\n    def set_scopes(self, scopes_list):\n        self.scopes = json.dumps(scopes_list)\n","size_bytes":5923}},"version":2}