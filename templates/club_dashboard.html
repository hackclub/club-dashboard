{% extends "base.html" %} {% block title %}{{ club.name }} - Hack Clubs Dash{%
endblock %} {% block extra_head %}
<link
    rel="stylesheet"
    type="text/css"
    href="{{ url_for('static', filename='css/dash.css') }}"
/>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
    .post-composer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .markdown-toggle {
        display: flex;
        gap: 0.5rem;
    }

    .markdown-preview {
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 0.75rem;
        background: #f8f9fa;
        margin-top: 0.5rem;
        max-height: 300px;
        overflow-y: auto;
    }

    .markdown-preview h1,
    .markdown-preview h2,
    .markdown-preview h3,
    .markdown-preview h4,
    .markdown-preview h5,
    .markdown-preview h6 {
        margin-top: 0;
        margin-bottom: 0.5rem;
    }

    .markdown-preview pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 1rem;
        border-radius: 0.375rem;
        overflow-x: auto;
    }

    .markdown-preview code {
        background: #e2e8f0;
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
    }

    .markdown-preview blockquote {
        border-left: 4px solid #3b82f6;
        margin: 0;
        padding-left: 1rem;
        color: #6b7280;
    }

    .post-composer-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 1rem;
    }

    /* Club Background Customization - Simple direct approach */
    .club-dashboard[data-has-background="true"] {
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
        background-attachment: fixed !important;
    }

    /* Join Code Modal Styles */
    .join-code-modal .modal-content {
        max-width: 600px;
        text-align: center;
    }

    .join-code-big {
        font-size: 4rem;
        font-weight: 800;
        color: #ec3750;
        background: linear-gradient(135deg, #fef7f7, #fff);
        border: 3px solid #ec3750;
        border-radius: 16px;
        padding: 2rem;
        margin: 2rem 0;
        letter-spacing: 0.2em;
        font-family: 'Courier New', 'Monaco', monospace;
        box-shadow: 0 8px 30px rgba(236, 55, 80, 0.2);
        transition: all 0.3s ease;
    }

    .join-code-big:hover {
        transform: scale(1.02);
        box-shadow: 0 12px 40px rgba(236, 55, 80, 0.3);
    }

    .join-code-display.clickable {
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .join-code-display.clickable:hover {
        background-color: rgba(236, 55, 80, 0.1);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(236, 55, 80, 0.2);
    }

    /* Mobile responsiveness for projector display */
    @media (max-width: 768px) {
        .join-code-big {
            font-size: 2.5rem;
            padding: 1.5rem;
        }
    }

    @media (max-width: 480px) {
        .join-code-big {
            font-size: 2rem;
            padding: 1rem;
            letter-spacing: 0.1em;
        }
    }

    /* Override modal z-index to be MUCH higher than navbar (navbar is z-index: 10000) */
    .club-dashboard .modal {
        z-index: 150000 !important;
    }

    .club-dashboard .modal-content {
        z-index: 150001 !important;
    }

    /* Disabled nav links for sync-immune unsynced clubs */
    .nav-link.disabled {
        opacity: 0.4;
        cursor: not-allowed;
        pointer-events: none;
    }

    .nav-link.disabled:hover {
        background: transparent;
        color: #64748b;
    }

    .nav-section.disabled .nav-section-title {
        opacity: 0.5;
    }

    /* Ensure navbar is completely isolated from club-dashboard styles */
    /* Use very high specificity to override any conflicting styles */
    body nav.navbar,
    body nav.navbar *:not(.club-dashboard-content *) {
        /* Navbar inherits from base.html only */
    }

    /* Force navbar to use base styles - maximum specificity */
    body .navbar .navbar-content {
        max-width: 1400px !important;
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
    }

    body .navbar .theme-toggle {
        position: relative !important;
        width: 40px !important;
        height: 40px !important;
        padding: 0 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        border-radius: 50% !important;
        background: var(--surface-elevated) !important;
        border: 2px solid var(--border) !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
    }

    body .navbar .theme-toggle:hover {
        background: var(--primary) !important;
        border-color: var(--primary) !important;
        transform: scale(1.1) !important;
    }

    body .navbar .theme-toggle i {
        font-size: 18px !important;
        transition: all 0.3s ease !important;
    }

    body .navbar .theme-toggle:hover i {
        color: white !important;
    }

    body .navbar .theme-toggle .theme-icon-dark,
    body .navbar .theme-toggle .theme-icon-light {
        position: absolute !important;
    }

    /* Light mode icon visibility */
    body[data-theme="light"] .navbar .theme-toggle .theme-icon-light {
        opacity: 0 !important;
        transform: rotate(180deg) scale(0) !important;
    }

    body[data-theme="light"] .navbar .theme-toggle .theme-icon-dark {
        opacity: 1 !important;
        transform: rotate(0deg) scale(1) !important;
        color: #64748b !important;
    }

    /* Dark mode icon visibility */
    body[data-theme="dark"] .navbar .theme-toggle .theme-icon-dark {
        opacity: 0 !important;
        transform: rotate(-180deg) scale(0) !important;
    }

    body[data-theme="dark"] .navbar .theme-toggle .theme-icon-light {
        opacity: 1 !important;
        transform: rotate(0deg) scale(1) !important;
        color: #fbbf24 !important;
    }
</style>
{% endblock %} {% block content %}
<script src="https://server.fillout.com/embed/v1/"></script>
<div
    class="club-dashboard"
    data-club-id="{{ club.id }}"
    data-join-code="{{ club.join_code }}"
    data-user-role="{% if current_user.id == club.leader_id %}leader{% elif is_co_leader %}co-leader{% elif is_admin_access %}admin{% else %}member{% endif %}"
    data-admin-access="{{ 'true' if is_admin_access else 'false' }}"
    {%
    if
    club.background_image_url
    %}
    data-has-background="true"
    data-background-url="{{ club.background_image_url }}"
    data-background-blur="{{ club.background_blur or 0 }}"
    {%
    endif
    %}
>
    <div class="club-header">
        <div class="container">
            <div class="club-info">
                <div class="club-avatar">
                    <i class="fas fa-users"></i>
                </div>
                <div class="club-details">
                    <h1>
                        {{ club.name }} {% if is_admin_access %}<span
                            style="
                                color: #fbbf24;
                                margin-left: 8px;
                                font-size: 0.8em;
                                font-weight: normal;
                            "
                            ><i class="fas fa-shield-alt"></i> Admin View</span
                        >{% endif %}
                    </h1>
                    <div class="club-meta">
                        <span
                            ><i class="fas fa-map-marker-alt"></i> {{
                            club.location or 'No location set' }}</span
                        >
                        <span
                            ><i class="fas fa-calendar"></i> Created {{
                            club.created_at.strftime('%B %Y') }}</span
                        >
                        <span
                            ><i class="fas fa-user-friends"></i> {{
                            club.members|length + 1 }} members</span
                        >
                    </div>
                </div>
                <div class="club-actions">
                    {% if current_user.id == club.leader_id or is_co_leader %}
                    <div
                        class="club-detail-item join-code-display clickable"
                        title="Click to show join code"
                        onclick="showJoinCodeModal()"
                    >
                        <i class="fas fa-key"></i> {{ club.join_code }}
                    </div>
                    {% if economy_enabled %}
                    <div
                        class="club-detail-item balance-display"
                        title="Club Tokens"
                    >
                        <i class="fas fa-coins"></i>
                        {{ (club.balance|float * 100)|int }} tokens
                    </div>
                    {% endif %}
                    <button class="qr-button" onclick="showQRModal()">
                        <i class="fas fa-qrcode"></i> QR Code
                    </button>
                    <button
                        class="new-code-button"
                        onclick="generateNewJoinCode()"
                    >
                        <i class="fas fa-sync-alt"></i> New Code
                    </button>
                    {% else %}

                    <button
                        class="btn"
                        style="background-color: #dc3545; color: white; padding: 0.5rem 1rem; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;"
                        onclick="confirmLeaveClub()"
                        title="Leave this club"
                    >
                        <i class="fas fa-sign-out-alt"></i> Leave Club
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="dashboard-layout">
            <div class="dashboard-sidebar">
                <nav class="sidebar-nav">
                    <div class="nav-section">
                        <h4 class="nav-section-title">Club Overview</h4>
                        <ul>
                            <li>
                                <a
                                    href="#dashboard"
                                    class="nav-link active"
                                    data-section="dashboard"
                                >
                                    <i class="fas fa-tachometer-alt"></i>
                                    Dashboard
                                </a>
                            </li>
                            <li>
                                <a
                                    href="#members"
                                    class="nav-link"
                                    data-section="members"
                                >
                                    <i class="fas fa-user-friends"></i> Members
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="nav-section">
                        <h4 class="nav-section-title">Communication</h4>
                        <ul>
                            <li>
                                <a
                                    href="#chat"
                                    class="nav-link"
                                    data-section="chat"
                                >
                                    <i class="fas fa-comments"></i> Chat
                                </a>
                            </li>
                            <li>
                                <a
                                    href="#stream"
                                    class="nav-link"
                                    data-section="stream"
                                >
                                    <i class="fas fa-bullhorn"></i>
                                    Announcements
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="nav-section">
                        <h4 class="nav-section-title">Activities & Events</h4>
                        <ul>
                            <li>
                                <a
                                    href="#attendance"
                                    class="nav-link"
                                    data-section="attendance"
                                >
                                    <i class="fas fa-calendar-check"></i> {% if
                                    current_user.id == club.leader_id or
                                    is_co_leader %}Sessions & Attendance{% else
                                    %}Events{% endif %}
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="nav-section">
                        <h4 class="nav-section-title">Projects & Learning</h4>
                        <ul>
                            <li>
                                <a
                                    href="#assignments"
                                    class="nav-link"
                                    data-section="assignments"
                                >
                                    <i class="fas fa-tasks"></i> {% if
                                    current_user.id == club.leader_id or
                                    is_co_leader %}Assignments{% else %}My
                                    Tasks{% endif %}
                                </a>
                            </li>
                            {% if economy_enabled %}
                            <li>
                                <a
                                    href="{{ url_for('project_submission', club_id=club.id) }}"
                                    class="nav-link project-link project-link-highlight"
                                    onclick="window.location.href=this.href; return false;"
                                >
                                    <i class="fas fa-code"></i>
                                    <span>Submit Project</span>
                                </a>
                            </li>
                            {% endif %}
                            <li>
                                <a
                                    href="#resources"
                                    class="nav-link"
                                    data-section="resources"
                                >
                                    <i class="fas fa-book"></i> Resources
                                </a>
                            </li>
                        </ul>
                    </div>

                    {% if effective_can_manage %}
                    <div class="nav-section {% if not is_connected_to_directory and club.sync_immune %}disabled{% endif %}">
                        <h4 class="nav-section-title">Club Promotion</h4>
                        <ul>
                            <li>
                                <a
                                    href="#advertising"
                                    class="nav-link {% if not is_connected_to_directory and club.sync_immune %}disabled{% endif %}"
                                    data-section="advertising"
                                >
                                    <i class="fas fa-bullhorn"></i> Advertising
                                </a>
                            </li>
                        </ul>
                    </div>
                    {% endif %}

                    {% if economy_enabled and effective_can_manage %}
                    <div class="nav-section {% if not is_connected_to_directory and club.sync_immune %}disabled{% endif %}">
                        <h4 class="nav-section-title">Token Economy</h4>
                        <ul>
                            <li>
                                <a
                                    href="#quests"
                                    class="nav-link {% if not is_connected_to_directory and club.sync_immune %}disabled{% endif %}"
                                    data-section="quests"
                                >
                                    <i class="fas fa-trophy"></i>
                                    Weekly Quests
                                </a>
                            </li>
                            <li>
                                <a
                                    href="{{ url_for('club_shop', club_id=club.id) }}"
                                    class="nav-link shop-link {% if not is_connected_to_directory and club.sync_immune %}disabled{% endif %}"
                                    onclick="{% if not is_connected_to_directory and club.sync_immune %}return false;{% else %}window.location.href=this.href; return false;{% endif %}"
                                >
                                    <i class="fas fa-shopping-cart"></i>
                                    Token Shop
                                </a>
                            </li>
                            <li>
                                <a
                                    href="#transactions"
                                    class="nav-link {% if not is_connected_to_directory and club.sync_immune %}disabled{% endif %}"
                                    data-section="transactions"
                                >
                                    <i class="fas fa-coins"></i>
                                    Token Transactions
                                    <span
                                        id="transactionsNotification"
                                        class="notification-dot"
                                        style="display: none"
                                    ></span>
                                </a>
                            </li>
                            {% if effective_can_manage %}
                            <li>
                                <a
                                    href="#piggy-bank"
                                    class="nav-link {% if not is_connected_to_directory and club.sync_immune %}disabled{% endif %}"
                                    data-section="piggy-bank"
                                >
                                    <i class="fas fa-piggy-bank"></i>
                                    Piggy Bank
                                </a>
                            </li>
                            {% endif %} {% if has_orders %}
                            <li>
                                <a
                                    href="{{ url_for('club_orders', club_id=club.id) }}"
                                    class="nav-link orders-link {% if not is_connected_to_directory and club.sync_immune %}disabled{% endif %}"
                                    onclick="{% if not is_connected_to_directory and club.sync_immune %}return false;{% else %}window.location.href=this.href; return false;{% endif %}"
                                >
                                    <i class="fas fa-box"></i> My Orders
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                    {% endif %} {% if current_user.id == club.leader_id %}
                    <div class="nav-section">
                        <h4 class="nav-section-title">Administration</h4>
                        <ul>
                            <li>
                                <a
                                    href="#settings"
                                    class="nav-link"
                                    data-section="settings"
                                >
                                    <i class="fas fa-cogs"></i> Settings
                                </a>
                            </li>
                            {% if current_user.has_permission('clubs.view_team_notes') or current_user.id == club.leader_id or is_co_leader or current_user.is_admin %}
                            <li>
                                <a
                                    href="#team-notes"
                                    class="nav-link"
                                    data-section="team-notes"
                                >
                                    <i class="fas fa-sticky-note"></i> Team Notes
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                    {% endif %}
                </nav>
            </div>

            <div class="dashboard-main">
                <section id="dashboard" class="club-section active fade-in">
                    {% if not is_connected_to_directory %}
                    <div class="alert-card" style="background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%); border: 2px solid #feb2b2;">
                        <div class="alert-icon" style="background: linear-gradient(135deg, #fc8181, #f56565); color: white;">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="alert-content">
                            <h4 style="color: #c53030;">
                                Connect to Hack Club Directory
                            </h4>
                            <p style="color: #742a2a;">
                                This club is not connected to the official Hack Club directory. {% if club.sync_immune %}While you can continue using the dashboard, {% else %}To unlock full features, {% endif %}connect your club to gain official recognition, funding opportunities, and access to exclusive resources.
                            </p>
                            {% if is_leader %}
                            <a
                                href="{{ url_for('verify_leader') }}"
                                class="alert-btn"
                                style="background: linear-gradient(135deg, #fc8181, #f56565); color: white;"
                            >
                                <i class="fas fa-link"></i> Connect Club Now
                            </a>
                            {% else %}
                            <p style="margin-top: 0.75rem; font-size: 0.9rem; color: #9b2c2c;">
                                <i class="fas fa-info-circle"></i> Only the club leader can connect to the directory.
                            </p>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    {% if banner_settings.enabled %}
                    <div
                        class="promotional-banner"
                        style="
                        background: {{ banner_settings.background_color | safe_css_color }};
                        border: 1px solid #e2e8f0;
                        border-radius: 16px;
                        padding: 1.5rem;
                        margin-bottom: 2rem;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                        color: {{ banner_settings.text_color | safe_css_color }};
                    "
                    >
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 1rem;
                            "
                        >
                            <div
                                style="
                                width: 50px;
                                height: 50px;
                                background: linear-gradient(135deg, {{ banner_settings.primary_color | safe_css_color }}, {{ banner_settings.secondary_color | safe_css_color }});
                                border-radius: 12px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: 1.25rem;
                            "
                            >
                                <i class="{{ banner_settings.icon | safe_html_attr }}"></i>
                            </div>
                            <div>
                                <h3
                                    style="margin: 0; font-size: 1.1rem; font-weight: 700; color: {{ banner_settings.text_color | safe_css_color }};"
                                >
                                    {{ banner_settings.title }}
                                </h3>
                                <p
                                    style="margin: 0.25rem 0 0 0; font-size: 0.9rem; color: {{ banner_settings.text_color | safe_css_color }}; opacity: 0.8;"
                                >
                                    {{ banner_settings.subtitle }}
                                </p>
                            </div>
                        </div>
                        <a
                            href="{{ banner_settings.link_url | safe_url }}"
                            style="
                            background: linear-gradient(135deg, {{ banner_settings.primary_color | safe_css_color }}, {{ banner_settings.secondary_color | safe_css_color }});
                            color: white;
                            text-decoration: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            font-weight: 600;
                            display: flex;
                            align-items: center;
                            gap: 0.5rem;
                            transition: transform 0.2s ease;
                        "
                            onmouseover="this.style.transform='translateY(-2px)'"
                            onmouseout="this.style.transform='translateY(0)'"
                        >
                            <i class="fas fa-arrow-right"></i>
                            {{ banner_settings.link_text }}
                        </a>
                    </div>
                    {% endif %}

                    <div class="section-header" style="position: relative">
                        <h2>
                            <i class="fas fa-tachometer-alt"></i> {% if
                            current_user.id == club.leader_id or current_user.id
                            == club.co_leader_id %}Dashboard{% else %}Welcome
                            Back!{% endif %}
                        </h2>
                        <p>
                            {% if current_user.id == club.leader_id or
                            is_co_leader %}Welcome to {{ club.name }}{% else
                            %}Here's what's happening in {{ club.name }}{% endif
                            %}
                        </p>
                    </div>


                    <div
                        class="quick-actions-section"
                        style="margin-bottom: 2rem"
                    >
                        <div
                            style="
                                display: flex;
                                gap: 1rem;
                                flex-wrap: wrap;
                                justify-content: center;
                            "
                        >
                            {% if economy_enabled %}
                            <a
                                href="{{ url_for('club_shop', club_id=club.id) }}"
                                class="btn btn-primary"
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 0.5rem;
                                    padding: 0.75rem 1.5rem;
                                    text-decoration: none;
                                "
                            >
                                <i class="fas fa-shopping-cart"></i>
                                Club Shop
                            </a>
                            <a
                                href="{{ url_for('project_submission', club_id=club.id) }}"
                                class="btn btn-secondary"
                                style="
                                    display: flex;
                                    align-items: center;
                                    gap: 0.5rem;
                                    padding: 0.75rem 1.5rem;
                                    text-decoration: none;
                                "
                            >
                                <i class="fas fa-code"></i>
                                Submit Project
                            </a>
                            {% endif %}
                        </div>
                    </div>

                    <div class="dashboard-cards">
                        {% if effective_can_manage %}

                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon members">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="card-content">
                                    <h3>Club Members</h3>
                                    <div class="card-metric">
                                        {{ club.members|length + 1 }}
                                    </div>
                                    <p>Total members</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#members"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('members')"
                                >
                                    <i class="fas fa-eye"></i> View Members
                                </a>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon meetings">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="card-content">
                                    <h3>Meetings</h3>
                                    <div class="card-metric" id="meetingsCount">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                    <p>Scheduled this month</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#schedule"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('schedule')"
                                >
                                    <i class="fas fa-plus"></i> Schedule Meeting
                                </a>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon assignments">
                                    <i class="fas fa-tasks"></i>
                                </div>
                                <div class="card-content">
                                    <h3>Assignments</h3>
                                    <div
                                        class="card-metric"
                                        id="assignmentsCount"
                                    >
                                        0
                                    </div>
                                    <p>Active assignments</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#assignments"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('assignments')"
                                >
                                    <i class="fas fa-plus"></i> Create
                                    Assignment
                                </a>
                            </div>
                        </div>

                        {% else %}

                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon assignments">
                                    <i class="fas fa-tasks"></i>
                                </div>
                                <div class="card-content">
                                    <h3>My Tasks</h3>
                                    <div
                                        class="card-metric"
                                        id="myAssignmentsCount"
                                    >
                                        0
                                    </div>
                                    <p>Active assignments</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#assignments"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('assignments')"
                                >
                                    <i class="fas fa-eye"></i> View Tasks
                                </a>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <div class="card-icon meetings">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="card-content">
                                    <h3>Upcoming Events</h3>
                                    <div
                                        class="card-metric"
                                        id="upcomingEventsCount"
                                    >
                                        0
                                    </div>
                                    <p>This month</p>
                                </div>
                            </div>
                            <div class="dashboard-card-actions">
                                <a
                                    href="#schedule"
                                    class="btn btn-primary btn-sm"
                                    onclick="openTab('schedule')"
                                >
                                    <i class="fas fa-calendar"></i> View Events
                                </a>
                            </div>
                        </div>

                        {% endif %}
                    </div>
                </section>

                <section id="stream" class="club-section fade-in">
                    <div class="section-header">
                        <h2><i class="fas fa-stream"></i> Stream</h2>
                        <p>Club announcements and updates</p>
                    </div>

                    {% if effective_can_manage %}
                    <div class="post-composer">
                        <div class="post-composer-header">
                            <h3>
                                <i class="fas fa-pen"></i> Create Announcement
                            </h3>
                            <div class="markdown-toggle">
                                <button
                                    type="button"
                                    class="btn btn-sm btn-outline-secondary"
                                    id="markdownPreviewBtn"
                                    onclick="toggleMarkdownPreview()"
                                >
                                    <i class="fas fa-eye"></i> Preview
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-sm btn-outline-info"
                                    onclick="showMarkdownHelp()"
                                >
                                    <i class="fas fa-question-circle"></i>
                                    Markdown Help
                                </button>
                            </div>
                        </div>
                        <div class="post-composer-body">
                            <div class="markdown-editor">
                                <textarea
                                    id="postContent"
                                    placeholder="Write your announcement in **Markdown**!

## Features you can use:
- **Bold text** with **asterisks**
- *Italic text* with *single asterisks*
- `Code snippets` with backticks
- [Links](https://example.com)
- > Blockquotes
- - Bullet lists
- 1. Numbered lists

```javascript
// Code blocks with syntax highlighting
console.log('Hello, world!');
```"
                                    style="
                                        min-height: 150px;
                                        font-family:
                                            &quot;Courier New&quot;, monospace;
                                    "
                                ></textarea>
                                <div
                                    id="markdownPreview"
                                    class="markdown-preview"
                                    style="
                                        display: none;
                                        min-height: 150px;
                                        border: 1px solid #dee2e6;
                                        border-radius: 0.375rem;
                                        padding: 0.75rem;
                                        background: #f8f9fa;
                                        margin-top: 0.5rem;
                                    "
                                >
                                    <em>Preview will appear here...</em>
                                </div>
                            </div>
                            <div class="post-composer-actions">
                                <small
                                    class="text-muted"
                                    style="margin-right: auto"
                                >
                                    <i class="fab fa-markdown"></i> Markdown
                                    supported
                                </small>
                                <button
                                    class="btn btn-primary"
                                    onclick="createPost()"
                                >
                                    <i class="fas fa-paper-plane"></i> Post
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="posts-list" id="postsList">
                        <div class="empty-state">
                            <i class="fas fa-stream"></i>
                            <h3>No posts yet</h3>
                            <p>
                                Be the first to share something with your club!
                            </p>
                        </div>
                    </div>
                </section>

                <section id="assignments" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2>
                                <i class="fas fa-tasks"></i> {% if
                                current_user.id == club.leader_id or
                                is_co_leader %}Assignments{% else %}My
                                Assignments{% endif %}
                            </h2>
                            <p>
                                {% if current_user.id == club.leader_id or
                                is_co_leader %}Coding challenges and tasks for
                                club members{% else %}Complete these coding
                                challenges and tasks{% endif %}
                            </p>
                        </div>
                        {% if effective_can_manage %}
                        <button
                            class="btn btn-primary"
                            onclick="openCreateAssignmentModal()"
                        >
                            <i class="fas fa-plus"></i> New Assignment
                        </button>
                        {% endif %}
                    </div>

                    <div id="assignmentsList">
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>No assignments yet</h3>
                            <p>
                                {% if current_user.id == club.leader_id or
                                is_co_leader %}Create your first assignment to
                                get started!{% else %}Your leaders will assign
                                coding challenges soon!{% endif %}
                            </p>
                        </div>
                    </div>
                </section>

                <section id="attendance" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2>
                                <i class="fas fa-calendar-check"></i> {% if
                                current_user.id == club.leader_id or
                                is_co_leader %}Sessions & Attendance{% else
                                %}Club Events{% endif %}
                            </h2>
                            <p>
                                {% if current_user.id == club.leader_id or
                                is_co_leader %}Manage club sessions, track
                                attendance, and view analytics{% else %}View
                                upcoming events and your attendance history{%
                                endif %}
                            </p>
                        </div>
                        {% if current_user.id == club.leader_id or is_co_leader
                        %}
                        <div class="header-actions">
                            <button
                                class="btn btn-primary"
                                onclick="openCreateSessionModal()"
                            >
                                <i class="fas fa-calendar-plus"></i> Schedule
                                Meeting
                            </button>
                            <button
                                class="btn btn-secondary"
                                onclick="showAttendanceReports()"
                            >
                                <i class="fas fa-chart-bar"></i> Reports
                            </button>
                        </div>
                        {% endif %}
                    </div>


                    <div class="attendance-calendar-container">
                        <div class="calendar-header">
                            <button
                                class="btn-calendar-nav"
                                onclick="changeMonth(-1)"
                            >
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h3 id="calendar-month-year"></h3>
                            <button
                                class="btn-calendar-nav"
                                onclick="changeMonth(1)"
                            >
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="calendar-grid" id="attendance-calendar">

                        </div>
                    </div>


                    <div class="sessions-container">
                        <div class="sessions-header">
                            <h3>Upcoming Sessions</h3>
                            <div class="session-filters">
                                <select
                                    id="session-type-filter"
                                    onchange="filterSessions()"
                                >
                                    <option value="">All Types</option>
                                    <option value="meeting">Meeting</option>
                                    <option value="workshop">Workshop</option>
                                    <option value="event">Event</option>
                                    <option value="hackathon">Hackathon</option>
                                </select>
                                <input
                                    type="date"
                                    id="session-date-filter"
                                    onchange="filterSessions()"
                                />
                            </div>
                        </div>
                        <div class="sessions-list" id="sessions-list">

                        </div>
                    </div>


                </section>

                <section id="members" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-user-friends"></i> Members</h2>
                            <p>Manage your club members</p>
                        </div>
                    </div>

                    <div
                        class="members-search-container"
                        style="
                            margin-bottom: 2rem;
                            display: flex;
                            justify-content: center;
                        "
                    >
                        <div class="form-group">
                            <input
                                type="text"
                                id="membersSearchInput"
                                class="form-control"
                                placeholder="Search members by name or email..."
                            />
                        </div>
                    </div>

                    <div class="members-list">

                        <div class="member-card">
                            <div class="member-info">
                                <div class="member-avatar">
                                    {{ club.leader.username[0].upper() }}
                                </div>
                                <div class="member-details">
                                    <div class="member-name">
                                        {{ apply_member_cosmetics(club.id,
                                        club.leader.id,
                                        club.leader.username)|safe }}
                                    </div>
                                    <div class="member-email">
                                        {{ club.leader.email }}
                                    </div>
                                </div>
                            </div>
                            <div class="member-meta">
                                <div class="member-role-info">
                                    <span class="role-badge role-badge-leader">
                                        <i class="fas fa-crown"></i> Leader
                                    </span>
                                    <div class="member-joined">
                                        Joined {{
                                        club.created_at.strftime('%Y-%m-%d') }}
                                    </div>
                                </div>
                            </div>
                        </div>


                        {% for membership in club.members %} {% if
                        membership.role == 'co-leader' %}
                        <div class="member-card">
                            <div class="member-info">
                                <div class="member-avatar">
                                    {{ membership.user.username[0].upper() }}
                                </div>
                                <div class="member-details">
                                    <div class="member-name">
                                        {{ apply_member_cosmetics(club.id,
                                        membership.user.id,
                                        membership.user.username)|safe }}
                                    </div>
                                    <div class="member-email">
                                        {{ membership.user.email }}
                                    </div>
                                </div>
                            </div>
                            <div class="member-meta">
                                <div class="member-role-info">
                                    <span
                                        class="role-badge role-badge-co-leader"
                                    >
                                        <i class="fas fa-star"></i> Co-Leader
                                    </span>
                                    <div class="member-joined">
                                        Joined {{
                                        membership.joined_at.strftime('%Y-%m-%d')
                                        }}
                                    </div>
                                </div>
                                {% if club.leader_id == current_user.id %}
                                <div class="member-actions">
                                    <button
                                        class="btn-icon btn-icon-warning"
                                        data-user-id="{{ membership.user.id }}"
                                        data-username="{{ membership.user.username }}"
                                        onclick="removeCoLeader(this.dataset.userId, this.dataset.username)"
                                        title="Remove Co-Leader"
                                    >
                                        <i class="fas fa-minus-circle"></i>
                                    </button>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %} {% endfor %}


                        {% for membership in club.members %} {% if
                        membership.user.id != club.leader_id and membership.role
                        != 'co-leader' %}
                        <div class="member-card">
                            <div class="member-info">
                                <div class="member-avatar">
                                    {{ membership.user.username[0].upper() }}
                                </div>
                                <div class="member-details">
                                    <div class="member-name">
                                        {{ apply_member_cosmetics(club.id,
                                        membership.user.id,
                                        membership.user.username)|safe }}
                                    </div>
                                    <div class="member-email">
                                        {{ membership.user.email }}
                                    </div>
                                </div>
                            </div>
                            <div class="member-meta">
                                <div class="member-role-info">
                                    {% if membership.role == 'co-leader' %}
                                    <span
                                        class="role-badge role-badge-co-leader"
                                    >
                                        <i class="fas fa-star"></i> Co-Leader
                                    </span>
                                    {% else %}
                                    <span class="role-badge role-badge-member">
                                        <i class="fas fa-user"></i> Member
                                    </span>
                                    {% endif %}
                                    <div class="member-joined">
                                        Joined {{
                                        membership.joined_at.strftime('%Y-%m-%d')
                                        }}
                                    </div>
                                </div>
                                {% if club.leader_id == current_user.id %}
                                <div class="member-actions">
                                    {% if membership.role != 'co-leader' %}
                                    <button
                                        class="btn-icon btn-icon-success"
                                        data-user-id="{{ membership.user.id }}"
                                        data-username="{{ membership.user.username }}"
                                        onclick="promoteToCoLeader(this.dataset.userId, this.dataset.username)"
                                        title="Make Co-Leader"
                                    >
                                        <i class="fas fa-crown"></i>
                                    </button>
                                    {% endif %}
                                    <button
                                        class="btn-icon btn-icon-danger"
                                        data-user-id="{{ membership.user.id }}"
                                        data-username="{{ membership.user.username }}"
                                        onclick="confirmRemoveMember(this.dataset.userId, this.dataset.username)"
                                        title="Remove Member"
                                    >
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %} {% endfor %}
                    </div>
                </section>

                <section id="chat" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-comments"></i> Chat</h2>
                            <p>
                                Chat with your club members
                            </p>
                        </div>
                    </div>
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">

                        </div>
                        <div class="chat-input-area">
                            <div class="input-group">
                                <div class="input-wrapper">
                                    <input
                                        type="text"
                                        id="chatMessageInput"
                                        class="form-control"
                                        placeholder="Type your message or paste/upload an image..."
                                        maxlength="1000"
                                        disabled
                                    />
                                    <div class="input-actions">
                                        <button
                                            class="input-btn-icon"
                                            type="button"
                                            id="uploadImageButton"
                                            title="Upload image"
                                            disabled
                                        >
                                            <i class="fas fa-image"></i>
                                        </button>
                                        <input
                                            type="file"
                                            id="imageFileInput"
                                            accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                                            style="display: none"
                                        />
                                    </div>
                                </div>
                                <button
                                    class="btn btn-primary"
                                    type="button"
                                    id="sendChatMessage"
                                    disabled
                                >
                                    <i class="fas fa-paper-plane"></i> Send
                                </button>
                            </div>
                            <div
                                class="image-preview"
                                id="imagePreview"
                                style="display: none"
                            >
                                <div class="image-preview-container">
                                    <img
                                        id="previewImage"
                                        src=""
                                        alt="Image preview"
                                    />
                                    <button
                                        class="remove-image-btn"
                                        id="removeImagePreview"
                                        title="Remove image"
                                    >
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="chat-status" id="chatStatus">
                                Loading chat...
                            </div>
                        </div>
                    </div>
                </section>

                <section id="resources" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-link"></i> Resources</h2>
                            <p>Useful links and learning materials</p>
                        </div>
                        {% if effective_can_manage %}
                        <button
                            class="btn btn-primary"
                            onclick="openAddResourceModal()"
                        >
                            <i class="fas fa-plus"></i> Add Resource
                        </button>
                        {% endif %}
                    </div>

                    <div id="resourcesList">
                        <div class="empty-state">
                            <i class="fas fa-book"></i>
                            <h3>No resources yet</h3>
                            <p>
                                Add helpful links and learning materials for
                                your club!
                            </p>
                        </div>
                    </div>
                </section>

                {% if effective_can_manage %}
                <section id="advertising" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-bullhorn"></i> Advertising</h2>
                            <p>Create custom posters for your club with tons of new features!</p>
                        </div>
                        <div style="display: flex; gap: 0.75rem;">
                            <a
                                href="{{ url_for('poster_editor', club_id=club.id) }}"
                                class="btn btn-primary"
                                style="display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none;"
                                title="Open full-featured poster studio editor"
                            >
                                <i class="fas fa-magic"></i> Create a Poster
                            </a>
                        </div>
                    </div>

                    <div class="branding-section">
                        <div class="content-header">
                            <div>
                                <h3>
                                    <i class="fas fa-paint-brush"></i> Branding
                                    Resources
                                </h3>
                                <p>
                                    Official Hack Club branding materials and
                                    brand colors
                                </p>
                            </div>
                            <div class="branding-header-actions">
                                <a
                                    href="https://hackclub.com/branding"
                                    target="_blank"
                                    class="btn btn-sm btn-outline"
                                >
                                    <i class="fas fa-external-link-alt"></i>
                                    Full Brand Guide
                                </a>
                                <button
                                    class="btn btn-sm btn-primary"
                                    onclick="downloadAllBrandingAssets()"
                                >
                                    <i class="fas fa-download"></i> Download All
                                    Assets
                                </button>
                            </div>
                        </div>

                        <div class="branding-grid">

                            <div class="branding-item">
                                <div class="branding-preview">
                                    <img
                                        src="{{ url_for('static', filename='assets/flag-standalone.png') }}"
                                        alt="Hack Club Logos"
                                        class="logo-preview"
                                    />
                                </div>
                                <div class="branding-info">
                                    <h4>Hack Club Logos</h4>
                                    <p>
                                        Official Hack Club logos and flag
                                        designs
                                    </p>
                                    <button
                                        class="btn btn-sm"
                                        onclick="window.open('https://hackclub.com/branding', '_blank')"
                                    >
                                        <i class="fas fa-external-link-alt"></i>
                                        View All Logos
                                    </button>
                                </div>
                            </div>


                            <div class="branding-item">
                                <div class="branding-preview">
                                    <div class="color-palette">
                                        <div
                                            class="color-swatch"
                                            style="background: #ec3750"
                                            data-color="#ec3750"
                                            title="Red"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #ff8c37"
                                            data-color="#ff8c37"
                                            title="Orange"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #f1c40f"
                                            data-color="#f1c40f"
                                            title="Yellow"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #33d6a6"
                                            data-color="#33d6a6"
                                            title="Green"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #5bc0de"
                                            data-color="#5bc0de"
                                            title="Cyan"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #338eda"
                                            data-color="#338eda"
                                            title="Blue"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #a633d6"
                                            data-color="#a633d6"
                                            title="Purple"
                                        ></div>
                                        <div
                                            class="color-swatch"
                                            style="background: #8492a6"
                                            data-color="#8492a6"
                                            title="Muted"
                                        ></div>
                                    </div>
                                </div>
                                <div class="branding-info">
                                    <h4>Brand Colors</h4>
                                    <p>Official Hack Club color palette</p>
                                    <button
                                        class="btn btn-sm"
                                        onclick="showColorPalette()"
                                    >
                                        <i class="fas fa-palette"></i> View
                                        Colors
                                    </button>
                                </div>
                            </div>


                            <div class="branding-item">
                                <div class="branding-preview sticker-preview">
                                    <div class="sticker-sample">
                                        <img
                                            src="{{ url_for('static', filename='assets/stickers/CleanShot2025-01-28at12.55.412x.png') }}"
                                            alt="Sticker"
                                        />
                                        <img
                                            src="{{ url_for('static', filename='assets/stickers/CleanShot2025-01-28at12.56.342x.png') }}"
                                            alt="Sticker"
                                        />
                                        <img
                                            src="{{ url_for('static', filename='assets/stickers/CleanShot2025-01-28at12.57.062x.png') }}"
                                            alt="Sticker"
                                        />
                                        <span class="more-indicator"
                                            >+40 more</span
                                        >
                                    </div>
                                </div>
                                <div class="branding-info">
                                    <h4>Stickers</h4>
                                    <p>49+ official Hack Club stickers</p>
                                    <div class="sticker-buttons">
                                        <button
                                            class="btn btn-sm"
                                            onclick="openStickerLibrary()"
                                        >
                                            <i class="fas fa-images"></i> Browse
                                            & Download
                                        </button>
                                        <button
                                            class="btn btn-sm btn-outline"
                                            onclick="window.open('https://forms.hackclub.com/stickers', '_blank')"
                                        >
                                            <i class="fas fa-shopping-cart"></i>
                                            Order Stickers
                                        </button>
                                    </div>
                                </div>
                            </div>


                            <div class="branding-item">
                                <div class="branding-preview">
                                    <div class="poster-sample">
                                        <i
                                            class="fas fa-print"
                                            style="
                                                font-size: 2em;
                                                color: #338eda;
                                            "
                                        ></i>
                                        <div class="poster-formats">
                                            <span class="format-badge">A3</span>
                                            <span class="format-badge">A4</span>
                                            <span class="format-badge"
                                                >Custom</span
                                            >
                                        </div>
                                    </div>
                                </div>
                                <div class="branding-info">
                                    <h4>Posters</h4>
                                    <p>
                                        Browse digital posters and order prints
                                    </p>
                                    <div class="poster-buttons">
                                        <button
                                            class="btn btn-sm"
                                            onclick="openPosterLibrary()"
                                        >
                                            <i class="fas fa-images"></i> Browse
                                            & Download
                                        </button>
                                        <div class="order-buttons">
                                            <button
                                                class="btn btn-sm btn-outline"
                                                onclick="orderPosters('domestic')"
                                            >
                                                <i class="fas fa-truck"></i> USA
                                                & Canada
                                            </button>
                                            <button
                                                class="btn btn-sm btn-outline"
                                                onclick="orderPosters('international')"
                                            >
                                                <i class="fas fa-globe"></i>
                                                International
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                {% endif %}


                <div id="colorPaletteModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3><i class="fas fa-palette"></i> Brand Colors</h3>
                            <button
                                class="modal-close"
                                onclick="closeColorPalette()"
                            >
                                &times;
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>
                                Official Hack Club brand colors. Click to copy
                                hex codes.
                            </p>
                            <div class="color-palette-detailed">
                                <div
                                    class="color-item"
                                    onclick="copyColor('#ec3750')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #ec3750"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Red</strong>
                                        <code>#ec3750</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#ff8c37')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #ff8c37"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Orange</strong>
                                        <code>#ff8c37</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#f1c40f')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #f1c40f"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Yellow</strong>
                                        <code>#f1c40f</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#33d6a6')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #33d6a6"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Green</strong>
                                        <code>#33d6a6</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#5bc0de')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #5bc0de"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Cyan</strong>
                                        <code>#5bc0de</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#338eda')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #338eda"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Blue</strong>
                                        <code>#338eda</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#a633d6')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #a633d6"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Purple</strong>
                                        <code>#a633d6</code>
                                    </div>
                                </div>
                                <div
                                    class="color-item"
                                    onclick="copyColor('#8492a6')"
                                >
                                    <div
                                        class="color-preview"
                                        style="background: #8492a6"
                                    ></div>
                                    <div class="color-info">
                                        <strong>Muted</strong>
                                        <code>#8492a6</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button
                                class="btn btn-secondary"
                                onclick="closeColorPalette()"
                            >
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>
                    </div>
                </div>

                {% if economy_enabled and effective_can_manage %}
                <section id="transactions" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2>
                                <i class="fas fa-exchange-alt"></i> Transactions
                            </h2>
                            <p>
                                Track your club's token transactions and balance
                                history
                            </p>
                        </div>
                        <div class="balance-info">
                            <div class="current-balance">
                                <span class="balance-label"
                                    >Current Balance:</span
                                >
                                <span class="balance-amount">
                                    {{ (club.balance|float * 100)|int }} tokens
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="transactions-filters">
                        <div class="filter-group">
                            <label for="transactionTypeFilter"
                                >Filter by type:</label
                            >
                            <select
                                id="transactionTypeFilter"
                                class="form-control"
                            >
                                <option value="">All Types</option>
                                <option value="credit">Credits (+)</option>
                                <option value="debit">Debits (-)</option>
                                <option value="grant">Grants</option>
                                <option value="purchase">Purchases</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="transactionDateFilter"
                                >Date range:</label
                            >
                            <select
                                id="transactionDateFilter"
                                class="form-control"
                            >
                                <option value="">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="quarter">This Quarter</option>
                            </select>
                        </div>
                    </div>

                    <div id="transactionsList">
                        <div class="loading-state">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading transactions...</p>
                        </div>
                    </div>

                    <div
                        id="transactionsPagination"
                        class="pagination-container"
                        style="display: none"
                    >
                        <button
                            id="prevPage"
                            class="btn btn-secondary"
                            disabled
                        >
                            Previous
                        </button>
                        <span id="pageInfo">Page 1 of 1</span>
                        <button
                            id="nextPage"
                            class="btn btn-secondary"
                            disabled
                        >
                            Next
                        </button>
                    </div>
                </section>
                {% endif %} {% if economy_enabled %}
                <section id="piggy-bank" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2>
                                <i class="fas fa-piggy-bank"></i> Piggy Bank
                            </h2>
                            <p>
                                Your club's token savings from approved
                                projects. These tokens accumulate as a fund for
                                future withdrawals and special activities.
                            </p>
                        </div>
                    </div>

                    <div class="current-balance piggy-bank-balance">
                        <span class="balance-label">Piggy Bank Balance:</span>
                        <span class="balance-amount">
                            {{ club.piggy_bank_tokens or 0 }} tokens
                        </span>
                    </div>

                    <div class="piggy-bank-info">
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <div class="info-content">
                                <h3>How It Works</h3>
                                <p>
                                    Your club earns 100 tokens in the piggy bank
                                    for every approved project submission. These
                                    tokens are separate from your spending
                                    balance and accumulate over time.
                                </p>
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="info-content">
                                <h3>Track Your Progress</h3>
                                <p>
                                    Watch your piggy bank grow as your club
                                    members submit successful projects. Each
                                    approval adds to your long-term savings
                                    fund.
                                </p>
                            </div>
                        </div>

                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="info-content">
                                <h3>Quest Rewards</h3>
                                <p>
                                    Quest rewards are drawn from your piggy
                                    bank! Complete weekly quests to transfer 100
                                    tokens from here to your spending balance.
                                    Make sure you have enough saved up!
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="piggy-bank-transactions">
                        <div class="transactions-header">
                            <h3>
                                <i class="fas fa-history"></i> Piggy Bank
                                History
                            </h3>
                            <p>
                                Track all deposits and withdrawals from your
                                piggy bank
                            </p>
                        </div>

                        <div class="piggy-bank-filters">
                            <div class="filter-group">
                                <label for="piggyBankTypeFilter"
                                    >Filter by type:</label
                                >
                                <select
                                    id="piggyBankTypeFilter"
                                    class="form-control"
                                >
                                    <option value="">All Types</option>
                                    <option value="piggy_bank_credit">
                                        Deposits (+)
                                    </option>
                                    <option value="piggy_bank_debit">
                                        Withdrawals (-)
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table
                                class="table"
                                id="piggyBankTransactionsTable"
                            >
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Description</th>
                                        <th>Project</th>
                                    </tr>
                                </thead>
                                <tbody id="piggyBankTransactionsList">
                                    <tr>
                                        <td colspan="5" class="text-center">
                                            <div class="loading-spinner">
                                                <i
                                                    class="fas fa-spinner fa-spin"
                                                ></i>
                                                Loading piggy bank history...
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="pagination-controls">
                            <button
                                id="piggyBankPrevPage"
                                class="btn btn-secondary"
                                disabled
                            >
                                Previous
                            </button>
                            <span id="piggyBankPageInfo">Page 1 of 1</span>
                            <button
                                id="piggyBankNextPage"
                                class="btn btn-secondary"
                                disabled
                            >
                                Next
                            </button>
                        </div>
                    </div>
                </section>
                {% endif %} {% if economy_enabled and effective_can_manage %}
                <section id="quests" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-trophy"></i> Weekly Quests</h2>
                            <p>
                                Complete weekly challenges to transfer tokens
                                from your piggy bank to your spending balance
                            </p>
                            <div class="quest-explanation">
                                <div class="explanation-card">
                                    <i class="fas fa-info-circle"></i>
                                    <div class="explanation-content">
                                        <strong>How Quest Rewards Work:</strong>
                                        <p>
                                            Quest rewards are transferred from
                                            your club's piggy bank to your
                                            regular spending balance. If your
                                            piggy bank doesn't have enough
                                            tokens, you won't receive the
                                            reward. Build your piggy bank by
                                            submitting approved projects!
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="quests-container">
                        <div class="quest-card" data-quest-type="gallery_post">
                            <div class="quest-header">
                                <div class="quest-icon">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <div class="quest-info">
                                    <h3>Gallery Post Quest</h3>
                                    <p>
                                        Make a post to the gallery to showcase
                                        your club's work
                                    </p>
                                </div>
                                <div class="quest-reward">
                                    <div class="reward-amount">100 tokens</div>
                                    <div class="reward-source">
                                        from piggy bank
                                    </div>
                                </div>
                            </div>
                            <div class="quest-progress">
                                <div class="progress-bar">
                                    <div
                                        class="progress-fill"
                                        id="galleryProgress"
                                        style="width: 0%"
                                    ></div>
                                </div>
                                <div class="progress-text">
                                    <span id="galleryProgressText"
                                        >0/1 posts</span
                                    >
                                    <span
                                        id="galleryStatus"
                                        class="quest-status pending"
                                        >Pending</span
                                    >
                                </div>
                            </div>
                        </div>

                        <div
                            class="quest-card"
                            data-quest-type="member_projects"
                        >
                            <div class="quest-header">
                                <div class="quest-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="quest-info">
                                    <h3>Member Projects Quest</h3>
                                    <p>
                                        Get 5 different members to submit
                                        projects
                                    </p>
                                </div>
                                <div class="quest-reward">
                                    <div class="reward-amount">100 tokens</div>
                                    <div class="reward-source">
                                        from piggy bank
                                    </div>
                                </div>
                            </div>
                            <div class="quest-progress">
                                <div class="progress-bar">
                                    <div
                                        class="progress-fill"
                                        id="membersProgress"
                                        style="width: 0%"
                                    ></div>
                                </div>
                                <div class="progress-text">
                                    <span id="membersProgressText"
                                        >0/5 members</span
                                    >
                                    <span
                                        id="membersStatus"
                                        class="quest-status pending"
                                        >Pending</span
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="quest-info-box">
                        <div class="info-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="info-content">
                            <h4>How Weekly Quests Work</h4>
                            <ul>
                                <li>
                                    Quests reset every Monday at 12:00 AM UTC
                                </li>
                                <li>Complete quests to earn 100 tokens each</li>
                                <li>
                                    Progress is tracked automatically based on
                                    your club's activity
                                </li>
                                <li>
                                    Rewards are distributed immediately upon
                                    completion
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>
                {% endif %} {% if effective_can_manage %}
                {% endif %} {% if current_user.id == club.leader_id %}
                <section id="settings" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-cogs"></i> Settings</h2>
                            <p>Club settings and configuration</p>
                        </div>
                    </div>

                    <div class="card" style="{% if not is_connected_to_directory %}opacity: 0.6;{% endif %}">
                        <div class="card-header">
                            <h3>Club Information
                                {% if not is_connected_to_directory %}
                                <span style="background: #fbbf24; color: #78350f; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem;">
                                    <i class="fas fa-lock"></i> LOCKED
                                </span>
                                {% endif %}
                            </h3>
                        </div>
                        <div class="card-body">
                            {% if not is_connected_to_directory %}
                            <div
                                style="
                                    background: #fef3c7;
                                    border: 2px solid #fbbf24;
                                    border-radius: 8px;
                                    padding: 1rem;
                                    margin-bottom: 1.5rem;
                                "
                            >
                                <p
                                    style="
                                        margin: 0;
                                        color: #78350f;
                                        font-size: 0.9rem;
                                        font-weight: 600;
                                    "
                                >
                                    <i
                                        class="fas fa-lock"
                                        style="
                                            color: #f59e0b;
                                            margin-right: 0.5rem;
                                        "
                                    ></i>
                                    <strong>Feature Locked:</strong> This feature requires your club to be connected to the official Hack Club directory.<br><br>
                                    {% if current_user.id == club.leader_id %}
                                    <a href="{{ url_for('verify_leader') }}" style="color: #d97706; text-decoration: underline;">
                                        Connect your club now
                                    </a> to unlock editing club information.
                                    {% else %}
                                    Only the club leader can connect the club to the directory.
                                    {% endif %}
                                </p>
                            </div>
                            {% else %}

                            <div class="form-group">
                                <label class="form-label">Club ID</label>
                                <div
                                    class="form-control-static"
                                    style="
                                        background: #f8f9fa;
                                        border: 1px solid #dee2e6;
                                        padding: 0.375rem 0.75rem;
                                        border-radius: 0.375rem;
                                        display: flex;
                                        align-items: center;
                                        justify-content: space-between;
                                    "
                                >
                                    <span
                                        style="
                                            font-family:
                                                &quot;Courier New&quot;,
                                                monospace;
                                            font-weight: 600;
                                            color: #495057;
                                        "
                                        >{{ club.id }}</span
                                    >
                                    <button
                                        type="button"
                                        class="btn btn-sm btn-outline-secondary"
                                        onclick="copyClubId()"
                                        title="Copy Club ID"
                                    >
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <small class="form-text text-muted">
                                    <i class="fas fa-info-circle"></i>
                                    Use this ID for API requests and
                                    administrative operations
                                </small>
                            </div>

                            <form id="clubSettingsForm">
                                <div class="form-group">
                                    <label class="form-label">Club Name</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="clubName"
                                        value="{{ club.name }}"
                                    />
                                </div>
                                <div class="form-group">
                                    <label class="form-label"
                                        >Description</label
                                    >
                                    <textarea
                                        class="form-control"
                                        id="clubDescription"
                                        rows="3"
                                    >
{{ club.description or '' }}</textarea
                                    >
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Location</label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="clubLocation"
                                        value="{{ club.location or '' }}"
                                    />
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </div>

                    {% if current_user.id == club.leader_id %}

                    <div class="card" style="margin-top: 2rem; {% if not is_connected_to_directory %}opacity: 0.6;{% endif %}">
                        <div class="card-header">
                            <h3 style="color: #17a2b8">
                                <i class="fas fa-envelope"></i> Leader Email
                                {% if not is_connected_to_directory %}
                                <span style="background: #fbbf24; color: #78350f; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem;">
                                    <i class="fas fa-lock"></i> LOCKED
                                </span>
                                {% endif %}
                            </h3>
                            <p
                                style="
                                    margin: 0.5rem 0 0 0;
                                    color: #6b7280;
                                    font-size: 0.9rem;
                                "
                            >
                                Update the club leader email in Hack Club
                                records
                            </p>
                        </div>
                        <div class="card-body">
                            {% if not is_connected_to_directory %}
                            <div
                                style="
                                    background: #fef3c7;
                                    border: 2px solid #fbbf24;
                                    border-radius: 8px;
                                    padding: 1rem;
                                    margin-bottom: 1.5rem;
                                "
                            >
                                <p
                                    style="
                                        margin: 0;
                                        color: #78350f;
                                        font-size: 0.9rem;
                                        font-weight: 600;
                                    "
                                >
                                    <i
                                        class="fas fa-lock"
                                        style="
                                            color: #f59e0b;
                                            margin-right: 0.5rem;
                                        "
                                    ></i>
                                    <strong>Feature Locked:</strong> This feature requires your club to be connected to the official Hack Club directory.<br><br>
                                    <a href="{{ url_for('verify_leader') }}" style="color: #d97706; text-decoration: underline;">
                                        Connect your club now
                                    </a> to unlock this feature and sync your email with official records.
                                </p>
                            </div>
                            {% else %}
                            <div
                                style="
                                    background: #d1ecf1;
                                    border: 1px solid #bee5eb;
                                    border-radius: 8px;
                                    padding: 1rem;
                                    margin-bottom: 1.5rem;
                                "
                            >
                                <p
                                    style="
                                        margin: 0;
                                        color: #0c5460;
                                        font-size: 0.9rem;
                                    "
                                >
                                    <i
                                        class="fas fa-info-circle"
                                        style="
                                            color: #17a2b8;
                                            margin-right: 0.5rem;
                                        "
                                    ></i>
                                    <strong>Current dashboard email:</strong> {{
                                    current_user.email }}<br />
                                    This will update the leader email field in
                                    our official records to match your dashboard
                                    email if they're different. This is normally
                                    just for debug purposes.
                                </p>
                            </div>

                            <button
                                type="button"
                                class="btn btn-info"
                                onclick="updateClubEmail()"
                                id="updateEmailBtn"
                            >
                                <i class="fas fa-sync-alt"></i> Update Club
                                Email
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <div class="card" style="margin-top: 2rem; {% if not is_connected_to_directory %}opacity: 0.6;{% endif %}">
                        <div class="card-header">
                            <h3 style="color: #dc3545">
                                <i class="fas fa-crown"></i> Leadership Transfer
                                {% if not is_connected_to_directory %}
                                <span style="background: #fbbf24; color: #78350f; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 0.5rem;">
                                    <i class="fas fa-lock"></i> LOCKED
                                </span>
                                {% endif %}
                            </h3>
                            <p
                                style="
                                    margin: 0.5rem 0 0 0;
                                    color: #6b7280;
                                    font-size: 0.9rem;
                                "
                            >
                                Transfer club leadership to another member
                            </p>
                        </div>
                        <div class="card-body">
                            {% if not is_connected_to_directory %}
                            <div
                                style="
                                    background: #fef3c7;
                                    border: 2px solid #fbbf24;
                                    border-radius: 8px;
                                    padding: 1rem;
                                    margin-bottom: 1.5rem;
                                "
                            >
                                <p
                                    style="
                                        margin: 0;
                                        color: #78350f;
                                        font-size: 0.9rem;
                                        font-weight: 600;
                                    "
                                >
                                    <i
                                        class="fas fa-lock"
                                        style="
                                            color: #f59e0b;
                                            margin-right: 0.5rem;
                                        "
                                    ></i>
                                    <strong>Feature Locked:</strong> This feature requires your club to be connected to the official Hack Club directory.<br><br>
                                    {% if current_user.id == club.leader_id %}
                                    <a href="{{ url_for('verify_leader') }}" style="color: #d97706; text-decoration: underline;">
                                        Connect your club now
                                    </a> to unlock leadership transfer functionality.
                                    {% else %}
                                    Only the club leader can connect the club to the directory.
                                    {% endif %}
                                </p>
                            </div>
                            {% else %}
                            <div
                                style="
                                    background: #fff3cd;
                                    border: 1px solid #ffeaa7;
                                    border-radius: 8px;
                                    padding: 1rem;
                                    margin-bottom: 1.5rem;
                                "
                            >
                                <p
                                    style="
                                        margin: 0;
                                        color: #856404;
                                        font-size: 0.9rem;
                                    "
                                >
                                    <i
                                        class="fas fa-exclamation-triangle"
                                        style="
                                            color: #f39c12;
                                            margin-right: 0.5rem;
                                        "
                                    ></i>
                                    <strong>Warning:</strong> This action will
                                    permanently transfer club leadership. You
                                    will become a regular member.
                                </p>
                            </div>
                            <div class="form-group">
                                <label class="form-label"
                                    >Select New Leader</label
                                >
                                <select
                                    class="form-control"
                                    id="newLeaderSelect"
                                >
                                    <option value="">
                                        Choose a member to become the new leader
                                    </option>
                                    {% for membership in club.members %}
                                    <option value="{{ membership.user.id }}">
                                        {{ membership.user.username }} ({{
                                        membership.user.email }})
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <button
                                class="btn"
                                style="background-color: #dc3545; color: white"
                                onclick="initiateLeadershipTransfer()"
                            >
                                <i class="fas fa-exchange-alt"></i> Transfer
                                Leadership
                            </button>
                            {% endif %}
                        </div>
                    </div>

                    {% if current_user.id == club.leader_id and is_connected_to_directory %}
                    <div class="card" style="margin-top: 2rem">
                        <div class="card-header">
                            <h3 style="color: #dc3545">
                                <i class="fas fa-trash-alt"></i> Delete Club
                            </h3>
                            <p
                                style="
                                    margin: 0.5rem 0 0 0;
                                    color: #6b7280;
                                    font-size: 0.9rem;
                                "
                            >
                                Permanently delete this club from the dashboard
                            </p>
                        </div>
                        <div class="card-body">
                            <div
                                style="
                                    background: #fff3cd;
                                    border: 1px solid #ffeaa7;
                                    border-radius: 8px;
                                    padding: 1rem;
                                    margin-bottom: 1.5rem;
                                "
                            >
                                <p
                                    style="
                                        margin: 0;
                                        color: #856404;
                                        font-size: 0.9rem;
                                    "
                                >
                                    <i
                                        class="fas fa-exclamation-triangle"
                                        style="
                                            color: #f39c12;
                                            margin-right: 0.5rem;
                                        "
                                    ></i>
                                    <strong>Warning:</strong> Unlinking your club will remove the "Onboarded to Dashboard" status in Airtable and <strong style="color: #dc3545;">permanently delete</strong> your club from the dashboard, including all data, members, posts, and economy data. You will need to reconnect and recreate the club to access dashboard features again.
                                </p>
                            </div>
                            <button
                                class="btn"
                                style="background-color: #dc3545; color: white"
                                onclick="initiateUnlinkClub()"
                            >
                                <i class="fas fa-trash-alt"></i> Delete Club from Dashboard
                            </button>
                        </div>
                    </div>
                    {% endif %}

                    <div class="card" style="margin-top: 2rem">
                        <div class="card-header">
                            <h3 style="color: #8b5cf6">
                                <i class="fas fa-image"></i> Background
                                Customization
                            </h3>
                            <p
                                style="
                                    margin: 0.5rem 0 0 0;
                                    color: #6b7280;
                                    font-size: 0.9rem;
                                "
                            >
                                Customize your club's background image
                            </p>
                        </div>
                        <div class="card-body">

                            <div class="form-group">
                                <label class="form-label"
                                    >Current Background</label
                                >
                                <div
                                    id="currentBackgroundPreview"
                                    style="
                                    width: 100%;
                                    height: 200px;
                                    border: 2px dashed #dee2e6;
                                    border-radius: 8px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    background-size: cover;
                                    background-position: center;
                                    background-repeat: no-repeat;
                                    {% if club.background_image_url %}
                                    background-image: url('{{ club.background_image_url }}');
                                    {% else %}
                                    background-color: #f8f9fa;
                                    {% endif %}
                                "
                                >
                                    {% if not club.background_image_url %}
                                    <div
                                        style="
                                            text-align: center;
                                            color: #6c757d;
                                        "
                                    >
                                        <i
                                            class="fas fa-image"
                                            style="
                                                font-size: 3rem;
                                                margin-bottom: 1rem;
                                            "
                                        ></i>
                                        <p>No background image set</p>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>


                            <div class="form-group">
                                <label class="form-label"
                                    >Upload Background Image</label
                                >
                                <div
                                    style="
                                        background: #e3f2fd;
                                        border: 1px solid #bbdefb;
                                        border-radius: 8px;
                                        padding: 1rem;
                                        margin-bottom: 1rem;
                                    "
                                >
                                    <p
                                        style="
                                            margin: 0;
                                            color: #1565c0;
                                            font-size: 0.9rem;
                                        "
                                    >
                                        <i
                                            class="fas fa-info-circle"
                                            style="margin-right: 0.5rem"
                                        ></i>
                                        <strong>Tips:</strong> Best results with
                                        landscape images (16:9 ratio). Max file
                                        size: 10MB.
                                    </p>
                                </div>
                                <input
                                    type="file"
                                    class="form-control"
                                    id="backgroundUpload"
                                    accept="image/png,image/jpg,image/jpeg,image/gif,image/webp"
                                    style="margin-bottom: 1rem"
                                />
                                <button
                                    type="button"
                                    class="btn btn-primary"
                                    onclick="uploadBackgroundImage()"
                                    id="uploadBackgroundBtn"
                                >
                                    <i class="fas fa-upload"></i> Upload
                                    Background
                                </button>
                            </div>




                            {% if club.background_image_url %}
                            <div
                                class="form-group"
                                style="
                                    border-top: 1px solid #dee2e6;
                                    padding-top: 1rem;
                                    margin-top: 1.5rem;
                                "
                            >
                                <button
                                    type="button"
                                    class="btn btn-outline-danger"
                                    onclick="removeBackground()"
                                    id="removeBackgroundBtn"
                                >
                                    <i class="fas fa-trash-alt"></i> Remove
                                    Background
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </section>
                {% endif %}

                <!-- Team Notes Section -->
                {% if current_user.has_permission('clubs.view_team_notes') or current_user.id == club.leader_id or is_co_leader or current_user.is_admin %}
                <section id="team-notes" class="club-section fade-in">
                    <div class="content-header">
                        <div>
                            <h2><i class="fas fa-sticky-note"></i> Team Notes</h2>
                            <p>Internal notes for club leaders and administrators</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Team Notes</h3>
                        </div>
                        <div class="card-body">
                            <div
                                style="
                                    background: #e3f2fd;
                                    border: 1px solid #bbdefb;
                                    border-radius: 8px;
                                    padding: 1rem;
                                    margin-bottom: 1.5rem;
                                "
                            >
                                <p
                                    style="
                                        margin: 0;
                                        color: #1565c0;
                                        font-size: 0.9rem;
                                        font-weight: 600;
                                    "
                                >
                                    <i
                                        class="fas fa-info-circle"
                                        style="
                                            color: #1976d2;
                                            margin-right: 0.5rem;
                                        "
                                    ></i>
                                    <strong>Private Notes:</strong> These notes are visible only to club leaders, co-leaders, and administrators. They sync with Airtable's "Team Notes" field.
                                </p>
                            </div>

                            <form id="teamNotesForm">
                                <div class="form-group">
                                    <label class="form-label">Notes</label>
                                    <textarea
                                        class="form-control"
                                        id="teamNotesContent"
                                        rows="10"
                                        placeholder="Add internal notes about your club here..."
                                        {% if not (current_user.has_permission('clubs.edit_team_notes') or current_user.id == club.leader_id or is_co_leader or current_user.is_admin) %}disabled{% endif %}
                                    >{{ club.team_notes or '' }}</textarea>
                                    <small class="form-text text-muted">
                                        <i class="fas fa-info-circle"></i>
                                        Use this space for planning, meeting notes, important reminders, or any internal club information.
                                    </small>
                                </div>
                                {% if current_user.has_permission('clubs.edit_team_notes') or current_user.id == club.leader_id or is_co_leader or current_user.is_admin %}
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Team Notes
                                </button>
                                {% endif %}
                            </form>

                            <div id="teamNotesStatus" style="margin-top: 1rem;"></div>
                        </div>
                    </div>
                </section>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div
    id="toastContainer"
    class="toast-container"
    style="position: fixed; bottom: 20px; right: 20px; z-index: 9999"
></div>


<div id="deleteChatMessageModal" class="modal" style="display: none">
    <div class="modal-content">
        <div class="modal-header error">
            <h3>
                <i class="fas fa-exclamation-triangle"></i>
                Delete Message
            </h3>
            <button
                onclick="closeModal('deleteChatMessageModal')"
                class="modal-close"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p>
                Are you sure you want to delete this message? This action cannot
                be undone.
            </p>
            <div class="message-preview" id="deleteMessagePreview">

            </div>
        </div>
        <div class="modal-footer">
            <button
                onclick="closeModal('deleteChatMessageModal')"
                class="btn-modal btn-secondary"
            >
                Cancel
            </button>
            <button id="confirmDeleteMessage" class="btn-modal btn-danger">
                <i class="fas fa-trash"></i> Delete Message
            </button>
        </div>
    </div>
</div>


<div id="removeBackgroundModal" class="modal" style="display: none">
    <div class="modal-content">
        <div class="modal-header error">
            <h3>
                <i class="fas fa-exclamation-triangle"></i>
                Remove Background
            </h3>
            <button
                onclick="closeModal('removeBackgroundModal')"
                class="modal-close"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p>
                Are you sure you want to remove the custom background image?
                This will restore the default dinosaur background and cannot be
                undone.
            </p>
        </div>
        <div class="modal-footer">
            <button
                onclick="closeModal('removeBackgroundModal')"
                class="btn-modal btn-secondary"
            >
                Cancel
            </button>
            <button id="confirmRemoveBackground" class="btn-modal btn-danger">
                <i class="fas fa-trash-alt"></i> Remove Background
            </button>
        </div>
    </div>
</div>


<div id="unlinkClubModal" class="modal" style="display: none">
    <div class="modal-content">
        <div class="modal-header error">
            <h3>
                <i class="fas fa-exclamation-triangle"></i>
                Unlink and Delete Club
            </h3>
            <button
                onclick="closeModal('unlinkClubModal')"
                class="modal-close"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p>
                Are you sure you want to unlink this club from the dashboard? This action will:
            </p>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li>Remove the "Onboarded to Dashboard" status in Airtable</li>
                <li><strong style="color: #dc3545;">Permanently delete the club from the dashboard</strong></li>
                <li>Remove all club data, members, posts, and economy data</li>
                <li>Require you to reconnect and recreate the club to access dashboard features again</li>
            </ul>
            <p style="color: #dc3545; font-weight: 600;">
                This action cannot be undone!
            </p>
        </div>
        <div class="modal-footer">
            <button
                onclick="closeModal('unlinkClubModal')"
                class="btn-modal btn-secondary"
            >
                Cancel
            </button>
            <button id="confirmUnlinkClub" class="btn-modal btn-danger">
                <i class="fas fa-trash-alt"></i> Delete Club
            </button>
        </div>
    </div>
</div>


<div id="editChatMessageModal" class="modal" style="display: none">
    <div class="modal-content">
        <div class="modal-header primary">
            <h3>
                <i class="fas fa-edit"></i>
                Edit Message
            </h3>
            <button
                onclick="closeModal('editChatMessageModal')"
                class="modal-close"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="editMessageContent">Message</label>
                <textarea
                    class="form-control"
                    id="editMessageContent"
                    rows="4"
                    maxlength="1000"
                    placeholder="Edit your message..."
                ></textarea>
                <div class="character-count">
                    <span id="editCharacterCount">0</span>/1000 characters
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button
                onclick="closeModal('editChatMessageModal')"
                class="btn-modal btn-secondary"
            >
                Cancel
            </button>
            <button id="confirmEditMessage" class="btn-modal btn-primary">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </div>
    </div>
</div>


<div id="qrModal" class="modal qr-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-qrcode"></i> Join {{ club.name }}</h3>
            <button
                class="close"
                onclick="document.getElementById('qrModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body" style="text-align: center">
            <div class="qr-code-container">
                <div
                    id="qrcode"
                    style="
                        display: flex;
                        justify-content: center;
                        margin-bottom: 1rem;
                    "
                ></div>
                <p style="margin-bottom: 1rem; color: #6b7280">
                    Scan this QR code to join the club
                </p>
                <div
                    class="join-url-box"
                    style="display: flex; gap: 0.5rem; margin-top: 1rem"
                >
                    <input
                        type="text"
                        id="joinUrl"
                        readonly
                        style="
                            flex: 1;
                            padding: 0.5rem;
                            border: 1px solid #e2e8f0;
                            border-radius: 6px;
                            font-size: 0.875rem;
                        "
                    />
                    <button
                        class="btn btn-secondary btn-sm"
                        onclick="copyJoinUrl()"
                    >
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<div id="joinCodeModal" class="modal join-code-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-key"></i> Club Join Code</h3>
            <button
                class="close"
                onclick="document.getElementById('joinCodeModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body" style="text-align: center">
            <div class="join-code-display-large">
                <p style="margin-bottom: 1rem; color: #6b7280; font-size: 1.1rem;">
                    Share this code with people who want to join {{ club.name }}
                </p>
                <div class="join-code-big">
                    {{ club.join_code }}
                </div>
                <p style="margin-top: 1rem; color: #6b7280; font-size: 0.95rem;">
                    Have them visit <strong>hack.club/join</strong> and enter this code
                </p>
                <button
                    class="btn btn-secondary"
                    onclick="copyJoinCode()"
                    style="margin-top: 1.5rem;"
                >
                    <i class="fas fa-copy"></i> Copy Join Code
                </button>
            </div>
        </div>
    </div>
</div>

<div id="createAssignmentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create Assignment</h3>
            <button
                class="close"
                onclick="document.getElementById('createAssignmentModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <form id="createAssignmentForm">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input
                        type="text"
                        class="form-control"
                        id="assignmentTitle"
                        required
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea
                        class="form-control"
                        id="assignmentDescription"
                        rows="4"
                        required
                    ></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Due Date (Optional)</label>
                    <input
                        type="date"
                        class="form-control"
                        id="assignmentDueDate"
                    />
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="assignmentForAll" checked />
                        For all members
                    </label>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('createAssignmentModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="createAssignment()">
                <i class="fas fa-plus"></i> Create Assignment
            </button>
        </div>
    </div>
</div>

<div id="createMeetingModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Schedule Meeting</h3>
            <button
                class="close"
                onclick="document.getElementById('createMeetingModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <form id="createMeetingForm">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input
                        type="text"
                        class="form-control"
                        id="meetingTitle"
                        required
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea
                        class="form-control"
                        id="meetingDescription"
                        rows="3"
                    ></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input
                        type="date"
                        class="form-control"
                        id="meetingDate"
                        required
                    />
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Start Time</label>
                            <input
                                type="time"
                                class="form-control"
                                id="meetingStartTime"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">End Time</label>
                            <input
                                type="time"
                                class="form-control"
                                id="meetingEndTime"
                            />
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input
                        type="text"
                        class="form-control"
                        id="meetingLocation"
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">Meeting Link (Optional)</label>
                    <input
                        type="url"
                        class="form-control"
                        id="meetingLink"
                        placeholder="https://..."
                    />
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('createMeetingModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="createMeeting()">
                <i class="fas fa-calendar-plus"></i> Schedule Meeting
            </button>
        </div>
    </div>
</div>

<div id="addResourceModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Resource</h3>
            <button
                class="close"
                onclick="document.getElementById('addResourceModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <form id="addResourceForm">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input
                        type="text"
                        class="form-control"
                        id="resourceTitle"
                        required
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input
                        type="url"
                        class="form-control"
                        id="resourceUrl"
                        required
                    />
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea
                        class="form-control"
                        id="resourceDescription"
                        rows="3"
                    ></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Icon</label>
                    <select class="form-control" id="resourceIcon">
                        <option value="book">Book</option>
                        <option value="link">Link</option>
                        <option value="video">Video</option>
                        <option value="code">Code</option>
                        <option value="file-alt">Article</option>
                        <option value="graduation-cap">Tutorial</option>
                        <option value="external-link-alt">External</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('addResourceModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="addResource()">
                <i class="fas fa-plus"></i> Add Resource
            </button>
        </div>
    </div>
</div>

<div id="transferLeadershipModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="color: #dc3545">
                <i class="fas fa-crown"></i> Transfer Leadership
            </h3>
            <button
                class="close"
                onclick="document.getElementById('transferLeadershipModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body">
            <div
                style="
                    background: #f8d7da;
                    border: 1px solid #f5c6cb;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                "
            >
                <p style="margin: 0; color: #721c24; font-weight: 600">
                    <i
                        class="fas fa-exclamation-triangle"
                        style="color: #dc3545; margin-right: 0.5rem"
                    ></i>
                    Are you sure you want to transfer leadership?
                </p>
            </div>
            <p style="margin-bottom: 1rem; color: #495057">
                You are about to transfer leadership of
                <strong>{{ club.name }}</strong> to:
            </p>
            <div
                style="
                    background: #e9ecef;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                "
            >
                <div style="display: flex; align-items: center; gap: 0.75rem">
                    <div
                        style="
                            width: 40px;
                            height: 40px;
                            background: #6c757d;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            font-weight: bold;
                        "
                        id="newLeaderAvatar"
                    >
                        ?
                    </div>
                    <div>
                        <div
                            style="font-weight: 600; color: #212529"
                            id="newLeaderName"
                        >
                            Select a member
                        </div>
                        <div
                            style="font-size: 0.875rem; color: #6c757d"
                            id="newLeaderEmail"
                        ></div>
                    </div>
                </div>
            </div>
            <div
                style="
                    background: #fff3cd;
                    border: 1px solid #ffeaa7;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1.5rem;
                "
            >
                <p style="margin: 0; color: #856404; font-size: 0.9rem">
                    <i
                        class="fas fa-info-circle"
                        style="color: #f39c12; margin-right: 0.5rem"
                    ></i>
                    After transfer, you will become a regular member and will no
                    longer have leader privileges.
                </p>
            </div>
            <div class="form-group">
                <label class="form-label">Type "TRANSFER" to confirm:</label>
                <input
                    type="text"
                    class="form-control"
                    id="transferConfirmationInput"
                    placeholder="Type TRANSFER to confirm"
                />
            </div>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('transferLeadershipModal').style.display='none'"
            >
                Cancel
            </button>
            <button
                id="confirmTransferButton"
                class="btn"
                style="background-color: #dc3545; color: white"
                onclick="confirmLeadershipTransfer()"
                disabled
            >
                <i class="fas fa-exchange-alt"></i> Transfer Leadership
            </button>
        </div>
    </div>
</div>


<div id="stickerLibraryModal" class="modal">
    <div class="modal-content large">
        <div class="modal-header">
            <h3><i class="fas fa-images"></i> Stickers</h3>
            <button class="modal-close" onclick="closeStickerLibrary()">
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p>
                Download official Hack Club stickers for your projects and
                posters.
            </p>
            <div class="sticker-library-grid" id="stickerLibraryGrid">

            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeStickerLibrary()">
                <i class="fas fa-times"></i> Close
            </button>
            <button class="btn btn-primary" onclick="downloadAllStickers()">
                <i class="fas fa-download"></i> Download All as ZIP
            </button>
        </div>
    </div>
</div>


<div id="posterLibraryModal" class="modal">
    <div class="modal-content large">
        <div class="modal-header">
            <h3><i class="fas fa-images"></i> Posters</h3>
            <button class="modal-close" onclick="closePosterLibrary()">
                &times;
            </button>
        </div>
        <div class="modal-body">
            <p>Download official Hack Club posters for your club.</p>
            <div class="poster-library-grid" id="posterLibraryGrid">

            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closePosterLibrary()">
                <i class="fas fa-times"></i> Close
            </button>
            <button class="btn btn-primary" onclick="downloadAllPosters()">
                <i class="fas fa-download"></i> Download All as ZIP
            </button>
        </div>
    </div>
</div>

<div id="purchaseRequestModal" class="modal">
    <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
            <h3>Request Purchase</h3>
            <button
                class="close"
                onclick="document.getElementById('purchaseRequestModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto">
            <form id="purchaseRequestForm">
                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label"
                                >Leader First Name *</label
                            >
                            <input
                                type="text"
                                class="form-control"
                                id="leaderFirstName"
                                value="{{ current_user.first_name or '' }}"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Leader Last Name *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="leaderLastName"
                                value="{{ current_user.last_name or '' }}"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Leader Email *</label>
                    <input
                        type="email"
                        class="form-control"
                        id="leaderEmail"
                        value="{{ current_user.email }}"
                        required
                    />
                </div>

                <div class="form-group">
                    <label class="form-label">Club Name</label>
                    <input
                        type="text"
                        class="form-control"
                        id="clubName"
                        value="{{ club.name }}"
                        readonly
                        style="background-color: #f8f9fa"
                    />
                </div>

                <div class="form-group">
                    <label class="form-label">Purchase Type *</label>
                    <select class="form-control" id="purchaseType" required>
                        <option value="">Select purchase type</option>
                        <option value="Pizza/Food">Pizza/Food</option>
                        <option value="Software">Software</option>
                        <option value="Hardware">Hardware</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Purchase Description *</label>
                    <textarea
                        class="form-control"
                        id="purchaseDescription"
                        rows="3"
                        placeholder="Describe what you want to purchase and how it will benefit the club"
                        required
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Purchase Reason *</label>
                    <textarea
                        class="form-control"
                        id="purchaseReason"
                        rows="2"
                        placeholder="Why does your club need this?"
                        required
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Amount *</label>
                    <div style="position: relative">
                        <input
                            type="number"
                            class="form-control"
                            id="purchaseAmount"
                            step="0.01"
                            min="0.01"
                            placeholder="0.00"
                            required
                            style="padding-left: 1.5rem"
                        />
                        <span
                            style="
                                position: absolute;
                                left: 0.5rem;
                                top: 50%;
                                transform: translateY(-50%);
                                color: #6b7280;
                            "
                            >$</span
                        >
                    </div>
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Available tokens:
                        <span id="purchaseBalanceDisplay"
                            >{{ (club.balance|float * 100)|int }}</span
                        >
                        tokens ></small
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">Fulfillment Method *</label>
                    <select
                        class="form-control"
                        id="fulfillmentMethod"
                        required
                    >
                        <option value="">Select fulfillment method</option>
                        <option value="Card Grant">Card Grant</option>
                        <option value="HCB Transfer">HCB Transfer</option>
                        <option value="Reimbursement">Reimbursement</option>
                    </select>
                    <small style="color: #64748b; font-size: 0.875rem"
                        >How you want to receive/use the funds</small
                    >
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('purchaseRequestModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="submitPurchaseRequest()">
                <i class="fas fa-paper-plane"></i> Submit Request
            </button>
        </div>
    </div>
</div>

<div id="cardGrantModal" class="modal">
    <div class="modal-content" style="max-width: 800px">
        <div class="modal-header">
            <h3>Submit Project for Card Grant</h3>
            <button
                class="close"
                onclick="document.getElementById('cardGrantModal').style.display='none'"
            >
                &times;
            </button>
        </div>
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto">
            <form id="cardGrantForm">
                <div class="form-group">
                    <label class="form-label">Select Club Member *</label>
                    <select
                        class="form-control"
                        id="grantMemberSelect"
                        onchange="loadMemberHackatimeProjects()"
                        required
                    >
                        <option value="{{ current_user.id }}">
                            {{ current_user.username }} (You)
                        </option>
                        {% if club.leader_id == current_user.id %} {% for
                        membership in club.members %}
                        <option value="{{ membership.user.id }}">
                            {{ membership.user.username }}
                        </option>
                        {% endfor %} {% endif %}
                    </select>
                    {% if club.leader_id == current_user.id %}
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Club leaders can submit grants on behalf of
                        members</small
                    >
                    {% endif %}
                </div>

                <div class="form-group">
                    <label class="form-label">Select Your Project *</label>
                    <select
                        class="form-control"
                        id="grantProjectSelect"
                        required
                    >
                        <option value="">Select your project</option>
                    </select>
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Only projects tracked on Hackatime are shown
                        here</small
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">Project Description *</label>
                    <textarea
                        class="form-control"
                        id="grantDescription"
                        rows="3"
                        placeholder="Briefly describe what you built and what you learned"
                        required
                    ></textarea>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">GitHub URL *</label>
                            <input
                                type="url"
                                class="form-control"
                                id="grantGithubUrl"
                                placeholder="https://github.com/username/repository"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Live URL *</label>
                            <input
                                type="url"
                                class="form-control"
                                id="grantLiveUrl"
                                placeholder="https://example.com"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Upload Screenshot *</label>
                    <input
                        type="file"
                        class="form-control"
                        id="grantScreenshot"
                        accept="image/*"
                        required
                    />
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Upload a screenshot of your project. The image will be
                        uploaded to our database and the URL will be used for
                        submission.</small
                    >
                </div>

                <div class="form-group">
                    <div
                        style="
                            background: #fef3c7;
                            border: 1px solid #f59e0b;
                            border-radius: 8px;
                            padding: 1rem;
                            margin-bottom: 1rem;
                        "
                    >
                        <h4
                            style="
                                color: #92400e;
                                margin: 0 0 0.5rem 0;
                                font-size: 1rem;
                                display: flex;
                                align-items: center;
                                gap: 0.5rem;
                            "
                        >
                            <i class="fas fa-exclamation-triangle"></i> Meeting
                            Requirements
                        </h4>
                        <p style="color: #92400e; margin: 0; font-size: 0.9rem">
                            To be eligible for grants, this project must have
                            been worked on during an in-person club meeting, and
                            your club must have at least 3 members.
                        </p>
                    </div>
                    <div class="form-check" style="margin-top: 1rem">
                        <input
                            type="checkbox"
                            class="form-check-input"
                            id="grantInPersonMeeting"
                            required
                        />
                        <label
                            class="form-check-label"
                            for="grantInPersonMeeting"
                        >
                            <strong
                                >I confirm this project was worked on during an
                                in-person club meeting *</strong
                            >
                        </label>
                    </div>
                    <small style="color: #64748b; font-size: 0.875rem"
                        >Virtual meetings are not eligible for grants. Your club
                        currently has {{ club.members|length + 1 }}
                        member(s).</small
                    >
                </div>

                <div class="form-group">
                    <label class="form-label"
                        >What did you learn about while making this project?
                        *</label
                    >
                    <textarea
                        class="form-control"
                        id="grantLearning"
                        rows="3"
                        placeholder="Share what you learned while making your project!"
                        required
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">What are we doing well? *</label>
                    <textarea
                        class="form-control"
                        id="grantDoingWell"
                        rows="2"
                        placeholder="What do you like about Hack Club Spaces?"
                        required
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">How can we improve? *</label>
                    <textarea
                        class="form-control"
                        id="grantImprove"
                        rows="2"
                        placeholder="How can we make Hack Club Spaces better?"
                        required
                    ></textarea>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">First Name *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantFirstName"
                                placeholder="Your first name"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Last Name *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantLastName"
                                placeholder="Your last name"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input
                                type="email"
                                class="form-control"
                                id="grantEmail"
                                placeholder="Your email address"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label class="form-label">Birthday *</label>
                            <input
                                type="date"
                                class="form-control"
                                id="grantBirthday"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Address Line 1 *</label>
                    <input
                        type="text"
                        class="form-control"
                        id="grantAddress1"
                        placeholder="Street address"
                        required
                    />
                </div>

                <div class="form-group">
                    <label class="form-label">Address Line 2</label>
                    <input
                        type="text"
                        class="form-control"
                        id="grantAddress2"
                        placeholder="Apt, Suite, Building (optional)"
                    />
                </div>

                <div class="row">
                    <div class="col-4">
                        <div class="form-group">
                            <label class="form-label">City *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantCity"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group">
                            <label class="form-label">State/Province *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantState"
                                required
                            />
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group">
                            <label class="form-label">ZIP/Postal Code *</label>
                            <input
                                type="text"
                                class="form-control"
                                id="grantZip"
                                required
                            />
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Country *</label>
                    <input
                        type="text"
                        class="form-control"
                        id="grantCountry"
                        required
                    />
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="document.getElementById('cardGrantModal').style.display='none'"
            >
                Cancel
            </button>
            <button class="btn btn-primary" onclick="submitCardGrant()">
                <i class="fas fa-paper-plane"></i> Submit Grant
            </button>
        </div>
    </div>
</div>
{% endblock %} {% block extra_scripts %}
<style>
    .dashboard-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 2rem;
        background: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.1) 0%,
            rgba(255, 255, 255, 0.05) 100%
        );
        border-radius: 20px;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
    }

    .art-submission-banner {
        background: linear-gradient(
            135deg,
            #ff6b35 0%,
            #f7931e 50%,
            #ffd700 100%
        );
        border-radius: 20px;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(255, 107, 53, 0.3);
        animation: bannerGlow 3s ease-in-out infinite;
    }

    @keyframes bannerGlow {
        0%,
        100% {
            box-shadow: 0 20px 40px rgba(255, 107, 53, 0.3);
            transform: translateY(0);
        }
        50% {
            box-shadow: 0 25px 50px rgba(255, 107, 53, 0.4);
            transform: translateY(-2px);
        }
    }

    .banner-content {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        padding: 1.5rem 2rem;
        position: relative;
        z-index: 2;
    }

    .banner-icon {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        backdrop-filter: blur(10px);
        animation: iconSpin 6s linear infinite;
        flex-shrink: 0;
    }

    @keyframes iconSpin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

    .banner-text {
        flex: 1;
        color: white;
    }

    .banner-text h3 {
        margin: 0 0 0.5rem 0;
        font-size: 1.4rem;
        font-weight: 700;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        animation: textFloat 2s ease-in-out infinite;
    }

    @keyframes textFloat {
        0%,
        100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-3px);
        }
    }

    .banner-text p {
        margin: 0;
        font-size: 1rem;
        opacity: 0.95;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .banner-cta {
        background: rgba(255, 255, 255, 0.95);
        color: #ff6b35;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        animation: ctaPulse 2s ease-in-out infinite;
        flex-shrink: 0;
    }

    @keyframes ctaPulse {
        0%,
        100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }

    .banner-cta:hover {
        background: white;
        transform: translateY(-2px) scale(1.1);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        color: #e55a2b;
    }

    .banner-decorations {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: 1;
    }

    .decoration {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        animation: decorationFloat 8s ease-in-out infinite;
    }

    .decoration-1 {
        width: 40px;
        height: 40px;
        top: 20%;
        right: 10%;
        animation-delay: 0s;
    }

    .decoration-2 {
        width: 60px;
        height: 60px;
        bottom: 15%;
        left: 15%;
        animation-delay: 2s;
    }

    .decoration-3 {
        width: 30px;
        height: 30px;
        top: 60%;
        right: 25%;
        animation-delay: 4s;
    }

    @keyframes decorationFloat {
        0%,
        100% {
            transform: translateY(0) rotate(0deg);
            opacity: 0.3;
        }
        50% {
            transform: translateY(-15px) rotate(180deg);
            opacity: 0.6;
        }
    }

    @media (max-width: 768px) {
        .banner-content {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
            padding: 1.5rem;
        }

        .banner-text h3 {
            font-size: 1.2rem;
        }

        .banner-text p {
            font-size: 0.9rem;
        }

        .banner-cta {
            align-self: stretch;
            justify-content: center;
        }
    }
</style>


<div id="tutorialOverlay" class="tutorial-overlay" style="display: none">
    <div class="tutorial-backdrop"></div>
    <div class="tutorial-bubble" id="tutorialBubble">
        <div class="tutorial-content">
            <div class="tutorial-header">
                <h3 id="tutorialTitle">Welcome to your Club Dashboard!</h3>
                <button class="tutorial-close" onclick="closeTutorial()">
                    &times;
                </button>
            </div>
            <div class="tutorial-body">
                <p id="tutorialText">
                    Let's take a quick tour of your club dashboard and show you
                    all the amazing features available.
                </p>
            </div>
            <div class="tutorial-footer">
                <div class="tutorial-progress">
                    <span id="tutorialStep">1</span> of
                    <span id="tutorialTotal">10</span>
                </div>
                <div class="tutorial-buttons">
                    <button
                        class="tutorial-btn tutorial-btn-secondary"
                        id="prevBtn"
                        onclick="previousStep()"
                        disabled
                    >
                        Previous
                    </button>
                    <button
                        class="tutorial-btn tutorial-btn-primary"
                        id="nextBtn"
                        onclick="nextStep()"
                    >
                        Next
                    </button>
                    <button
                        class="tutorial-btn tutorial-btn-primary"
                        id="finishBtn"
                        onclick="closeTutorial()"
                        style="display: none"
                    >
                        Finish
                    </button>
                </div>
            </div>
        </div>
        <div class="tutorial-arrow" id="tutorialArrow"></div>
    </div>
</div>


<style>
    .tutorial-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        pointer-events: none;
    }

    .tutorial-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        pointer-events: all;
    }

    .tutorial-bubble {
        position: absolute;
        background: #ffffff;
        border-radius: 12px;
        box-shadow:
            0 20px 25px -5px rgba(0, 0, 0, 0.1),
            0 10px 10px -5px rgba(0, 0, 0, 0.04);
        max-width: 400px;
        min-width: 300px;
        pointer-events: all;
        transform-origin: center center;
        animation: tutorialAppear 0.3s ease-out;
        border: 2px solid #ec3750;
    }

    @keyframes tutorialAppear {
        0% {
            opacity: 0;
            transform: scale(0.8) translateY(10px);
        }
        100% {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }

    .tutorial-content {
        padding: 0;
    }

    .tutorial-header {
        padding: 20px 20px 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .tutorial-header h3 {
        margin: 0;
        color: #1a202c;
        font-size: 1.25rem;
        font-weight: 600;
        line-height: 1.4;
        flex: 1;
        padding-right: 10px;
    }

    .tutorial-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #6b7280;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s ease;
        flex-shrink: 0;
    }

    .tutorial-close:hover {
        background: #f3f4f6;
        color: #374151;
    }

    .tutorial-body {
        padding: 15px 20px 20px 20px;
    }

    .tutorial-body p {
        margin: 0;
        color: #4b5563;
        line-height: 1.6;
        font-size: 0.95rem;
    }

    .tutorial-footer {
        padding: 0 20px 20px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .tutorial-progress {
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 500;
    }

    .tutorial-progress #tutorialStep {
        color: #ec3750;
        font-weight: 600;
    }

    .tutorial-buttons {
        display: flex;
        gap: 10px;
    }

    .tutorial-btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
        min-width: 80px;
    }

    .tutorial-btn-primary {
        background: #ec3750;
        color: white;
    }

    .tutorial-btn-primary:hover:not(:disabled) {
        background: #dc2626;
        transform: translateY(-1px);
    }

    .tutorial-btn-secondary {
        background: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
    }

    .tutorial-btn-secondary:hover:not(:disabled) {
        background: #e5e7eb;
    }

    .tutorial-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .tutorial-arrow {
        position: absolute;
        width: 16px;
        height: 16px;
        background: #ffffff;
        border: 2px solid #ec3750;
        transform: rotate(45deg);
        border-radius: 0 0 4px 0;
    }

    .tutorial-arrow.top {
        top: -10px;
        left: 50%;
        margin-left: -8px;
        border-top: none;
        border-left: none;
    }

    .tutorial-arrow.bottom {
        bottom: -10px;
        left: 50%;
        margin-left: -8px;
        border-bottom: none;
        border-right: none;
    }

    .tutorial-arrow.left {
        left: -10px;
        top: 50%;
        margin-top: -8px;
        border-left: none;
        border-bottom: none;
    }

    .tutorial-arrow.right {
        right: -10px;
        top: 50%;
        margin-top: -8px;
        border-right: none;
        border-top: none;
    }

    .tutorial-highlight {
        position: relative;
        z-index: 9999;
        box-shadow:
            0 0 0 4px rgba(236, 55, 80, 0.3),
            0 0 0 8px rgba(236, 55, 80, 0.1);
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .tutorial-highlight.club-header {
        position: sticky !important;
        top: 70px !important;
        z-index: 10000 !important;
    }

    .tutorial-highlight.sidebar-nav,
    .tutorial-highlight .nav-link {
        position: relative !important;
        z-index: 9998 !important;
    }

    .dashboard-sidebar.tutorial-highlight {
        position: sticky !important;
        top: 190px !important;
        z-index: 9998 !important;
    }

    .tutorial-pulse {
        animation: tutorialPulse 2s infinite;
    }

    @keyframes tutorialPulse {
        0%,
        100% {
            box-shadow:
                0 0 0 4px rgba(236, 55, 80, 0.3),
                0 0 0 8px rgba(236, 55, 80, 0.1);
        }
        50% {
            box-shadow:
                0 0 0 6px rgba(236, 55, 80, 0.4),
                0 0 0 12px rgba(236, 55, 80, 0.15);
        }
    }

    /* Grouped buttons container */
    .action-buttons-container {
        position: fixed;
        bottom: 20px;
        left: 20px;
        display: flex;
        flex-direction: column;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        padding: 16px;
        border-radius: 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Tutorial button styles */
    .tutorial-start-btn {
        background: #ec3750;
        color: white;
        border: none;
        border-radius: 50px;
        padding: 12px 20px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 140px;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(236, 55, 80, 0.3);
    }

    .tutorial-start-btn:hover {
        background: #dc2626;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(236, 55, 80, 0.4);
    }

    .tutorial-start-btn i {
        font-size: 1rem;
    }

    @media (max-width: 768px) {
        .tutorial-bubble {
            max-width: calc(100vw - 40px);
            min-width: auto;
        }

        .action-buttons-container {
            bottom: 15px;
            left: 15px;
            padding: 12px;
        }

        .tutorial-start-btn {
            padding: 10px 16px;
            font-size: 0.85rem;
            min-width: 120px;
        }
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script>
    // Make club data available globally
    window.clubData = {
        clubId: {{ club.id }},
        joinCode: '{{ club.join_code }}',
        isLeader: {{ 'true' if club.leader_id == current_user.id else 'false' }},
        balance: {{ club.balance|float }},
        name: '{{ club.name }}',
        economyEnabled: {{ 'true' if economy_enabled else 'false' }},
        isAdminAccess: {{ 'true' if is_admin_access else 'false' }}
    };

    // Make current user email and ID available globally
    window.currentUserEmail = '{{ current_user.email }}';
    window.currentUserId = {{ current_user.id }};

    // Helper function to add admin parameter to API URLs when needed
    window.buildApiUrl = function(url) {
        if (window.clubData && window.clubData.isAdminAccess) {
            const separator = url.includes('?') ? '&' : '?';
            return url + separator + 'admin=true';
        }
        return url;
    };

    // Make user role available globally
    window.userRole = '{% if current_user.id == club.leader_id %}leader{% elif is_co_leader %}co-leader{% elif is_admin_access %}admin{% else %}member{% endif %}';

    // Initialize club data for dash.js
    clubId = {{ club.id }};
    joinCode = '{{ club.join_code }}';


    // Tutorial System
    let currentTutorialStep = 0;
    let isFirstVisit = !localStorage.getItem('clubDashboardTutorialCompleted');

    const allTutorialSteps = [
        {
            title: "Welcome to your Club Dashboard! ",
            text: "This is your command center for managing your Hack Club. Let's explore all the amazing features available to you!",
            target: ".club-header",
            position: "bottom",
            action: null
        },
        {
            title: "Club Information",
            text: "Here you can see your club's basic info including location, creation date, and member count. This gives you a quick overview of your club.",
            target: ".club-details",
            position: "bottom",
            action: null
        },
        {
            title: "Join Code & Token Balance",
            text: "Your unique join code helps new members join your club, and you can see your current token balance here. Click the QR code button to share it easily!",
            target: ".club-actions",
            position: "left",
            action: null,
            requiresEconomy: true
        },
        {
            title: "Join Code",
            text: "Your unique join code helps new members join your club. Click the QR code button to share it easily!",
            target: ".club-actions",
            position: "left",
            action: null,
            requiresEconomy: false
        },
        {
            title: "Navigation Sidebar",
            text: "This sidebar contains all your dashboard sections. Each section provides different tools for managing your club effectively.",
            target: ".dashboard-sidebar",
            position: "right",
            action: null
        },
        {
            title: "Member Management",
            text: "Use these sections to manage your club members, assign tasks, and track member projects. Perfect for keeping everyone engaged!",
            target: "[data-section='members']",
            position: "right",
            action: () => document.querySelector("[data-section='members']").click()
        },
        {
            title: "Weekly Quests System ",
            text: "Complete weekly challenges to earn tokens! Post to the gallery or get members to submit projects. Quests reset every Monday!",
            target: "[data-section='quests']",
            position: "right",
            action: () => document.querySelector("[data-section='quests']").click(),
            requiresEconomy: true
        },
        {
            title: "Quest Progress Tracking",
            text: "Track your progress on weekly quests here. Each completed quest rewards your club with 100 tokens automatically!",
            target: ".quests-container",
            position: "top",
            action: null,
            requiresEconomy: true
        },
        {
            title: "Transaction History",
            text: "View all your club's token transactions here - quest rewards, purchases, and more. Keep track of your club's financial activity!",
            target: "[data-section='transactions']",
            position: "right",
            action: () => document.querySelector("[data-section='transactions']").click(),
            requiresEconomy: true
        },
        {
            title: "Club Shop ",
            text: "Leaders can spend tokens in the club shop! Let's visit the shop to see how to purchase items for your club.",
            target: ".shop-link",
            position: "right",
            action: null,
            isExternal: true,
            externalUrl: function() {
                const clubId = window.clubData ? window.clubData.clubId : clubId;
                return `/club/${clubId}/shop`;
            },
            requiresEconomy: true
        },
        {
            title: "Project Submissions",
            text: "Submit projects here to earn grants and contribute to your weekly quest progress. Great way to showcase your work!",
            target: ".project-link",
            position: "right",
            action: null,
            isExternal: true,
            requiresEconomy: true
        },
        {
            title: "Resources & Links",
            text: "Share helpful resources and links with your club members. Keep all your important materials organized in one place.",
            target: "[data-section='resources']",
            position: "right",
            action: () => document.querySelector("[data-section='resources']").click()
        },
        {
            title: "Schedule Management",
            text: "Plan and organize club meetings and events. Keep everyone informed about upcoming activities and deadlines.",
            target: "[data-section='schedule']",
            position: "right",
            action: () => document.querySelector("[data-section='schedule']").click()
        },
        {
            title: "Explore the Gallery! ",
            text: "Don't forget to check out the gallery to see amazing projects from clubs worldwide. You can also post your own work there!",
            target: ".dashboard-content",
            position: "top",
            action: null,
            isExternal: true,
            externalUrl: "/gallery",
            requiresEconomy: true
        },
        {
            title: "You're all set! ",
            text: window.clubData.economyEnabled ?
                "You now know the basics of your club dashboard! Use quests to earn tokens, shop for supplies, and showcase your projects. Happy hacking!" :
                "You now know the basics of your club dashboard! Manage your members, share resources, and organize events. Happy hacking!",
            target: ".dashboard-content",
            position: "top",
            action: () => document.querySelector("[data-section='dashboard']").click()
        }
    ];

    // Filter tutorial steps based on economy status
    const tutorialSteps = allTutorialSteps.filter(step => {
        if (step.requiresEconomy === true && !window.clubData.economyEnabled) {
            return false; // Skip economy-required steps when economy is disabled
        }
        if (step.requiresEconomy === false && window.clubData.economyEnabled) {
            return false; // Skip non-economy steps when economy is enabled (for steps with alternatives)
        }
        return true;
    });

    function startTutorial() {
        currentTutorialStep = 0;
        document.getElementById('tutorialOverlay').style.display = 'block';
        showTutorialStep(currentTutorialStep);
    }

    function showTutorialStep(stepIndex) {
        const step = tutorialSteps[stepIndex];
        const bubble = document.getElementById('tutorialBubble');
        const arrow = document.getElementById('tutorialArrow');

        // Update content
        document.getElementById('tutorialTitle').textContent = step.title;
        document.getElementById('tutorialText').textContent = step.text;
        document.getElementById('tutorialStep').textContent = stepIndex + 1;
        document.getElementById('tutorialTotal').textContent = tutorialSteps.length;

        // Update buttons
        document.getElementById('prevBtn').disabled = stepIndex === 0;

        // Handle external link steps
        if (step.isExternal) {
            if (step.externalUrl === "/gallery") {
                document.getElementById('nextBtn').textContent = 'Visit Gallery';
            } else if (typeof step.externalUrl === 'function') {
                document.getElementById('nextBtn').textContent = 'Visit Shop';
            } else {
                document.getElementById('nextBtn').textContent = 'Got it!';
            }
        } else {
            document.getElementById('nextBtn').textContent = 'Next';
        }

        document.getElementById('nextBtn').style.display = stepIndex === tutorialSteps.length - 1 ? 'none' : 'inline-block';
        document.getElementById('finishBtn').style.display = stepIndex === tutorialSteps.length - 1 ? 'inline-block' : 'none';

        // Clear previous highlights
        document.querySelectorAll('.tutorial-highlight').forEach(el => {
            el.classList.remove('tutorial-highlight', 'tutorial-pulse');
        });

        // Position bubble and highlight target
        setTimeout(() => {
            const targetElement = document.querySelector(step.target);
            if (targetElement) {
                targetElement.classList.add('tutorial-highlight', 'tutorial-pulse');

                // Special handling for sticky header
                if (step.target === '.club-header') {
                    targetElement.classList.add('club-header');
                }

                // Special handling for sidebar elements
                if (step.target === '.dashboard-sidebar' || step.target.includes('[data-section=')) {
                    if (step.target === '.dashboard-sidebar') {
                        targetElement.classList.add('sidebar-nav');
                    }
                }

                positionBubble(bubble, arrow, targetElement, step.position);

                // Execute step action
                if (step.action) {
                    setTimeout(step.action, 500);
                }
            } else {
                // If target element doesn't exist (e.g., economy features are disabled),
                // position the bubble in the center of the screen
                bubble.style.left = '50%';
                bubble.style.top = '50%';
                bubble.style.transform = 'translate(-50%, -50%)';
                arrow.style.display = 'none';
            }
        }, 100);
    }

    function positionBubble(bubble, arrow, target, position) {
        const targetRect = target.getBoundingClientRect();
        const bubbleRect = bubble.getBoundingClientRect();
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;

        // Reset arrow classes
        arrow.className = 'tutorial-arrow';

        let bubbleX, bubbleY, arrowClass;

        switch (position) {
            case 'top':
                bubbleX = targetRect.left + targetRect.width / 2 - bubbleRect.width / 2;
                bubbleY = targetRect.top - bubbleRect.height - 20;
                arrowClass = 'bottom';
                break;
            case 'bottom':
                bubbleX = targetRect.left + targetRect.width / 2 - bubbleRect.width / 2;
                bubbleY = targetRect.bottom + 20;
                arrowClass = 'top';
                break;
            case 'left':
                bubbleX = targetRect.left - bubbleRect.width - 20;
                bubbleY = targetRect.top + targetRect.height / 2 - bubbleRect.height / 2;
                arrowClass = 'right';
                break;
            case 'right':
                bubbleX = targetRect.right + 20;
                bubbleY = targetRect.top + targetRect.height / 2 - bubbleRect.height / 2;
                arrowClass = 'left';
                break;
        }

        // Keep bubble within viewport and below navbar
        const navbarHeight = 70; // Account for top navbar
        bubbleX = Math.max(20, Math.min(viewportWidth - bubbleRect.width - 20, bubbleX));
        bubbleY = Math.max(navbarHeight + 20, Math.min(viewportHeight - bubbleRect.height - 20, bubbleY));

        bubble.style.left = bubbleX + 'px';
        bubble.style.top = bubbleY + 'px';
        arrow.classList.add(arrowClass);
    }

    function nextStep() {
        const currentStep = tutorialSteps[currentTutorialStep];

        // Handle external navigation
        if (currentStep.isExternal && currentStep.externalUrl) {
            // Skip external navigation if it requires economy and economy is disabled
            if (currentStep.requiresEconomy && !window.clubData.economyEnabled) {
                // Skip this step and continue to next
                if (currentTutorialStep < tutorialSteps.length - 1) {
                    currentTutorialStep++;
                    showTutorialStep(currentTutorialStep);
                } else {
                    closeTutorial();
                }
                return;
            }

            // Store tutorial state
            localStorage.setItem('tutorialInProgress', 'true');
            localStorage.setItem('tutorialCurrentStep', currentTutorialStep + 1);
            // Navigate to external page
            const url = typeof currentStep.externalUrl === 'function' ? currentStep.externalUrl() : currentStep.externalUrl;
            window.location.href = url;
            return;
        }

        if (currentTutorialStep < tutorialSteps.length - 1) {
            currentTutorialStep++;
            showTutorialStep(currentTutorialStep);
        }
    }

    function previousStep() {
        if (currentTutorialStep > 0) {
            currentTutorialStep--;
            showTutorialStep(currentTutorialStep);
        }
    }

    function closeTutorial() {
        document.getElementById('tutorialOverlay').style.display = 'none';
        document.querySelectorAll('.tutorial-highlight').forEach(el => {
            el.classList.remove('tutorial-highlight', 'tutorial-pulse');
        });
        localStorage.setItem('clubDashboardTutorialCompleted', 'true');
        // Hide tutorial button after completion
        const startBtn = document.querySelector('.tutorial-start-btn');
        if (startBtn) startBtn.style.display = 'none';
    }

    // Handle keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (document.getElementById('tutorialOverlay').style.display === 'block') {
            if (e.key === 'ArrowRight' || e.key === 'Enter') {
                e.preventDefault();
                if (currentTutorialStep === tutorialSteps.length - 1) {
                    closeTutorial();
                } else {
                    nextStep();
                }
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                previousStep();
            } else if (e.key === 'Escape') {
                e.preventDefault();
                closeTutorial();
            }
        }
    });

    // Check for tutorial restoration on page load
    function checkTutorialRestore() {
        const tutorialInProgress = localStorage.getItem('tutorialInProgress');
        const savedStep = localStorage.getItem('tutorialCurrentStep');

        if (tutorialInProgress === 'true' && savedStep) {
            // Clear stored state
            localStorage.removeItem('tutorialInProgress');
            localStorage.removeItem('tutorialCurrentStep');

            // Resume tutorial from saved step
            currentTutorialStep = parseInt(savedStep);
            document.getElementById('tutorialOverlay').style.display = 'block';
            showTutorialStep(currentTutorialStep);
            return true;
        }
        return false;
    }

    // Auto-start tutorial for first-time visitors
    document.addEventListener('DOMContentLoaded', function() {
        // First check if we're restoring from another page
        if (!checkTutorialRestore()) {
            // If not restoring and it's first visit, start tutorial
            if (isFirstVisit) {
                setTimeout(startTutorial, 1000);
            }
        }
    });

    // Initialize custom background on page load
    document.addEventListener('DOMContentLoaded', function() {
        const dashboard = document.querySelector('.club-dashboard');
        if (dashboard && dashboard.dataset.hasBackground === 'true') {
            const backgroundUrl = dashboard.dataset.backgroundUrl;

            // Set the background image directly
            dashboard.style.backgroundImage = `url('${backgroundUrl}')`;
        }
    });

    // Add event listener for background removal confirmation
    document.addEventListener('DOMContentLoaded', function() {
        const confirmBtn = document.getElementById('confirmRemoveBackground');
        if (confirmBtn) {
            confirmBtn.addEventListener('click', confirmRemoveBackground);
        }
    });

    // Background Customization Functions
    function uploadBackgroundImage() {
        const fileInput = document.getElementById('backgroundUpload');
        const uploadBtn = document.getElementById('uploadBackgroundBtn');

        if (!fileInput.files || fileInput.files.length === 0) {
            showToast('error', 'Please select an image file first', 'No File Selected');
            return;
        }

        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append('image', file);

        // Disable button and show loading
        uploadBtn.disabled = true;
        uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';

        fetch(`/api/clubs/${clubId}/background`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('success', 'Background image uploaded successfully', 'Upload Complete');

                // Update preview
                const preview = document.getElementById('currentBackgroundPreview');
                preview.style.backgroundImage = `url('${data.background_url}')`;
                preview.innerHTML = ''; // Remove "no background" message

                // Update the main dashboard background immediately
                const dashboard = document.querySelector('.club-dashboard');
                dashboard.style.backgroundImage = `url('${data.background_url}')`;
                dashboard.setAttribute('data-has-background', 'true');
                dashboard.setAttribute('data-background-url', data.background_url);

                // Show remove button if it doesn't exist
                if (!document.getElementById('removeBackgroundBtn')) {
                    location.reload(); // Reload to show remove button
                }

                // Clear file input
                fileInput.value = '';
            } else {
                showToast('error', data.error || 'Failed to upload background image', 'Upload Failed');
            }
        })
        .catch(error => {
            console.error('Error uploading background:', error);
            showToast('error', 'Network error occurred while uploading', 'Upload Failed');
        })
        .finally(() => {
            // Re-enable button
            uploadBtn.disabled = false;
            uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Background';
        });
    }

    // Removed blur functionality

    // Removed blur settings function

    function removeBackground() {
        // Show the confirmation modal instead of browser alert
        showModal('removeBackgroundModal');
    }

    function confirmRemoveBackground() {
        // Close the modal first
        closeModal('removeBackgroundModal');

        const removeBtn = document.getElementById('removeBackgroundBtn');

        // Disable button and show loading
        removeBtn.disabled = true;
        removeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Removing...';

        fetch(`/api/clubs/${clubId}/background`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                remove_background: true
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('success', 'Background image removed successfully', 'Background Removed');

                // Update preview to show no background
                const preview = document.getElementById('currentBackgroundPreview');
                preview.style.backgroundImage = 'none';
                preview.style.backgroundColor = '#f8f9fa';
                preview.innerHTML = `
                    <div style="text-align: center; color: #6c757d;">
                        <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <p>No background image set</p>
                    </div>
                `;

                // Remove background and restore default dinos
                const dashboard = document.querySelector('.club-dashboard');

                if (dashboard) {
                    dashboard.style.backgroundImage = '';
                    dashboard.removeAttribute('data-has-background');
                    dashboard.removeAttribute('data-background-url');
                }

                // Reload page to hide remove button
                setTimeout(() => location.reload(), 1000);
            } else {
                showToast('error', data.error || 'Failed to remove background image', 'Remove Failed');
            }
        })
        .catch(error => {
            console.error('Error removing background:', error);
            showToast('error', 'Network error occurred while removing background', 'Remove Failed');
        })
        .finally(() => {
            // Re-enable button
            removeBtn.disabled = false;
            removeBtn.innerHTML = '<i class="fas fa-trash-alt"></i> Remove Background';
        });
    }

    // Join Code Modal Functions
    function showJoinCodeModal() {
        document.getElementById('joinCodeModal').style.display = 'block';
    }

    function copyJoinCode() {
        const joinCode = '{{ club.join_code }}';
        navigator.clipboard.writeText(joinCode).then(function() {
            // Show success message
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            btn.style.background = '#10b981';
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '';
            }, 2000);
        }).catch(function(err) {
            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = joinCode;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                btn.style.background = '#10b981';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy: ', err);
            }
            document.body.removeChild(textArea);
        });
    }
</script>


{% if current_user.id == club.leader_id %}
<div
    class="action-buttons-container"
    style="display: {{ 'none' if not session.get('show_tutorial', True) else 'flex' }};"
>
    <button
        class="feedback-btn"
        onclick="openFeedbackForm()"
        style="
            background: #eb144c;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(235, 20, 76, 0.3);
            margin-bottom: 12px;
        "
        onmouseover="this.style.background='#d1173d'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(235, 20, 76, 0.4)'"
        onmouseout="this.style.background='#EB144C'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(235, 20, 76, 0.3)'"
    >
        <i class="fas fa-comment"></i>
        Give Feedback
    </button>
    <button class="tutorial-start-btn" onclick="startTutorial()">
        <i class="fas fa-question-circle"></i>
        Take Tour
    </button>
</div>

<script>
    function openFeedbackForm() {
        // Open Fillout form in a new window/tab as fallback
        window.open(
            "https://forms.hackclub.com/pXZ4qwhTgEus",
            "_blank",
            "width=800,height=600,scrollbars=yes,resizable=yes",
        );
    }

    // Try to initialize Fillout widget after page load
    document.addEventListener("DOMContentLoaded", function () {
        // Check if Fillout script is loaded, if not, load it
        if (typeof window.Fillout === "undefined") {
            const script = document.createElement("script");
            script.src = "https://server.fillout.com/embed/v1/";
            script.async = true;
            document.head.appendChild(script);

            script.onload = function () {
                // Try to replace button with actual Fillout widget after script loads
                setTimeout(initializeFilloutWidget, 1000);
            };
        } else {
            initializeFilloutWidget();
        }
    });

    function initializeFilloutWidget() {
        try {
            const feedbackBtn = document.querySelector(".feedback-btn");
            if (feedbackBtn && window.Fillout) {
                // Create Fillout div
                const filloutDiv = document.createElement("div");
                filloutDiv.setAttribute("data-fillout-id", "pXZ4qwhTgEus");
                filloutDiv.setAttribute("data-fillout-embed-type", "standard");
                filloutDiv.setAttribute(
                    "data-fillout-button-text",
                    "Give Feedback",
                );
                filloutDiv.setAttribute("data-fillout-button-color", "#EB144C");
                filloutDiv.setAttribute("data-fillout-inherit-parameters", "");
                filloutDiv.setAttribute(
                    "data-fillout-domain",
                    "forms.hackclub.com",
                );
                filloutDiv.setAttribute("data-fillout-popup-size", "medium");
                filloutDiv.style.marginBottom = "12px";

                // Replace the button with Fillout widget
                feedbackBtn.parentNode.replaceChild(filloutDiv, feedbackBtn);

                // Reinitialize Fillout
                if (window.Fillout && window.Fillout.initializeWidgets) {
                    window.Fillout.initializeWidgets();
                }
            }
        } catch (error) {
            console.log(
                "Fillout widget initialization failed, keeping fallback button",
            );
        }
    }
</script>
{% endif %}


<script>
    // Branding Functions
    function downloadLogo() {
        const link = document.createElement("a");
        link.href = `${STATIC_URL}assets/flag-standalone.png`;
        link.download = "hack-club-logo.png";
        link.click();
    }

    function openStickerLibrary() {
        const modal = document.getElementById("stickerLibraryModal");
        const grid = document.getElementById("stickerLibraryGrid");

        // Clear existing content
        grid.innerHTML = "";

        // Load all stickers
        availableStickers.forEach((filename) => {
            const stickerItem = document.createElement("div");
            stickerItem.className = "sticker-library-item";
            stickerItem.innerHTML = `
            <img src="${STATIC_URL}assets/stickers/${filename}" alt="Sticker">
            <button class="download-btn" onclick="downloadSticker('${filename}')">
                <i class="fas fa-download"></i>
            </button>
        `;
            grid.appendChild(stickerItem);
        });

        modal.style.display = "flex";
    }

    function closeStickerLibrary() {
        document.getElementById("stickerLibraryModal").style.display = "none";
    }

    function downloadSticker(filename) {
        const link = document.createElement("a");
        link.href = `${STATIC_URL}assets/stickers/${filename}`;
        link.download = filename;
        link.click();
    }

    async function downloadAllStickers() {
        const zip = new JSZip();
        const progressText = document.createElement("div");
        progressText.style.position = "fixed";
        progressText.style.top = "50%";
        progressText.style.left = "50%";
        progressText.style.transform = "translate(-50%, -50%)";
        progressText.style.background = "rgba(0,0,0,0.8)";
        progressText.style.color = "white";
        progressText.style.padding = "20px";
        progressText.style.borderRadius = "8px";
        progressText.style.zIndex = "10001";
        progressText.textContent = "Preparing stickers... 0%";
        document.body.appendChild(progressText);

        try {
            const total = availableStickers.length;
            let completed = 0;

            for (const filename of availableStickers) {
                try {
                    const response = await fetch(
                        `${STATIC_URL}assets/stickers/${filename}`,
                    );
                    if (response.ok) {
                        const blob = await response.blob();
                        zip.file(filename, blob);
                    }
                    completed++;
                    progressText.textContent = `Downloading stickers... ${Math.round((completed / total) * 100)}%`;
                } catch (error) {
                    console.warn(
                        `Failed to download sticker: ${filename}`,
                        error,
                    );
                    completed++;
                    progressText.textContent = `Downloading stickers... ${Math.round((completed / total) * 100)}%`;
                }
            }

            progressText.textContent = "Creating ZIP file...";
            const zipBlob = await zip.generateAsync({ type: "blob" });

            const link = document.createElement("a");
            link.href = URL.createObjectURL(zipBlob);
            link.download = "hack-club-stickers.zip";
            link.click();

            URL.revokeObjectURL(link.href);
        } catch (error) {
            console.error("Error creating stickers ZIP:", error);
            alert("Failed to create stickers ZIP. Please try again.");
        } finally {
            document.body.removeChild(progressText);
        }
    }

    function openPosterLibrary() {
        const modal = document.getElementById("posterLibraryModal");
        const grid = document.getElementById("posterLibraryGrid");

        // Clear existing content
        grid.innerHTML = "";

        // Load all posters
        availablePosters.forEach((filename) => {
            const posterItem = document.createElement("div");
            posterItem.className = "poster-item";
            posterItem.innerHTML = `
            <img src="${STATIC_URL}assets/posters/${filename}" alt="Poster">
            <button class="download-btn" onclick="downloadPoster('${filename}')">
                <i class="fas fa-download"></i>
            </button>
        `;
            grid.appendChild(posterItem);
        });

        modal.style.display = "flex";
    }

    function closePosterLibrary() {
        document.getElementById("posterLibraryModal").style.display = "none";
    }

    function downloadPoster(filename) {
        const link = document.createElement("a");
        link.href = `${STATIC_URL}assets/posters/${filename}`;
        link.download = filename;
        link.click();
    }

    async function downloadAllPosters() {
        const zip = new JSZip();
        const progressText = document.createElement("div");
        progressText.style.position = "fixed";
        progressText.style.top = "50%";
        progressText.style.left = "50%";
        progressText.style.transform = "translate(-50%, -50%)";
        progressText.style.background = "rgba(0,0,0,0.8)";
        progressText.style.color = "white";
        progressText.style.padding = "20px";
        progressText.style.borderRadius = "8px";
        progressText.style.zIndex = "10001";
        progressText.textContent = "Preparing posters... 0%";
        document.body.appendChild(progressText);

        try {
            const total = availablePosters.length;
            let completed = 0;

            for (const filename of availablePosters) {
                try {
                    const response = await fetch(
                        `${STATIC_URL}assets/posters/${filename}`,
                    );
                    if (response.ok) {
                        const blob = await response.blob();
                        zip.file(filename, blob);
                    }
                    completed++;
                    progressText.textContent = `Downloading posters... ${Math.round((completed / total) * 100)}%`;
                } catch (error) {
                    console.warn(
                        `Failed to download poster: ${filename}`,
                        error,
                    );
                    completed++;
                    progressText.textContent = `Downloading posters... ${Math.round((completed / total) * 100)}%`;
                }
            }

            progressText.textContent = "Creating ZIP file...";
            const zipBlob = await zip.generateAsync({ type: "blob" });

            const link = document.createElement("a");
            link.href = URL.createObjectURL(zipBlob);
            link.download = "hack-club-posters.zip";
            link.click();

            URL.revokeObjectURL(link.href);
        } catch (error) {
            console.error("Error creating posters ZIP:", error);
            alert("Failed to create posters ZIP. Please try again.");
        } finally {
            document.body.removeChild(progressText);
        }
    }

    function downloadAllBrandingAssets() {
        const link = document.createElement("a");
        link.href = `${STATIC_URL}assets/branding-master-2025.zip`;
        link.download = "hack-club-branding-master-2025.zip";
        link.click();
    }

    function showColorPalette() {
        document.getElementById("colorPaletteModal").style.display = "flex";
    }

    function closeColorPalette() {
        document.getElementById("colorPaletteModal").style.display = "none";
    }

    function copyColor(color) {
        navigator.clipboard
            .writeText(color)
            .then(() => {
                // Show temporary notification
                const notification = document.createElement("div");
                notification.innerHTML = `Copied ${color} to clipboard`;
                notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 10000;
            font-weight: 500;
        `;
                document.body.appendChild(notification);

                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 2000);
            })
            .catch(() => {
                alert(`Color code: ${color}`);
            });
    }

    function orderPosters(type) {
        let url;
        if (type === "domestic") {
            url = "https://forms.hackclub.com/t/uzgyhTqvsFus";
        } else if (type === "international") {
            url = "https://forms.hackclub.com/intlposters";
        }

        if (url) {
            window.open(url, "_blank");
        }
    }

    // Copy Club ID to clipboard
    function copyClubId() {
        const clubId = "{{ club.id }}";
        navigator.clipboard
            .writeText(clubId)
            .then(function () {
                // Show success feedback
                const button = event.target.closest("button");
                const originalIcon = button.innerHTML;
                button.innerHTML =
                    '<i class="fas fa-check" style="color: #28a745;"></i>';
                button.title = "Copied!";

                // Reset after 2 seconds
                setTimeout(function () {
                    button.innerHTML = originalIcon;
                    button.title = "Copy Club ID";
                }, 2000);
            })
            .catch(function (err) {
                console.error("Could not copy text: ", err);
                // Fallback for older browsers
                const textArea = document.createElement("textarea");
                textArea.value = clubId;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand("copy");
                    // Button feedback is enough, no toast needed
                } catch (err) {
                    console.error("Failed to copy Club ID");
                }
                document.body.removeChild(textArea);
            });
    }

    // Function to show gallery post required message
    function showGalleryPostRequired() {
        showToast(
            "info",
            "Create a gallery post first to unlock this feature! Visit the Gallery page to get started.",
            5000,
        );
    }
</script>

<style>
    /* Locked feature styles */
    .locked-feature {
        opacity: 0.5;
        position: relative;
    }

    .locked-nav-item {
        opacity: 0.6;
        cursor: not-allowed !important;
        position: relative;
    }

    .locked-nav-item:hover {
        background-color: #f8f9fa !important;
        color: #6c757d !important;
    }

    .locked-badge {
        background: #dc3545;
        color: white;
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 10px;
        margin-left: 8px;
        font-weight: 500;
    }

    .locked-text {
        color: #ffff;
        font-size: 0.9rem;
    }

    .balance-display.locked-feature .locked-text {
        color: #6c757d;
        font-weight: normal;
    }

    .balance-display.locked-feature i.fa-lock {
        color: #dc3545;
        margin-right: 5px;
    }

    /* Quest explanation styles */
    .quest-explanation {
        margin-top: 1rem;
    }

    .explanation-card {
        background: #e3f2fd;
        border: 1px solid #2196f3;
        border-radius: 8px;
        padding: 1rem;
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .explanation-card i {
        color: #1976d2;
        font-size: 1.2rem;
        margin-top: 0.25rem;
        flex-shrink: 0;
    }

    .explanation-content {
        flex: 1;
    }

    .explanation-content strong {
        color: #1565c0;
        display: block;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    .explanation-content p {
        margin: 0;
        color: #424242;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    /* Quest reward source styling */
    .reward-source {
        font-size: 0.8rem;
        color: #666;
        margin-top: 0.25rem;
        font-style: italic;
    }
</style>

<script src="{{ url_for('static', filename='js/dash.js') }}"></script>

<script>
    // Markdown preview functions
    function toggleMarkdownPreview() {
        const content = document.getElementById("postContent").value;
        const preview = document.getElementById("markdownPreview");
        const btn = document.getElementById("markdownPreviewBtn");

        if (preview.style.display === "none") {
            // Show preview
            if (content.trim()) {
                // Convert markdown to HTML for preview (client-side basic conversion)
                preview.innerHTML = convertMarkdownToHTML(content);
            } else {
                preview.innerHTML = "<em>Nothing to preview...</em>";
            }
            preview.style.display = "block";
            btn.innerHTML = '<i class="fas fa-edit"></i> Edit';
        } else {
            // Hide preview
            preview.style.display = "none";
            btn.innerHTML = '<i class="fas fa-eye"></i> Preview';
        }
    }

    function convertMarkdownToHTML(markdown) {
        // Basic client-side markdown conversion for preview
        let html = markdown;

        // Headers
        html = html.replace(/^### (.*$)/gim, "<h3>$1</h3>");
        html = html.replace(/^## (.*$)/gim, "<h2>$1</h2>");
        html = html.replace(/^# (.*$)/gim, "<h1>$1</h1>");

        // Bold and italic
        html = html.replace(/\*\*(.*)\*\*/gim, "<strong>$1</strong>");
        html = html.replace(/\*(.*)\*/gim, "<em>$1</em>");

        // Code
        html = html.replace(/`([^`]*)`/gim, "<code>$1</code>");

        // Links
        html = html.replace(
            /\[([^\]]*)\]\(([^\)]*)\)/gim,
            '<a href="$2" target="_blank">$1</a>',
        );

        // Line breaks
        html = html.replace(/\n/gim, "<br>");

        // Blockquotes
        html = html.replace(/^> (.*$)/gim, "<blockquote>$1</blockquote>");

        // Lists (basic)
        html = html.replace(/^\- (.*$)/gim, "<li>$1</li>");
        html = html.replace(/^\d+\. (.*$)/gim, "<li>$1</li>");

        return html;
    }

    function showMarkdownHelp() {
        const helpContent = `
        <div style="text-align: left; line-height: 1.6;">
            <h4>Markdown Quick Reference</h4>
            <table style="width: 100%; border-collapse: collapse;">
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 0.5rem; font-family: monospace; background: #f8f9fa;">**bold**</td>
                    <td style="padding: 0.5rem;"><strong>bold</strong></td>
                </tr>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 0.5rem; font-family: monospace; background: #f8f9fa;">*italic*</td>
                    <td style="padding: 0.5rem;"><em>italic</em></td>
                </tr>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 0.5rem; font-family: monospace; background: #f8f9fa;">\`code\`</td>
                    <td style="padding: 0.5rem;"><code>code</code></td>
                </tr>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 0.5rem; font-family: monospace; background: #f8f9fa;"># Heading 1</td>
                    <td style="padding: 0.5rem;"><h1 style="margin: 0; font-size: 1.2em;">Heading 1</h1></td>
                </tr>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 0.5rem; font-family: monospace; background: #f8f9fa;">## Heading 2</td>
                    <td style="padding: 0.5rem;"><h2 style="margin: 0; font-size: 1.1em;">Heading 2</h2></td>
                </tr>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 0.5rem; font-family: monospace; background: #f8f9fa;">[Link](url)</td>
                    <td style="padding: 0.5rem;"><a href="#">Link</a></td>
                </tr>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 0.5rem; font-family: monospace; background: #f8f9fa;">- List item</td>
                    <td style="padding: 0.5rem;"> List item</td>
                </tr>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 0.5rem; font-family: monospace; background: #f8f9fa;">> Quote</td>
                    <td style="padding: 0.5rem; border-left: 3px solid #3b82f6; padding-left: 1rem; color: #6b7280;">Quote</td>
                </tr>
            </table>
            <p style="margin-top: 1rem; color: #6b7280; font-size: 0.875rem;">
                <strong>Pro tip:</strong> Use the Preview button to see how your markdown will look!
            </p>
        </div>
        `;

        showToast("info", helpContent, "Markdown Help");
    }

    // Function to update club email in Airtable
    function updateClubEmail() {
        const btn = document.getElementById("updateEmailBtn");
        const originalText = btn.innerHTML;

        // Disable button and show loading state
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';

        const clubId = document.querySelector(".club-dashboard").dataset.clubId;
        const currentUserEmail = "{{ current_user.email }}";

        fetch(`/api/clubs/${clubId}/update-email`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            credentials: "same-origin",
            body: JSON.stringify({
                email: currentUserEmail
            })
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast(
                        "success",
                        "Email updated successfully in Hack Club records!",
                        "Updated",
                    );
                    btn.innerHTML = '<i class="fas fa-check"></i> Updated!';
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 3000);
                } else {
                    const errorMsg = data.details ? `${data.error}: ${data.details}` : data.error;
                    throw new Error(errorMsg || "Failed to update email");
                }
            })
            .catch((error) => {
                console.error("Error updating email:", error);
                showToast(
                    "error",
                    error.message ||
                        "Failed to update email. Please try again.",
                    "Error",
                );
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
    }

    // Unlink Club from Dashboard Functions
    function initiateUnlinkClub() {
        openModal('unlinkClubModal');
    }

    document.addEventListener('DOMContentLoaded', function() {
        const confirmUnlinkBtn = document.getElementById('confirmUnlinkClub');
        if (confirmUnlinkBtn) {
            confirmUnlinkBtn.addEventListener('click', function() {
                unlinkClubFromDashboard();
            });
        }
    });

    function unlinkClubFromDashboard() {
        const btn = document.getElementById('confirmUnlinkClub');
        const originalText = btn.innerHTML;

        // Disable button and show loading state
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Unlinking...';

        const clubId = document.querySelector(".club-dashboard").dataset.clubId;

        fetch(`/api/clubs/${clubId}/unlink-dashboard`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            credentials: "same-origin"
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast(
                        "success",
                        "Club unlinked and deleted successfully! Redirecting...",
                        "Deleted",
                    );
                    // Redirect after a short delay
                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 1500);
                } else {
                    const errorMsg = data.details ? `${data.error}: ${data.details}` : data.error;
                    throw new Error(errorMsg || "Failed to unlink club");
                }
            })
            .catch((error) => {
                console.error("Error unlinking club:", error);
                showToast(
                    "error",
                    error.message ||
                        "Failed to unlink club. Please try again.",
                    "Error",
                );
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
    }

    // Attendance Management Functions
    let currentSession = null;
    let currentDate = new Date();
    let allMembers = [];
    let sessions = [];

    // Initialize attendance management
    function initAttendanceManagement() {
        loadMembers();
        loadSessions();
        renderCalendar();
    }

    // Calendar functions
    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        document.getElementById("calendar-month-year").textContent =
            `${new Intl.DateTimeFormat("en-US", { month: "long" }).format(currentDate)} ${year}`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        let calendarHTML = '<div class="calendar-weekdays">';
        const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        weekdays.forEach((day) => {
            calendarHTML += `<div class="weekday">${day}</div>`;
        });
        calendarHTML += '</div><div class="calendar-days">';

        // Empty cells for days before month starts
        for (let i = 0; i < firstDay; i++) {
            calendarHTML += '<div class="calendar-day empty"></div>';
        }

        // Days of the month
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const dateStr = date.toISOString().split("T")[0];
            const hasSession = sessions.some((s) => s.session_date === dateStr);
            const isToday = date.toDateString() === new Date().toDateString();

            calendarHTML += `
                <div class="calendar-day ${hasSession ? "has-session" : ""} ${isToday ? "today" : ""}"
                     onclick="selectDate('${dateStr}')">
                    <span class="day-number">${day}</span>
                    ${hasSession ? '<div class="session-indicator"></div>' : ""}
                </div>`;
        }

        calendarHTML += "</div>";
        document.getElementById("attendance-calendar").innerHTML = calendarHTML;
    }

    function changeMonth(direction) {
        currentDate.setMonth(currentDate.getMonth() + direction);
        renderCalendar();
    }

    function selectDate(dateStr) {
        const sessionsOnDate = sessions.filter(
            (s) => s.session_date === dateStr,
        );
        if (sessionsOnDate.length > 0) {
            showSessionsForDate(sessionsOnDate);
        } else {
            openCreateSessionModal(dateStr);
        }
    }

    // Session management
    function loadSessions() {
        fetch(`/api/clubs/${clubId}/attendance/sessions`)
            .then((response) => response.json())
            .then((data) => {
                sessions = data.sessions || [];
                renderSessionsList();
                renderCalendar();
            })
            .catch((error) => {
                console.error("Error loading sessions:", error);
                showToast("error", "Failed to load sessions");
            });
    }

    function renderSessionsList() {
        const container = document.getElementById("sessions-list");
        if (sessions.length === 0) {
            container.innerHTML =
                '<div class="empty-state">No sessions scheduled. Create your first session!</div>';
            return;
        }

        let html = "";
        sessions.forEach((session) => {
            const date = new Date(session.session_date);
            const isActive = session.is_active;
            const isPast = date < new Date().setHours(0, 0, 0, 0);

            html += `
                <div class="session-card ${isActive ? "active" : ""} ${isPast ? "past" : ""}">
                    <div class="session-header">
                        <h4>${session.title}</h4>
                        <div class="session-type">${session.session_type}</div>
                    </div>
                    <div class="session-details">
                        <div class="session-date">
                            <i class="fas fa-calendar"></i>
                            ${date.toLocaleDateString()}
                        </div>
                        ${
                            session.start_time
                                ? `
                            <div class="session-time">
                                <i class="fas fa-clock"></i>
                                ${session.start_time}${session.end_time ? ` - ${session.end_time}` : ""}
                            </div>
                        `
                                : ""
                        }
                        ${
                            session.location
                                ? `
                            <div class="session-location">
                                <i class="fas fa-map-marker-alt"></i>
                                ${session.location}
                            </div>
                        `
                                : ""
                        }
                    </div>
                    <div class="session-stats">
                        <span class="attendance-count">
                            <i class="fas fa-users"></i>
                            ${session.attendance_count} members
                        </span>
                        ${
                            session.guest_count > 0
                                ? `
                            <span class="guest-count">
                                <i class="fas fa-user-plus"></i>
                                ${session.guest_count} guests
                            </span>
                        `
                                : ""
                        }
                    </div>
                    <div class="session-actions">
                        <button class="btn btn-sm btn-success" onclick="manageAttendance(${session.id})">
                            <i class="fas fa-users"></i> Manage Attendance
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="viewSessionSummary(${session.id})">
                            <i class="fas fa-chart-line"></i> Summary
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="editSession(${session.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-sm btn-info" onclick="addSessionNotes(${session.id})">
                            <i class="fas fa-sticky-note"></i> Notes
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSession(${session.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        });

        container.innerHTML = html;
    }

    function openCreateSessionModal(preselectedDate = null) {
        const modal = document.getElementById("createSessionModal");
        if (preselectedDate) {
            document.getElementById("session-date").value = preselectedDate;
        }
        modal.style.display = "block";
    }

    function createSession() {
        const form = document.getElementById("createSessionForm");
        const formData = new FormData(form);
        const sessionData = Object.fromEntries(formData);

        fetch(`/api/clubs/${clubId}/attendance/sessions`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            credentials: "same-origin",
            body: JSON.stringify(sessionData),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast("success", "Session created successfully!");
                    closeModal("createSessionModal");
                    loadSessions();
                    form.reset();
                } else {
                    throw new Error(data.error || "Failed to create session");
                }
            })
            .catch((error) => {
                console.error("Error creating session:", error);
                showToast("error", error.message || "Failed to create session");
            });
    }

    // Member management
    function loadMembers() {
        fetch(`/api/clubs/${clubId}/members`)
            .then((response) => response.json())
            .then((data) => {
                allMembers = data.members || [];
            })
            .catch((error) => {
                console.error("Error loading members:", error);
            });
    }

    function searchMembers() {
        const query = document
            .getElementById("member-search")
            .value.toLowerCase();
        const resultsContainer = document.getElementById(
            "member-search-results",
        );

        if (query.length < 2) {
            resultsContainer.innerHTML = "";
            return;
        }

        const filteredMembers = allMembers.filter(
            (member) =>
                member.username.toLowerCase().includes(query) ||
                member.email.toLowerCase().includes(query),
        );

        let html = "";
        filteredMembers.slice(0, 5).forEach((member) => {
            html += `
                <div class="search-result-item" onclick="addMemberToSession(${member.id}, '${member.username}')">
                    <span class="member-name">${member.username}</span>
                    <span class="member-email">${member.email}</span>
                </div>
            `;
        });

        resultsContainer.innerHTML = html;
    }

    function addMemberToSession(userId, username) {
        if (!currentSession) return;

        fetch(
            `/api/clubs/${clubId}/attendance/sessions/${currentSession.id}/members`,
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                credentials: "same-origin",
                body: JSON.stringify({ user_id: userId, status: "present" }),
            },
        )
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast("success", `${username} marked as present`);
                    loadSessionAttendance();
                    document.getElementById("member-search").value = "";
                    document.getElementById("member-search-results").innerHTML =
                        "";
                } else {
                    throw new Error(data.error || "Failed to add member");
                }
            })
            .catch((error) => {
                console.error("Error adding member:", error);
                showToast("error", error.message || "Failed to add member");
            });
    }

    // Simplified session management
    function manageAttendance(sessionId) {
        // Get session data
        const session = sessions.find((s) => s.id === sessionId);
        if (!session) {
            showToast("error", "Session not found");
            return;
        }

        // Open a simple attendance management modal
        openAttendanceModal(session);
    }

    function openAttendanceModal(session) {
        // Set session info in modal
        document.getElementById("attendance-session-title").textContent =
            session.title;
        document.getElementById("attendance-session-date").textContent =
            new Date(session.session_date).toLocaleDateString();

        // Load current attendance for this session
        loadAttendanceForSession(session.id);

        // Show the modal
        document.getElementById("attendanceModal").style.display = "block";
    }

    function loadAttendanceForSession(sessionId) {
        // Load attendance data for the session
        fetch(
            `/api/clubs/${clubId}/attendance/sessions/${sessionId}/attendance`,
        )
            .then((response) => response.json())
            .then((data) => {
                renderSimpleAttendance(data.attendance || []);
            })
            .catch((error) => {
                console.error("Error loading attendance:", error);
                showToast("error", "Failed to load attendance data");
            });
    }

    function renderSimpleAttendance(attendance) {
        const container = document.getElementById("simple-attendance-grid");
        let html = "";

        attendance.forEach((record) => {
            html += `
                <div class="simple-attendance-item">
                    <div class="member-info">
                        <div class="member-name">${record.username}</div>
                        <div class="member-email">${record.user_email}</div>
                    </div>
                    <div class="attendance-toggle">
                        <button class="btn ${record.status === "present" ? "btn-success" : "btn-secondary"}"
                                onclick="toggleAttendance(${record.user_id}, '${record.status === "present" ? "absent" : "present"}')">
                            <i class="fas fa-${record.status === "present" ? "check" : "times"}"></i>
                            ${record.status === "present" ? "Present" : "Mark Present"}
                        </button>
                    </div>
                </div>
            `;
        });

        container.innerHTML =
            html ||
            '<div class="empty-state">No attendance records found</div>';
    }

    function loadSessionAttendance() {
        if (!currentSession) return;

        Promise.all([
            fetch(
                `/api/clubs/${clubId}/attendance/sessions/${currentSession.id}/attendance`,
            ),
            fetch(
                `/api/clubs/${clubId}/attendance/sessions/${currentSession.id}/guests`,
            ),
        ])
            .then((responses) => Promise.all(responses.map((r) => r.json())))
            .then(([attendanceData, guestsData]) => {
                renderMemberAttendance(attendanceData.attendance || []);
                renderGuestAttendance(guestsData.guests || []);
                updateAttendanceCounts();
            })
            .catch((error) => {
                console.error("Error loading attendance:", error);
                showToast("error", "Failed to load attendance data");
            });
    }

    function renderMemberAttendance(attendance) {
        const container = document.getElementById("members-attendance-grid");
        let html = "";

        attendance.forEach((record) => {
            html += `
                <div class="attendance-item ${record.status}">
                    <div class="member-info">
                        <div class="member-name">${record.username}</div>
                        <div class="member-email">${record.user_email}</div>
                    </div>
                    <div class="attendance-status">
                        <select onchange="updateAttendanceStatus(${record.id}, this.value)">
                            <option value="present" ${record.status === "present" ? "selected" : ""}>Present</option>
                            <option value="late" ${record.status === "late" ? "selected" : ""}>Late</option>
                            <option value="absent" ${record.status === "absent" ? "selected" : ""}>Absent</option>
                            <option value="excused" ${record.status === "excused" ? "selected" : ""}>Excused</option>
                        </select>
                    </div>
                    <div class="attendance-time">
                        ${record.check_in_time ? new Date(record.check_in_time).toLocaleTimeString() : "Not checked in"}
                    </div>
                    <div class="attendance-actions">
                        <button class="btn-sm btn-outline" onclick="addAttendanceNote(${record.id})">
                            <i class="fas fa-sticky-note"></i>
                        </button>
                        <button class="btn-sm btn-danger" onclick="removeAttendance(${record.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        });

        container.innerHTML =
            html || '<div class="empty-state">No members checked in yet</div>';
    }

    function renderGuestAttendance(guests) {
        const container = document.getElementById("guests-attendance-grid");
        let html = "";

        guests.forEach((guest) => {
            html += `
                <div class="attendance-item" data-guest-id="${guest.id}">
                    <div class="guest-info">
                        <div class="guest-name">${guest.name}</div>
                        <div class="guest-email">${guest.email || "No email"}</div>
                        ${guest.organization ? `<div class="guest-org">${guest.organization}</div>` : ""}
                    </div>
                    <div class="attendance-time">
                        ${guest.check_in_time ? new Date(guest.check_in_time).toLocaleTimeString() : "Not checked in"}
                    </div>
                    <div class="attendance-actions">
                        <button class="btn-sm btn-outline" onclick="editGuest(${guest.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-sm btn-danger" onclick="removeGuest(${guest.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        });

        container.innerHTML =
            html || '<div class="empty-state">No guests added yet</div>';
    }

    function updateAttendanceCounts() {
        const memberCount = document.querySelectorAll(
            "#members-attendance-grid .attendance-item",
        ).length;
        const guestCount = document.querySelectorAll(
            "#guests-attendance-grid .attendance-item",
        ).length;

        document.getElementById("members-count-badge").textContent =
            memberCount;
        document.getElementById("guests-count-badge").textContent = guestCount;
    }

    function switchAttendanceTab(tab) {
        // Update tab buttons
        document
            .querySelectorAll(".tab-btn")
            .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // Update tab content
        document
            .querySelectorAll(".tab-pane")
            .forEach((pane) => pane.classList.remove("active"));
        document.getElementById(`${tab}-attendance`).classList.add("active");
    }

    function openAddGuestModal() {
        document.getElementById("addGuestModal").style.display = "block";
    }

    function addGuest() {
        const form = document.getElementById("addGuestForm");
        const formData = new FormData(form);
        const guestData = Object.fromEntries(formData);

        fetch(
            `/api/clubs/${clubId}/attendance/sessions/${currentSession.id}/guests`,
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                credentials: "same-origin",
                body: JSON.stringify(guestData),
            },
        )
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast("success", "Guest added successfully!");
                    closeModal("addGuestModal");
                    loadSessionAttendance();
                    form.reset();
                } else {
                    throw new Error(data.error || "Failed to add guest");
                }
            })
            .catch((error) => {
                console.error("Error adding guest:", error);
                showToast("error", error.message || "Failed to add guest");
            });
    }

    function updateAttendanceStatus(recordId, status) {
        fetch(`/api/clubs/${clubId}/attendance/records/${recordId}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            credentials: "same-origin",
            body: JSON.stringify({ status: status }),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast("success", "Attendance updated");
                } else {
                    throw new Error(
                        data.error || "Failed to update attendance",
                    );
                }
            })
            .catch((error) => {
                console.error("Error updating attendance:", error);
                showToast(
                    "error",
                    error.message || "Failed to update attendance",
                );
            });
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
    }

    function showConfirmModal(title, message, type, onConfirm) {
        // Handle different parameter combinations for compatibility
        if (
            typeof title === "string" &&
            typeof message === "string" &&
            typeof type === "function"
        ) {
            // 3-parameter call: title is actually message, message is details, type is callback
            onConfirm = type;
            type = "primary";
        }

        // Use UniversalModal instead of old modal
        const modalType = type === "danger" ? "warning" : "confirm";
        UniversalModal.confirm(
            message,
            onConfirm,
            null,
            title
        );
    }

    // Reports functionality
    function showAttendanceReports() {
        document.getElementById("attendanceReportsModal").style.display =
            "block";
        loadAttendanceReports();
    }

    function loadAttendanceReports() {
        const reportType = document.getElementById("report-type-select").value;
        const startDate = document.getElementById("report-start-date").value;
        const endDate = document.getElementById("report-end-date").value;

        let url = `/api/clubs/${clubId}/attendance/reports?type=${reportType}`;
        if (startDate) url += `&start_date=${startDate}`;
        if (endDate) url += `&end_date=${endDate}`;

        fetch(url, {
            credentials: "same-origin",
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    renderReport(data.data, reportType);
                } else {
                    throw new Error(data.error || "Failed to load report");
                }
            })
            .catch((error) => {
                console.error("Error loading report:", error);
                showToast("error", error.message || "Failed to load report");
            });
    }

    function renderReport(data, reportType) {
        const container = document.getElementById("report-content");

        if (reportType === "summary") {
            let html = `
                <div class="report-summary">
                    <div class="summary-stats">
                        <div class="stat-card">
                            <h4>${data.summary.total_sessions}</h4>
                            <p>Total Sessions</p>
                        </div>
                        <div class="stat-card">
                            <h4>${data.summary.total_attendance}</h4>
                            <p>Total Attendance</p>
                        </div>
                        <div class="stat-card">
                            <h4>${data.summary.total_guests}</h4>
                            <p>Total Guests</p>
                        </div>
                        <div class="stat-card">
                            <h4>${data.summary.average_attendance}</h4>
                            <p>Avg Attendance</p>
                        </div>
                    </div>

                    <div class="member-stats-section">
                        <h3>Member Attendance Statistics</h3>
                        <div class="member-stats-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Member</th>
                                        <th>Sessions</th>
                                        <th>Present</th>
                                        <th>Late</th>
                                        <th>Absent</th>
                                        <th>Attendance Rate</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;

            data.member_stats.forEach((member) => {
                html += `
                    <tr>
                        <td>
                            <div class="member-info">
                                <div class="member-name">${member.username}</div>
                                <div class="member-email">${member.email}</div>
                            </div>
                        </td>
                        <td>${member.total_sessions}</td>
                        <td>${member.present}</td>
                        <td>${member.late}</td>
                        <td>${member.absent}</td>
                        <td>
                            <div class="attendance-rate ${member.attendance_rate >= 80 ? "good" : member.attendance_rate >= 60 ? "fair" : "poor"}">
                                ${member.attendance_rate}%
                            </div>
                        </td>
                    </tr>
                `;
            });

            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="session-types-section">
                        <h3>Session Types</h3>
                        <div class="session-types-chart">
            `;

            Object.entries(data.session_types).forEach(([type, count]) => {
                html += `
                    <div class="session-type-item">
                        <span class="type-name">${type}</span>
                        <span class="type-count">${count}</span>
                    </div>
                `;
            });

            html += `
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }
    }

    function exportAttendance() {
        const format = prompt("Export format (csv or json):", "csv");
        if (!format) return;

        const startDate = prompt(
            "Start date (YYYY-MM-DD, leave blank for all):",
        );
        const endDate = prompt("End date (YYYY-MM-DD, leave blank for all):");

        let url = `/api/clubs/${clubId}/attendance/export?format=${format}`;
        if (startDate) url += `&start_date=${startDate}`;
        if (endDate) url += `&end_date=${endDate}`;

        if (format === "csv") {
            // Download CSV file
            window.open(url, "_blank");
        } else {
            // Show JSON data
            fetch(url, { credentials: "same-origin" })
                .then((response) => response.json())
                .then((data) => {
                    const jsonString = JSON.stringify(data, null, 2);
                    const blob = new Blob([jsonString], {
                        type: "application/json",
                    });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = `attendance_export_${new Date().toISOString().split("T")[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                })
                .catch((error) => {
                    console.error("Export error:", error);
                    showToast("error", "Failed to export data");
                });
        }
    }

    function filterSessions() {
        // This function would filter the sessions list based on the selected filters
        // Implementation depends on your specific filtering needs
        renderSessionsList();
    }

    // Placeholder functions for buttons that aren't fully implemented yet
    function endSession() {
        showConfirmModal(
            "End Session",
            "Are you sure you want to end this session?",
            "warning",
            function () {
                // TODO: Implement session ending logic
                showToast("info", "Session ended");
                document.getElementById("active-session-panel").style.display =
                    "none";
            },
        );
    }

    function addAttendanceNote(recordId) {
        // Find the attendance record to get current note
        const currentNote = ""; // We could fetch this if needed

        // Populate the modal
        document.getElementById("attendance-note-id").value = recordId;
        document.getElementById("attendance-note-textarea").value = currentNote;

        // Show the modal
        document.getElementById("attendanceNoteModal").style.display = "block";
    }

    function saveAttendanceNote() {
        const recordId = document.getElementById("attendance-note-id").value;
        const note = document.getElementById("attendance-note-textarea").value;

        fetch(`/api/clubs/${clubId}/attendance/records/${recordId}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            credentials: "same-origin",
            body: JSON.stringify({ notes: note }),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast("success", "Note added successfully");
                    loadSessionAttendance();
                    closeModal("attendanceNoteModal");
                } else {
                    throw new Error(data.error || "Failed to add note");
                }
            })
            .catch((error) => {
                console.error("Error adding note:", error);
                showToast("error", error.message || "Failed to add note");
            });
    }

    function removeAttendance(recordId) {
        showConfirmModal(
            "Remove Attendance",
            "Are you sure you want to remove this attendance record?",
            "danger",
            function () {
                fetch(`/api/clubs/${clubId}/attendance/records/${recordId}`, {
                    method: "DELETE",
                    credentials: "same-origin",
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.success) {
                            showToast("success", "Attendance record removed");
                            loadSessionAttendance();
                        } else {
                            throw new Error(
                                data.error ||
                                    "Failed to remove attendance record",
                            );
                        }
                    })
                    .catch((error) => {
                        console.error("Error removing attendance:", error);
                        showToast(
                            "error",
                            error.message ||
                                "Failed to remove attendance record",
                        );
                    });
            },
        );
    }

    function editGuest(guestId) {
        // Get current guest data
        const guestDiv = document.querySelector(`[data-guest-id="${guestId}"]`);
        if (!guestDiv) return;

        const currentName = guestDiv.querySelector(".guest-name").textContent;
        const currentEmail = guestDiv
            .querySelector(".guest-email")
            .textContent.replace("No email", "");
        const currentOrg =
            guestDiv.querySelector(".guest-org")?.textContent || "";

        // Create a simple edit modal (you could make this more sophisticated)
        const name = prompt("Guest Name:", currentName);
        if (name === null) return;

        const email = prompt("Email (optional):", currentEmail);
        const organization = prompt("Organization (optional):", currentOrg);

        if (name.trim() === "") {
            showToast("error", "Name is required");
            return;
        }

        fetch(`/api/clubs/${clubId}/attendance/guests/${guestId}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            credentials: "same-origin",
            body: JSON.stringify({
                name: name.trim(),
                email: email?.trim() || null,
                organization: organization?.trim() || null,
            }),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast("success", "Guest updated successfully");
                    loadSessionAttendance();
                } else {
                    throw new Error(data.error || "Failed to update guest");
                }
            })
            .catch((error) => {
                console.error("Error updating guest:", error);
                showToast("error", error.message || "Failed to update guest");
            });
    }

    function removeGuest(guestId) {
        showConfirmModal(
            "Remove Guest",
            "Are you sure you want to remove this guest?",
            "danger",
            function () {
                fetch(`/api/clubs/${clubId}/attendance/guests/${guestId}`, {
                    method: "DELETE",
                    credentials: "same-origin",
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.success) {
                            showToast("success", "Guest removed");
                            loadSessionAttendance();
                        } else {
                            throw new Error(
                                data.error || "Failed to remove guest",
                            );
                        }
                    })
                    .catch((error) => {
                        console.error("Error removing guest:", error);
                        showToast(
                            "error",
                            error.message || "Failed to remove guest",
                        );
                    });
            },
        );
    }

    function viewSessionSummary(sessionId) {
        fetch(
            `/api/clubs/${clubId}/attendance/reports?type=session_detail&session_id=${sessionId}`,
            {
                credentials: "same-origin",
            },
        )
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showSessionSummaryModal(data.data);
                } else {
                    throw new Error(
                        data.error || "Failed to load session summary",
                    );
                }
            })
            .catch((error) => {
                console.error("Error loading session summary:", error);
                showToast(
                    "error",
                    error.message || "Failed to load session summary",
                );
            });
    }

    function showSessionSummaryModal(data) {
        const modal = document.getElementById("sessionSummaryModal");
        const session = data.session;
        const stats = data.statistics;

        document.getElementById("summary-session-title").textContent =
            session.title;
        document.getElementById("summary-session-date").textContent = new Date(
            session.session_date,
        ).toLocaleDateString();
        document.getElementById("summary-session-type").textContent =
            session.session_type;

        // Update stats
        document.getElementById("summary-total-members").textContent =
            stats.total_members;
        document.getElementById("summary-total-guests").textContent =
            stats.total_guests;
        document.getElementById("summary-present").textContent = stats.present;
        document.getElementById("summary-late").textContent = stats.late;
        document.getElementById("summary-absent").textContent = stats.absent;
        document.getElementById("summary-excused").textContent = stats.excused;

        // Add notes section if there's a description
        const notesSection = document.getElementById("session-summary-notes");
        if (session.description) {
            notesSection.style.display = "block";
            document.getElementById("summary-notes-content").textContent =
                session.description;
        } else {
            notesSection.style.display = "none";
        }

        modal.style.display = "block";
    }

    function editSession(sessionId) {
        // Get session data and populate edit modal
        const session = sessions.find((s) => s.id === sessionId);
        if (!session) return;

        // Populate edit form - only set values for elements that exist
        const setElementValue = (id, value) => {
            const element = document.getElementById(id);
            if (element) element.value = value || "";
        };

        setElementValue("edit-session-id", sessionId);
        setElementValue("edit-session-title", session.title);
        setElementValue("edit-session-description", session.description);
        setElementValue("edit-session-date", session.session_date);
        setElementValue("edit-session-start-time", session.start_time);
        setElementValue("edit-session-location", session.location);
        setElementValue("edit-session-type", session.session_type || "meeting");

        document.getElementById("editSessionModal").style.display = "block";
    }

    function updateSession() {
        const sessionId = document.getElementById("edit-session-id").value;
        const form = document.getElementById("editSessionForm");
        const formData = new FormData(form);
        const sessionData = Object.fromEntries(formData);

        fetch(`/api/clubs/${clubId}/attendance/sessions/${sessionId}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            credentials: "same-origin",
            body: JSON.stringify(sessionData),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast("success", "Session updated successfully!");
                    closeModal("editSessionModal");
                    loadSessions();
                    form.reset();
                } else {
                    throw new Error(data.error || "Failed to update session");
                }
            })
            .catch((error) => {
                console.error("Error updating session:", error);
                showToast("error", error.message || "Failed to update session");
            });
    }

    function deleteSession(sessionId) {
        showConfirmModal(
            "Delete Session",
            "Are you sure you want to delete this session? This will also delete all attendance records and guests for this session.",
            "danger",
            function () {
                fetch(`/api/clubs/${clubId}/attendance/sessions/${sessionId}`, {
                    method: "DELETE",
                    credentials: "same-origin",
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.success) {
                            showToast(
                                "success",
                                "Session deleted successfully",
                            );
                            loadSessions();
                            renderCalendar();
                        } else {
                            throw new Error(
                                data.error || "Failed to delete session",
                            );
                        }
                    })
                    .catch((error) => {
                        console.error("Error deleting session:", error);
                        showToast(
                            "error",
                            error.message || "Failed to delete session",
                        );
                    });
            },
        );
    }

    function addSessionNotes(sessionId) {
        const session = sessions.find((s) => s.id === sessionId);
        const currentNotes = session?.description || "";

        // Populate the modal with current notes
        document.getElementById("session-notes-id").value = sessionId;
        document.getElementById("session-notes-textarea").value = currentNotes;
        document.getElementById("session-notes-title").textContent =
            session?.title || "Session";

        // Show the modal
        document.getElementById("sessionNotesModal").style.display = "block";
    }

    function saveSessionNotes() {
        const sessionId = document.getElementById("session-notes-id").value;
        const notes = document.getElementById("session-notes-textarea").value;

        fetch(`/api/clubs/${clubId}/attendance/sessions/${sessionId}/notes`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
            },
            credentials: "same-origin",
            body: JSON.stringify({ notes: notes }),
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    showToast("success", "Session notes updated");
                    loadSessions();
                    closeModal("sessionNotesModal");
                } else {
                    throw new Error(data.error || "Failed to update notes");
                }
            })
            .catch((error) => {
                console.error("Error updating notes:", error);
                showToast("error", error.message || "Failed to update notes");
            });
    }

    function showSessionsForDate(sessionsOnDate) {
        const dateStr = sessionsOnDate[0].session_date;
        const formattedDate = new Date(dateStr).toLocaleDateString();

        let html = `<h4>Sessions on ${formattedDate}</h4><div class="date-sessions">`;

        sessionsOnDate.forEach((session) => {
            html += `
                <div class="session-item">
                    <div class="session-info">
                        <h5>${session.title}</h5>
                        <p>${session.session_type}  ${session.start_time || "No time set"}</p>
                        ${session.location ? `<p><i class="fas fa-map-marker-alt"></i> ${session.location}</p>` : ""}
                    </div>
                    <div class="session-actions">
                        <button class="btn btn-sm btn-success" onclick="manageAttendance(${session.id})">
                            <i class="fas fa-users"></i> Attendance
                        </button>
                    </div>
                </div>
            `;
        });

        html += "</div>";

        const modal = document.getElementById("dateSessionsModal");
        document.getElementById("date-sessions-content").innerHTML = html;
        modal.style.display = "block";
    }

    // Initialize when attendance section is shown
    document.addEventListener("DOMContentLoaded", function () {
        // Check if we're on the attendance section
        const navLinks = document.querySelectorAll(".nav-link");
        navLinks.forEach((link) => {
            link.addEventListener("click", function () {
                if (this.dataset.section === "attendance") {
                    setTimeout(() => {
                        initAttendanceManagement();
                    }, 100);
                }
            });
        });

        // Load meetings count for this month
        loadMeetingsCount();
    });

    // Function to load and count meetings scheduled this month
    function loadMeetingsCount() {
        const clubId = {{ club.id }};
        fetch(`/api/clubs/${clubId}/meetings`)
            .then(response => response.json())
            .then(data => {
                console.log('Meetings API response:', data);
                if (data.meetings && Array.isArray(data.meetings)) {
                    // Get current month and year
                    const now = new Date();
                    const currentMonth = now.getMonth(); // getMonth() returns 0-11
                    const currentYear = now.getFullYear();

                    console.log(`Current month: ${currentMonth + 1}/${currentYear}`);

                    // Filter meetings for this month
                    const meetingsThisMonth = data.meetings.filter(meeting => {
                        // Parse the date string (format: YYYY-MM-DD)
                        const meetingDate = new Date(meeting.meeting_date + 'T00:00:00');
                        const meetingMonth = meetingDate.getMonth();
                        const meetingYear = meetingDate.getFullYear();

                        console.log(`Meeting: ${meeting.title} - ${meeting.meeting_date} - Month: ${meetingMonth + 1}, Year: ${meetingYear}`);

                        return meetingMonth === currentMonth && meetingYear === currentYear;
                    });

                    console.log(`Meetings this month: ${meetingsThisMonth.length}`);

                    // Update the count
                    const countElement = document.getElementById('meetingsCount');
                    if (countElement) {
                        countElement.textContent = meetingsThisMonth.length;
                    }
                } else {
                    // If no meetings or error, show 0
                    const countElement = document.getElementById('meetingsCount');
                    if (countElement) {
                        countElement.textContent = '0';
                    }
                }
            })
            .catch(error => {
                console.error('Error loading meetings count:', error);
                // On error, show 0
                const countElement = document.getElementById('meetingsCount');
                if (countElement) {
                    countElement.textContent = '0';
                }
            });
    }
</script>


<div id="createSessionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Schedule Club Meeting</h3>
            <span class="modal-close" onclick="closeModal('createSessionModal')"
                >&times;</span
            >
        </div>
        <div class="modal-body">
            <form
                id="createSessionForm"
                onsubmit="event.preventDefault(); createSession();"
            >
                <div class="form-group">
                    <label for="session-title">Meeting Title</label>
                    <input
                        type="text"
                        id="session-title"
                        name="title"
                        required
                        placeholder="e.g., Weekly Club Meeting"
                    />
                </div>

                <div class="form-group">
                    <label for="session-date">Date</label>
                    <input
                        type="date"
                        id="session-date"
                        name="session_date"
                        required
                    />
                </div>
                <div class="form-group">
                    <label for="session-start-time">Time</label>
                    <input
                        type="time"
                        id="session-start-time"
                        name="start_time"
                        placeholder="Meeting time"
                    />
                </div>

                <div class="form-group">
                    <label for="session-location">Location (optional)</label>
                    <input
                        type="text"
                        id="session-location"
                        name="location"
                        placeholder="e.g., Room 101, Online, Library"
                    />
                </div>

                <div class="form-group">
                    <label for="session-description">Notes (optional)</label>
                    <textarea
                        id="session-description"
                        name="description"
                        rows="2"
                        placeholder="Any additional notes about this meeting..."
                    ></textarea>
                </div>

                <input
                    type="hidden"
                    id="session-type"
                    name="session_type"
                    value="meeting"
                />

                <div class="modal-actions">
                    <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="closeModal('createSessionModal')"
                    >
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-calendar-plus"></i> Schedule Meeting
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="addGuestModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Visitor</h3>
            <span class="modal-close" onclick="closeModal('addGuestModal')"
                >&times;</span
            >
        </div>
        <div class="modal-body">
            <form
                id="addGuestForm"
                onsubmit="event.preventDefault(); addGuest();"
            >
                <div class="form-group">
                    <label for="guest-name">Visitor Name</label>
                    <input
                        type="text"
                        id="guest-name"
                        name="name"
                        required
                        placeholder="Full name"
                    />
                </div>

                <div class="form-group">
                    <label for="guest-organization"
                        >School/Organization (optional)</label
                    >
                    <input
                        type="text"
                        id="guest-organization"
                        name="organization"
                        placeholder="e.g., Lincoln High School"
                    />
                </div>

                <div class="form-group">
                    <label for="guest-notes">Notes (optional)</label>
                    <textarea
                        id="guest-notes"
                        name="notes"
                        rows="2"
                        placeholder="How did they hear about us? Any other notes..."
                    ></textarea>
                </div>

                <input type="hidden" id="guest-email" name="email" value="" />
                <input type="hidden" id="guest-phone" name="phone" value="" />

                <div class="modal-actions">
                    <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="closeModal('addGuestModal')"
                    >
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Add Visitor
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="attendanceReportsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Attendance Reports</h3>
            <span
                class="modal-close"
                onclick="closeModal('attendanceReportsModal')"
                >&times;</span
            >
        </div>
        <div class="modal-body">
            <div class="report-controls">
                <div class="form-row">
                    <div class="form-group">
                        <label for="report-type-select">Report Type</label>
                        <select
                            id="report-type-select"
                            onchange="loadAttendanceReports()"
                        >
                            <option value="summary">Summary Report</option>
                            <option value="member_detail">Member Detail</option>
                            <option value="session_detail">
                                Session Detail
                            </option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="report-start-date">Start Date</label>
                        <input
                            type="date"
                            id="report-start-date"
                            onchange="loadAttendanceReports()"
                        />
                    </div>
                    <div class="form-group">
                        <label for="report-end-date">End Date</label>
                        <input
                            type="date"
                            id="report-end-date"
                            onchange="loadAttendanceReports()"
                        />
                    </div>
                </div>
            </div>

            <div id="report-content" class="report-content">

            </div>
        </div>
    </div>
</div>

<div id="editSessionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit Meeting</h3>
            <span class="modal-close" onclick="closeModal('editSessionModal')"
                >&times;</span
            >
        </div>
        <div class="modal-body">
            <form
                id="editSessionForm"
                onsubmit="event.preventDefault(); updateSession();"
            >
                <input type="hidden" id="edit-session-id" />

                <div class="form-group">
                    <label for="edit-session-title">Meeting Title</label>
                    <input
                        type="text"
                        id="edit-session-title"
                        name="title"
                        required
                    />
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-session-date">Date</label>
                        <input
                            type="date"
                            id="edit-session-date"
                            name="session_date"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="edit-session-start-time">Time</label>
                        <input
                            type="time"
                            id="edit-session-start-time"
                            name="start_time"
                        />
                    </div>
                </div>

                <div class="form-group">
                    <label for="edit-session-location">Location</label>
                    <input
                        type="text"
                        id="edit-session-location"
                        name="location"
                        placeholder="e.g., Room 101, Online, Library"
                    />
                </div>

                <div class="form-group">
                    <label for="edit-session-description">Notes</label>
                    <textarea
                        id="edit-session-description"
                        name="description"
                        rows="2"
                        placeholder="Any additional notes about this meeting..."
                    ></textarea>
                </div>

                <input
                    type="hidden"
                    id="edit-session-type"
                    name="session_type"
                    value="meeting"
                />

                <div class="modal-actions">
                    <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="closeModal('editSessionModal')"
                    >
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Update Meeting
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


<div id="attendanceModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Manage Attendance</h3>
            <span class="modal-close" onclick="closeModal('attendanceModal')"
                >&times;</span
            >
        </div>
        <div class="modal-body">
            <div class="session-info-header">
                <h4 id="attendance-session-title"></h4>
                <p>
                    <i class="fas fa-calendar"></i>
                    <span id="attendance-session-date"></span>
                </p>
            </div>

            <div class="attendance-content">
                <div class="attendance-actions-simple">
                    <button
                        class="btn btn-primary"
                        onclick="addMemberToSession()"
                    >
                        <i class="fas fa-user-plus"></i> Add Member
                    </button>
                    <button
                        class="btn btn-secondary"
                        onclick="addGuestToSession()"
                    >
                        <i class="fas fa-user-friends"></i> Add Guest
                    </button>
                </div>

                <div id="simple-attendance-grid" class="simple-attendance-grid">

                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button
                class="btn btn-secondary"
                onclick="closeModal('attendanceModal')"
            >
                Close
            </button>
        </div>
    </div>
</div>

<div id="sessionSummaryModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Session Summary</h3>
            <span
                class="modal-close"
                onclick="closeModal('sessionSummaryModal')"
                >&times;</span
            >
        </div>
        <div class="modal-body">
            <div class="session-summary-header">
                <h4 id="summary-session-title"></h4>
                <div class="session-meta">
                    <span
                        ><i class="fas fa-calendar"></i>
                        <span id="summary-session-date"></span
                    ></span>
                    <span
                        ><i class="fas fa-tag"></i>
                        <span id="summary-session-type"></span
                    ></span>
                </div>
            </div>

            <div class="summary-stats-grid">
                <div class="summary-stat">
                    <h5 id="summary-total-members">0</h5>
                    <p>Total Members</p>
                </div>
                <div class="summary-stat">
                    <h5 id="summary-total-guests">0</h5>
                    <p>Total Guests</p>
                </div>
                <div class="summary-stat">
                    <h5 id="summary-present">0</h5>
                    <p>Present</p>
                </div>
                <div class="summary-stat">
                    <h5 id="summary-late">0</h5>
                    <p>Late</p>
                </div>
                <div class="summary-stat">
                    <h5 id="summary-absent">0</h5>
                    <p>Absent</p>
                </div>
                <div class="summary-stat">
                    <h5 id="summary-excused">0</h5>
                    <p>Excused</p>
                </div>
            </div>

            <div
                id="session-summary-notes"
                class="session-notes"
                style="display: none"
            >
                <h5>Session Notes</h5>
                <div id="summary-notes-content" class="notes-content"></div>
            </div>
        </div>
    </div>
</div>

<div id="dateSessionsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Sessions</h3>
            <span class="modal-close" onclick="closeModal('dateSessionsModal')"
                >&times;</span
            >
        </div>
        <div class="modal-body">
            <div id="date-sessions-content">

            </div>
        </div>
    </div>
</div>


<div id="sessionNotesModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-sticky-note"></i> Session Notes</h3>
            <span class="modal-close" onclick="closeModal('sessionNotesModal')"
                >&times;</span
            >
        </div>
        <div class="modal-body">
            <input type="hidden" id="session-notes-id" />
            <div class="form-group">
                <label for="session-notes-textarea"
                    >Notes for "<span id="session-notes-title"></span>":</label
                >
                <textarea
                    id="session-notes-textarea"
                    rows="6"
                    placeholder="Add notes or summary for this session..."
                ></textarea>
            </div>
            <div class="modal-actions">
                <button
                    type="button"
                    class="btn btn-secondary"
                    onclick="closeModal('sessionNotesModal')"
                >
                    Cancel
                </button>
                <button
                    type="button"
                    class="btn btn-primary"
                    onclick="saveSessionNotes()"
                >
                    <i class="fas fa-save"></i> Save Notes
                </button>
            </div>
        </div>
    </div>
</div>


<div id="attendanceNoteModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-sticky-note"></i> Attendance Note</h3>
            <span
                class="modal-close"
                onclick="closeModal('attendanceNoteModal')"
                >&times;</span
            >
        </div>
        <div class="modal-body">
            <input type="hidden" id="attendance-note-id" />
            <div class="form-group">
                <label for="attendance-note-textarea"
                    >Note for this attendance record:</label
                >
                <textarea
                    id="attendance-note-textarea"
                    rows="4"
                    placeholder="Add a note for this member's attendance..."
                ></textarea>
            </div>
            <div class="modal-actions">
                <button
                    type="button"
                    class="btn btn-secondary"
                    onclick="closeModal('attendanceNoteModal')"
                >
                    Cancel
                </button>
                <button
                    type="button"
                    class="btn btn-primary"
                    onclick="saveAttendanceNote()"
                >
                    <i class="fas fa-save"></i> Save Note
                </button>
            </div>
        </div>
    </div>
</div>


<style>
    /* Enhanced Attendance Management Styles */
    .attendance-calendar-container {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border);
    }

    .calendar-header h3 {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text);
        margin: 0;
        text-align: center;
        flex: 1;
    }

    .btn-calendar-nav {
        background: linear-gradient(
            135deg,
            var(--primary),
            var(--primary-light)
        );
        border: none;
        color: white;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(236, 55, 80, 0.3);
    }

    .btn-calendar-nav:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(236, 55, 80, 0.4);
    }

    .btn-calendar-nav:active {
        transform: translateY(0);
    }

    .calendar-grid {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
    }

    .calendar-weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        background: linear-gradient(
            135deg,
            var(--primary),
            var(--primary-light)
        );
    }

    .weekday {
        padding: 1rem;
        text-align: center;
        font-weight: 700;
        color: white;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .calendar-days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: var(--border);
    }

    .calendar-day {
        min-height: 80px;
        padding: 0.75rem;
        background: white;
        cursor: pointer;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .calendar-day:hover {
        background: #f0f9ff;
        border-color: var(--primary);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .calendar-day.today {
        background: linear-gradient(135deg, #e3f2fd, #f0f9ff);
        border-color: var(--primary);
        box-shadow: 0 4px 16px rgba(236, 55, 80, 0.2);
    }

    .calendar-day.today .day-number {
        color: var(--primary);
        font-weight: 800;
    }

    .calendar-day.has-session {
        background: linear-gradient(135deg, #e8f5e8, #f0fdf4);
        border-color: var(--success);
    }

    .calendar-day.has-session .day-number {
        color: var(--success);
        font-weight: 700;
    }

    .calendar-day.empty {
        background: #fafafa;
        cursor: default;
        opacity: 0.5;
    }

    .calendar-day.empty:hover {
        transform: none;
        box-shadow: none;
        border-color: transparent;
        background: #fafafa;
    }

    .day-number {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 0.25rem;
    }

    .session-indicator {
        width: 8px;
        height: 8px;
        background: var(--success);
        border-radius: 50%;
        margin-top: auto;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        animation: pulse 2s infinite;
    }

    .calendar-day.has-session.today .session-indicator {
        background: var(--primary);
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
            opacity: 1;
        }
        50% {
            transform: scale(1.2);
            opacity: 0.8;
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    .session-mini-preview {
        font-size: 0.625rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .sessions-container {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .sessions-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .session-filters {
        display: flex;
        gap: 1rem;
    }

    .session-filters select,
    .session-filters input {
        padding: 0.5rem;
        border: 1px solid var(--border);
        border-radius: 6px;
    }

    .sessions-list {
        display: grid;
        gap: 1rem;
    }

    .session-card {
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1rem;
        transition: all 0.2s;
    }

    .session-card:hover {
        border-color: var(--primary);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .session-card.active {
        border-color: var(--success);
        background: #f0fdf4;
    }

    .session-card.past {
        opacity: 0.7;
    }

    .session-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.5rem;
    }

    .session-type {
        background: var(--primary);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
        text-transform: uppercase;
        font-weight: 600;
    }

    .session-details {
        display: flex;
        gap: 1rem;
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .session-stats {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        font-size: 0.875rem;
    }

    .session-actions {
        display: flex;
        gap: 0.5rem;
    }

    .active-session-panel {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--success);
    }

    .session-info h3 {
        margin: 0 0 0.5rem 0;
        color: var(--text);
    }

    .session-meta {
        display: flex;
        gap: 1rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 1rem;
    }

    .attendance-actions {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        align-items: flex-start;
    }

    .member-search {
        position: relative;
        flex: 1;
    }

    .member-search input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 0.875rem;
    }

    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid var(--border);
        border-top: none;
        border-radius: 0 0 8px 8px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 10;
    }

    .search-result-item {
        padding: 0.75rem;
        cursor: pointer;
        border-bottom: 1px solid var(--border);
        transition: background-color 0.2s;
    }

    .search-result-item:hover {
        background: var(--background);
    }

    .search-result-item:last-child {
        border-bottom: none;
    }

    .member-name {
        font-weight: 600;
        display: block;
    }

    .member-email {
        font-size: 0.875rem;
        color: var(--text-secondary);
        display: block;
    }

    .attendance-tabs {
        display: flex;
        border-bottom: 1px solid var(--border);
        margin-bottom: 1rem;
    }

    .tab-btn {
        background: none;
        border: none;
        padding: 0.75rem 1rem;
        cursor: pointer;
        font-weight: 600;
        color: var(--text-secondary);
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
    }

    .tab-btn.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
    }

    .tab-btn span {
        background: var(--border);
        color: var(--text);
        padding: 0.25rem 0.5rem;
        border-radius: 10px;
        font-size: 0.75rem;
        margin-left: 0.5rem;
    }

    .tab-btn.active span {
        background: var(--primary);
        color: white;
    }

    .tab-pane {
        display: none;
    }

    .tab-pane.active {
        display: block;
    }

    .attendance-grid {
        display: grid;
        gap: 0.75rem;
    }

    .attendance-item {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr auto;
        gap: 1rem;
        align-items: center;
        padding: 1rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: white;
    }

    .attendance-item.present {
        border-left: 4px solid var(--success);
    }

    .attendance-item.late {
        border-left: 4px solid var(--warning);
    }

    .attendance-item.absent {
        border-left: 4px solid var(--error);
    }

    .attendance-item.excused {
        border-left: 4px solid var(--info);
    }

    .member-info,
    .guest-info {
        display: flex;
        flex-direction: column;
    }

    .member-name,
    .guest-name {
        font-weight: 600;
        color: var(--text);
    }

    .member-email,
    .guest-email,
    .guest-org {
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .attendance-status select {
        padding: 0.5rem;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: white;
    }

    .attendance-time {
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .attendance-actions {
        display: flex;
        gap: 0.5rem;
    }

    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-outline {
        background: white;
        border: 1px solid var(--border);
        color: var(--text-secondary);
    }

    .btn-outline:hover {
        background: var(--background);
    }

    .btn-danger {
        background: var(--error);
        color: white;
    }

    .btn-danger:hover {
        background: #dc2626;
    }

    .session-controls {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border);
    }

    .empty-state {
        text-align: center;
        padding: 2rem;
        color: var(--text-secondary);
        font-style: italic;
    }

    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 0;
        border-radius: 12px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem;
        border-bottom: 1px solid var(--border);
    }

    .modal-header h3 {
        margin: 0;
    }

    .modal-close {
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-secondary);
    }

    .modal-body {
        padding: 1.5rem;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--text);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        padding: 0.75rem;
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: 0.875rem;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 1.5rem;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }

        .attendance-item {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }

        .session-details {
            flex-direction: column;
            gap: 0.5rem;
        }

        .attendance-actions {
            flex-direction: column;
        }

        .session-controls {
            flex-direction: column;
            gap: 1rem;
        }
    }

    /* Reports Styles */
    .report-controls {
        background: var(--background);
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
    }

    .report-content {
        min-height: 300px;
    }

    .report-summary {
        padding: 1rem;
    }

    .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        text-align: center;
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
    }

    .stat-card h4 {
        font-size: 2rem;
        font-weight: 700;
        margin: 0 0 0.5rem 0;
        color: var(--primary);
    }

    .stat-card p {
        margin: 0;
        color: var(--text-secondary);
        font-weight: 500;
    }

    .member-stats-section,
    .session-types-section {
        margin-bottom: 2rem;
    }

    .member-stats-section h3,
    .session-types-section h3 {
        margin: 0 0 1rem 0;
        color: var(--text);
        border-bottom: 2px solid var(--primary);
        padding-bottom: 0.5rem;
    }

    .member-stats-table {
        overflow-x: auto;
    }

    .member-stats-table table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: var(--shadow);
    }

    .member-stats-table th,
    .member-stats-table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid var(--border);
    }

    .member-stats-table th {
        background: var(--primary);
        color: white;
        font-weight: 600;
    }

    .member-stats-table tr:last-child td {
        border-bottom: none;
    }

    .attendance-rate {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.875rem;
        text-align: center;
    }

    .attendance-rate.good {
        background: #d1fae5;
        color: #065f46;
    }

    .attendance-rate.fair {
        background: #fef3c7;
        color: #92400e;
    }

    .attendance-rate.poor {
        background: #fee2e2;
        color: #991b1b;
    }

    .session-types-chart {
        display: grid;
        gap: 0.75rem;
    }

    .session-type-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: white;
        border-radius: 8px;
        border: 1px solid var(--border);
    }

    .type-name {
        font-weight: 600;
        color: var(--text);
        text-transform: capitalize;
    }

    .type-count {
        background: var(--primary);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.875rem;
    }

    /* Responsive adjustments for reports */
    @media (max-width: 768px) {
        .summary-stats {
            grid-template-columns: 1fr 1fr;
        }

        .stat-card h4 {
            font-size: 1.5rem;
        }

        .member-stats-table {
            font-size: 0.875rem;
        }

        .member-stats-table th,
        .member-stats-table td {
            padding: 0.75rem 0.5rem;
        }
    }

    /* Session Summary Modal Styles */
    .session-summary-header {
        text-align: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border);
    }

    .session-summary-header h4 {
        margin: 0 0 0.5rem 0;
        color: var(--text);
        font-size: 1.5rem;
    }

    .session-summary-header .session-meta {
        display: flex;
        justify-content: center;
        gap: 2rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    .summary-stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .summary-stat {
        background: var(--background);
        padding: 1.5rem;
        border-radius: 8px;
        text-align: center;
        border: 1px solid var(--border);
    }

    .summary-stat h5 {
        font-size: 2rem;
        font-weight: 700;
        margin: 0 0 0.5rem 0;
        color: var(--primary);
    }

    .summary-stat p {
        margin: 0;
        color: var(--text-secondary);
        font-weight: 500;
        font-size: 0.875rem;
    }

    .session-notes {
        background: var(--background);
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid var(--border);
    }

    .session-notes h5 {
        margin: 0 0 1rem 0;
        color: var(--text);
    }

    .notes-content {
        color: var(--text-secondary);
        line-height: 1.6;
        white-space: pre-wrap;
    }

    /* Date Sessions Modal Styles */
    .date-sessions {
        display: grid;
        gap: 1rem;
    }

    .session-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: var(--background);
        border-radius: 8px;
        border: 1px solid var(--border);
    }

    .session-item .session-info h5 {
        margin: 0 0 0.25rem 0;
        color: var(--text);
    }

    .session-item .session-info p {
        margin: 0;
        color: var(--text-secondary);
        font-size: 0.875rem;
    }

    /* Enhanced Session Cards */
    .session-card {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.5rem;
        transition: all 0.3s ease;
        background: white;
        position: relative;
        overflow: hidden;
    }

    .session-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: var(--primary);
        transform: scaleY(0);
        transition: transform 0.3s ease;
    }

    .session-card:hover::before {
        transform: scaleY(1);
    }

    .session-card:hover {
        border-color: var(--primary);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
    }

    .session-card.active::before {
        background: var(--success);
        transform: scaleY(1);
    }

    .session-card.active {
        border-color: var(--success);
        background: linear-gradient(135deg, #f0fdf4, #ffffff);
    }

    .session-card.past {
        opacity: 0.8;
        background: #fafafa;
    }

    .session-header h4 {
        margin: 0 0 0.5rem 0;
        color: var(--text);
        font-size: 1.25rem;
        font-weight: 600;
    }

    .session-type {
        background: linear-gradient(
            135deg,
            var(--primary),
            var(--primary-light)
        );
        color: white;
        padding: 0.375rem 1rem;
        border-radius: 20px;
        font-size: 0.75rem;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 8px rgba(236, 55, 80, 0.3);
    }

    .session-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .session-actions .btn {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 500;
    }

    .btn-sm.btn-info {
        background: var(--info);
        color: white;
    }

    .btn-sm.btn-info:hover {
        background: #0ea5e9;
        transform: translateY(-1px);
    }

    .btn-sm.btn-danger {
        background: var(--error);
        color: white;
    }

    .btn-sm.btn-danger:hover {
        background: #dc2626;
        transform: translateY(-1px);
    }

    /* Simple Attendance Modal Styles */
    .simple-attendance-grid {
        display: grid;
        gap: 1rem;
        margin-top: 1rem;
        max-height: 400px;
        overflow-y: auto;
    }

    .simple-attendance-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e9ecef;
    }

    .attendance-actions-simple {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e9ecef;
    }

    .session-info-header {
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #e9ecef;
    }

    .session-info-header h4 {
        margin: 0 0 0.5rem 0;
        color: #2d3748;
    }

    .session-info-header p {
        margin: 0;
        color: #718096;
    }
        opacity: 0.1;
    }

    .session-info h3 {
        margin: 0 0 1rem 0;
        color: var(--text);
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .session-info h3::before {
        content: "";
        font-size: 0.75em;
        animation: blink 1.5s infinite;
    }

    @keyframes blink {
        0%,
        50% {
            opacity: 1;
        }
        51%,
        100% {
            opacity: 0.3;
        }
    }

    /* Mobile Responsive Improvements */
    @media (max-width: 768px) {
        .calendar-header h3 {
            font-size: 1.25rem;
        }

        .btn-calendar-nav {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }

        .calendar-day {
            min-height: 60px;
            padding: 0.5rem;
        }

        .day-number {
            font-size: 1rem;
        }

        .summary-stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .session-actions .btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }
    }

</style>

{% endblock %}
